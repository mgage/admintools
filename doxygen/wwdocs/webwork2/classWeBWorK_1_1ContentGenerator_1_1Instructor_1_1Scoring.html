<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::ContentGenerator::Instructor::Scoring Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator.html">ContentGenerator</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html">Instructor</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html">Scoring</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::ContentGenerator::Instructor::Scoring Class Reference</h1><!-- doxytag: class="WeBWorK::ContentGenerator::Instructor::Scoring" --><!-- doxytag: inherits="WeBWorK::ContentGenerator::Instructor" --><div class="dynheader">
Inheritance diagram for WeBWorK::ContentGenerator::Instructor::Scoring:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring__inherit__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring_inherit__map" id="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring_inherit__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html" title="WeBWorK::ContentGenerator::Instructor" alt="" coords="31,155,287,181"/><area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="63,80,255,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="117,5,200,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::ContentGenerator::Instructor::Scoring:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring__coll__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring_coll__map" id="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring_coll__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html" title="WeBWorK::ContentGenerator::Instructor" alt="" coords="31,155,287,181"/><area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="63,80,255,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="117,5,200,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a3437588081939cc41469b47eeda86272">writeStandardCSV</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a29c511655f4fdc537e2caa23ae0a7a36">scoreSet</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a82f67d87a8b95f155ea463a11b793dd7">sumScores</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a22d58d739cda75e4234f87b3c3416b8d">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a6a4292d36c6b1e23f5d16655eb3d1fe5">pad</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#ab1b04f78bbe5c479e9030ebb3370525d">body</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a3ccedbb77bdc774871ad5de392fdf86a">everything2normal</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#aaceeb8b554f3b2a3a7ea0445ea513746">quote</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#aae550f47641ccbd8698c990dfe501588">writeCSV</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a899a8c53b687c773aa54fe525e5a364c">everything2totals</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#aecda4ad0a0578b6720011e5a4b42dcc1">unquote</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a49ab12a687b7621b03e74771155a86ca">popup_set_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a3fd9a7fb472fd21a59e425450fffedd9">appendColumns</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a45cd8a6e23731a5acc96e167e294c776">readStandardCSV</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a9253723261ac84a0064c66f04ca4403f">maxLength</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a1b9d3a4f9fec6dd115565264283ded12">everything2info</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#aa500325e3ea6f1550a386c0d34ab2ba6">splitQuoted</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a11bf6f31e619dd7140eef7443fdd8688">everything2full</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a21df7f8d3f6efeb1bf94e68f579cd79f">readCSV</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html">WeBWorK::ContentGenerator::Instructor::Scoring</a> - Generate scoring data files </p>

<p>Definition at line <a class="el" href="ContentGenerator_2Instructor_2Scoring_8pm_source.html#l00018">18</a> of file <a class="el" href="ContentGenerator_2Instructor_2Scoring_8pm_source.html">ContentGenerator/Instructor/Scoring.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a3fd9a7fb472fd21a59e425450fffedd9"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::appendColumns" ref="a3fd9a7fb472fd21a59e425450fffedd9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::appendColumns </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-appendColumns' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-appendColumns-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-appendColumns-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-appendColumns-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in appendColumns: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a3fd9a7fb472fd21a59e425450fffedd9">appendColumns</a> {
    my ($self, $a1, $a2) = @_;
    my @a1 = @$a1;
    my @a2 = @$a2;
    <span class="keywordflow">for</span> (my $i = 0; $i &lt; @a1; $i++) {
        push @{$a1[$i]}, @{$a2[$i]};
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab1b04f78bbe5c479e9030ebb3370525d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::body" ref="ab1b04f78bbe5c479e9030ebb3370525d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::body </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-body' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-body-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-body-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-body-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in body: 119</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#ab1b04f78bbe5c479e9030ebb3370525d">body</a> {
    my ($self)      = @_;
    my $r           = $self-&gt;r;
    my $urlpath     = $r-&gt;urlpath;
    my $ce          = $r-&gt;ce;
    my $authz       = $r-&gt;authz;
    my $scoringDir  = $ce-&gt;{courseDirs}-&gt;{scoring};
    my $courseName  = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $user        = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
    my $scoringPage       = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, courseID =&gt; $courseName);
    my $scoringURL        = $self-&gt;systemLink($scoringPage, authen=&gt;0);
    
    my $scoringDownloadPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::ScoringDownload&quot;</span>, $r,  
                                          courseID =&gt; $courseName
    );
    
    my $scoringFileName = $self-&gt;{scoringFileName};
    
<span class="preprocessor">    # Check permissions</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, <span class="stringliteral">&quot;You are not authorized to access the Instructor tools.&quot;</span>)
        unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
    
    <span class="keywordflow">return</span> CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, <span class="stringliteral">&quot;You are not authorized to score sets.&quot;</span>)
        unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;score_sets&quot;</span>);

    print join(<span class="stringliteral">&quot;&quot;</span>,
            CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$scoringURL),<span class="stringliteral">&quot;\n&quot;</span>,
            $self-&gt;hidden_authen_fields,<span class="stringliteral">&quot;\n&quot;</span>,
            CGI::hidden({-name=&gt;<span class="stringliteral">&#39;scoreSelected&#39;</span>, -value=&gt;1}),
            CGI::start_table({border=&gt;1,}),
                CGI::Tr({},
                    CGI::td($self-&gt;popup_set_form),
                    CGI::td({},
                        CGI::checkbox({ -name=&gt;<span class="stringliteral">&#39;includeIndex&#39;</span>,
                                        -value=&gt;1,
                                        -label=&gt;<span class="stringliteral">&#39;Include Index&#39;</span>,
                                        -checked=&gt;0,
                                       },
                        ),
                        CGI::br(),
<span class="preprocessor">                        # These are not yet implemented</span>
<span class="preprocessor"></span><span class="preprocessor">                        #CGI::checkbox({ -name=&gt;&#39;includeTotals&#39;,</span>
<span class="preprocessor"></span><span class="preprocessor">                        #               -value=&gt;1,</span>
<span class="preprocessor"></span><span class="preprocessor">                        #               -label=&gt;&#39;Include Total score column&#39;,</span>
<span class="preprocessor"></span><span class="preprocessor">                        #               -checked=&gt;1,</span>
<span class="preprocessor"></span><span class="preprocessor">                        #              },</span>
<span class="preprocessor"></span><span class="preprocessor">                        #),</span>
<span class="preprocessor"></span><span class="preprocessor">                        #CGI::br(),</span>
<span class="preprocessor"></span><span class="preprocessor">                        #CGI::checkbox({ -name=&gt;&#39;includePercent&#39;,</span>
<span class="preprocessor"></span><span class="preprocessor">                        #               -value=&gt;1,</span>
<span class="preprocessor"></span><span class="preprocessor">                        #               -label=&gt;&#39;Include Percent correct column&#39;,</span>
<span class="preprocessor"></span><span class="preprocessor">                        #               -checked=&gt;1,</span>
<span class="preprocessor"></span><span class="preprocessor">                        #              },</span>
<span class="preprocessor"></span><span class="preprocessor">                        #),</span>
<span class="preprocessor"></span><span class="preprocessor">                        #CGI::br(),</span>
<span class="preprocessor"></span>                        CGI::checkbox({ -name=&gt;<span class="stringliteral">&#39;recordSingleSetScores&#39;</span>,
                                        -value=&gt;1,
                                        -label=&gt;<span class="stringliteral">&#39;Record Scores for Single Sets&#39;</span>,
                                        -checked=&gt;0,
                                      },
                                     <span class="stringliteral">&#39;Record Scores for Single Sets&#39;</span>
                        ),
                        CGI::br(),
                        CGI::checkbox({ -name=&gt;<span class="stringliteral">&#39;padFields&#39;</span>,
                                        -value=&gt;1,
                                        -label=&gt;<span class="stringliteral">&#39;Pad Fields&#39;</span>,
                                        -checked=&gt;1,
                                      },
                                     <span class="stringliteral">&#39;Pad Fields&#39;</span>
                        ),
                    ),
                ),
                CGI::Tr(CGI::td({colspan =&gt;2,align=&gt;<span class="stringliteral">&#39;center&#39;</span>},
                    CGI::input({type=&gt;<span class="stringliteral">&#39;submit&#39;</span>,value=&gt;<span class="stringliteral">&#39;Score selected set(s) and save to: &#39;</span>,name=&gt;<span class="stringliteral">&#39;score-sets&#39;</span>}),
                    CGI::input({type=&gt;<span class="stringliteral">&#39;text&#39;</span>, name=&gt;<span class="stringliteral">&#39;scoringFileName&#39;</span>, size=&gt;<span class="stringliteral">&#39;40&#39;</span>,value=&gt;<span class="stringliteral">&quot;$scoringFileName&quot;</span>})
                )),
            
           CGI::end_table(),
           CGI::end_form(),
    );

    
    <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;score_sets&quot;</span>)) {
        my @selected = $r-&gt;param(<span class="stringliteral">&#39;selectedSet&#39;</span>);
        <span class="keywordflow">if</span> (@selected) {
            print CGI::p(<span class="stringliteral">&quot;All of these files will also be made available for mail merge&quot;</span>);
        } 
        <span class="keywordflow">foreach</span> my $setID (@selected) {
    
            my @validFiles;
            <span class="keywordflow">foreach</span> my $type (<span class="stringliteral">&quot;scr&quot;</span>, <span class="stringliteral">&quot;ful&quot;</span>) {
                my $filename = <span class="stringliteral">&quot;s$setID$type.csv&quot;</span>;
                my $path = <span class="stringliteral">&quot;$scoringDir/$filename&quot;</span>;
                push @validFiles, $filename <span class="keywordflow">if</span> -f $path;
            }
            <span class="keywordflow">if</span> (@validFiles) {
                print CGI::h2(<span class="stringliteral">&quot;$setID&quot;</span>);
                <span class="keywordflow">foreach</span> my $filename (@validFiles) {
<span class="preprocessor">                    #print CGI::a({href=&gt;&quot;../scoringDownload/?getFile=${filename}&amp;&quot;.$self-&gt;url_authen_args}, $filename);</span>
<span class="preprocessor"></span>                    print CGI::a({href=&gt;$self-&gt;systemLink($scoringDownloadPage,
                                   params=&gt;{getFile =&gt; $filename } )}, $filename);
                    print CGI::br();
                }
                print CGI::hr();
            }
        }
        <span class="keywordflow">if</span> (-f <span class="stringliteral">&quot;$scoringDir/$scoringFileName&quot;</span>) {
            print CGI::h2(<span class="stringliteral">&quot;Totals&quot;</span>);
<span class="preprocessor">            #print CGI::a({href=&gt;&quot;../scoringDownload/?getFile=${courseName}_totals.csv&amp;&quot;.$self-&gt;url_authen_args}, &quot;${courseName}_totals.csv&quot;);</span>
<span class="preprocessor"></span>            print CGI::a({href=&gt;$self-&gt;systemLink($scoringDownloadPage,
                                   params=&gt;{getFile =&gt; <span class="stringliteral">&quot;$scoringFileName&quot;</span> } )}, <span class="stringliteral">&quot;$scoringFileName&quot;</span>);
            print CGI::hr();
            print CGI::pre({style=&gt;<span class="stringliteral">&#39;font-size:smaller&#39;</span>},<a class="code" href="classWeBWorK_1_1Utils.html#a7aa337cd97110ff3e5c7536bfb1a84e8">WeBWorK::Utils::readFile</a>(<span class="stringliteral">&quot;$scoringDir/$scoringFileName&quot;</span>));
        }
    }
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a11bf6f31e619dd7140eef7443fdd8688"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::everything2full" ref="a11bf6f31e619dd7140eef7443fdd8688" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::everything2full </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-everything2full' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-everything2full-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-everything2full-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-everything2full-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in everything2full: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a11bf6f31e619dd7140eef7443fdd8688">everything2full</a> {
    my ($self, @everything) = @_;
    my @result = ();
    <span class="keywordflow">foreach</span> my $row (@everything) {
        push @result, [@{$row}[0..($#{$row}-1)]];
    }
    <span class="keywordflow">return</span> @result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1b9d3a4f9fec6dd115565264283ded12"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::everything2info" ref="a1b9d3a4f9fec6dd115565264283ded12" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::everything2info </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-everything2info' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-everything2info-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-everything2info-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-everything2info-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in everything2info: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a1b9d3a4f9fec6dd115565264283ded12">everything2info</a> {
    my ($self, @everything) = @_;
    my @result = ();
    <span class="keywordflow">foreach</span> my $row (@everything) {
        push @result, [@{$row}[0..4]];
    }
    <span class="keywordflow">return</span> @result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3ccedbb77bdc774871ad5de392fdf86a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::everything2normal" ref="a3ccedbb77bdc774871ad5de392fdf86a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::everything2normal </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-everything2normal' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-everything2normal-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-everything2normal-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-everything2normal-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in everything2normal: 15</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a3ccedbb77bdc774871ad5de392fdf86a">everything2normal</a> {
    my ($self, @everything) = @_;
    my @result = ();
    <span class="keywordflow">foreach</span> my $row (@everything) {
        my @row = @$row;
        my @newRow = ();
        push @newRow, @row[0..4];
        <span class="keywordflow">for</span> (my $i = 5; $i &lt; @row; $i+=3) {
            push @newRow, $row[$i];
        }
<span class="preprocessor">        #push @newRow, $row[$#row];</span>
<span class="preprocessor"></span>        push @result, [@newRow];
    }
    <span class="keywordflow">return</span> @result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a899a8c53b687c773aa54fe525e5a364c"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::everything2totals" ref="a899a8c53b687c773aa54fe525e5a364c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::everything2totals </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-everything2totals' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-everything2totals-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-everything2totals-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-everything2totals-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in everything2totals: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a899a8c53b687c773aa54fe525e5a364c">everything2totals</a> {
    my ($self, @everything) = @_;
    my @result = ();
    <span class="keywordflow">foreach</span> my $row (@everything) {
        push @result, [${$row}[$#{$row}]];
    }
    <span class="keywordflow">return</span> @result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a22d58d739cda75e4234f87b3c3416b8d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::initialize" ref="a22d58d739cda75e4234f87b3c3416b8d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in initialize: 93</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a22d58d739cda75e4234f87b3c3416b8d">initialize</a> {
    my ($self)     = @_;
    my $r          = $self-&gt;r;
    my $urlpath    = $r-&gt;urlpath;
    my $ce         = $r-&gt;ce;
    my $db         = $r-&gt;db;
    my $authz      = $r-&gt;authz;
    my $scoringDir = $ce-&gt;{courseDirs}-&gt;{scoring};
    my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $user       = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
<span class="preprocessor">    # Check permission</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
    <span class="keywordflow">return</span> unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;score_sets&quot;</span>);
    
    my @selected = $r-&gt;param(<span class="stringliteral">&#39;selectedSet&#39;</span>);
    my $scoreSelected = $r-&gt;param(<span class="stringliteral">&#39;scoreSelected&#39;</span>);
    my $scoringFileName = $r-&gt;param(<span class="stringliteral">&#39;scoringFileName&#39;</span>) || <span class="stringliteral">&quot;${courseName}_totals&quot;</span>;
    $scoringFileName =~ s/\.csv\s*$<span class="comment">//; $scoringFileName .=&#39;.csv&#39;;  # must end in .csv</span>
    $self-&gt;{scoringFileName}=$scoringFileName;
    
    $self-&gt;{padFields}  = defined($r-&gt;param(<span class="stringliteral">&#39;padFields&#39;</span>) ) ? 1 : 0; 
    
    <span class="keywordflow">if</span> (defined $scoreSelected &amp;&amp; @selected) {

        my @totals                 = ();
        my $recordSingleSetScores  = $r-&gt;param(<span class="stringliteral">&#39;recordSingleSetScores&#39;</span>);
        
<span class="preprocessor">        # pre-fetch users</span>
<span class="preprocessor"></span>        debug(<span class="stringliteral">&quot;pre-fetching users&quot;</span>);
<span class="preprocessor">        # DBFIXME shouldn&#39;t need ID list</span>
<span class="preprocessor"></span>        my @Users = $db-&gt;getUsers($db-&gt;listUsers);
        my %Users;
        <span class="keywordflow">foreach</span> my $User (@Users) {
            next unless $User;
            next unless $ce-&gt;status_abbrev_has_behavior($User-&gt;status, <span class="stringliteral">&quot;include_in_scoring&quot;</span>);
            $Users{$User-&gt;user_id} = $User;
        }
<span class="preprocessor">        # DBFIXME use an ORDER BY clause in the database</span>
<span class="preprocessor"></span>        my @sortedUserIDs = sort { 
            lc($Users{$a}-&gt;last_name) cmp lc($Users{$b}-&gt;last_name) 
                ||
            lc($Users{$a}-&gt;first_name) cmp lc($Users{$b}-&gt;first_name)
                ||
            lc($Users{$a}-&gt;user_id) cmp lc($Users{$b}-&gt;user_id)
            }

            keys %Users;
<span class="preprocessor">        #my @userInfo = (\%Users, \@sortedUserIDs);</span>
<span class="preprocessor"></span>        debug(<span class="stringliteral">&quot;done pre-fetching users&quot;</span>);
        
        my $scoringType            = ($recordSingleSetScores) ?<span class="stringliteral">&#39;everything&#39;</span>:<span class="stringliteral">&#39;totals&#39;</span>;
        my (@everything, @normal,@full,@info,@totalsColumn);
        @info             = $self-&gt;scoreSet($selected[0], <span class="stringliteral">&quot;info&quot;</span>, undef, \%Users, \@sortedUserIDs) <span class="keywordflow">if</span> defined($selected[0]);
        @totals           = @info;
        my $showIndex     = defined($r-&gt;param(<span class="stringliteral">&#39;includeIndex&#39;</span>)) ? defined($r-&gt;param(<span class="stringliteral">&#39;includeIndex&#39;</span>)) : 0; 
        
     
        <span class="keywordflow">foreach</span> my $setID (@selected) {
            next unless defined $setID;
            <span class="keywordflow">if</span> ($scoringType eq <span class="stringliteral">&#39;everything&#39;</span>) {
                @everything = $self-&gt;scoreSet($setID, <span class="stringliteral">&quot;everything&quot;</span>, $showIndex, \%Users, \@sortedUserIDs);
                @normal = $self-&gt;everything2normal(@everything);
                @full = $self-&gt;everything2full(@everything);
                @info = $self-&gt;everything2info(@everything);
                @totalsColumn = $self-&gt;everything2totals(@everything);
                $self-&gt;appendColumns(\@totals, \@totalsColumn);
                $self-&gt;writeCSV(<span class="stringliteral">&quot;$scoringDir/s${setID}scr.csv&quot;</span>, @normal);
                $self-&gt;writeCSV(<span class="stringliteral">&quot;$scoringDir/s${setID}ful.csv&quot;</span>, @full);             
            } <span class="keywordflow">else</span> {
                @totalsColumn  = $self-&gt;scoreSet($setID, <span class="stringliteral">&quot;totals&quot;</span>, $showIndex, \%Users, \@sortedUserIDs);
                $self-&gt;appendColumns(\@totals, \@totalsColumn);
            }   
        }
        my @sum_scores  = $self-&gt;sumScores(\@totals, $showIndex, \%Users, \@sortedUserIDs);
        $self-&gt;appendColumns( \@totals,\@sum_scores);
        $self-&gt;writeCSV(<span class="stringliteral">&quot;$scoringDir/$scoringFileName&quot;</span>, @totals);

    } elsif (defined $scoreSelected) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You must select one or more sets for scoring&quot;</span>);
    } 
    
<span class="preprocessor">    # Obtaining list of sets:</span>
<span class="preprocessor"></span>    my @setNames =  $db-&gt;listGlobalSets();
    my @set_records = ();
<span class="preprocessor">    # DBFIXME shouldn&#39;t need ID list</span>
<span class="preprocessor"></span>    @set_records = $db-&gt;getGlobalSets( @setNames); 
    
    
<span class="preprocessor">    # store data</span>
<span class="preprocessor"></span>    $self-&gt;{ra_sets}              =   \@setNames; # ra_sets IS NEVER USED AGAIN!!!!!
    $self-&gt;{ra_set_records}       =   \@set_records;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a9253723261ac84a0064c66f04ca4403f"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::maxLength" ref="a9253723261ac84a0064c66f04ca4403f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::maxLength </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-maxLength' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-maxLength-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-maxLength-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-maxLength-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in maxLength: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a9253723261ac84a0064c66f04ca4403f">maxLength</a> {
    my ($self, $arrayRef) = @_;
    my $max = 0;
    <span class="keywordflow">foreach</span> my $cell (@$arrayRef) {
        $max = length $cell unless length $cell &lt; $max;
    }
    <span class="keywordflow">return</span> $max;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a6a4292d36c6b1e23f5d16655eb3d1fe5"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::pad" ref="a6a4292d36c6b1e23f5d16655eb3d1fe5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::pad </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-pad' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-pad-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-pad-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-pad-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in pad: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a6a4292d36c6b1e23f5d16655eb3d1fe5">pad</a> {
    my ($self, $string, $padTo) = @_;
    $string = <span class="stringliteral">&#39;&#39;</span> unless defined $string;
    <span class="keywordflow">return</span> $string unless $self-&gt;{padFields}==1;
    my $spaces = $padTo - length $string;

<span class="preprocessor">#   return &quot; &quot;x$spaces.$string;</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> $string.<span class="stringliteral">&quot; &quot;</span>x$spaces;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a49ab12a687b7621b03e74771155a86ca"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::popup_set_form" ref="a49ab12a687b7621b03e74771155a86ca" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::popup_set_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-popup_set_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-popup_set_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-popup_set_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-popup_set_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in popup_set_form: 32</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a49ab12a687b7621b03e74771155a86ca">popup_set_form</a> {
    my $self  = shift;
    my $r     = $self-&gt;r;   
    my $db    = $r-&gt;db;
    my $ce    = $r-&gt;ce;
    my $authz = $r-&gt;authz;
    my $user  = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);

    my $root = $ce-&gt;{webworkURLs}-&gt;{root};
    my $courseName = $ce-&gt;{courseName};

<span class="preprocessor"> #     return CGI::em(&quot;You are not authorized to access the Instructor tools.&quot;) unless $authz-&gt;hasPermissions($user, &quot;access_instructor_tools&quot;);</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # This code will require changing if the permission and user tables ever have different keys.</span>
<span class="preprocessor"></span>    my @setNames              = ();
    my $ra_set_records        = $self-&gt;{ra_set_records};
    my %setLabels             = ();#  %$hr_classlistLabels;
    my @set_records           =  sort {$a-&gt;set_id cmp $b-&gt;set_id } @{$ra_set_records};
    <span class="keywordflow">foreach</span> my $sr (@set_records) {
        $setLabels{$sr-&gt;set_id} = $sr-&gt;set_id;
        push(@setNames, $sr-&gt;set_id);  # reorder sets
    }
    <span class="keywordflow">return</span>          CGI::popup_menu(-name=&gt;<span class="stringliteral">&#39;selectedSet&#39;</span>,
                               -values=&gt;\@setNames,
                               -labels=&gt;\%setLabels,
                               -size  =&gt; 10,
                               -multiple =&gt; 1,
                               #-<span class="keywordflow">default</span>=&gt;$user
                    ),


}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aaceeb8b554f3b2a3a7ea0445ea513746"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::quote" ref="aaceeb8b554f3b2a3a7ea0445ea513746" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::quote </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-quote' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-quote-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-quote-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-quote-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in quote: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#aaceeb8b554f3b2a3a7ea0445ea513746">quote</a> {
    my ($self, $string) = @_;
    <span class="keywordflow">if</span> ($string =~ m/[<span class="stringliteral">&quot;, ]/) {</span>
<span class="stringliteral">        $string =~ s/&quot;</span>/<span class="stringliteral">&quot;&quot;</span>/;
        $string = <span class="stringliteral">&quot;\&quot;$string\&quot;&quot;</span>;
    }
    <span class="keywordflow">return</span> $string;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a21df7f8d3f6efeb1bf94e68f579cd79f"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::readCSV" ref="a21df7f8d3f6efeb1bf94e68f579cd79f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::readCSV </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-readCSV' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-readCSV-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-readCSV-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-readCSV-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in readCSV: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a21df7f8d3f6efeb1bf94e68f579cd79f">readCSV</a> {
    my ($self, $fileName) = @_;
    my @result = ();
    my @rows = split m/\n/, readFile($fileName);
    <span class="keywordflow">foreach</span> my $row (@rows) {
        push @result, [split m/\s*,\s*/, $row];
    }
    <span class="keywordflow">return</span> @result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a45cd8a6e23731a5acc96e167e294c776"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::readStandardCSV" ref="a45cd8a6e23731a5acc96e167e294c776" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::readStandardCSV </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-readStandardCSV' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-readStandardCSV-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-readStandardCSV-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-readStandardCSV-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in readStandardCSV: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a45cd8a6e23731a5acc96e167e294c776">readStandardCSV</a> {
    my ($self, $fileName) = @_;
    my @result = ();
    my @rows = split m/\n/, readFile($fileName);
    <span class="keywordflow">foreach</span> my $row (@rows) {
        push @result, [$self-&gt;splitQuoted($row)];
    }
    <span class="keywordflow">return</span> @result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a29c511655f4fdc537e2caa23ae0a7a36"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::scoreSet" ref="a29c511655f4fdc537e2caa23ae0a7a36" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::scoreSet </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-scoreSet' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-scoreSet-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-scoreSet-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-scoreSet-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in scoreSet: 278</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a29c511655f4fdc537e2caa23ae0a7a36">scoreSet</a> {
    my ($self, $setID, $format, $showIndex, $UsersRef, $sortedUserIDsRef) = @_;
    my $r  = $self-&gt;r;
    my $db = $r-&gt;db;
    my @scoringData;
    my $scoringItems   = {    info             =&gt; 0,
                              successIndex     =&gt; 0,
                              setTotals        =&gt; 0,
                              problemScores    =&gt; 0,
                              problemAttempts  =&gt; 0, 
                              <a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">header</a>           =&gt; 0,
    };
    $format = <span class="stringliteral">&quot;normal&quot;</span> unless defined $format;
    $format = <span class="stringliteral">&quot;normal&quot;</span> unless $format eq <span class="stringliteral">&quot;full&quot;</span> or $format eq <span class="stringliteral">&quot;everything&quot;</span> or $format eq <span class="stringliteral">&quot;totals&quot;</span> or $format eq <span class="stringliteral">&quot;info&quot;</span>;
    my $columnsPerProblem = ($format eq <span class="stringliteral">&quot;full&quot;</span> or $format eq <span class="stringliteral">&quot;everything&quot;</span>) ? 3 : 1;
    
<span class="preprocessor">    # DBFIXME these have already been fetched in ra_set_records</span>
<span class="preprocessor"></span>    my $setRecord = $db-&gt;getGlobalSet($setID); #checked
    die <span class="stringliteral">&quot;global set $setID not found. &quot;</span> unless $setRecord;
<span class="preprocessor">    #my %users;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my %userStudentID=();</span>
<span class="preprocessor"></span><span class="preprocessor">    #foreach my $userID ($db-&gt;listUsers()) {</span>
<span class="preprocessor"></span><span class="preprocessor">    #   my $userRecord = $db-&gt;getUser($userID); # checked</span>
<span class="preprocessor"></span><span class="preprocessor">    #   die &quot;user record for $userID not found&quot; unless $userID;</span>
<span class="preprocessor"></span><span class="preprocessor">    #   # FIXME: if two users have the same student ID, the second one will</span>
<span class="preprocessor"></span><span class="preprocessor">    #   # clobber the first one. this is bad!</span>
<span class="preprocessor"></span><span class="preprocessor">    #   # The key is what we&#39;d like to sort by.</span>
<span class="preprocessor"></span><span class="preprocessor">    #   $users{$userRecord-&gt;student_id} = $userRecord;</span>
<span class="preprocessor"></span><span class="preprocessor">    #   $userStudentID{$userID} = $userRecord-&gt;student_id;</span>
<span class="preprocessor"></span><span class="preprocessor">    #}</span>
<span class="preprocessor"></span>    
    my %Users = %$UsersRef; # user objects hashed on user ID
    my @sortedUserIDs = @$sortedUserIDsRef; # user IDs sorted by student ID
    
    my @problemIDs = $db-&gt;listGlobalProblems($setID);

<span class="preprocessor">    # determine what information will be returned</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($format eq <span class="stringliteral">&#39;normal&#39;</span>) {
        $scoringItems  = {    info             =&gt; 1,
                              successIndex     =&gt; $showIndex,
                              setTotals        =&gt; 1,
                              problemScores    =&gt; 1,
                              problemAttempts  =&gt; 0, 
                              <a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">header</a>           =&gt; 1,
        };
    } elsif ($format eq <span class="stringliteral">&#39;full&#39;</span>) {
        $scoringItems  = {    info             =&gt; 1,
                              successIndex     =&gt; $showIndex,
                              setTotals        =&gt; 0,
                              problemScores    =&gt; 1,
                              problemAttempts  =&gt; 1, 
                              <a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">header</a>           =&gt; 1,
        };
    } elsif ($format eq <span class="stringliteral">&#39;everything&#39;</span>) {
        $scoringItems  = {    info             =&gt; 1,
                              successIndex     =&gt; $showIndex,
                              setTotals        =&gt; 1,
                              problemScores    =&gt; 1,
                              problemAttempts  =&gt; 1, 
                              <a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">header</a>           =&gt; 1,
        };
    } elsif ($format eq <span class="stringliteral">&#39;totals&#39;</span>) {
        $scoringItems  = {    info             =&gt; 0,
                              successIndex     =&gt; $showIndex,
                              setTotals        =&gt; 1,
                              problemScores    =&gt; 0,
                              problemAttempts  =&gt; 0, 
                              <a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">header</a>           =&gt; 0,
        };
    } elsif ($format eq <span class="stringliteral">&#39;info&#39;</span>) {
        $scoringItems  = {    info             =&gt; 0,
                              successIndex     =&gt; 0,
                              setTotals        =&gt; 0,
                              problemScores    =&gt; 0,
                              problemAttempts  =&gt; 0, 
                              <a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">header</a>           =&gt; 1,
        };
    } <span class="keywordflow">else</span> {
        warn <span class="stringliteral">&quot;unrecognized format&quot;</span>;
    }
    
<span class="preprocessor">    # Initialize a two-dimensional array of the proper size</span>
<span class="preprocessor"></span>    <span class="keywordflow">for</span> (my $i = 0; $i &lt; @sortedUserIDs + 7; $i++) { # 7 is how many descriptive fields there are in each column
        push @scoringData, [];
    }
    
<span class="preprocessor">    #my @userKeys = sort keys %users; # list of &quot;student IDs&quot; NOT user IDs</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> ($scoringItems-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">header</a>}) {
        $scoringData[0][0] = <span class="stringliteral">&quot;NO OF FIELDS&quot;</span>;
        $scoringData[1][0] = <span class="stringliteral">&quot;SET NAME&quot;</span>;
        $scoringData[2][0] = <span class="stringliteral">&quot;PROB NUMBER&quot;</span>;
        $scoringData[3][0] = <span class="stringliteral">&quot;DUE DATE&quot;</span>;
        $scoringData[4][0] = <span class="stringliteral">&quot;DUE TIME&quot;</span>;
        $scoringData[5][0] = <span class="stringliteral">&quot;PROB VALUE&quot;</span>;

    
    
<span class="preprocessor">    # Write identifying information about the users</span>
<span class="preprocessor"></span>
        <span class="keywordflow">for</span> (my $field=0; $field &lt; @userInfoFields; $field++) {
            <span class="keywordflow">if</span> ($field &gt; 0) {
                <span class="keywordflow">for</span> (my $i = 0; $i &lt; 6; $i++) {
                    $scoringData[$i][$field] = <span class="stringliteral">&quot;&quot;</span>;
                }
            }
            $scoringData[6][$field] = $userInfoColumnHeadings[$field];
            <span class="keywordflow">for</span> (my $user = 0; $user &lt; @sortedUserIDs; $user++) {
                my $fieldName = $userInfoFields[$field];
                $scoringData[$user + 7][$field] = $Users{$sortedUserIDs[$user]}-&gt;$fieldName;
            }
        }
    }
    <span class="keywordflow">return</span> @scoringData <span class="keywordflow">if</span> $format eq <span class="stringliteral">&quot;info&quot;</span>;
    
<span class="preprocessor">    # pre-fetch global problems</span>
<span class="preprocessor"></span>    debug(<span class="stringliteral">&quot;pre-fetching global problems for set $setID&quot;</span>);
    my %GlobalProblems = map { $_-&gt;problem_id =&gt; $_ }
        $db-&gt;getAllGlobalProblems($setID);
    debug(<span class="stringliteral">&quot;done pre-fetching global problems for set $setID&quot;</span>);
    
<span class="preprocessor">    # pre-fetch user problems</span>
<span class="preprocessor"></span>    debug(<span class="stringliteral">&quot;pre-fetching user problems for set $setID&quot;</span>);
    my %UserProblems; # $UserProblems{$userID}{$problemID}

<span class="preprocessor">  # Gateway change here: for non-gateway (non-versioned) sets, we just </span>
<span class="preprocessor"></span><span class="preprocessor">  # get each user&#39;s problems.  For gateway (versioned) sets, we get the </span>
<span class="preprocessor"></span><span class="preprocessor">  # user&#39;s best version and return that</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ! defined( $setRecord-&gt;assignment_type() ) ||
         $setRecord-&gt;assignment_type() !~ /gateway/ ) {
        <span class="keywordflow">foreach</span> my $userID (@sortedUserIDs) {
            my %CurrUserProblems = map { $_-&gt;problem_id =&gt; $_ }
                $db-&gt;getAllMergedUserProblems($userID, $setID);
            $UserProblems{$userID} = \%CurrUserProblems;
        }
    } <span class="keywordflow">else</span> {  # versioned sets; <span class="keyword">get</span> the problems <span class="keywordflow">for</span> the best version 

        <span class="keywordflow">foreach</span> my $userID (@sortedUserIDs) {
            my $CurrUserProblems = {};
            my @versionNums = $db-&gt;listSetVersions($userID,$setID);

            my $bestScore = -1;

            <span class="keywordflow">if</span> ( @versionNums ) {
                <span class="keywordflow">for</span> my $i ( @versionNums ) {
                my %versionUserProblems = map { $_-&gt;problem_id =&gt; $_ }
                    $db-&gt;getAllMergedProblemVersions( $userID, $setID, $i );
                my $score = 0;
                <span class="keywordflow">foreach</span> ( values ( %versionUserProblems ) ) {
                    my $status = $_-&gt;status || 0;
                    my $value = $_-&gt;value || 1;
<span class="preprocessor">                # some of these are coming in null; I&#39;m not</span>
<span class="preprocessor"></span><span class="preprocessor">                # why, or if this should be necessary</span>
<span class="preprocessor"></span>                    $_-&gt;status($status);
                    $_-&gt;value($value);
                    $score += $status*$value;
                }
                <span class="keywordflow">if</span> ( $score &gt; $bestScore ) {
                    $CurrUserProblems = \%versionUserProblems;
                    $bestScore = $score;
                }
                }
            } <span class="keywordflow">else</span> {
                my %cp = map { $_-&gt;problem_id =&gt; $_ }
                $db-&gt;getAllMergedUserProblems($userID, $setID);
                $CurrUserProblems = \%cp;
            }
            $UserProblems{$userID} = { %{$CurrUserProblems} };
        }
    }
    debug(<span class="stringliteral">&quot;done pre-fetching user problems for set $setID&quot;</span>);
    
<span class="preprocessor">    # Write the problem data</span>
<span class="preprocessor"></span>    my $dueDateString = $self-&gt;formatDateTime($setRecord-&gt;due_date);
    my ($dueDate, $dueTime) = $dueDateString =~ m/^([^\s]*)\s*([^\s]*)$/;
    my $valueTotal = 0;
    my %userStatusTotals = ();
    my %userSuccessIndex = ();
    my %numberOfAttempts = ();
    my $num_of_problems  = @problemIDs;
    <span class="keywordflow">for</span> (my $problem = 0; $problem &lt; @problemIDs; $problem++) {
        
<span class="preprocessor">        #my $globalProblem = $db-&gt;getGlobalProblem($setID, $problemIDs[$problem]); #checked</span>
<span class="preprocessor"></span>        my $globalProblem = $GlobalProblems{$problemIDs[$problem]};
        die <span class="stringliteral">&quot;global problem $problemIDs[$problem] not found for set $setID&quot;</span> unless $globalProblem;
        
        my $column = 5 + $problem * $columnsPerProblem;
        <span class="keywordflow">if</span> ($scoringItems-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">header</a>}) {
            $scoringData[0][$column] = <span class="stringliteral">&quot;&quot;</span>;
            $scoringData[1][$column] = $setRecord-&gt;set_id;
            $scoringData[2][$column] = $globalProblem-&gt;problem_id;
            $scoringData[3][$column] = $dueDate;
            $scoringData[4][$column] = $dueTime;
            $scoringData[5][$column] = $globalProblem-&gt;value;
            $scoringData[6][$column] = <span class="stringliteral">&quot;STATUS&quot;</span>;
            <span class="keywordflow">if</span> ($scoringItems-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">header</a>} and $scoringItems-&gt;{problemAttempts}) { # Fill in with blanks, or maybe the problem number
                <span class="keywordflow">for</span> (my $row = 0; $row &lt; 6; $row++) {
                    <span class="keywordflow">for</span> (my $col = $column+1; $col &lt;= $column + 2; $col++) {
                        <span class="keywordflow">if</span> ($row == 2) {
                            $scoringData[$row][$col] = $globalProblem-&gt;problem_id;
                        } <span class="keywordflow">else</span> {
                            $scoringData[$row][$col] = <span class="stringliteral">&quot;&quot;</span>;
                        }
                    }
                }
                $scoringData[6][$column + 1] = <span class="stringliteral">&quot;#corr&quot;</span>;
                $scoringData[6][$column + 2] = <span class="stringliteral">&quot;#incorr&quot;</span>;
            }
        }
        $valueTotal += $globalProblem-&gt;value;
        
        
        <span class="keywordflow">for</span> (my $user = 0; $user &lt; @sortedUserIDs; $user++) {
<span class="preprocessor">            #my $userProblem = $userProblems{    $users{$userKeys[$user]}-&gt;user_id   };</span>
<span class="preprocessor"></span><span class="preprocessor">            #my $userProblem = $UserProblems{$sers{$userKeys[$user]}-&gt;user_id}{$problemIDs[$problem]};</span>
<span class="preprocessor"></span>            my $userProblem = $UserProblems{$sortedUserIDs[$user]}{$problemIDs[$problem]};
            unless (defined $userProblem) { # assume an empty problem record <span class="keywordflow">if</span> the problem isn<span class="stringliteral">&#39;t assigned to this user</span>
<span class="stringliteral">                $userProblem = $db-&gt;newUserProblem;</span>
<span class="stringliteral">                $userProblem-&gt;status(0);</span>
<span class="stringliteral">                $userProblem-&gt;value(0);</span>
<span class="stringliteral">                $userProblem-&gt;num_correct(0);</span>
<span class="stringliteral">                $userProblem-&gt;num_incorrect(0);</span>
<span class="stringliteral">            }</span>
<span class="stringliteral">            $userStatusTotals{$user} = 0 unless exists $userStatusTotals{$user};</span>
<span class="stringliteral">            my $user_problem_status          = ($userProblem-&gt;status =~/^[\d\.]+$/) ? $userProblem-&gt;status : 0; # ensure it&#39;</span>s numeric
            $userStatusTotals{$user}        += $user_problem_status * $userProblem-&gt;value;  
            <span class="keywordflow">if</span> ($scoringItems-&gt;{successIndex})   {
                $numberOfAttempts{$user}  = 0 unless defined($numberOfAttempts{$user});
                my $num_correct     = $userProblem-&gt;num_correct;
                my $num_incorrect   = $userProblem-&gt;num_incorrect;
                $num_correct        = ( defined($num_correct) and $num_correct) ? $num_correct : 0;
                $num_incorrect      = ( defined($num_incorrect) and $num_incorrect) ? $num_incorrect : 0;
                $numberOfAttempts{$user} += $num_correct + $num_incorrect;   
            }
            <span class="keywordflow">if</span> ($scoringItems-&gt;{problemScores}) {
                $scoringData[7 + $user][$column] = $userProblem-&gt;status;
                <span class="keywordflow">if</span> ($scoringItems-&gt;{problemAttempts}) {
                    $scoringData[7 + $user][$column + 1] = $userProblem-&gt;num_correct;
                    $scoringData[7 + $user][$column + 2] = $userProblem-&gt;num_incorrect;
                }
            }
        }
    }
    <span class="keywordflow">if</span> ($scoringItems-&gt;{successIndex}) {
        <span class="keywordflow">for</span> (my $user = 0; $user &lt; @sortedUserIDs; $user++) {
            my $avg_num_attempts = ($num_of_problems) ? $numberOfAttempts{$user}/$num_of_problems : 0;
            $userSuccessIndex{$user} = ($avg_num_attempts &amp;&amp; $valueTotal) ? ($userStatusTotals{$user}/$valueTotal)**2/$avg_num_attempts : 0;                        
        }
    }
<span class="preprocessor">    # write the status totals</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($scoringItems-&gt;{setTotals}) { # Ironic, isn<span class="stringliteral">&#39;t it?</span>
<span class="stringliteral">        my $totalsColumn = $format eq &quot;totals&quot; ? 0 : 5 + @problemIDs * $columnsPerProblem;</span>
<span class="stringliteral">        $scoringData[0][$totalsColumn]    = &quot;&quot;;</span>
<span class="stringliteral">        $scoringData[1][$totalsColumn]    = $setRecord-&gt;set_id;</span>
<span class="stringliteral">        $scoringData[2][$totalsColumn]    = &quot;&quot;;</span>
<span class="stringliteral">        $scoringData[3][$totalsColumn]    = &quot;&quot;;</span>
<span class="stringliteral">        $scoringData[4][$totalsColumn]    = &quot;&quot;;</span>
<span class="stringliteral">        $scoringData[5][$totalsColumn]    = $valueTotal;</span>
<span class="stringliteral">        $scoringData[6][$totalsColumn]    = &quot;total&quot;;</span>
<span class="stringliteral">        if ($scoringItems-&gt;{successIndex}) {</span>
<span class="stringliteral">            $scoringData[0][$totalsColumn+1]    = &quot;&quot;;</span>
<span class="stringliteral">            $scoringData[1][$totalsColumn+1]    = $setRecord-&gt;set_id;</span>
<span class="stringliteral">            $scoringData[2][$totalsColumn+1]    = &quot;&quot;;</span>
<span class="stringliteral">            $scoringData[3][$totalsColumn+1]    = &quot;&quot;;</span>
<span class="stringliteral">            $scoringData[4][$totalsColumn+1]    = &quot;&quot;;</span>
<span class="stringliteral">            $scoringData[5][$totalsColumn+1]    = &#39;</span>100<span class="stringliteral">&#39;;</span>
<span class="stringliteral">            $scoringData[6][$totalsColumn+1]  = &quot;index&quot; ;</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">        for (my $user = 0; $user &lt; @sortedUserIDs; $user++) {</span>
<span class="stringliteral">            $userStatusTotals{$user} =$userStatusTotals{$user} ||0;</span>
<span class="stringliteral">            $scoringData[7+$user][$totalsColumn] = sprintf(&quot;%.1f&quot;,$userStatusTotals{$user}) if $scoringItems-&gt;{setTotals};</span>
<span class="stringliteral">            $scoringData[7+$user][$totalsColumn+1] = sprintf(&quot;%.0f&quot;,100*$userSuccessIndex{$user}) if $scoringItems-&gt;{successIndex};</span>
<span class="stringliteral"></span>
<span class="stringliteral">        }</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    debug(&quot;End  set $setID&quot;);</span>
<span class="stringliteral">    return @scoringData;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa500325e3ea6f1550a386c0d34ab2ba6"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::splitQuoted" ref="aa500325e3ea6f1550a386c0d34ab2ba6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::splitQuoted </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-splitQuoted' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-splitQuoted-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-splitQuoted-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-splitQuoted-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in splitQuoted: 30</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#aa500325e3ea6f1550a386c0d34ab2ba6">splitQuoted</a> {
    my ($self, $string) = @_;
    my ($leadingSpace, $preText, $quoted, $postText, $trailingSpace, $result);
    my @result = ();
    my $continue = 1;
    <span class="keywordflow">while</span> ($continue) {
        $string =~ m/\G(\s*)/gc;
        $leadingSpace = $1;
        $string =~ m/\G([^<span class="stringliteral">&quot;,]*)/gc;</span>
<span class="stringliteral">        $preText = $1;</span>
<span class="stringliteral">        if ($string =~ m/\G&quot;</span>((?:[^<span class="stringliteral">&quot;]|&quot;</span><span class="stringliteral">&quot;)*)&quot;</span>/gc) {
            $quoted = $1;
        }
        $string =~ m/\G([^,]*?)(\s*)(,?)/gc;
        ($postText, $trailingSpace, $continue) = ($1, $2, $3);

        $preText = <span class="stringliteral">&quot;&quot;</span> unless defined $preText;
        $postText = <span class="stringliteral">&quot;&quot;</span> unless defined $postText;
        $quoted = <span class="stringliteral">&quot;&quot;</span> unless defined $quoted;

        <span class="keywordflow">if</span> ($quoted and (not $preText and not $postText)) {
                $quoted =~ s/<span class="stringliteral">&quot;&quot;</span>/<span class="stringliteral">&quot;/;</span>
<span class="stringliteral">                $result = $quoted;</span>
<span class="stringliteral">        } else {</span>
<span class="stringliteral">            $result = &quot;</span>$preText$quoted$postText<span class="stringliteral">&quot;;</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">        push @result, $result;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    return @result;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a82f67d87a8b95f155ea463a11b793dd7"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::sumScores" ref="a82f67d87a8b95f155ea463a11b793dd7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::sumScores </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-sumScores' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-sumScores-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-sumScores-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-sumScores-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in sumScores: 43</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a82f67d87a8b95f155ea463a11b793dd7">sumScores</a> {    # Create a totals column <span class="keywordflow">for each</span> student
    my $self        = shift;
    my $r_totals    = shift;
    my $showIndex   = shift;
    my $r_users     = shift;
    my $r_sorted_user_ids =shift;
    my $r           = $self-&gt;r;
    my $db          = $r-&gt;db;
    my @scoringData = ();
    my $index_increment  = ($showIndex) ? 2 : 1;
<span class="preprocessor">    # This whole thing is a hack, but here goes.  We&#39;re going to sum the appropriate columns of the totals file:</span>
<span class="preprocessor"></span><span class="preprocessor">    # I believe we have $r_totals-&gt;[rows]-&gt;[cols]  -- the way it&#39;s printed out.</span>
<span class="preprocessor"></span>    my $start_column  = 6;  #The problem column 
    my $last_column   = $#{$r_totals-&gt;[1]};  # <span class="keywordflow">try</span> to figure out the number of the last column in the array.
    my $row_count     = $#{$r_totals};
    
<span class="preprocessor">    # Calculate total number of problems for the course.</span>
<span class="preprocessor"></span>    my $totalPoints      = 0;
    my $problemValueRow  = 5;
    <span class="keywordflow">for</span>( my $j = $start_column;$j&lt;=$last_column;$j+= $index_increment) {
        my $score = $r_totals-&gt;[$problemValueRow]-&gt;[$j];
        $totalPoints += ($score =~/^\s*[\d\.]+\s*$/)? $score : 0;
    }
    <span class="keywordflow">foreach</span> my $i (0..$row_count) {
        my $studentTotal = 0;
        <span class="keywordflow">for</span>( my $j = $start_column;$j&lt;=$last_column;$j+= $index_increment) {
            my $score = $r_totals-&gt;[$i]-&gt;[$j];
            $studentTotal += ($score =~/^\s*[\d\.]+\s*$/)? $score : 0;
            
        }
        $scoringData[$i][0] =sprintf(<span class="stringliteral">&quot;%.1f&quot;</span>,$studentTotal);
        $scoringData[$i][1] =($totalPoints) ?sprintf(<span class="stringliteral">&quot;%.1f&quot;</span>,100*$studentTotal/$totalPoints) : 0;
    }
    $scoringData[0]      = [<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>];
    $scoringData[1]      = [<span class="stringliteral">&#39;summary&#39;</span>, <span class="stringliteral">&#39;%score&#39;</span>];
    $scoringData[2]      = [<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>];
    $scoringData[3]      = [<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>];
    $scoringData[4]      = [<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>];
    $scoringData[6]      = [<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>];


    <span class="keywordflow">return</span> @scoringData;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aecda4ad0a0578b6720011e5a4b42dcc1"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::unquote" ref="aecda4ad0a0578b6720011e5a4b42dcc1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::unquote </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-unquote' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-unquote-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-unquote-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-unquote-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in unquote: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#aecda4ad0a0578b6720011e5a4b42dcc1">unquote</a> {
    my ($self, $string) = @_;
    <span class="keywordflow">if</span> ($string =~ m/^<span class="stringliteral">&quot;(.*)&quot;</span>$/) {
        $string = $1;
        $string =~ s/<span class="stringliteral">&quot;&quot;</span>/<span class="stringliteral">&quot;/;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    return $string;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aae550f47641ccbd8698c990dfe501588"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::writeCSV" ref="aae550f47641ccbd8698c990dfe501588" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::writeCSV </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-writeCSV' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-writeCSV-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-writeCSV-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-writeCSV-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in writeCSV: 34</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#aae550f47641ccbd8698c990dfe501588">writeCSV</a> {
    my ($self, $filename, @csv) = @_;
    
    my @lengths = ();
    <span class="keywordflow">for</span> (my $row = 0; $row &lt; @csv; $row++) {
        <span class="keywordflow">for</span> (my $column = 0; $column &lt; @{$csv[$row]}; $column++) {
            $lengths[$column] = 0 unless defined $lengths[$column];
            $lengths[$column] = length $csv[$row][$column] <span class="keywordflow">if</span> defined($csv[$row][$column]) and length $csv[$row][$column] &gt; $lengths[$column];
        }
    }
    
<span class="preprocessor">    # Before writing a new totals file, we back up an existing totals file keeping any previous backups.</span>
<span class="preprocessor"></span><span class="preprocessor">    # We do not backup any other type of scoring files (e.g. ful or scr).</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> (($filename =~ m|(.*)/(.*_totals)\.csv$|) and (-e $filename)) {
        my $scoringDir = $1;
        my $short_filename = $2;
        my $i=1;
        <span class="keywordflow">while</span>(-e <span class="stringliteral">&quot;${scoringDir}/${short_filename}_bak$i.csv&quot;</span>) {$i++;}      #don<span class="stringliteral">&#39;t overwrite existing backups</span>
<span class="stringliteral">        my $bakFileName =&quot;${scoringDir}/${short_filename}_bak$i.csv&quot;;</span>
<span class="stringliteral">        rename $filename, $bakFileName or warn &quot;Unable to rename $filename to $bakFileName&quot;;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral"></span>
<span class="stringliteral">    open my $fh, &quot;&gt;&quot;, $filename or warn &quot;Unable to open $filename for writing&quot;;</span>
<span class="stringliteral">    foreach my $row (@csv) {</span>
<span class="stringliteral">        my @rowPadded = ();</span>
<span class="stringliteral">        foreach (my $column = 0; $column &lt; @$row; $column++) {</span>
<span class="stringliteral">            push @rowPadded, $self-&gt;pad($row-&gt;[$column], $lengths[$column] + 1);</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">        print $fh join(&quot;,&quot;, @rowPadded);</span>
<span class="stringliteral">        print $fh &quot;\n&quot;;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    close $fh;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3437588081939cc41469b47eeda86272"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Scoring::writeStandardCSV" ref="a3437588081939cc41469b47eeda86272" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Scoring::writeStandardCSV </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-writeStandardCSV' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-writeStandardCSV-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-writeStandardCSV-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-writeStandardCSV-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in writeStandardCSV: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Scoring.html#a3437588081939cc41469b47eeda86272">writeStandardCSV</a> {
    my ($self, $filename, @csv) = @_;
    open my $fh, <span class="stringliteral">&quot;&gt;&quot;</span>, $filename;
    <span class="keywordflow">foreach</span> my $row (@csv) {
        print $fh (join <span class="stringliteral">&quot;,&quot;</span>, map {$self-&gt;quote($_)} @$row);
        print $fh <span class="stringliteral">&quot;\n&quot;</span>;
    }
    close $fh;
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="ContentGenerator_2Instructor_2Scoring_8pm_source.html">ContentGenerator/Instructor/Scoring.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:58:05 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
