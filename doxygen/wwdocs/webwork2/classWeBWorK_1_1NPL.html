<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::NPL Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1NPL.html">NPL</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::NPL Class Reference</h1><!-- doxytag: class="WeBWorK::NPL" --><!-- doxytag: inherits="WeBWorK" --><div class="dynheader">
Inheritance diagram for WeBWorK::NPL:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1NPL__inherit__graph.png" border="0" usemap="#WeBWorK_1_1NPL_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1NPL_inherit__map" id="WeBWorK_1_1NPL_inherit__map">
<area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="21,5,104,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::NPL:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1NPL__coll__graph.png" border="0" usemap="#WeBWorK_1_1NPL_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1NPL_coll__map" id="WeBWorK_1_1NPL_coll__map">
<area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="21,5,104,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1NPL-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a7f779b8937a59ffd31ff03c0d5a31d78">format_tag</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a9555d8bbf7f12b741e2fdced94d06f3b">parse_normal_list</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#adb5ecffde147c2fe371813424aef0397">gen_find_tags</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a4b913d0e0e4b7d19c00a4b94bf2af7ae">format_textbooks</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a015185379caa070e2de0c5c88491b0f0">parse_normal_value</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a6256484ad643843271edc8c498e98168">format_tags</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a4a63f5b9aefa91d705f5e0b70ca9bb5c">read_textbooks</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#ab8b8fc61a0e28c22c9d34d02a3473060">match_textbook</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a11c3fc22c675c052cb949397d97f120a">match_global</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a7072b49a7fdb3ef05a3970d4ea7766d3">read_tags</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#aa583359fec4014934ddbfe3867f0cc4b">parse_keywords</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a51085fe04730d3f78dee76ecae26536b">kwtidy</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#aaaa8a10d68447de6ffff4be8272a342d">format_problems</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a55a46371b73df1c2a2d67b6bb440fc9b">format_textbook</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a86627e31d4b906424d14bb298e173c46">format_description</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1NPL.html#a2c4f4e86bfee979ba6b5b3c4570e6d7b">parse_problems</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1NPL.html">WeBWorK::NPL</a> - Parse formats used by the National Problem Library.</p>
<h2><a class="anchor" id="SYNOPSIS">
SYNOPSIS</a></h2>
<pre>	use <a class="el" href="classWeBWorK_1_1NPL.html">WeBWorK::NPL</a> qw/read_textbooks read_tags format_tags gen_find_tags/;</pre><pre>	open TEXTS, "&amp;lt;", "Textbooks";
	my $textbooks = [];
	read_textbooks(\*TEXTS, $textbooks);</pre><pre>	open PGFILE, "&amp;lt;", "file.pg";
	my $tags = {};
	read_tags(\*PGFILE, $tags);</pre><pre>	foreach my $string (format_tags($tags)) {
		$string =~ s/^/## /gm;
		print "TAG: $string\\n";
	}</pre><pre>	use File::Find;
	my $process = sub { print "Found: $_[0]\\n" };
	my $wanted = gen_find_tags({author=&gt;'Rogawski'}, $process);
	find({wanted=&gt;$wanted}, @ARGV);</pre><h2><a class="anchor" id="DESCRIPTION">
DESCRIPTION</a></h2>
<p>This package contains parsing routines for the various data formats associated with the National Problem Library.</p>
<h2><a class="anchor" id="FUNCTIONS">
FUNCTIONS</a></h2>
<h3><a class="anchor" id="read_textbooks">
read_textbooks</a></h3>
<pre>	read_textbooks($fh, $arrayref)</pre><p>Reads a Textbooks file opened for reading on $fh and appends its contents to $arrayref. Each item appended to $arrayref is a reference to a hash containing the following keys: </p>
<pre>	_title      The title of the textbook
	_edition    The edition of the textbook
	_author     The author of the textbook
	1           The name of chapter 1
	1.1         The name of section 1.1
	1.2         The name of section 1.2
	...
	2           The name of chapter 2
	2.1         The name of section 2.1
	...</pre><p>Since the number of sections in a textbook is typically small, it is not terribly inefficient to pull chapters or sections out: </p>
<pre>	@chapters = grep { /^\d+$/ } keys %textbook;
	@sections = grep { /^\d+\.\d+$/ } keys %textbook;</pre><h3><a class="anchor" id="read_tags">
read_tags</a></h3>
<pre>	read_tags($fh, $hashref, $extra_editing_info);</pre><p>Reads the <a class="el" href="classWeBWorK_1_1NPL.html">NPL</a> tags from a <a class="el" href="classWeBWorK_1_1PG.html">PG</a> file opened for reading on $fh and stores the tags in %$hashref. The following keys may be added to %$hashref: </p>
<pre>	DESCRIPTION
	KEYWORDS
	DBsubject
	DBchapter
	DBsection
	Date
	Institution
	Author
	UsesAuxiliaryFiles      (experimental, subject to change)
	textbooks               (arrayref)</pre><p>The value for the </p>
<div class="fragment"><pre class="fragment">textbooks
</pre></div><p> key will be a reference to an array of textbook hashes containing the textbook tags from the source file. In each textbook hash, entries with empty values (e.g. </p>
<div class="fragment"><pre class="fragment">TitleText1(<span class="stringliteral">&#39;&#39;</span>)
</pre></div><p> ) will be omitted. This is to deal with the large number of empty-valued tags in the <a class="el" href="classWeBWorK_1_1NPL.html">NPL</a>. The keys of each textbook hash will be among: </p>
<pre>	title
	edition
	author
	chapter
	section
	problem        (arrayref)</pre><p>The value for the </p>
<div class="fragment"><pre class="fragment">problem
</pre></div><p> key will be a reference to an array of problem numbers. </p>
<p>If $extra_editing_info is true, special hash items _pos, _rest, and _maxtextbook will also be added to %$hashref. </p>
<p>_pos will contain the position of the first byte of the next line after the last tag in the file. _rest will contain the bytes of the "rest" of the file, after all tags, starting at _pos. _maxtextbook will contain the highest number used to identify a textbook in the file. (e.g. If TitleText1 and TitleText3 appear in the file, there will only be two items in the textbooks array, but _maxtextbook will be 3.) </p>
<p>This is useful for appending tags to a file which contains existing tags, where the new tags should appear immediately after the existing tags: </p>
<pre>	open PGFILE, "+&amp;lt;", "file.pg";
	my $tags = {};
	read_tags(\*PGFILE, $tags, 1);
	my $pos = $tags{_pos};
	my $rest = $tags{_rest};
	seek PGFILE, $pos, 0;
	print PGFILE "\#\# SomeNewTag('foo','bar')\\n";
	print PGFILE $rest;
	close PGFILE;</pre><h3><a class="anchor" id="format_tags">
format_tags</a></h3>
<pre>	format_tags($tags, $mintextbook);</pre><p>Given a reference to a hash of tags, return a list of strings representing said tags. The strings do not begin with the standard <a class="el" href="classWeBWorK_1_1NPL.html">NPL</a> comment prefix ("\#\# ") or end with newlines. These must be added by the caller if the strings are to be inserted into a <a class="el" href="classWeBWorK_1_1PG.html">PG</a> source file. </p>
<p>One complication is the DESCRIPTION field, which contains embedded newlines. If a DESCRIPTION tag occurs in %$tags, it will be formatted with embedded newlines but without a trailing newline. For example, after this code executes, </p>
<pre>	$tags = { DESCRIPTION =&gt; "line one\\nline two\\nline three" };
	($desc) = format_tags($tags);</pre><p>$desc will contain the string: </p>
<pre>	"DESCRIPTION\\nline one\\nline two\\nline three\\nENDDESCRIPTION"</pre><p>To account for this when writing to a <a class="el" href="classWeBWorK_1_1PG.html">PG</a> file, you could use: </p>
<pre>	foreach my $string (format_tags($tags)) {
		$string =~ s/^/## /gm;
		print PGFILE "$string\\n";
	}</pre><h3><a class="anchor" id="gen_find_tags">
gen_find_tags</a></h3>
<pre>	gen_find_tags($pattern, $action, $extra_editing_info);</pre><p>Generates an anonymous subroutine suitable for passing the the find() function of the File::Find module. The no_chdir=&gt;1 option must be passed to find() for the generated subroutine to operate properly. </p>
<p>$pattern is a reference to a hash describing the fields that must match. $action is a reference to a subroutine that will be called if all fields match. $extra_editing_info is passed to <a class="el" href="classWeBWorK_1_1NPL.html#a7072b49a7fdb3ef05a3970d4ea7766d3">read_tags()</a>. </p>
<p>Legal fields for $pattern are as follows: </p>
<p><b>Global fields:</b> DESCRIPTION, KEYWORDS, DBsubject, DBchapter, DBsection, Date, Institution, Author. (The experimental UsesAuxiliaryFiles field may be supported in the future.) </p>
<p><b>Text-specific fields:</b> title, edition, author, chapter, section, problem. </p>
<p>If multiple text-specific keys are given, then all must match for a single textbook. </p>
<p>$action is called as follows: </p>
<pre>	$action-&gt;($path, $tags, $text_index)</pre><p>There $path the path to the matching file, $tags a reference to the tag hash for the matching file, and $text_index the index into the @{$tags-&gt;{textbooks}} array if $pattern included textbook-specific tags. </p>

<p>Definition at line <a class="el" href="NPL_8pm_source.html#l00176">176</a> of file <a class="el" href="NPL_8pm_source.html">NPL.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a86627e31d4b906424d14bb298e173c46"></a><!-- doxytag: member="WeBWorK::NPL::format_description" ref="a86627e31d4b906424d14bb298e173c46" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::format_description </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-format_description' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-format_description-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-format_description-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-format_description-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in format_description: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a86627e31d4b906424d14bb298e173c46">format_description</a> {
    my $value = shift;
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;DESCRIPTION\n$value\nENDDESCRIPTION&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aaaa8a10d68447de6ffff4be8272a342d"></a><!-- doxytag: member="WeBWorK::NPL::format_problems" ref="aaaa8a10d68447de6ffff4be8272a342d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::format_problems </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-format_problems' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-format_problems-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-format_problems-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-format_problems-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in format_problems: 11</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#aaaa8a10d68447de6ffff4be8272a342d">format_problems</a> {
    my $first = shift;
    my @problems;
    <span class="keywordflow">if</span> (ref $first) {
        @problems = @$first;
    } <span class="keywordflow">else</span> {
        @problems = ($first, @_);
    }
    
    <span class="keywordflow">return</span> join(<span class="charliteral">&#39;,&#39;</span>, @problems);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7f779b8937a59ffd31ff03c0d5a31d78"></a><!-- doxytag: member="WeBWorK::NPL::format_tag" ref="a7f779b8937a59ffd31ff03c0d5a31d78" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::format_tag </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-format_tag' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-format_tag-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-format_tag-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-format_tag-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in format_tag: 25</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a7f779b8937a59ffd31ff03c0d5a31d78">format_tag</a> {
    my ($field, $value, $n) = @_;
    my $tag = $field2tag{$field} || $field;
    
<span class="preprocessor">    # problems are always listed in a single string in the tag.</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($field eq <span class="stringliteral">&quot;problem&quot;</span>) {
        $value = <a class="code" href="classWeBWorK_1_1NPL.html#aaaa8a10d68447de6ffff4be8272a342d">format_problems</a>($value);
    }
    
<span class="preprocessor">    # if we have an arrayref, we represent it as multiple strings in one tag.</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (ref $value) {
        $value = join(<span class="charliteral">&#39;,&#39;</span>, map { <span class="stringliteral">&quot;&#39;$_&#39;&quot;</span> } @$value);
    } elsif (defined $value) {
        $value = <span class="stringliteral">&quot;&#39;$value&#39;&quot;</span>;
    } <span class="keywordflow">else</span> {
        warn <span class="stringliteral">&quot;value is not defined for field $field!\n&quot;</span>;
        $value = <span class="stringliteral">&quot;&#39;&#39;&quot;</span>;
    }
    
    <span class="keywordflow">if</span> (defined $n) {
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;$tag$n($value)&quot;</span>;
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;$tag($value)&quot;</span>;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a6256484ad643843271edc8c498e98168"></a><!-- doxytag: member="WeBWorK::NPL::format_tags" ref="a6256484ad643843271edc8c498e98168" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::format_tags </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-format_tags' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-format_tags-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-format_tags-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-format_tags-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in format_tags: 17</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a6256484ad643843271edc8c498e98168">format_tags</a> {
    my ($tags, $mintextbook) = @_;
    $mintextbook ||= 1;
    my @result;
    my @ordered_fields = grep { exists $tags-&gt;{$_} } @global_fields, <span class="stringliteral">&quot;textbooks&quot;</span>;
    <span class="keywordflow">foreach</span> my $field (@ordered_fields) {
        my $value = $tags-&gt;{$field};
        <span class="keywordflow">if</span> ($field eq <span class="stringliteral">&quot;DESCRIPTION&quot;</span>) {
            push @result, <a class="code" href="classWeBWorK_1_1NPL.html#a86627e31d4b906424d14bb298e173c46">format_description</a>($value);
        } elsif ($field eq <span class="stringliteral">&quot;textbooks&quot;</span>) {
            push @result, <a class="code" href="classWeBWorK_1_1NPL.html#a4b913d0e0e4b7d19c00a4b94bf2af7ae">format_textbooks</a>($value, $mintextbook);
        } <span class="keywordflow">else</span> {
            push @result, <a class="code" href="classWeBWorK_1_1NPL.html#a7f779b8937a59ffd31ff03c0d5a31d78">format_tag</a>($field, $value);
        }
    }
    <span class="keywordflow">return</span> @result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a55a46371b73df1c2a2d67b6bb440fc9b"></a><!-- doxytag: member="WeBWorK::NPL::format_textbook" ref="a55a46371b73df1c2a2d67b6bb440fc9b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::format_textbook </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-format_textbook' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-format_textbook-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-format_textbook-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-format_textbook-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in format_textbook: 21</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a55a46371b73df1c2a2d67b6bb440fc9b">format_textbook</a> {
    my ($textbook, $n) = @_;
    
<span class="preprocessor">    # combine chapter/section into single section tag</span>
<span class="preprocessor"></span>    my $chapter = $textbook-&gt;{chapter};
    my $section = $textbook-&gt;{section};
    <span class="keywordflow">if</span> (defined $chapter or defined $section) {
        $section = <span class="stringliteral">&quot;.$section&quot;</span> <span class="keywordflow">if</span> defined $section;
        $section = <span class="stringliteral">&quot;$chapter$section&quot;</span> <span class="keywordflow">if</span> defined $chapter;
        <span class="keyword">delete</span> $textbook-&gt;{chapter};
        $textbook-&gt;{section} = $section;
    }
    
    my @result;
    my @ordered_fields = grep { exists $textbook-&gt;{$_} } @textbook_fields;
    <span class="keywordflow">foreach</span> my $field (@ordered_fields) {
        my $value = $textbook-&gt;{$field};
        push @result, <a class="code" href="classWeBWorK_1_1NPL.html#a7f779b8937a59ffd31ff03c0d5a31d78">format_tag</a>($field, $value, $n);
    }
    <span class="keywordflow">return</span> @result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4b913d0e0e4b7d19c00a4b94bf2af7ae"></a><!-- doxytag: member="WeBWorK::NPL::format_textbooks" ref="a4b913d0e0e4b7d19c00a4b94bf2af7ae" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::format_textbooks </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-format_textbooks' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-format_textbooks-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-format_textbooks-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-format_textbooks-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in format_textbooks: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a4b913d0e0e4b7d19c00a4b94bf2af7ae">format_textbooks</a> {
    my ($textbook, $n) = @_;
    my @textbooks = @$textbook;
    my @result;
    <span class="keywordflow">foreach</span> my $textbook (@textbooks) {
        push @result, <a class="code" href="classWeBWorK_1_1NPL.html#a55a46371b73df1c2a2d67b6bb440fc9b">format_textbook</a>($textbook, $n);
        $n++;
    }
    <span class="keywordflow">return</span> @result;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="adb5ecffde147c2fe371813424aef0397"></a><!-- doxytag: member="WeBWorK::NPL::gen_find_tags" ref="adb5ecffde147c2fe371813424aef0397" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::gen_find_tags </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-gen_find_tags' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-gen_find_tags-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-gen_find_tags-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-gen_find_tags-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in gen_find_tags: 38</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#adb5ecffde147c2fe371813424aef0397">gen_find_tags</a> {
    my ($pattern, $action, $extra_editing_info) = @_;
    <span class="keywordflow">return</span> sub {
        <span class="keywordflow">return</span> unless /\.pg$/ and -f $File::Find::name;
        
        my $name = $File::Find::name;
<span class="preprocessor">        #my $relpath = $name;</span>
<span class="preprocessor"></span><span class="preprocessor">        #$relpath =~ s/^$src\///;</span>
<span class="preprocessor"></span>        
        my %tags;
        
        open my $fh, <span class="stringliteral">&quot;&lt;&quot;</span>, $name or <span class="keywordflow">do</span> {
            warn <span class="stringliteral">&quot;skipping $name: $!\n&quot;</span>;
            <span class="keywordflow">return</span>;
        };
        <a class="code" href="classWeBWorK_1_1NPL.html#a7072b49a7fdb3ef05a3970d4ea7766d3">read_tags</a>($fh, \%tags, $extra_editing_info);
        close $fh;
        
        my (%global_pattern, %textbook_pattern);
        <span class="keywordflow">foreach</span> my $field (@global_fields) {
            $global_pattern{$field} = $pattern-&gt;{$field} <span class="keywordflow">if</span> exists $pattern-&gt;{$field};
        }
        <span class="keywordflow">foreach</span> my $field (@textbook_fields) {
            $textbook_pattern{$field} = $pattern-&gt;{$field} <span class="keywordflow">if</span> exists $pattern-&gt;{$field};
        }
        
        <span class="keywordflow">if</span> (%global_pattern) {
            <span class="keywordflow">return</span> unless <a class="code" href="classWeBWorK_1_1NPL.html#a11c3fc22c675c052cb949397d97f120a">match_global</a>(\%tags, \%global_pattern);
        }
        my $text_index;
        <span class="keywordflow">if</span> (%textbook_pattern) {
            $text_index = <a class="code" href="classWeBWorK_1_1NPL.html#ab8b8fc61a0e28c22c9d34d02a3473060">match_textbook</a>(\%tags, \%textbook_pattern);
            <span class="keywordflow">return</span> unless $text_index &gt;= 0;
        }
        
        $action-&gt;($name, \%tags, $text_index);
    };
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a51085fe04730d3f78dee76ecae26536b"></a><!-- doxytag: member="WeBWorK::NPL::kwtidy" ref="a51085fe04730d3f78dee76ecae26536b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::kwtidy </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-kwtidy' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-kwtidy-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-kwtidy-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-kwtidy-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in kwtidy: 6</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a51085fe04730d3f78dee76ecae26536b">kwtidy</a> {
    my $keyword = shift;
    $keyword =~ s/\W<span class="comment">//g;</span>
    $keyword =~ s/_<span class="comment">//g;</span>
    <span class="keywordflow">return</span> lc $keyword;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a11c3fc22c675c052cb949397d97f120a"></a><!-- doxytag: member="WeBWorK::NPL::match_global" ref="a11c3fc22c675c052cb949397d97f120a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::match_global </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-match_global' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-match_global-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-match_global-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-match_global-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in match_global: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a11c3fc22c675c052cb949397d97f120a">match_global</a> {
    my ($tags, $matches) = @_;
    <span class="keywordflow">foreach</span> my $field (keys %$matches) {
        <span class="keywordflow">return</span> 0 unless $tags-&gt;{$field} eq $matches-&gt;{$field};
    }
    <span class="keywordflow">return</span> 1;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab8b8fc61a0e28c22c9d34d02a3473060"></a><!-- doxytag: member="WeBWorK::NPL::match_textbook" ref="ab8b8fc61a0e28c22c9d34d02a3473060" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::match_textbook </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-match_textbook' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-match_textbook-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-match_textbook-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-match_textbook-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in match_textbook: 15</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#ab8b8fc61a0e28c22c9d34d02a3473060">match_textbook</a> {
    my ($tags, $matches) = @_;
    <span class="keywordflow">return</span> -1 unless defined $tags-&gt;{textbooks};
    my @textbooks = @{$tags-&gt;{textbooks}};
    
<span class="preprocessor">    #textbook: foreach my $textbook (@{$tags-&gt;{textbooks}}) {</span>
<span class="preprocessor"></span>    textbook: <span class="keywordflow">foreach</span> my $i (0 .. $#{$tags-&gt;{textbooks}}) {
        my $textbook = $tags-&gt;{textbooks}[$i];
        <span class="keywordflow">foreach</span> my $field (keys %$matches) {
            next <span class="keywordflow">if</span> $field !~ /^(title|edition|author|chapter|section|problem)$/;
            next textbook unless $textbook-&gt;{$field} eq $matches-&gt;{$field};
        }
<span class="preprocessor">        #warn &quot;matched text i=$i: &quot;, Dumper($textbook);</span>
<span class="preprocessor"></span>        <span class="keywordflow">return</span> $i;
    }
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa583359fec4014934ddbfe3867f0cc4b"></a><!-- doxytag: member="WeBWorK::NPL::parse_keywords" ref="aa583359fec4014934ddbfe3867f0cc4b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::parse_keywords </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-parse_keywords' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-parse_keywords-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-parse_keywords-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-parse_keywords-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in parse_keywords: 12</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#aa583359fec4014934ddbfe3867f0cc4b">parse_keywords</a> {
    my $string = shift;
    my ($items, $errors) = <a class="code" href="classWeBWorK_1_1NPL.html#a9555d8bbf7f12b741e2fdced94d06f3b">parse_normal_list</a>(<span class="stringliteral">&#39;KEYWORDS&#39;</span>, $string);
    <span class="keywordflow">if</span> (@$errors) {
        warn <span class="stringliteral">&quot;errors while parsing KEYWORDS list:\n@$errors\n&quot;</span>
            . <span class="stringliteral">&quot;Partially-parsed KEYWORDS: @$items\n&quot;</span>
            . <span class="stringliteral">&quot;Resorting to old-style KEYWORDS parsing...\n&quot;</span>;
        @$items = split /(?:,|\s)+/, $string;
        warn <span class="stringliteral">&quot;Old-style parse result: &quot;</span>, join(<span class="charliteral">&#39;|&#39;</span>, @$items), <span class="stringliteral">&quot;\n&quot;</span>;
    }
    <span class="keywordflow">return</span> map { <a class="code" href="classWeBWorK_1_1NPL.html#a51085fe04730d3f78dee76ecae26536b">kwtidy</a>($_) } @$items;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a9555d8bbf7f12b741e2fdced94d06f3b"></a><!-- doxytag: member="WeBWorK::NPL::parse_normal_list" ref="a9555d8bbf7f12b741e2fdced94d06f3b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::parse_normal_list </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-parse_normal_list' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-parse_normal_list-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-parse_normal_list-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-parse_normal_list-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in parse_normal_list: 58</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a9555d8bbf7f12b741e2fdced94d06f3b">parse_normal_list</a> {
    my ($name, $string) = @_;
    
    use constant NRM=&gt;0;
    use constant STR=&gt;1;
    use constant ESC=&gt;2;
    use constant STP=&gt;3;
    my $state = NRM;
    my @errors;
    my @items;
    my $curr_item = <span class="stringliteral">&#39;&#39;</span>;
    my $next_item = 0;
    <span class="keywordflow">foreach</span> my $i (0 .. length($string)-1) {
        my $c = substr($string,$i,1);
<span class="preprocessor">        #print &quot;i=$i c=$c state=$state curr_item=$curr_item next_item=$next_item\n&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">        # state changes</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ($state == NRM) {
            <span class="keywordflow">if</span> ($c eq <span class="stringliteral">&quot;&#39;&quot;</span>) {
                $state = STR;
            } elsif ($c eq <span class="charliteral">&#39;,&#39;</span> or $c eq <span class="charliteral">&#39; &#39;</span>) {
<span class="preprocessor">                # do nothing -- closequote already consumed curr_item</span>
<span class="preprocessor"></span>            } <span class="keywordflow">else</span> {
                push @errors, 
                    <span class="stringliteral">&quot;illegal char &#39;$c&#39; in state NRM while parsing value for $name.\n&quot;</span>
                    . <span class="stringliteral">&quot;    $string\n&quot;</span>
                    . <span class="stringliteral">&#39;    &#39;</span> . <span class="charliteral">&#39; &#39;</span>x$i . <span class="stringliteral">&quot;^\n&quot;</span>;
                $next_item = 1;
                $state = STP;
            }
        } elsif ($state == STR) {
            <span class="keywordflow">if</span> ($c eq <span class="stringliteral">&quot;&#39;&quot;</span>) {
                $state = NRM;
                $next_item = 1;
            } elsif ($c eq <span class="charliteral">&#39;\\&#39;</span>) {
                $state = ESC;
            } <span class="keywordflow">else</span> {
                $curr_item .= $c;
            }
        } elsif ($state == ESC) {
            $curr_item .= $c;
            $state = STR;
        } elsif ($state == STP) {
            last;
        } <span class="keywordflow">else</span> {
            die <span class="stringliteral">&quot;unexpected state $state while parsing value for $name.\n&quot;</span>;
        }
<span class="preprocessor">        #print &quot;i=$i c=$c state=$state curr_item=$curr_item next_item=$next_item\n&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">        # actions</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ($next_item) {
            push @items, $curr_item;
            $curr_item = <span class="stringliteral">&#39;&#39;</span>;
            $next_item = 0;
<span class="preprocessor">            #print &quot;stored item to list\n&quot;;</span>
<span class="preprocessor"></span>        }
    }
    
    <span class="keywordflow">return</span> \@items, \@errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a015185379caa070e2de0c5c88491b0f0"></a><!-- doxytag: member="WeBWorK::NPL::parse_normal_value" ref="a015185379caa070e2de0c5c88491b0f0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::parse_normal_value </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-parse_normal_value' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-parse_normal_value-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-parse_normal_value-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-parse_normal_value-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in parse_normal_value: 6</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a015185379caa070e2de0c5c88491b0f0">parse_normal_value</a> {
    my ($name, $string) = @_;
    my ($items, $errors) = <a class="code" href="classWeBWorK_1_1NPL.html#a9555d8bbf7f12b741e2fdced94d06f3b">parse_normal_list</a>($name, $string);
    push @$errors, <span class="stringliteral">&quot;only one item allowed in value for $name.\n&quot;</span> <span class="keywordflow">if</span> @$items &gt; 1;
    <span class="keywordflow">return</span> shift @$items, $errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2c4f4e86bfee979ba6b5b3c4570e6d7b"></a><!-- doxytag: member="WeBWorK::NPL::parse_problems" ref="a2c4f4e86bfee979ba6b5b3c4570e6d7b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::parse_problems </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-parse_problems' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-parse_problems-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-parse_problems-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-parse_problems-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in parse_problems: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a2c4f4e86bfee979ba6b5b3c4570e6d7b">parse_problems</a> {
    my $string = shift;
    $string =~ s/\D/ /g;
    <span class="keywordflow">return</span> grep { /\S/ } split /\s+/, $string;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7072b49a7fdb3ef05a3970d4ea7766d3"></a><!-- doxytag: member="WeBWorK::NPL::read_tags" ref="a7072b49a7fdb3ef05a3970d4ea7766d3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::read_tags </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-read_tags' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-read_tags-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-read_tags-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-read_tags-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in read_tags: 38</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a7072b49a7fdb3ef05a3970d4ea7766d3">read_tags</a> {
    my ($file, $result, $extra_editing_info) = @_;
    
    my $fh;
    <span class="keywordflow">if</span> (ref $file) {
        $fh = $file;
    } elsif (defined $file and not ref $file) {
        $fh = <span class="keyword">new</span> IO::File($file, <span class="charliteral">&#39;r&#39;</span>);
    }
    
    my $pos;
    my $rest = <span class="stringliteral">&#39;&#39;</span>;
    my $maxtextbook;
    <span class="keywordflow">while</span> (&lt;$fh&gt;) {
<span class="preprocessor">        #if (0) {</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (/^(.*?\#.*?)(\s*)DESCRIPTION/) {
            my $prefix = $1;
            my $whitespace = $2;
            my $description = <span class="stringliteral">&#39;&#39;</span>;
            <span class="keywordflow">while</span> (&lt;$fh&gt;) {
                <span class="keywordflow">if</span> (/\#.*ENDDESCRIPTION/) {
                    chomp $description;
                    $result-&gt;{DESCRIPTION} = $description <span class="keywordflow">if</span> length $description &gt; 0;
                    last;
                } <span class="keywordflow">else</span> {
<span class="preprocessor">                    # handle prefix and whitespace separately so that we can still</span>
<span class="preprocessor"></span><span class="preprocessor">                    # chop the prefix off even if people are being careless about</span>
<span class="preprocessor"></span><span class="preprocessor">                    # whitespace. :P</span>
<span class="preprocessor"></span>                    s/^$prefix<span class="comment">//;</span>
                    s/^$whitespace<span class="comment">//;</span>
                    $description .= $_;
                }
            }
            <span class="keywordflow">if</span> ($extra_editing_info) {
                $pos = tell $fh;
                $rest = <span class="stringliteral">&#39;&#39;</span>;
            }
        } elsif (/\#.*KEYWORDS\((.*)\)/) {
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4a63f5b9aefa91d705f5e0b70ca9bb5c"></a><!-- doxytag: member="WeBWorK::NPL::read_textbooks" ref="a4a63f5b9aefa91d705f5e0b70ca9bb5c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::NPL::read_textbooks </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-read_textbooks' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-read_textbooks-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-read_textbooks-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-read_textbooks-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in read_textbooks: 33</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1NPL.html#a4a63f5b9aefa91d705f5e0b70ca9bb5c">read_textbooks</a> {
    my ($fh, $result) = @_;
    
    my %curr_textbook;
    
    <span class="keywordflow">while</span> (&lt;$fh&gt;) {
        s/#.*$<span class="comment">//g;</span>
        next unless /\S/;
        s/^\s*<span class="comment">//;</span>
        s/\s*$<span class="comment">//;</span>
        
        <span class="keywordflow">if</span> (/^(TitleText|EditionText|AuthorText)\(\s*<span class="stringliteral">&#39;(.*?)&#39;</span>\s*\)/) {
            my $field = $tag2field{$1};
            my $value = $2;
            <span class="keywordflow">if</span> (exists $curr_textbook{<span class="stringliteral">&quot;_$field&quot;</span>}) {
<span class="preprocessor">                # repeated tag -- this is a new textbook</span>
<span class="preprocessor"></span>                push @$result, {%curr_textbook};
                %curr_textbook = ();
            }
            $curr_textbook{<span class="stringliteral">&quot;_$field&quot;</span>} = $value;
        } elsif (/^(\d+)(?:\.(\d+))?\s*&gt;&gt;&gt;\s*(.*)$/) {
            my $chapter = $1;
            my $section = $2;
            my $name = $3;
            <span class="keywordflow">if</span> (defined $section and length $section &gt; 0) {
                $curr_textbook{<span class="stringliteral">&quot;$chapter.$section&quot;</span>} = $name;
            } <span class="keywordflow">else</span> {
                $curr_textbook{$chapter} = $name;
            }
        }
    }
    push @$result, {%curr_textbook};
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="NPL_8pm_source.html">NPL.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:59:46 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
