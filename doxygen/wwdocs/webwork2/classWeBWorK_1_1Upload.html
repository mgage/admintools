<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::Upload Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1Upload.html">Upload</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::Upload Class Reference</h1><!-- doxytag: class="WeBWorK::Upload" --><!-- doxytag: inherits="WeBWorK" --><div class="dynheader">
Inheritance diagram for WeBWorK::Upload:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Upload__inherit__graph.png" border="0" usemap="#WeBWorK_1_1Upload_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1Upload_inherit__map" id="WeBWorK_1_1Upload_inherit__map">
<area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="29,5,112,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::Upload:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Upload__coll__graph.png" border="0" usemap="#WeBWorK_1_1Upload_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1Upload_coll__map" id="WeBWorK_1_1Upload_coll__map">
<area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="29,5,112,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1Upload-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Upload.html#adce51956076f79d63cdf26a63d597ef0">store</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Upload.html#a3e39b61c25c025d6c3185c7779529e15">disposeTo</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Upload.html#ac2bf3de9b9cd28984f9c20728052e4fd">dispose</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Upload.html#afc8381d47be4e14ec227d48cb1d6e9e3">fileHandle</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Upload.html#a5eca1d77859b353ed254bc05bfc82fce">filePath</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Upload.html#a88173b6512720736a2886ffa112e2ea6">hash</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Upload.html#a565ff8cd52013d596c590e88e76e4450">retrieve</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Upload.html#a33b68762c70b66eb94fac6d261f90827">filename</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Upload.html#afae9fec80a1a6486fa2d6dbb2abb272e">id</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1Upload.html">WeBWorK::Upload</a> - store uploads securely across requests.</p>
<h2><a class="anchor" id="SYNOPSIS">
SYNOPSIS</a></h2>
<p>Given </p>
<div class="fragment"><pre class="fragment">$u
</pre></div><p> , an Apache::Upload object </p>
<pre> my $upload = <a class="el" href="classWeBWorK_1_1Upload.html">WeBWorK::Upload</a>-&gt;store($u,
 	dir =&gt; $ce-&gt;{webworkDirs}-&gt;{DATA}
 );
 my $id = $upload-&gt;id;
 my $hash = $upload-&gt;hash;</pre><p>Later... </p>
<pre> my $upload = <a class="el" href="classWeBWorK_1_1Upload.html">WeBWorK::Upload</a>-&gt;retrieve($id, $hash,
 	dir =&gt; $ce-&gt;{webworkDirs}-&gt;{uploadCache}
 );
 my $fh = $upload-&gt;fileHandle;
 my $path = $upload-&gt;filePath;</pre><pre> # get rid of the upload -- $upload is useless after this!
 $upload-&gt;dispose;</pre><pre> # ...or move it somewhere before disposal
 $upload-&gt;disposeTo($path);</pre><h2><a class="anchor" id="DESCRIPTION">
DESCRIPTION</a></h2>
<p><a class="el" href="classWeBWorK_1_1Upload.html">WeBWorK::Upload</a> provides a method for securely storing uploaded files until such time as they are needed. This is useful for situations in which an upload cannot be handled by the system until some later request, such as the case where a user is not yet authenticated, and a login page must be returned. Since a file upload should not be sent back to the client and then uploaded again with the user provides his login information, some proxy must be sent in its place. <a class="el" href="classWeBWorK_1_1Upload.html">WeBWorK::Upload</a> generates a unique ID which can be used to retrieve the original file.</p>
<h2><a class="anchor" id="STORING_UPLOADS">
STORING UPLOADS</a></h2>
<p>Uploads represented as Apache::Uploads objects can be stored in an upload cache and later retrieved, given the proper ID and hash. The hash is used to confirm the authenticity of the ID.</p>
<h3><a class="anchor" id="CONSTRUCTOR">
CONSTRUCTOR</a></h3>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_store__u____options_"></a><b>store($u, %options)</b> </p>
<p>Stores the Apache::Upload </p>
<div class="fragment"><pre class="fragment">$u
</pre></div><p> securely. The following keys must be defined in %options: </p>
<pre> dir =&gt; the directory in which to store the uploaded file</pre><p class="endli"></p>
</li>
</ul>
<p>Return the upload's unique ID, or an undefiend value if the upload is not valid. </p>
<p>Return the upload's hash, or an undefiend value if the upload is not valid.</p>
<h2><a class="anchor" id="RETRIEVING_UPLOADS">
RETRIEVING UPLOADS</a></h2>
<p>An upload stored in the upload cache can be retrieved by supplying its ID and hash (accessible from the above </p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">id</span>
</pre></div><p> and </p>
<div class="fragment"><pre class="fragment"><a class="code" href="classWeBWorK_1_1Upload.html#a88173b6512720736a2886ffa112e2ea6">hash</a>
</pre></div><p> methods, respectivly. The file can then be accessed by name or file handle, moved, and disposed of.</p>
<h3><a class="anchor" id="CONSTRUCTOR">
CONSTRUCTOR</a></h3>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_retrieve__id___hash____options_"></a><b>retrieve($id, $hash, %options)</b> </p>
<p>Retrieves the Apache::Upload referenced by </p>
<div class="fragment"><pre class="fragment">$id
</pre></div><p> and </p>
<div class="fragment"><pre class="fragment">$hash
</pre></div><p> . The following keys must be defined in %options: </p>
<pre> dir =&gt; the directory in which to store the uploaded file</pre><p class="endli"></p>
</li>
</ul>
<h3><a class="anchor" id="METHODS">
METHODS</a></h3>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_filename"></a><b>filename</b> </p>
<p class="endli">Returns the original name of the uploaded file.  </p>
</li>
</ul>
<p>Return a file handle pointing to the uploaded file, or an undefiend value if the upload is not valid. Suitable for reading. </p>
<p>Return the path to the uploaded file, or an undefiend value if the upload is not valid. </p>
<p>If you use this, bear in mind that you must not dispose of the upload (either by moving or deleting the uploaded file or calling the </p>
<div class="fragment"><pre class="fragment"><a class="code" href="classWeBWorK_1_1Upload.html#ac2bf3de9b9cd28984f9c20728052e4fd">dispose</a>
</pre></div><p> method). If you wish to move the file, use the </p>
<div class="fragment"><pre class="fragment"><a class="code" href="classWeBWorK_1_1Upload.html#a3e39b61c25c025d6c3185c7779529e15">disposeTo</a>
</pre></div><p> method instead. </p>
<p>Remove the file from the upload cache. Returns true if the upload was successfully destroyed, or an undefiend value if the upload is not valid. </p>
<p>Remove the file from the upload cache, and move it to </p>
<div class="fragment"><pre class="fragment">$path
</pre></div><p> . Returns true if the upload was successfully moved, or an undefiend value if the upload is not valid.</p>
<h2><a class="anchor" id="AUTHOR">
AUTHOR</a></h2>
<p>Written by Sam Hathaway, sh002i at math.rochester.edu. Based on the original <a class="el" href="classWeBWorK_1_1Upload.html">WeBWorK::Upload</a> module by Dennis Lambe, Jr., malsyned at math.rochester.edu. </p>

<p>Definition at line <a class="el" href="Upload_8pm_source.html#l00142">142</a> of file <a class="el" href="Upload_8pm_source.html">Upload.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ac2bf3de9b9cd28984f9c20728052e4fd"></a><!-- doxytag: member="WeBWorK::Upload::dispose" ref="ac2bf3de9b9cd28984f9c20728052e4fd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Upload::dispose </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-dispose' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-dispose-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-dispose-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-dispose-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in dispose: 19</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Upload.html#ac2bf3de9b9cd28984f9c20728052e4fd">dispose</a> {
    my ($self) = @_;
    my $uuid = $self-&gt;{uuid};
    my $dir = $self-&gt;{dir};
    
    my $infoName = <span class="stringliteral">&quot;$uuid.info&quot;</span>;
    my $infoPath = <span class="stringliteral">&quot;$dir/$infoName&quot;</span>;
    
    my $fileName = <span class="stringliteral">&quot;$uuid.file&quot;</span>;
    my $filePath = <span class="stringliteral">&quot;$dir/$fileName&quot;</span>;
    
<span class="preprocessor">    # make sure info file still exists (i.e. the file hasn&#39;t been disposed of)</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless -e $infoPath;
    
    unlink $infoPath;
    unlink $filePath;
    
    <span class="keywordflow">return</span> 1;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3e39b61c25c025d6c3185c7779529e15"></a><!-- doxytag: member="WeBWorK::Upload::disposeTo" ref="a3e39b61c25c025d6c3185c7779529e15" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Upload::disposeTo </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-disposeTo' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-disposeTo-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-disposeTo-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-disposeTo-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in disposeTo: 19</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Upload.html#a3e39b61c25c025d6c3185c7779529e15">disposeTo</a> {
    my ($self, $newPath) = @_;
    my $uuid = $self-&gt;{uuid};
    my $dir = $self-&gt;{dir};
    
    croak <span class="stringliteral">&quot;no path specified&quot;</span> unless $newPath;
    
    my $infoName = <span class="stringliteral">&quot;$uuid.info&quot;</span>;
    my $infoPath = <span class="stringliteral">&quot;$dir/$infoName&quot;</span>;
    
    my $fileName = <span class="stringliteral">&quot;$uuid.file&quot;</span>;
    my $filePath = <span class="stringliteral">&quot;$dir/$fileName&quot;</span>;
    
<span class="preprocessor">    # make sure info file still exists (i.e. the file hasn&#39;t been disposed of)</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless -e $infoPath;
    
    unlink $infoPath;
    move($filePath, $newPath);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="afc8381d47be4e14ec227d48cb1d6e9e3"></a><!-- doxytag: member="WeBWorK::Upload::fileHandle" ref="afc8381d47be4e14ec227d48cb1d6e9e3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Upload::fileHandle </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-fileHandle' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-fileHandle-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fileHandle-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fileHandle-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in fileHandle: 18</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Upload.html#afc8381d47be4e14ec227d48cb1d6e9e3">fileHandle</a> {
    my ($self) = @_;
    my $uuid = $self-&gt;{uuid};
    my $dir = $self-&gt;{dir};
    
    my $infoName = <span class="stringliteral">&quot;$uuid.info&quot;</span>;
    my $infoPath = <span class="stringliteral">&quot;$dir/$infoName&quot;</span>;
    
    my $fileName = <span class="stringliteral">&quot;$uuid.file&quot;</span>;
    my $filePath = <span class="stringliteral">&quot;$dir/$fileName&quot;</span>;
    
<span class="preprocessor">    # make sure info file still exists (i.e. the file hasn&#39;t been disposed of)</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless -e $infoPath;
    
    open my $fh, <span class="stringliteral">&quot;&lt;&quot;</span>, $filePath
        or die <span class="stringliteral">&quot;failed to open upload $filePath for reading: $!&quot;</span>;
    <span class="keywordflow">return</span> $fh;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a33b68762c70b66eb94fac6d261f90827"></a><!-- doxytag: member="WeBWorK::Upload::filename" ref="a33b68762c70b66eb94fac6d261f90827" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Upload::filename </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-filename' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-filename-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-filename-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-filename-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in filename: 17</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Upload.html#a33b68762c70b66eb94fac6d261f90827">filename</a> {
    my ($self) = @_;
    my $uuid = $self-&gt;{uuid};
    my $dir = $self-&gt;{dir};
    my $realFileName = $self-&gt;{realFileName};
    
    my $infoName = <span class="stringliteral">&quot;$uuid.info&quot;</span>;
    my $infoPath = <span class="stringliteral">&quot;$dir/$infoName&quot;</span>;
    
    my $fileName = <span class="stringliteral">&quot;$uuid.file&quot;</span>;
    my $filePath = <span class="stringliteral">&quot;$dir/$fileName&quot;</span>;
    
<span class="preprocessor">    # make sure info file still exists (i.e. the file hasn&#39;t been disposed of)</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless -e $infoPath;
    
    <span class="keywordflow">return</span> $realFileName;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a5eca1d77859b353ed254bc05bfc82fce"></a><!-- doxytag: member="WeBWorK::Upload::filePath" ref="a5eca1d77859b353ed254bc05bfc82fce" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Upload::filePath </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-filePath' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-filePath-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-filePath-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-filePath-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in filePath: 16</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Upload.html#a5eca1d77859b353ed254bc05bfc82fce">filePath</a> {
    my ($self) = @_;
    my $uuid = $self-&gt;{uuid};
    my $dir = $self-&gt;{dir};
    
    my $infoName = <span class="stringliteral">&quot;$uuid.info&quot;</span>;
    my $infoPath = <span class="stringliteral">&quot;$dir/$infoName&quot;</span>;
    
    my $fileName = <span class="stringliteral">&quot;$uuid.file&quot;</span>;
    my $filePath = <span class="stringliteral">&quot;$dir/$fileName&quot;</span>;
    
<span class="preprocessor">    # make sure info file still exists (i.e. the file hasn&#39;t been disposed of)</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless -e $infoPath;
    
    <span class="keywordflow">return</span> $filePath;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a88173b6512720736a2886ffa112e2ea6"></a><!-- doxytag: member="WeBWorK::Upload::hash" ref="a88173b6512720736a2886ffa112e2ea6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Upload::hash </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-hash' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-hash-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-hash-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-hash-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in hash: 14</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Upload.html#a88173b6512720736a2886ffa112e2ea6">hash</a> {
    my ($self) = @_;
    my $uuid = $self-&gt;{uuid};
    my $dir = $self-&gt;{dir};
    my $hash = $self-&gt;{<a class="code" href="classWeBWorK_1_1Upload.html#a88173b6512720736a2886ffa112e2ea6">hash</a>};
    
    my $infoName = <span class="stringliteral">&quot;$uuid.info&quot;</span>;
    my $infoPath = <span class="stringliteral">&quot;$dir/$infoName&quot;</span>;
    
<span class="preprocessor">    # make sure info file still exists (i.e. the file hasn&#39;t been disposed of)</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless -e $infoPath;
    
    <span class="keywordflow">return</span> $hash;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="afae9fec80a1a6486fa2d6dbb2abb272e"></a><!-- doxytag: member="WeBWorK::Upload::id" ref="afae9fec80a1a6486fa2d6dbb2abb272e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Upload::id </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-id' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-id-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-id-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-id-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in id: 13</span>
<span class="preprocessor"></span>sub <span class="keywordtype">id</span> {
    my ($self) = @_;
    my $uuid = $self-&gt;{uuid};
    my $dir = $self-&gt;{dir};
    
    my $infoName = <span class="stringliteral">&quot;$uuid.info&quot;</span>;
    my $infoPath = <span class="stringliteral">&quot;$dir/$infoName&quot;</span>;
    
<span class="preprocessor">    # make sure info file still exists (i.e. the file hasn&#39;t been disposed of)</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless -e $infoPath;
    
    <span class="keywordflow">return</span> $uuid;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a565ff8cd52013d596c590e88e76e4450"></a><!-- doxytag: member="WeBWorK::Upload::retrieve" ref="a565ff8cd52013d596c590e88e76e4450" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Upload::retrieve </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-retrieve' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-retrieve-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-retrieve-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-retrieve-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in retrieve: 41</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Upload.html#a565ff8cd52013d596c590e88e76e4450">retrieve</a> {
    my ($invocant, $uuid, $hash, %options) = @_;
    
    croak <span class="stringliteral">&quot;no upload ID specified&quot;</span> unless $uuid;
    croak <span class="stringliteral">&quot;no upload hash specified&quot;</span> unless $hash;
    
    my $infoName = <span class="stringliteral">&quot;$uuid.info&quot;</span>;
    my $infoPath = <span class="stringliteral">&quot;$options{dir}/$infoName&quot;</span>;
    
    my $fileName = <span class="stringliteral">&quot;$uuid.file&quot;</span>;
    my $filePath = <span class="stringliteral">&quot;$options{dir}/$fileName&quot;</span>;
    
    croak <span class="stringliteral">&quot;no upload matches the ID specified&quot;</span> unless -e $infoPath;
    
<span class="preprocessor">    # get real file name and secret from info file</span>
<span class="preprocessor"></span>    open my $infoFH, <span class="stringliteral">&quot;&lt;&quot;</span>, $infoPath
        or die <span class="stringliteral">&quot;failed to read upload info file $infoPath: $!&quot;</span>;
    my ($realFileName, $secret) = &lt;$infoFH&gt;;
    close $infoFH;
    
<span class="preprocessor">    # jesus christ</span>
<span class="preprocessor"></span>    chomp $realFileName;
    chomp $secret;
    
<span class="preprocessor">    # generate correct hash from $uuid and $secret</span>
<span class="preprocessor"></span>    my $correctHash = md5_hex($uuid, $secret);
    
<span class="preprocessor">    #warn __PACKAGE__, &quot;: secret is $secret\n&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #warn __PACKAGE__, &quot;: correctHash is $correctHash\n&quot;;</span>
<span class="preprocessor"></span>    
    croak <span class="stringliteral">&quot;upload hash incorrect!&quot;</span> unless $hash eq $correctHash;
    
<span class="preprocessor">    # -- you passed the test... --</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">return</span> bless {
        uuid =&gt; $uuid,
        dir =&gt; $options{dir},
        <a class="code" href="classWeBWorK_1_1Upload.html#a88173b6512720736a2886ffa112e2ea6">hash</a> =&gt; $hash,
        realFileName =&gt; $realFileName,
    }, ref($invocant) || $invocant;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="adce51956076f79d63cdf26a63d597ef0"></a><!-- doxytag: member="WeBWorK::Upload::store" ref="adce51956076f79d63cdf26a63d597ef0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Upload::store </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-store' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-store-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-store-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-store-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in store: 41</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Upload.html#adce51956076f79d63cdf26a63d597ef0">store</a> {
    my ($invocant, $apacheUpload, %options) = @_;
    
    croak <span class="stringliteral">&quot;no Apache::Upload specified&quot;</span> unless $apacheUpload;
    
<span class="preprocessor">    # generate UUID</span>
<span class="preprocessor"></span>    my $ug = <span class="keyword">new</span> Data::UUID;
    my $uuid = $ug-&gt;create_str;
    
<span class="preprocessor">    # generate one-time secret</span>
<span class="preprocessor"></span>    my $secret = sprintf(<span class="stringliteral">&quot;%X&quot;</span>x4, map { <span class="keywordtype">int</span> rand 2**32 } 1..4);
    
<span class="preprocessor">    # generate hash from $uuid and $secret</span>
<span class="preprocessor"></span>    my $hash = md5_hex($uuid, $secret);
    
<span class="preprocessor">    # get information about uploaded file</span>
<span class="preprocessor"></span>    my $realFileName = $apacheUpload-&gt;filename;
    my $fh = $apacheUpload-&gt;fh;
    
    my $infoName = <span class="stringliteral">&quot;$uuid.info&quot;</span>;
    my $infoPath = <span class="stringliteral">&quot;$options{dir}/$infoName&quot;</span>;
    
    my $fileName = <span class="stringliteral">&quot;$uuid.file&quot;</span>;
    my $filePath = <span class="stringliteral">&quot;$options{dir}/$fileName&quot;</span>;
    
<span class="preprocessor">    # write info file</span>
<span class="preprocessor"></span>    open my $infoFH, <span class="stringliteral">&quot;&gt;&quot;</span>, $infoPath
        or die <span class="stringliteral">&quot;failed to write upload info file $infoPath: $!&quot;</span>;
    print $infoFH <span class="stringliteral">&quot;$realFileName\n$secret\n&quot;</span>;
    close $infoFH;
    
<span class="preprocessor">    # copy uploaded file</span>
<span class="preprocessor"></span>    copy($fh, $filePath); # the file name is a secret!
    
    <span class="keywordflow">return</span> bless {
        uuid =&gt; $uuid,
        dir  =&gt; $options{dir},
        <a class="code" href="classWeBWorK_1_1Upload.html#a88173b6512720736a2886ffa112e2ea6">hash</a> =&gt; $hash,
        realFileName =&gt; $realFileName,
    }, ref($invocant) || $invocant;
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="Upload_8pm_source.html">Upload.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 23:00:01 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
