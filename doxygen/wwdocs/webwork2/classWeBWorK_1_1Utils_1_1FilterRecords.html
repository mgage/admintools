<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::Utils::FilterRecords Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1Utils.html">Utils</a>::<a class="el" href="classWeBWorK_1_1Utils_1_1FilterRecords.html">FilterRecords</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::Utils::FilterRecords Class Reference</h1><!-- doxytag: class="WeBWorK::Utils::FilterRecords" --><!-- doxytag: inherits="WeBWorK::Utils" --><div class="dynheader">
Inheritance diagram for WeBWorK::Utils::FilterRecords:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Utils_1_1FilterRecords__inherit__graph.png" border="0" usemap="#WeBWorK_1_1Utils_1_1FilterRecords_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1Utils_1_1FilterRecords_inherit__map" id="WeBWorK_1_1Utils_1_1FilterRecords_inherit__map">
<area shape="rect" href="classWeBWorK_1_1Utils.html" title="WeBWorK::Utils" alt="" coords="48,80,165,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="65,5,148,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::Utils::FilterRecords:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Utils_1_1FilterRecords__coll__graph.png" border="0" usemap="#WeBWorK_1_1Utils_1_1FilterRecords_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1Utils_1_1FilterRecords_coll__map" id="WeBWorK_1_1Utils_1_1FilterRecords_coll__map">
<area shape="rect" href="classWeBWorK_1_1Utils.html" title="WeBWorK::Utils" alt="" coords="48,80,165,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="65,5,148,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1Utils_1_1FilterRecords-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1FilterRecords.html#a2f16ec3d09f4fa11f89b91a971b04244">filterRecords</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1FilterRecords.html#a61a059d1a1cc35be75703cd06a291d18">getFiltersForClass</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1Utils_1_1FilterRecords.html">WeBWorK::Utils::FilterRecords</a> - utilities for sorting database records.</p>
<h2><a class="anchor" id="SYNOPSIS">
SYNOPSIS</a></h2>
<pre> use <a class="el" href="classWeBWorK_1_1Utils_1_1FilterRecords.html">WeBWorK::Utils::FilterRecords</a> qw/getFiltersForClass/;</pre><pre> # get a list of sorts
 my ($FiltersRef, $FilterLabelsRef) = getFiltersForClass(@Users);
 my @filters      = @$filtersRef;      # filter names
 my %FilterLabels = %$FilterLabelsRef; # suitable for CGI's "-labels" parameter</pre><pre> use <a class="el" href="classWeBWorK_1_1Utils_1_1FilterRecords.html">WeBWorK::Utils::FilterRecords</a> qw/FilterRecords/;</pre><pre> # start with a list of records
 my @Users = $db-&gt;getUsers($db-&gt;listUsers);</pre><pre> # sort the records using a preset
 @FilteredUsers = <a class="el" href="classWeBWorK_1_1Utils_1_1FilterRecords.html">FilterRecords</a>({preset=&gt;"none"}, @Users);</pre><pre> # or provide a custom sort
 @FilteredUsers = <a class="el" href="classWeBWorK_1_1Utils_1_1FilterRecords.html">FilterRecords</a>({fields=&gt;[qw/section /]}, @Users);</pre><h2><a class="anchor" id="DESCRIPTION">
DESCRIPTION</a></h2>
<p>This module provides record filtering functions, and a collection of preset filters for the standard <a class="el" href="classWeBWorK.html">WeBWorK</a> record classes. Filters are specified by a list of field names. Records that match the current user in the specified field will be allowed through</p>
<h2><a class="anchor" id="FUNCTIONS">
FUNCTIONS</a></h2>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_getFiltersForClass__class_"></a><b>getFiltersForClass($class)</b> </p>
<p>Given the name of a record class, returns the preset filters available for that class. </p>
<p>The return value consists of a two-element list. The first element is a reference to a list of filter names. The second element is a reference to a hash mapping filter names to string descriptions. </p>
<p>Together, these two lists are suitable for passing to the </p>
<div class="fragment"><pre class="fragment">-values
</pre></div><p> and</p>
<div class="fragment"><pre class="fragment">-labels
</pre></div><p> parameters of several <a class="el" href="classWeBWorK_1_1CGI.html">CGI</a> module methods, i.e. popup_menu(), scrolling_list(), checkbox_group(), and radio_group().  </p>
</li>
</ul>
<p>Given a sort specification (or the name of a preset format) and a list of records, returns a list of the same records in order according to the sort. </p>
<p>%options can consist of either: </p>
<pre> preset =&gt; the name of a preset format listed by getFormatsForClass()</pre><p>or: </p>
<pre> fields =&gt; a reference to a list of fields in the records' class</pre><p>If </p>
<div class="fragment"><pre class="fragment">preset
</pre></div><p> is given, and its value does not match any known preset but <em>is</em> the name of a field in the record class, the records will be sorted by that field. </p>
<p>If </p>
<div class="fragment"><pre class="fragment">fields
</pre></div><p> is given, the records are sorted according to the specified fields. If multiple fields are specified, the second field is is consulted if two records are found to have identical first fields, and so on.</p>
<h2><a class="anchor" id="BUGS">
BUGS</a></h2>
<p>No provision for case-insensitive, descending, or numeric sorting. </p>
<p>No provision for programmatic sorts. While a one-time programmatic sort can be done easily without using this module, programmatic preset sorts would be useful, i.e. for intelligent sorting of set IDs. </p>
<p>The fields being compared cannot contain nulls, because of the way packed keys are being generated. </p>

<p>Definition at line <a class="el" href="FilterRecords_8pm_source.html#l00095">95</a> of file <a class="el" href="FilterRecords_8pm_source.html">FilterRecords.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a2f16ec3d09f4fa11f89b91a971b04244"></a><!-- doxytag: member="WeBWorK::Utils::FilterRecords::filterRecords" ref="a2f16ec3d09f4fa11f89b91a971b04244" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::FilterRecords::filterRecords </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-filterRecords' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-filterRecords-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-filterRecords-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-filterRecords-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in filterRecords: 28</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1FilterRecords.html#a2f16ec3d09f4fa11f89b91a971b04244">filterRecords</a> {
    my ($options, @Records) = @_;
    
<span class="preprocessor">    # nothing to do</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> () unless @Records;
    
<span class="preprocessor">    # get class info (we assume that the records are all of the same type)</span>
<span class="preprocessor"></span>    
    my %options = %$options;
    
    my @filtersToUse = @{$options{filter}};

    <span class="keywordflow">if</span> (grep {$_ eq <span class="stringliteral">&quot;all&quot;</span>} @filtersToUse) {<span class="keywordflow">return</span> @Records;}
    
    my @GoodRecords = ();
    <span class="keywordflow">foreach</span> my $record (@Records){
    <span class="keywordflow">foreach</span> my $fil (@filtersToUse){
        my ($name, $value) = split(/:/, $fil);
<span class="preprocessor">        #warn &quot;filter = $fil&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">        #warn &quot;name = $name&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">        #warn &quot;value = $value&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">        #warn &quot;section = $record-&gt;section&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">#       my @data = split(/::/, $record);</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ($record-&gt;$name eq $value) {push @GoodRecords, $record}
    }
    }
    <span class="keywordflow">return</span> @GoodRecords;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a61a059d1a1cc35be75703cd06a291d18"></a><!-- doxytag: member="WeBWorK::Utils::FilterRecords::getFiltersForClass" ref="a61a059d1a1cc35be75703cd06a291d18" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::FilterRecords::getFiltersForClass </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getFiltersForClass' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getFiltersForClass-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getFiltersForClass-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getFiltersForClass-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getFiltersForClass: 38</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1FilterRecords.html#a61a059d1a1cc35be75703cd06a291d18">getFiltersForClass</a> {
    my (@Records) = @_;

    my (%sections, %recitations);
    my (@names,%labels);
    push @names, <span class="stringliteral">&quot;all&quot;</span>;
    $labels{all} = <span class="stringliteral">&quot;Display all possible records&quot;</span>;
    
    <span class="keywordflow">if</span> (ref $Records[0] eq <span class="stringliteral">&quot;WeBWorK::DB::Record::User&quot;</span>){
        <span class="keywordflow">foreach</span> my $user (@Records){
            $sections{$user-&gt;section}++;
            $recitations{$user-&gt;recitation}++;
        }
    
        <span class="keywordflow">if</span> (scalar(keys %sections) &gt; 1) {
          <span class="keywordflow">foreach</span> my $sec (<a class="code" href="classWeBWorK_1_1Utils.html#a765334eb4484125d0ea5ad2a68b3b1f2">sortByName</a>(undef, keys %sections)){
            push @names, <span class="stringliteral">&quot;section:$sec&quot;</span>;
            <span class="keywordflow">if</span> ($sec ne <span class="stringliteral">&quot;&quot;</span>){
                $labels{<span class="stringliteral">&quot;section:$sec&quot;</span>} = <span class="stringliteral">&quot;Display section $sec&quot;</span>;
            } <span class="keywordflow">else</span> {
                $labels{<span class="stringliteral">&quot;section:$sec&quot;</span>} = <span class="stringliteral">&quot;Display section &lt;blank&gt;&quot;</span>;
            }
          }
        }

        <span class="keywordflow">if</span> (scalar(keys %recitations) &gt; 1) {
          <span class="keywordflow">foreach</span> my $rec (<a class="code" href="classWeBWorK_1_1Utils.html#a765334eb4484125d0ea5ad2a68b3b1f2">sortByName</a>(undef, keys %recitations)){
            push @names, <span class="stringliteral">&quot;recitation:$rec&quot;</span>;
            <span class="keywordflow">if</span> ($rec ne <span class="stringliteral">&quot;&quot;</span>){
                $labels{<span class="stringliteral">&quot;recitation:$rec&quot;</span>} = <span class="stringliteral">&quot;Display recitation $rec&quot;</span>;
            } <span class="keywordflow">else</span> {
                    $labels{<span class="stringliteral">&quot;recitation:$rec&quot;</span>} = <span class="stringliteral">&quot;Display recitation &lt;blank&gt;&quot;</span>;
            }
          }
        }
    }
    <span class="keywordflow">return</span> ( \@names, \%labels );
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="FilterRecords_8pm_source.html">FilterRecords.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 23:00:22 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
