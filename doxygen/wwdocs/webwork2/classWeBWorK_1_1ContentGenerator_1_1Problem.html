<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::ContentGenerator::Problem Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator.html">ContentGenerator</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html">Problem</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::ContentGenerator::Problem Class Reference</h1><!-- doxytag: class="WeBWorK::ContentGenerator::Problem" --><!-- doxytag: inherits="WeBWorK::ContentGenerator" --><div class="dynheader">
Inheritance diagram for WeBWorK::ContentGenerator::Problem:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Problem__inherit__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Problem_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Problem_inherit__map" id="WeBWorK_1_1ContentGenerator_1_1Problem_inherit__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="33,80,225,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="88,5,171,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::ContentGenerator::Problem:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Problem__coll__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Problem_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Problem_coll__map" id="WeBWorK_1_1ContentGenerator_1_1Problem_coll__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="33,80,225,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="88,5,171,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1ContentGenerator_1_1Problem-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a5b641f7ce4102ad926bbe1a1bee1e07d">output_past_answer_button</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a538013d0ae630d620ff750fee7727c72">can_showHints</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a0fbd3d52d80756e95d4efe140db41cc6">output_checkboxes</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#aee10df8b75bfbf5851e2b4c54982d155">output_wztooltip_JS</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a50e4b0d84f00cd29294647a59516fcdb">output_score_summary</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a461931607818f34aa384218d05fea011">can_body_parts</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a0fb7411e1038ede519c3722c1ac04400">can_showCorrectAnswers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#afbd994a6d1f9b16b1410a44c2b224dc5">nav</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#ac617cdd326d8faea23113465cd4e150a">can_checkAnswers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#afadef18e0ceac6941a41153a66d7dea2">set_showOldAnswers_default</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#ae7b1e4d25e117ae799f14070ae868090">output_email_instructor</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a90da80416ca294368a4d7fa82205f45f">warnings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a2d7190c9403f0e022aa800671398189a">head</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a983fd27f5d107394fd54b4c5b2e656ea">output_form_start</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a00bc76ff83a23a74a2598f46ecb5a3f2">previewAnswer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a5f1b03dc35734884c481dc25d6535cab">can_recordAnswers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a327eee35b1efde3c4b38c92482eecc60">attemptResults</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#aba0b03e5353605d8a6dd2fd1eb659e26">previewCorrectAnswer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#abf4675596a12b87f8a990695bc4f136d">output_JS</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#af971a886cfe86ea8e5c5788e41baa387">output_custom_edit_message</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a92f64bca9b0cc8196d23ecd1e76aab99">title</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a2f0ac3f6f5d0808b23a47cb2df03225a">output_problem_body</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a4d361c5714a925ee998efb2d35b61a27">options</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a232671ea99005df3a2de141d70dce950">pre_header_initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a941e2997220bffc2f57ab014b1cf61db">body</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a53d8009c43a89f45603a4d88b3c2cdb8">output_summary</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a34fa25000dd1b6fc9ba362fb42b72307">output_removDupli_JS</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#ab5fc606be37453174489160d3213d1fe">output_message</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a7f058e347cf5e1b438e4ba3f949f34ed">can_showSolutions</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a7632bfd0c4eb88cbdb3b3ba5ddf22d1f">can_showOldAnswers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a806e1e3642c7fd46e5dba374551db7ba">siblings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a41b091303d677cac168a7a74bc3f535f">output_hidden_info</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a23670b662afcfffa68fe9b32e836a445">output_editorLink</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a34383d97a035d8768169cf50bd5eeb06">output_submit_buttons</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#ad7e5eef3af99b10a25437e5a8e4ab4a7">output_misc</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html">WeBWorK::ContentGenerator::Problem</a> - Allow a student to interact with a problem. </p>

<p>Definition at line <a class="el" href="ContentGenerator_2Problem_8pm_source.html#l00027">27</a> of file <a class="el" href="ContentGenerator_2Problem_8pm_source.html">ContentGenerator/Problem.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a327eee35b1efde3c4b38c92482eecc60"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::attemptResults" ref="a327eee35b1efde3c4b38c92482eecc60" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::attemptResults </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-attemptResults' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-attemptResults-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-attemptResults-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-attemptResults-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in attemptResults: 141</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a327eee35b1efde3c4b38c92482eecc60">attemptResults</a> {
    my $self = shift;
    my $r = $self-&gt;r;
    my $pg = shift;
    my $showAttemptAnswers = shift;
    my $showCorrectAnswers = shift;
    my $showAttemptResults = $showAttemptAnswers &amp;&amp; shift;
    my $showSummary = shift;
    my $showAttemptPreview = shift || 0;
    
    my $ce = $self-&gt;r-&gt;ce;
    
<span class="preprocessor">    # for color coding the responses.</span>
<span class="preprocessor"></span>    my @correct_ids = ();
    my @incorrect_ids = ();


    my $problemResult = $pg-&gt;{result}; # the overall result of the problem
    my @answerNames = @{ $pg-&gt;{flags}-&gt;{ANSWER_ENTRY_ORDER} };
    
    my $showMessages = $showAttemptAnswers &amp;&amp; grep { $pg-&gt;{answers}-&gt;{$_}-&gt;{ans_message} } @answerNames;
    
    my $basename = <span class="stringliteral">&quot;equation-&quot;</span> . $self-&gt;{<span class="keyword">set</span>}-&gt;psvn. <span class="stringliteral">&quot;.&quot;</span> . $self-&gt;{problem}-&gt;problem_id . <span class="stringliteral">&quot;-preview&quot;</span>;
    
<span class="preprocessor">    # to make grabbing these options easier, we&#39;ll pull them out now...</span>
<span class="preprocessor"></span>    my %imagesModeOptions = %{$ce-&gt;{pg}-&gt;{displayModeOptions}-&gt;{images}};
    
    my $imgGen = WeBWorK::PG::ImageGenerator-&gt;new(
        tempDir         =&gt; $ce-&gt;{webworkDirs}-&gt;{tmp},
        latex           =&gt; $ce-&gt;{externalPrograms}-&gt;{latex},
        dvipng          =&gt; $ce-&gt;{externalPrograms}-&gt;{dvipng},
        useCache        =&gt; 1,
        cacheDir        =&gt; $ce-&gt;{webworkDirs}-&gt;{equationCache},
        cacheURL        =&gt; $ce-&gt;{webworkURLs}-&gt;{equationCache},
        cacheDB         =&gt; $ce-&gt;{webworkFiles}-&gt;{equationCacheDB},
        dvipng_align    =&gt; $imagesModeOptions{dvipng_align},
        dvipng_depth_db =&gt; $imagesModeOptions{dvipng_depth_db},
    );
    
    my $showEvaluatedAnswers = $ce-&gt;{pg}-&gt;{options}-&gt;{showEvaluatedAnswers};

    my $header;
<span class="preprocessor">    #$header .= CGI::th(&quot;Part&quot;);</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($showEvaluatedAnswers) {
        $header .= $showAttemptAnswers ? CGI::th($r-&gt;maketext(<span class="stringliteral">&quot;Entered&quot;</span>))  : <span class="stringliteral">&quot;&quot;</span>;
    }   
    $header .= $showAttemptPreview ? CGI::th($r-&gt;maketext(<span class="stringliteral">&quot;Answer Preview&quot;</span>))  : <span class="stringliteral">&quot;&quot;</span>;
    $header .= $showCorrectAnswers ? CGI::th($r-&gt;maketext(<span class="stringliteral">&quot;Correct&quot;</span>))  : <span class="stringliteral">&quot;&quot;</span>;
    $header .= $showAttemptResults ? CGI::th($r-&gt;maketext(<span class="stringliteral">&quot;Result&quot;</span>))   : <span class="stringliteral">&quot;&quot;</span>;
    $header .= $showMessages       ? CGI::th($r-&gt;maketext(<span class="stringliteral">&quot;Messages&quot;</span>)) : <span class="stringliteral">&quot;&quot;</span>;
    my $fully = <span class="stringliteral">&#39;&#39;</span>;
    my @tableRows = ( $header );
    my $numCorrect = 0;
    my $numBlanks  =0;
    my $tthPreambleCache;
    <span class="keywordflow">foreach</span> my $name (@answerNames) {
        my $answerResult  = $pg-&gt;{answers}-&gt;{$name};
        my $studentAnswer = $answerResult-&gt;{student_ans}; # original_student_ans
        my $preview       = ($showAttemptPreview
                                ? $self-&gt;previewAnswer($answerResult, $imgGen, \$tthPreambleCache)
                                : <span class="stringliteral">&quot;&quot;</span>);
        my $correctAnswerPreview = $self-&gt;previewCorrectAnswer($answerResult, $imgGen, \$tthPreambleCache);
        my $correctAnswer = $answerResult-&gt;{correct_ans};
        my $answerScore   = $answerResult-&gt;{score};
        my $answerMessage = $showMessages ? $answerResult-&gt;{ans_message} : <span class="stringliteral">&quot;&quot;</span>;
        $answerMessage =~ s/\n/&lt;BR&gt;/g;
        $numCorrect += $answerScore &gt;= 1;
        $numBlanks++ unless $studentAnswer =~/\S/ || $answerScore &gt;= 1;   # unless student answer contains entry
        my $resultString = $answerScore &gt;= 1 ? CGI::span({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>}, $r-&gt;maketext(<span class="stringliteral">&quot;Correct&quot;</span>)) :
                           $answerScore &gt; 0  ? $r-&gt;maketext(<span class="stringliteral">&quot;[_1]% correct&quot;</span>, <span class="keywordtype">int</span>($answerScore*100)) :
                                                       CGI::span({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, $r-&gt;maketext(<span class="stringliteral">&quot;Incorrect&quot;</span>));
        $fully = $r-&gt;maketext(<span class="stringliteral">&quot;completely&quot;</span>) <span class="keywordflow">if</span> $answerScore &gt;0 and $answerScore &lt; 1;
        
        push @correct_ids,   $name <span class="keywordflow">if</span> $answerScore == 1;
        push @incorrect_ids, $name <span class="keywordflow">if</span> $answerScore &lt; 1;
        
<span class="preprocessor">        # need to capture auxiliary answers as well and identify their ids.</span>
<span class="preprocessor"></span>        
        
        my $row;
<span class="preprocessor">        #$row .= CGI::td($name);</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ($showEvaluatedAnswers) {
          $row .= $showAttemptAnswers ? CGI::td($self-&gt;nbsp($studentAnswer)) : <span class="stringliteral">&quot;&quot;</span>;
        }
        $row .= $showAttemptPreview ? CGI::td({onmouseover=&gt;qq!Tip(<span class="stringliteral">&#39;$studentAnswer&#39;</span>,SHADOW, <span class="keyword">true</span>, 
                            DELAY, 1000, FADEIN, 300, FADEOUT, 300, STICKY, 1, OFFSETX, -20, CLOSEBTN, <span class="keyword">true</span>, CLICKCLOSE, <span class="keyword">false</span>, 
                            BGCOLOR, <span class="stringliteral">&#39;#F4FF91&#39;</span>, TITLE, <span class="stringliteral">&#39;Entered:&#39;</span>,TITLEBGCOLOR, <span class="stringliteral">&#39;#F4FF91&#39;</span>, TITLEFONTCOLOR, <span class="stringliteral">&#39;#000000&#39;</span>)!},
                            $self-&gt;nbsp($preview))       : <span class="stringliteral">&quot;&quot;</span>;
        $row .= $showCorrectAnswers ? CGI::td({onmouseover=&gt; qq!Tip(<span class="stringliteral">&#39;$correctAnswer&#39;</span>,SHADOW, <span class="keyword">true</span>, 
                            DELAY, 1000, FADEIN, 300, FADEOUT, 300, STICKY, 1, OFFSETX, -20, CLOSEBTN, <span class="keyword">true</span>, CLICKCLOSE, <span class="keyword">false</span>, 
                            BGCOLOR, <span class="stringliteral">&#39;#F4FF91&#39;</span>, TITLE, <span class="stringliteral">&#39;Entered:&#39;</span>,TITLEBGCOLOR, <span class="stringliteral">&#39;#F4FF91&#39;</span>, TITLEFONTCOLOR, <span class="stringliteral">&#39;#000000&#39;</span>)!},
                          $self-&gt;nbsp($correctAnswerPreview)) : <span class="stringliteral">&quot;&quot;</span>;
        $row .= $showAttemptResults ? CGI::td($self-&gt;nbsp($resultString))  : <span class="stringliteral">&quot;&quot;</span>;
        $row .= $showMessages       ? CGI::td({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;Message&quot;</span>},$self-&gt;nbsp($answerMessage)) : <span class="stringliteral">&quot;&quot;</span>;
        push @tableRows, $row;
    }
    
<span class="preprocessor">    # render equation images</span>
<span class="preprocessor"></span>    $imgGen-&gt;render(refresh =&gt; 1);
    
<span class="preprocessor">#   my $numIncorrectNoun = scalar @answerNames == 1 ? &quot;question&quot; : &quot;questions&quot;;</span>
<span class="preprocessor"></span>    my $scorePercent = sprintf(<span class="stringliteral">&quot;%.0f%%&quot;</span>, $problemResult-&gt;{score} * 100);
<span class="preprocessor">#   FIXME  -- I left the old code in in case we have to back out.</span>
<span class="preprocessor"></span><span class="preprocessor">#   my $summary = &quot;On this attempt, you answered $numCorrect out of &quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#       . scalar @answerNames . &quot; $numIncorrectNoun correct, for a score of $scorePercent.&quot;;</span>
<span class="preprocessor"></span>    my $summary = <span class="stringliteral">&quot;&quot;</span>; 
    unless (defined($problemResult-&gt;{summary}) and $problemResult-&gt;{summary} =~ /\S/) {
        <span class="keywordflow">if</span> (scalar @answerNames == 1) {  #<span class="keywordflow">default</span> messages
                <span class="keywordflow">if</span> ($numCorrect == scalar @answerNames) {
                    $summary .= CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},$r-&gt;maketext(<span class="stringliteral">&quot;The answer above is correct.&quot;</span>));
                 } <span class="keywordflow">else</span> {
                     $summary .= CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},$r-&gt;maketext(<span class="stringliteral">&quot;The answer above is NOT [_1]correct.&quot;</span>, $fully));
                 }
        } <span class="keywordflow">else</span> {
                <span class="keywordflow">if</span> ($numCorrect == scalar @answerNames) {
                    $summary .= CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},$r-&gt;maketext(<span class="stringliteral">&quot;All of the answers above are correct.&quot;</span>));
                 } 
<span class="preprocessor">                 #unless ($numCorrect + $numBlanks == scalar( @answerNames)) { # this allowed you to figure out if you got one answer right.</span>
<span class="preprocessor"></span>                 elsif ($numBlanks != scalar( @answerNames)) {
                    $summary .= CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},$r-&gt;maketext(<span class="stringliteral">&quot;At least one of the answers above is NOT [_1]correct.&quot;</span>, $fully));
                 }
                 <span class="keywordflow">if</span> ($numBlanks) {
                    my $s = ($numBlanks&gt;1)?<span class="stringliteral">&#39;&#39;</span>:<span class="charliteral">&#39;s&#39;</span>;
                    $summary .= CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsAlert&quot;</span>},$r-&gt;maketext(<span class="stringliteral">&quot;[quant,_1,of the questions remains,of the questions remain] unanswered.&quot;</span>, $numBlanks));
                 }
        }
    } <span class="keywordflow">else</span> {
        $summary = $problemResult-&gt;{summary};   # summary has been defined by grader
    }
    
    $self-&gt;{correct_ids}=[@correct_ids]       <span class="keywordflow">if</span> @correct_ids;
    $self-&gt;{incorrect_ids} = [@incorrect_ids] <span class="keywordflow">if</span> @incorrect_ids;

    <span class="keywordflow">return</span>
        CGI::table({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;attemptResults&quot;</span>}, CGI::Tr(\@tableRows))
        . ($showSummary ? CGI::p({<span class="keyword">class</span>=&gt;<span class="stringliteral">&#39;attemptResultsSummary&#39;</span>},$summary) : <span class="stringliteral">&quot;&quot;</span>);
}


<span class="preprocessor"># Note: previewAnswer is lifted into GatewayQuiz.pm</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a941e2997220bffc2f57ab014b1cf61db"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::body" ref="a941e2997220bffc2f57ab014b1cf61db" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::body </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-body' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-body-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-body-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-body-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in body: 51</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a941e2997220bffc2f57ab014b1cf61db">body</a> {
    my $self = shift;
    my $set = $self-&gt;{<span class="keyword">set</span>};
    my $problem = $self-&gt;{problem};
    my $pg = $self-&gt;{pg};
    print CGI::p(<span class="stringliteral">&quot;Entering Problem::body subroutine.  This indicates an older style system.template file -- consider upgrading. &quot;</span>);
    my $valid = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemUtil_1_1ProblemUtil.html#a50179aed1e96c8806589ed09516eabc4">WeBWorK::ContentGenerator::ProblemUtil::ProblemUtil::check_invalid</a>($self);
    unless($valid eq <span class="stringliteral">&quot;valid&quot;</span>){
        <span class="keywordflow">return</span> $valid;
    }
    
    
    
<span class="preprocessor">    ##### answer processing #####</span>
<span class="preprocessor"></span>    debug(<span class="stringliteral">&quot;begin answer processing&quot;</span>);
<span class="preprocessor">    # if answers were submitted:</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $scoreRecordedMessage = WeBWorK::ContentGenerator::ProblemUtil::ProblemUtil::process_and_log_answer($self);</span>
<span class="preprocessor"></span>    debug(<span class="stringliteral">&quot;end answer processing&quot;</span>);
<span class="preprocessor">    # output for templates that only use body instead of calling the body parts individually</span>
<span class="preprocessor"></span>    $self -&gt;output_JS;
    $self -&gt;output_custom_edit_message;
    $self -&gt;output_summary;
    $self -&gt;output_hidden_info;
    $self -&gt;output_form_start();
    $self -&gt;output_problem_body;
    $self -&gt;output_message;
    $self -&gt;output_editorLink;
    $self -&gt;output_checkboxes;
    $self -&gt;output_submit_buttons;
    $self -&gt;output_score_summary;
    $self -&gt;output_misc;
    print <span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;
<span class="preprocessor">    # debugging stuff</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (0) {
        print
            CGI::hr(),
            CGI::h2(<span class="stringliteral">&quot;debugging information&quot;</span>),
            CGI::h3(<span class="stringliteral">&quot;form fields&quot;</span>),
            ref2string($self-&gt;{formFields}),
            CGI::h3(<span class="stringliteral">&quot;user object&quot;</span>),
            ref2string($self-&gt;{user}),
            CGI::h3(<span class="stringliteral">&quot;set object&quot;</span>),
            ref2string($set),
            CGI::h3(<span class="stringliteral">&quot;problem object&quot;</span>),
            ref2string($problem),
            CGI::h3(<span class="stringliteral">&quot;PG object&quot;</span>),
            ref2string($pg, {<span class="stringliteral">&#39;WeBWorK::PG::Translator&#39;</span> =&gt; 1});
    }
    debug(<span class="stringliteral">&quot;leaving body of Problem.pm&quot;</span>);
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a461931607818f34aa384218d05fea011"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::can_body_parts" ref="a461931607818f34aa384218d05fea011" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::can_body_parts </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-can_body_parts' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-can_body_parts-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-can_body_parts-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-can_body_parts-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in can_body_parts: 3</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a461931607818f34aa384218d05fea011">can_body_parts</a>{
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac617cdd326d8faea23113465cd4e150a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::can_checkAnswers" ref="ac617cdd326d8faea23113465cd4e150a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::can_checkAnswers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-can_checkAnswers' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-can_checkAnswers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-can_checkAnswers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-can_checkAnswers-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in can_checkAnswers: 21</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#ac617cdd326d8faea23113465cd4e150a">can_checkAnswers</a> {
    my ($self, $User, $EffectiveUser, $Set, $Problem, $submitAnswers) = @_;
    my $authz = $self-&gt;r-&gt;authz;
    my $thisAttempt = $submitAnswers ? 1 : 0;
    
    <span class="keywordflow">if</span> (before($Set-&gt;open_date)) {
        <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;check_answers_before_open_date&quot;</span>);
    } elsif (between($Set-&gt;open_date, $Set-&gt;due_date)) {
        my $max_attempts = $Problem-&gt;max_attempts;
        my $attempts_used = $Problem-&gt;num_correct + $Problem-&gt;num_incorrect + $thisAttempt;
        <span class="keywordflow">if</span> ($max_attempts == -1 or $attempts_used &lt; $max_attempts) {
            <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;check_answers_after_open_date_with_attempts&quot;</span>);
        } <span class="keywordflow">else</span> {
            <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;check_answers_after_open_date_without_attempts&quot;</span>);
        }
    } elsif (between($Set-&gt;due_date, $Set-&gt;answer_date)) {
        <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;check_answers_after_due_date&quot;</span>);
    } elsif (after($Set-&gt;answer_date)) {
        <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;check_answers_after_answer_date&quot;</span>);
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a5f1b03dc35734884c481dc25d6535cab"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::can_recordAnswers" ref="a5f1b03dc35734884c481dc25d6535cab" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::can_recordAnswers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-can_recordAnswers' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-can_recordAnswers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-can_recordAnswers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-can_recordAnswers-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in can_recordAnswers: 23</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a5f1b03dc35734884c481dc25d6535cab">can_recordAnswers</a> {
    my ($self, $User, $EffectiveUser, $Set, $Problem, $submitAnswers) = @_;
    my $authz = $self-&gt;r-&gt;authz;
    my $thisAttempt = $submitAnswers ? 1 : 0;
    <span class="keywordflow">if</span> ($User-&gt;user_id ne $EffectiveUser-&gt;user_id) {
        <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;record_answers_when_acting_as_student&quot;</span>);
    }
    <span class="keywordflow">if</span> (before($Set-&gt;open_date)) {
        <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;record_answers_before_open_date&quot;</span>);
    } elsif (between($Set-&gt;open_date, $Set-&gt;due_date)) {
        my $max_attempts = $Problem-&gt;max_attempts;
        my $attempts_used = $Problem-&gt;num_correct + $Problem-&gt;num_incorrect + $thisAttempt;
        <span class="keywordflow">if</span> ($max_attempts == -1 or $attempts_used &lt; $max_attempts) {
            <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;record_answers_after_open_date_with_attempts&quot;</span>);
        } <span class="keywordflow">else</span> {
            <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;record_answers_after_open_date_without_attempts&quot;</span>);
        }
    } elsif (between($Set-&gt;due_date, $Set-&gt;answer_date)) {
        <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;record_answers_after_due_date&quot;</span>);
    } elsif (after($Set-&gt;answer_date)) {
        <span class="keywordflow">return</span> $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;record_answers_after_answer_date&quot;</span>);
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a0fb7411e1038ede519c3722c1ac04400"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::can_showCorrectAnswers" ref="a0fb7411e1038ede519c3722c1ac04400" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::can_showCorrectAnswers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-can_showCorrectAnswers' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-can_showCorrectAnswers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-can_showCorrectAnswers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-can_showCorrectAnswers-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in can_showCorrectAnswers: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a0fb7411e1038ede519c3722c1ac04400">can_showCorrectAnswers</a> {
    my ($self, $User, $EffectiveUser, $Set, $Problem) = @_;
    my $authz = $self-&gt;r-&gt;authz;
    
    <span class="keywordflow">return</span>
        after($Set-&gt;answer_date)
            ||
        $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;show_correct_answers_before_answer_date&quot;</span>)
        ;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a538013d0ae630d620ff750fee7727c72"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::can_showHints" ref="a538013d0ae630d620ff750fee7727c72" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::can_showHints </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-can_showHints' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-can_showHints-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-can_showHints-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-can_showHints-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in can_showHints: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a538013d0ae630d620ff750fee7727c72">can_showHints</a> {
<span class="preprocessor">    #my ($self, $User, $EffectiveUser, $Set, $Problem) = @_;</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">return</span> 1;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7632bfd0c4eb88cbdb3b3ba5ddf22d1f"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::can_showOldAnswers" ref="a7632bfd0c4eb88cbdb3b3ba5ddf22d1f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::can_showOldAnswers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-can_showOldAnswers' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-can_showOldAnswers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-can_showOldAnswers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-can_showOldAnswers-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in can_showOldAnswers: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a7632bfd0c4eb88cbdb3b3ba5ddf22d1f">can_showOldAnswers</a> {
<span class="preprocessor">    #my ($self, $User, $EffectiveUser, $Set, $Problem) = @_;</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">return</span> 1;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7f058e347cf5e1b438e4ba3f949f34ed"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::can_showSolutions" ref="a7f058e347cf5e1b438e4ba3f949f34ed" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::can_showSolutions </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-can_showSolutions' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-can_showSolutions-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-can_showSolutions-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-can_showSolutions-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in can_showSolutions: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a7f058e347cf5e1b438e4ba3f949f34ed">can_showSolutions</a> {
    my ($self, $User, $EffectiveUser, $Set, $Problem) = @_;
    my $authz = $self-&gt;r-&gt;authz;
    
    <span class="keywordflow">return</span>
        after($Set-&gt;answer_date)
            ||
        $authz-&gt;hasPermissions($User-&gt;user_id, <span class="stringliteral">&quot;show_solutions_before_answer_date&quot;</span>)
        ;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2d7190c9403f0e022aa800671398189a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::head" ref="a2d7190c9403f0e022aa800671398189a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::head </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-head' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-head-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-head-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-head-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in head: 6</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a2d7190c9403f0e022aa800671398189a">head</a> {
    my ($self) = @_;

    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">if</span> ( $self-&gt;{invalidSet} );
    <span class="keywordflow">return</span> $self-&gt;{pg}-&gt;{head_text} <span class="keywordflow">if</span> $self-&gt;{pg}-&gt;{head_text};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="afbd994a6d1f9b16b1410a44c2b224dc5"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::nav" ref="afbd994a6d1f9b16b1410a44c2b224dc5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::nav </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-nav' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-nav-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-nav-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-nav-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in nav: 56</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#afbd994a6d1f9b16b1410a44c2b224dc5">nav</a> {
    my ($self, $args) = @_;
    my $r = $self-&gt;r;
    my $db = $r-&gt;db;
    my $urlpath = $r-&gt;urlpath;

    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">if</span> ( $self-&gt;{invalidSet} );

    my $courseID = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $setID = $self-&gt;{<span class="keyword">set</span>}-&gt;set_id <span class="keywordflow">if</span> !($self-&gt;{invalidSet});
    my $problemID = $self-&gt;{problem}-&gt;problem_id <span class="keywordflow">if</span> !($self-&gt;{invalidProblem});
    my $eUserID = $r-&gt;param(<span class="stringliteral">&quot;effectiveUser&quot;</span>);

    my ($prevID, $nextID);

    <span class="keywordflow">if</span> (!$self-&gt;{invalidProblem}) {
        my @problemIDs = $db-&gt;listUserProblems($eUserID, $setID);
        <span class="keywordflow">foreach</span> my $id (@problemIDs) {
            $prevID = $id <span class="keywordflow">if</span> $id &lt; $problemID
                and (not defined $prevID or $id &gt; $prevID);
            $nextID = $id <span class="keywordflow">if</span> $id &gt; $problemID
                and (not defined $nextID or $id &lt; $nextID);
        }
    }

    my @links;

    <span class="keywordflow">if</span> ($prevID) {
        my $prevPage = $urlpath-&gt;newFromModule(__PACKAGE__, $r, 
            courseID =&gt; $courseID, setID =&gt; $setID, problemID =&gt; $prevID);
        push @links, $r-&gt;maketext(<span class="stringliteral">&quot;Previous Problem&quot;</span>), $r-&gt;location . $prevPage-&gt;path, $r-&gt;maketext(<span class="stringliteral">&quot;navPrev&quot;</span>);
    } <span class="keywordflow">else</span> {
        push @links, $r-&gt;maketext(<span class="stringliteral">&quot;Previous Problem&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, $r-&gt;maketext(<span class="stringliteral">&quot;navPrevGrey&quot;</span>);
    }

    <span class="keywordflow">if</span> (defined($setID) &amp;&amp; $setID ne <span class="stringliteral">&#39;Undefined_Set&#39;</span>) {
        push @links, $r-&gt;maketext(<span class="stringliteral">&quot;Problem List&quot;</span>), $r-&gt;location . $urlpath-&gt;parent-&gt;path, $r-&gt;maketext(<span class="stringliteral">&quot;navProbList&quot;</span>);
    } <span class="keywordflow">else</span> {
        push @links, $r-&gt;maketext(<span class="stringliteral">&quot;Problem List&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, $r-&gt;maketext(<span class="stringliteral">&quot;navProbListGrey&quot;</span>);
    }

    <span class="keywordflow">if</span> ($nextID) {
        my $nextPage = $urlpath-&gt;newFromModule(__PACKAGE__, $r, 
            courseID =&gt; $courseID, setID =&gt; $setID, problemID =&gt; $nextID);
        push @links, $r-&gt;maketext(<span class="stringliteral">&quot;Next Problem&quot;</span>), $r-&gt;location . $nextPage-&gt;path, $r-&gt;maketext(<span class="stringliteral">&quot;navNext&quot;</span>);
    } <span class="keywordflow">else</span> {
        push @links, $r-&gt;maketext(<span class="stringliteral">&quot;Next Problem&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, $r-&gt;maketext(<span class="stringliteral">&quot;navNextGrey&quot;</span>);
    }

    my $tail = <span class="stringliteral">&quot;&quot;</span>;

    $tail .= <span class="stringliteral">&quot;&amp;displayMode=&quot;</span>.$self-&gt;{displayMode} <span class="keywordflow">if</span> defined $self-&gt;{displayMode};
    $tail .= <span class="stringliteral">&quot;&amp;showOldAnswers=&quot;</span>.$self-&gt;{will}-&gt;{showOldAnswers}
        <span class="keywordflow">if</span> defined $self-&gt;{will}-&gt;{showOldAnswers};
    <span class="keywordflow">return</span> $self-&gt;navMacro($args, $tail, @links);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4d361c5714a925ee998efb2d35b61a27"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::options" ref="a4d361c5714a925ee998efb2d35b61a27" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::options </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-options' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-options-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-options-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-options-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in options: 20</span>
<span class="preprocessor"></span>sub options {
    my ($self) = @_;
<span class="preprocessor">    #warn &quot;doing options in Problem&quot;;</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    # don&#39;t show options if we don&#39;t have anything to show</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">if</span> $self-&gt;{invalidSet} or $self-&gt;{invalidProblem};
    
    my $displayMode = $self-&gt;{displayMode};
    my %can = %{ $self-&gt;{can} };
    
    my @options_to_show = <span class="stringliteral">&quot;displayMode&quot;</span>;
    push @options_to_show, <span class="stringliteral">&quot;showOldAnswers&quot;</span> <span class="keywordflow">if</span> $can{showOldAnswers};
    push @options_to_show, <span class="stringliteral">&quot;showHints&quot;</span> <span class="keywordflow">if</span> $can{showHints};
    push @options_to_show, <span class="stringliteral">&quot;showSolutions&quot;</span> <span class="keywordflow">if</span> $can{showSolutions};
    
    <span class="keywordflow">return</span> $self-&gt;optionsMacro(
        options_to_show =&gt; \@options_to_show,
        extra_params =&gt; [<span class="stringliteral">&quot;editMode&quot;</span>, <span class="stringliteral">&quot;sourceFilePath&quot;</span>],
    );
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a0fbd3d52d80756e95d4efe140db41cc6"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_checkboxes" ref="a0fbd3d52d80756e95d4efe140db41cc6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_checkboxes </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_checkboxes' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_checkboxes-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_checkboxes-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_checkboxes-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_checkboxes: 69</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a0fbd3d52d80756e95d4efe140db41cc6">output_checkboxes</a>{
    my $self = shift;
    my $r = $self-&gt;r;
    my %can = %{ $self-&gt;{can} };
    my %will = %{ $self-&gt;{will} };

    <span class="keywordflow">if</span> ($can{showCorrectAnswers}) {
        print <a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(
            -type    =&gt; <span class="stringliteral">&quot;checkbox&quot;</span>,
            -<span class="keywordtype">id</span>      =&gt; <span class="stringliteral">&quot;showCorrectAnswers_id&quot;</span>,
            -label_text =&gt; $r-&gt;maketext(<span class="stringliteral">&quot;Show correct answers&quot;</span>),
            -input_attr =&gt; $will{showCorrectAnswers} ?
            {
                -name    =&gt; <span class="stringliteral">&quot;showCorrectAnswers&quot;</span>,
                -checked =&gt; <span class="stringliteral">&quot;checked&quot;</span>,
                -value   =&gt; 1,
            }
            :
            {
                -name    =&gt; <span class="stringliteral">&quot;showCorrectAnswers&quot;</span>,
                -value   =&gt; 1,
            }
        );
    }
    <span class="keywordflow">if</span> ($can{showHints}) {
        print CGI::div({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},
            <a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(
                -type    =&gt; <span class="stringliteral">&quot;checkbox&quot;</span>,
                -<span class="keywordtype">id</span>      =&gt; <span class="stringliteral">&quot;showHints_id&quot;</span>,
                -label_text =&gt; $r-&gt;maketext(<span class="stringliteral">&quot;Show Hints&quot;</span>),
                -input_attr =&gt; $will{showHints} ?
                {
                    -name    =&gt; <span class="stringliteral">&quot;showHints&quot;</span>,
                    -checked =&gt; <span class="stringliteral">&quot;checked&quot;</span>,
                    -value   =&gt; 1,
                }
                :
                {
                    -name    =&gt; <span class="stringliteral">&quot;showCorrectAnswers&quot;</span>,
                    -value   =&gt; 1,
                }
            )
        );
    }
    <span class="keywordflow">if</span> ($can{showSolutions}) {
        print <a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(
            -type    =&gt; <span class="stringliteral">&quot;checkbox&quot;</span>,
            -<span class="keywordtype">id</span>      =&gt; <span class="stringliteral">&quot;showSolutions_id&quot;</span>,
            -label_text =&gt; $r-&gt;maketext(<span class="stringliteral">&quot;Show Solutions&quot;</span>),
            -input_attr =&gt; $will{showSolutions} ?
            {
                -name    =&gt; <span class="stringliteral">&quot;showSolutions&quot;</span>,
                -checked =&gt; <span class="stringliteral">&quot;checked&quot;</span>,
                -value   =&gt; 1,
            }
            :
            {
                -name    =&gt; <span class="stringliteral">&quot;showCorrectAnswers&quot;</span>,
                -value   =&gt; 1,
            }
        );
    }
    
    <span class="keywordflow">if</span> ($can{showCorrectAnswers} or $can{showHints} or $can{showSolutions}) {
        print CGI::br();
    }
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="af971a886cfe86ea8e5c5788e41baa387"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_custom_edit_message" ref="af971a886cfe86ea8e5c5788e41baa387" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_custom_edit_message </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_custom_edit_message' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_custom_edit_message-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_custom_edit_message-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_custom_edit_message-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_custom_edit_message: 19</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#af971a886cfe86ea8e5c5788e41baa387">output_custom_edit_message</a>{
    my $self = shift;
    my $r = $self-&gt;r;
    my $authz = $r-&gt;authz;
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $editMode = $self-&gt;{editMode};
    my $problem = $self-&gt;{problem};
    
<span class="preprocessor">    # custom message for editor</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;modify_problem_sets&quot;</span>) and defined $editMode) {
        <span class="keywordflow">if</span> ($editMode eq <span class="stringliteral">&quot;temporaryFile&quot;</span>) {
            print CGI::p(CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&#39;temporaryFile&#39;</span>}, $r-&gt;maketext(<span class="stringliteral">&quot;Viewing temporary file&quot;</span>), $problem-&gt;source_file));
        } elsif ($editMode eq <span class="stringliteral">&quot;savedFile&quot;</span>) {
<span class="preprocessor">            # taken care of in the initialization phase</span>
<span class="preprocessor"></span>        }
    }
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a23670b662afcfffa68fe9b32e836a445"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_editorLink" ref="a23670b662afcfffa68fe9b32e836a445" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_editorLink </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_editorLink' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_editorLink-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_editorLink-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_editorLink-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_editorLink: 49</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a23670b662afcfffa68fe9b32e836a445">output_editorLink</a>{
    
    my $self = shift;
    
    my $set = $self-&gt;{<span class="keyword">set</span>};
    my $problem = $self-&gt;{problem};
    my $pg = $self-&gt;{pg};
    
    my $r = $self-&gt;r;
    
    my $authz = $r-&gt;authz;
    my $urlpath = $r-&gt;urlpath;
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
    my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    
<span class="preprocessor">    # FIXME: move editor link to top, next to problem number.</span>
<span class="preprocessor"></span><span class="preprocessor">    # format as &quot;[edit]&quot; like we&#39;re doing with course info file, etc.</span>
<span class="preprocessor"></span><span class="preprocessor">    # add edit link for set as well.</span>
<span class="preprocessor"></span>    my $editorLink = <span class="stringliteral">&quot;&quot;</span>;
<span class="preprocessor">    # if we are here without a real homework set, carry that through</span>
<span class="preprocessor"></span>    my $forced_field = [];
    $forced_field = [<span class="stringliteral">&#39;sourceFilePath&#39;</span> =&gt;  $r-&gt;param(<span class="stringliteral">&quot;sourceFilePath&quot;</span>)] <span class="keywordflow">if</span>
        ($set-&gt;set_id eq <span class="stringliteral">&#39;Undefined_Set&#39;</span>);
    <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;modify_problem_sets&quot;</span>)) {
        my $editorPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::PGProblemEditor&quot;</span>, $r, 
            courseID =&gt; $courseName, setID =&gt; $set-&gt;set_id, problemID =&gt; $problem-&gt;problem_id);
        my $editorURL = $self-&gt;systemLink($editorPage, params=&gt;$forced_field);
        $editorLink = CGI::p(CGI::a({href=&gt;$editorURL,target =&gt;<span class="stringliteral">&#39;WW_Editor&#39;</span>}, $r-&gt;maketext(<span class="stringliteral">&quot;Edit this problem&quot;</span>)));
    }
    
<span class="preprocessor">    ##### translation errors? #####</span>
<span class="preprocessor"></span>
    <span class="keywordflow">if</span> ($pg-&gt;{flags}-&gt;{error_flag}) {
        <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_problem_debugging_info&quot;</span>)) {
            print <span class="stringliteral">&quot;Call errorOutput&lt;/br&gt;&quot;</span>;
            print $self-&gt;errorOutput($pg-&gt;{errors}, $pg-&gt;{body_text});
            print $editorLink;
        } <span class="keywordflow">else</span> {
            print $self-&gt;errorOutput($pg-&gt;{errors}, $r-&gt;maketext(<span class="stringliteral">&quot;You do not have permission to view the details of this error.&quot;</span>));
        }
        
        print <span class="stringliteral">&quot;&quot;</span>;
    }
    <span class="keywordflow">else</span>{
        print $editorLink;
    }
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae7b1e4d25e117ae799f14070ae868090"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_email_instructor" ref="ae7b1e4d25e117ae799f14070ae868090" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_email_instructor </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_email_instructor' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_email_instructor-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_email_instructor-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_email_instructor-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_email_instructor: 20</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#ae7b1e4d25e117ae799f14070ae868090">output_email_instructor</a>{
    my $self = shift;
    my $problem = $self-&gt;{problem};
    my %will = %{ $self-&gt;{will} };
    my $pg = $self-&gt;{pg};

    print $self-&gt;feedbackMacro(
        module             =&gt; __PACKAGE__,
        <span class="keyword">set</span>                =&gt; $self-&gt;{<span class="keyword">set</span>}-&gt;set_id,
        problem            =&gt; $problem-&gt;problem_id,
        displayMode        =&gt; $self-&gt;{displayMode},
        showOldAnswers     =&gt; $will{showOldAnswers},
        showCorrectAnswers =&gt; $will{showCorrectAnswers},
        showHints          =&gt; $will{showHints},
        showSolutions      =&gt; $will{showSolutions},
        pg_object          =&gt; $pg,
    );
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a983fd27f5d107394fd54b4c5b2e656ea"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_form_start" ref="a983fd27f5d107394fd54b4c5b2e656ea" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_form_start </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_form_start' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_form_start-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_form_start-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_form_start-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_form_start: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a983fd27f5d107394fd54b4c5b2e656ea">output_form_start</a>{
    my $self = shift;
    my $r = $self-&gt;r;
    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt; $r-&gt;uri,-name=&gt;<span class="stringliteral">&quot;problemMainForm&quot;</span>, onsubmit=&gt;<span class="stringliteral">&quot;submitAction()&quot;</span>);
    print $self-&gt;hidden_authen_fields;
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a41b091303d677cac168a7a74bc3f535f"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_hidden_info" ref="a41b091303d677cac168a7a74bc3f535f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_hidden_info </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_hidden_info' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_hidden_info-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_hidden_info-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_hidden_info-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_hidden_info: 25</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a41b091303d677cac168a7a74bc3f535f">output_hidden_info</a>{
    my $self = shift;
    my $previewAnswers = $self-&gt;{previewAnswers};
    
    <span class="keywordflow">if</span>($previewAnswers){
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
    }
    <span class="keywordflow">else</span>{
        <span class="keywordflow">if</span>(defined $self-&gt;{correct_ids}){
            my $correctRef = $self-&gt;{correct_ids};
            my @correct = @$correctRef;
            <span class="keywordflow">foreach</span>(@correct){
                print CGI::hidden(-name=&gt;<span class="stringliteral">&quot;correct_ids&quot;</span>, -value=&gt;$_.<span class="stringliteral">&quot;_val&quot;</span>);
            }
        }
        <span class="keywordflow">if</span>(defined $self-&gt;{incorrect_ids}){
            my $incorrectRef = $self-&gt;{incorrect_ids};
            my @incorrect = @$incorrectRef;
            <span class="keywordflow">foreach</span>(@incorrect){
                print CGI::hidden(-name=&gt;<span class="stringliteral">&quot;incorrect_ids&quot;</span>, -value=&gt;$_.<span class="stringliteral">&quot;_val&quot;</span>);
            }
        }
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="abf4675596a12b87f8a990695bc4f136d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_JS" ref="abf4675596a12b87f8a990695bc4f136d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_JS </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_JS' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_JS-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_JS-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_JS-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_JS: 17</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#abf4675596a12b87f8a990695bc4f136d">output_JS</a>{
    my $self = shift;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;

    my $site_url = $ce-&gt;{webworkURLs}-&gt;{htdocs};
    
<span class="preprocessor">    # This file declares a function called addOnLoadEvent which allows multiple different scripts to add to a single onLoadEvent handler on a page.</span>
<span class="preprocessor"></span>    print CGI::start_script({type=&gt;<span class="stringliteral">&quot;text/javascript&quot;</span>, src=&gt;<span class="stringliteral">&quot;$site_url/js/addOnLoadEvent.js&quot;</span>}), CGI::end_script();
    
    print CGI::start_script({type=&gt;<span class="stringliteral">&quot;text/javascript&quot;</span>, src=&gt;<span class="stringliteral">&quot;$site_url/js/removeDuplicates.js&quot;</span>}), CGI::end_script();
    
<span class="preprocessor">    # The color.js file, which uses javascript to color the input fields based on whether they are correct or incorrect.</span>
<span class="preprocessor"></span>    print CGI::start_script({type=&gt;<span class="stringliteral">&quot;text/javascript&quot;</span>, src=&gt;<span class="stringliteral">&quot;$site_url/js/color.js&quot;</span>}), CGI::end_script();
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab5fc606be37453174489160d3213d1fe"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_message" ref="ab5fc606be37453174489160d3213d1fe" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_message </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_message' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_message-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_message-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_message-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_message: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#ab5fc606be37453174489160d3213d1fe">output_message</a>{
    my $self = shift;
    my $pg = $self-&gt;{pg};
    my $r = $self-&gt;r;

    print CGI::p(CGI::b($r-&gt;maketext(<span class="stringliteral">&quot;Note&quot;</span>).<span class="stringliteral">&quot;: &quot;</span>). CGI::i($pg-&gt;{result}-&gt;{msg})) if $pg-&gt;{result}-&gt;{msg};
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad7e5eef3af99b10a25437e5a8e4ab4a7"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_misc" ref="ad7e5eef3af99b10a25437e5a8e4ab4a7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_misc </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_misc' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_misc-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_misc-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_misc-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_misc: 43</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#ad7e5eef3af99b10a25437e5a8e4ab4a7">output_misc</a>{

    my $self = shift;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $pg = $self-&gt;{pg};
    my %will = %{ $self-&gt;{will} };
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);

    
<span class="preprocessor">    # save state for viewOptions</span>
<span class="preprocessor"></span>    print  CGI::hidden(
               -name  =&gt; <span class="stringliteral">&quot;showOldAnswers&quot;</span>,
               -value =&gt; $will{showOldAnswers}
           ),

           CGI::hidden(
               -name  =&gt; <span class="stringliteral">&quot;displayMode&quot;</span>,
               -value =&gt; $self-&gt;{displayMode}
           );
    print( CGI::hidden(
               -name    =&gt; <span class="stringliteral">&#39;editMode&#39;</span>,
               -value   =&gt; $self-&gt;{editMode},
           )
    ) if defined($self-&gt;{editMode}) and $self-&gt;{editMode} eq <span class="stringliteral">&#39;temporaryFile&#39;</span>;
    
<span class="preprocessor">    # this is a security risk -- students can use this to find the source code for the problem</span>
<span class="preprocessor"></span>
    my $permissionLevel = $db-&gt;getPermissionLevel($user)-&gt;permission;
    my $professorPermissionLevel = $ce-&gt;{userRoles}-&gt;{professor};
    print( CGI::hidden(
                -name   =&gt; <span class="stringliteral">&#39;sourceFilePath&#39;</span>,
                -value  =&gt;  $self-&gt;{problem}-&gt;{source_file}
    ))  if defined($self-&gt;{problem}-&gt;{source_file}) and $permissionLevel&gt;= $professorPermissionLevel; # only allow <span class="keyword">this</span> <span class="keywordflow">for</span> professors

    print( CGI::hidden(
                -name   =&gt; <span class="stringliteral">&#39;problemSeed&#39;</span>,
                -value  =&gt;  $r-&gt;param(<span class="stringliteral">&quot;problemSeed&quot;</span>)
    ))  if defined($r-&gt;param(&quot;problemSeed&quot;)) and $permissionLevel&gt;= $professorPermissionLevel; <span class="preprocessor"># only allow this for professors</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a5b641f7ce4102ad926bbe1a1bee1e07d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_past_answer_button" ref="a5b641f7ce4102ad926bbe1a1bee1e07d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_past_answer_button </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_past_answer_button' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_past_answer_button-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_past_answer_button-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_past_answer_button-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_past_answer_button: 32</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a5b641f7ce4102ad926bbe1a1bee1e07d">output_past_answer_button</a>{
    my $self = shift;
    my $r = $self-&gt;r;
    my $problem = $self-&gt;{problem};
    
    my $authz = $r-&gt;authz;
    my $urlpath = $r-&gt;urlpath;
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
    my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);

    my $pastAnswersPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::ShowAnswers&quot;</span>, $r, 
        courseID =&gt; $courseName);
    my $showPastAnswersURL = $self-&gt;systemLink($pastAnswersPage, authen =&gt; 0); # no authen info <span class="keywordflow">for</span> form action
        
<span class="preprocessor">    # print answer inspection button</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_answers&quot;</span>)) {
        print <span class="stringliteral">&quot;\n&quot;</span>,
            CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>,-action=&gt;$showPastAnswersURL,-target=&gt;<span class="stringliteral">&quot;WW_Info&quot;</span>),<span class="stringliteral">&quot;\n&quot;</span>,
            $self-&gt;hidden_authen_fields,<span class="stringliteral">&quot;\n&quot;</span>,
            CGI::hidden(-name =&gt; <span class="stringliteral">&#39;courseID&#39;</span>,  -value=&gt;$courseName), <span class="stringliteral">&quot;\n&quot;</span>,
            CGI::hidden(-name =&gt; <span class="stringliteral">&#39;problemID&#39;</span>, -value=&gt;$problem-&gt;problem_id), <span class="stringliteral">&quot;\n&quot;</span>,
            CGI::hidden(-name =&gt; <span class="stringliteral">&#39;setID&#39;</span>,  -value=&gt;$problem-&gt;set_id), <span class="stringliteral">&quot;\n&quot;</span>,
            CGI::hidden(-name =&gt; <span class="stringliteral">&#39;studentUser&#39;</span>,    -value=&gt;$problem-&gt;user_id), <span class="stringliteral">&quot;\n&quot;</span>,
            CGI::p( {-align=&gt;<span class="stringliteral">&quot;left&quot;</span>},
                CGI::submit(-name =&gt; <span class="stringliteral">&#39;action&#39;</span>,  -value=&gt;$r-&gt;maketext(<span class="stringliteral">&quot;Show Past Answers&quot;</span>))
            ), <span class="stringliteral">&quot;\n&quot;</span>,
            CGI::endform();
    }
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2f0ac3f6f5d0808b23a47cb2df03225a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_problem_body" ref="a2f0ac3f6f5d0808b23a47cb2df03225a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_problem_body </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_problem_body' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_problem_body-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_problem_body-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_problem_body-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_problem_body: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a2f0ac3f6f5d0808b23a47cb2df03225a">output_problem_body</a>{
    my $self = shift;
    my $pg = $self-&gt;{pg};

    print <span class="stringliteral">&quot;\n&quot;</span>;
    print CGI::p($pg-&gt;{body_text});
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a34fa25000dd1b6fc9ba362fb42b72307"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_removDupli_JS" ref="a34fa25000dd1b6fc9ba362fb42b72307" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_removDupli_JS </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_removDupli_JS' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_removDupli_JS-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_removDupli_JS-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_removDupli_JS-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_removDupli_JS: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a34fa25000dd1b6fc9ba362fb42b72307">output_removDupli_JS</a>{
    my $self = shift;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;

    my $site_url = $ce-&gt;{webworkURLs}-&gt;{htdocs};
    
    print CGI::start_script({type=&gt;<span class="stringliteral">&quot;text/javascript&quot;</span>, src=&gt;<span class="stringliteral">&quot;$site_url/js/removeDuplicates.js&quot;</span>}), CGI::end_script();
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a50e4b0d84f00cd29294647a59516fcdb"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_score_summary" ref="a50e4b0d84f00cd29294647a59516fcdb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_score_summary </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_score_summary' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_score_summary-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_score_summary-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_score_summary-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_score_summary: 67</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a50e4b0d84f00cd29294647a59516fcdb">output_score_summary</a>{
    my $self = shift;
    my $r = $self-&gt;r;
    my $problem = $self-&gt;{problem};
    my $set = $self-&gt;{<span class="keyword">set</span>};
    my $pg = $self-&gt;{pg};
    my $scoreRecordedMessage = <span class="stringliteral">&quot;&quot;</span>;
    <span class="keywordflow">if</span>  (defined $self-&gt;{scoreRecordedMessage}) {
        $scoreRecordedMessage = $self-&gt;{scoreRecordedMessage};
    } <span class="keywordflow">else</span> {
        $scoreRecordedMessage = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemUtil_1_1ProblemUtil.html#a6e7e9b2d6c1a078f04c67bc68645de90">WeBWorK::ContentGenerator::ProblemUtil::ProblemUtil::process_and_log_answer</a>($self) || <span class="stringliteral">&quot;&quot;</span>;
    }
    my $submitAnswers = $self-&gt;{submitAnswers};
    
<span class="preprocessor">    # score summary</span>
<span class="preprocessor"></span>    my $attempts = $problem-&gt;num_correct + $problem-&gt;num_incorrect;
<span class="preprocessor">    #my $attemptsNoun = $attempts != 1 ? $r-&gt;maketext(&quot;times&quot;) : $r-&gt;maketext(&quot;time&quot;);</span>
<span class="preprocessor"></span>    my $problem_status    = $problem-&gt;status || 0;
    my $lastScore = sprintf(<span class="stringliteral">&quot;%.0f%%&quot;</span>, $problem_status * 100); # Round to whole number
<span class="preprocessor">    #my ($attemptsLeft, $attemptsLeftNoun);</span>
<span class="preprocessor"></span>    my $attemptsLeft = $problem-&gt;max_attempts - $attempts;
<span class="preprocessor">#   if ($problem-&gt;max_attempts == -1) {</span>
<span class="preprocessor"></span><span class="preprocessor">#       # unlimited attempts</span>
<span class="preprocessor"></span><span class="preprocessor">#       $attemptsLeft = $r-&gt;maketext(&quot;unlimited&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">#       $attemptsLeftNoun = $r-&gt;maketext(&quot;attempts&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">#   } else {</span>
<span class="preprocessor"></span><span class="preprocessor">#       $attemptsLeft = $problem-&gt;max_attempts - $attempts;</span>
<span class="preprocessor"></span><span class="preprocessor">#       $attemptsLeftNoun = $attemptsLeft == 1 ? $r-&gt;maketext(&quot;attempt&quot;) : $r-&gt;maketext(&quot;attempts&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">#   }</span>
<span class="preprocessor"></span>    
    my $setClosed = 0;
    my $setClosedMessage;
    <span class="keywordflow">if</span> (before($set-&gt;open_date) or after($set-&gt;due_date)) {
        $setClosed = 1;
        <span class="keywordflow">if</span> (before($set-&gt;open_date)) {
            $setClosedMessage = $r-&gt;maketext(<span class="stringliteral">&quot;This homework set is not yet open.&quot;</span>);
        } elsif (after($set-&gt;due_date)) {
            $setClosedMessage = $r-&gt;maketext(<span class="stringliteral">&quot;This homework set is closed.&quot;</span>);
        }
    }
<span class="preprocessor">    #if (before($set-&gt;open_date) or after($set-&gt;due_date)) {</span>
<span class="preprocessor"></span><span class="preprocessor">    #   $setClosed = 1;</span>
<span class="preprocessor"></span><span class="preprocessor">    #   $setClosedMessage = &quot;This homework set is closed.&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #   if ($authz-&gt;hasPermissions($user, &quot;view_answers&quot;)) {</span>
<span class="preprocessor"></span><span class="preprocessor">    #       $setClosedMessage .= &quot; However, since you are a privileged user, additional attempts will be recorded.&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #   } else {</span>
<span class="preprocessor"></span><span class="preprocessor">    #       $setClosedMessage .= &quot; Additional attempts will not be recorded.&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #   }</span>
<span class="preprocessor"></span><span class="preprocessor">    #}</span>
<span class="preprocessor"></span>    unless (defined( $pg-&gt;{state}-&gt;{state_summary_msg}) and $pg-&gt;{state}-&gt;{state_summary_msg}=~/\S/) {
        my $notCountedMessage = ($problem-&gt;value) ? <span class="stringliteral">&quot;&quot;</span> : $r-&gt;maketext(<span class="stringliteral">&quot;(This problem will not count towards your grade.)&quot;</span>);
        print CGI::p(join(<span class="stringliteral">&quot;&quot;</span>,
            $submitAnswers ? $scoreRecordedMessage . CGI::br() : <span class="stringliteral">&quot;&quot;</span>,
            $r-&gt;maketext(<span class="stringliteral">&quot;You have attempted this problem [quant,_1,time,times].&quot;</span>,$attempts), CGI::br(),
            $submitAnswers ? $r-&gt;maketext(<span class="stringliteral">&quot;You received a score of [_1] for this attempt.&quot;</span>,sprintf(<span class="stringliteral">&quot;%.0f%%&quot;</span>, $pg-&gt;{result}-&gt;{score} * 100)) . CGI::br():<span class="stringliteral">&#39;&#39;</span>,
            $problem-&gt;attempted
                ? $r-&gt;maketext(<span class="stringliteral">&quot;Your overall recorded score is [_1].  [_2]&quot;</span>,$lastScore,$notCountedMessage) . CGI::br()
                : <span class="stringliteral">&quot;&quot;</span>,
#           $setClosed ? $setClosedMessage : $r-&gt;maketext(<span class="stringliteral">&quot;You have [_1] [_2] remaining.&quot;</span>,$attemptsLeft,$attemptsLeftNoun) 
            $setClosed ? $setClosedMessage : $r-&gt;maketext(<span class="stringliteral">&quot;You have [negquant,_1,unlimited attempts,attempt,attempts] remaining.&quot;</span>,$attemptsLeft) 
        ));
    }<span class="keywordflow">else</span> {
        print CGI::p($pg-&gt;{state}-&gt;{state_summary_msg});
    }
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a34383d97a035d8768169cf50bd5eeb06"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_submit_buttons" ref="a34383d97a035d8768169cf50bd5eeb06" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_submit_buttons </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_submit_buttons' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_submit_buttons-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_submit_buttons-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_submit_buttons-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_submit_buttons: 27</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a34383d97a035d8768169cf50bd5eeb06">output_submit_buttons</a>{
    my $self = shift;
    my $r = $self-&gt;r;
    my %can = %{ $self-&gt;{can} };
    
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $effectiveUser = $r-&gt;param(<span class="stringliteral">&#39;effectiveUser&#39;</span>);

    print <a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(-type=&gt;<span class="stringliteral">&quot;submit&quot;</span>, -<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;previewAnswers_id&quot;</span>, -input_attr=&gt;{-name=&gt;<span class="stringliteral">&quot;previewAnswers&quot;</span>, -value=&gt;$r-&gt;maketext(<span class="stringliteral">&quot;Preview Answers&quot;</span>)});
    <span class="keywordflow">if</span> ($can{checkAnswers}) {
        print <a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(-type=&gt;<span class="stringliteral">&quot;submit&quot;</span>, -<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;checkAnswers_id&quot;</span>, -input_attr=&gt;{-name=&gt;<span class="stringliteral">&quot;checkAnswers&quot;</span>, -value=&gt;$r-&gt;maketext(<span class="stringliteral">&quot;Check Answers&quot;</span>)});
    }
    <span class="keywordflow">if</span> ($can{getSubmitButton}) {
        <span class="keywordflow">if</span> ($user ne $effectiveUser) {
<span class="preprocessor">            # if acting as a student, make it clear that answer submissions will</span>
<span class="preprocessor"></span><span class="preprocessor">            # apply to the student&#39;s records, not the professor&#39;s.</span>
<span class="preprocessor"></span>            print <a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(-type=&gt;<span class="stringliteral">&quot;submit&quot;</span>, -<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;submitAnswers_id&quot;</span>, -input_attr=&gt;{-name=&gt;<span class="stringliteral">&quot;submitAnswers&quot;</span>, -value=&gt;$r-&gt;maketext(<span class="stringliteral">&quot;Submit Answers for [_1]&quot;</span>, $effectiveUser)});
        } <span class="keywordflow">else</span> {
<span class="preprocessor">            #print CGI::submit(-name=&gt;&quot;submitAnswers&quot;, -label=&gt;&quot;Submit Answers&quot;, -onclick=&gt;&quot;alert(&#39;submit button clicked&#39;)&quot;);</span>
<span class="preprocessor"></span>            print <a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(-type=&gt;<span class="stringliteral">&quot;submit&quot;</span>, -<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;submitAnswers_id&quot;</span>, -input_attr=&gt;{-name=&gt;<span class="stringliteral">&quot;submitAnswers&quot;</span>, -value=&gt;$r-&gt;maketext(<span class="stringliteral">&quot;Submit Answers&quot;</span>), -onclick=&gt;<span class="stringliteral">&quot;&quot;</span>});
<span class="preprocessor">            # FIXME  for unknown reasons the -onclick label seems to have to be there in order to allow the forms onsubmit to trigger</span>
<span class="preprocessor"></span><span class="preprocessor">            # WTF???</span>
<span class="preprocessor"></span>        }
    }
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a53d8009c43a89f45603a4d88b3c2cdb8"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_summary" ref="a53d8009c43a89f45603a4d88b3c2cdb8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_summary </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_summary' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_summary-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_summary-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_summary-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_summary: 46</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a53d8009c43a89f45603a4d88b3c2cdb8">output_summary</a>{
    
    my $self = shift;
    
    my $editMode = $self-&gt;{editMode};
    my $problem = $self-&gt;{problem};
    my $pg = $self-&gt;{pg};
    my $submitAnswers = $self-&gt;{submitAnswers};
    my %will = %{ $self-&gt;{will} };
    my $checkAnswers = $self-&gt;{checkAnswers};
    my $previewAnswers = $self-&gt;{previewAnswers};
    
    my $r = $self-&gt;r;
    
    my $authz = $r-&gt;authz;
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
<span class="preprocessor">    # attempt summary</span>
<span class="preprocessor"></span><span class="preprocessor">    #FIXME -- the following is a kludge:  if showPartialCorrectAnswers is negative don&#39;t show anything.</span>
<span class="preprocessor"></span><span class="preprocessor">    # until after the due date</span>
<span class="preprocessor"></span><span class="preprocessor">    # do I need to check $will{showCorrectAnswers} to make preflight work??</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (defined($pg-&gt;{flags}-&gt;{showPartialCorrectAnswers}) and ($pg-&gt;{flags}-&gt;{showPartialCorrectAnswers} &gt;= 0 and $submitAnswers) ) {
<span class="preprocessor">        # print this if user submitted answers OR requested correct answers</span>
<span class="preprocessor"></span>        
        print $self-&gt;attemptResults($pg, 1,
            $will{showCorrectAnswers},
            $pg-&gt;{flags}-&gt;{showPartialCorrectAnswers}, 1, 1);
    } elsif ($checkAnswers) {
<span class="preprocessor">        # print this if user previewed answers</span>
<span class="preprocessor"></span>        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&#39;ResultsWithError&#39;</span>},$r-&gt;maketext(<span class="stringliteral">&quot;ANSWERS ONLY CHECKED -- ANSWERS NOT RECORDED&quot;</span>)), CGI::br();
        print $self-&gt;attemptResults($pg, 1, $will{showCorrectAnswers}, 1, 1, 1);
<span class="preprocessor">            # show attempt answers</span>
<span class="preprocessor"></span><span class="preprocessor">            # show correct answers if asked</span>
<span class="preprocessor"></span><span class="preprocessor">            # show attempt results (correctness)</span>
<span class="preprocessor"></span><span class="preprocessor">            # show attempt previews</span>
<span class="preprocessor"></span>    } elsif ($previewAnswers) {
<span class="preprocessor">        # print this if user previewed answers</span>
<span class="preprocessor"></span>        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&#39;ResultsWithError&#39;</span>},$r-&gt;maketext(<span class="stringliteral">&quot;PREVIEW ONLY -- ANSWERS NOT RECORDED&quot;</span>)),CGI::br(),$self-&gt;attemptResults($pg, 1, 0, 0, 0, 1);
<span class="preprocessor">            # show attempt answers</span>
<span class="preprocessor"></span><span class="preprocessor">            # don&#39;t show correct answers</span>
<span class="preprocessor"></span><span class="preprocessor">            # don&#39;t show attempt results (correctness)</span>
<span class="preprocessor"></span><span class="preprocessor">            # show attempt previews</span>
<span class="preprocessor"></span>    }
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aee10df8b75bfbf5851e2b4c54982d155"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::output_wztooltip_JS" ref="aee10df8b75bfbf5851e2b4c54982d155" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::output_wztooltip_JS </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-output_wztooltip_JS' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-output_wztooltip_JS-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-output_wztooltip_JS-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-output_wztooltip_JS-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in output_wztooltip_JS: 11</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#aee10df8b75bfbf5851e2b4c54982d155">output_wztooltip_JS</a>{
    
    my $self = shift;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;

    my $site_url = $ce-&gt;{webworkURLs}-&gt;{htdocs};
    
    print CGI::start_script({type=&gt;<span class="stringliteral">&quot;text/javascript&quot;</span>, src=&gt;<span class="stringliteral">&quot;$site_url/js/wz_tooltip.js&quot;</span>}), CGI::end_script();
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a232671ea99005df3a2de141d70dce950"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::pre_header_initialize" ref="a232671ea99005df3a2de141d70dce950" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::pre_header_initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-pre_header_initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-pre_header_initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-pre_header_initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-pre_header_initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in pre_header_initialize: 281</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a232671ea99005df3a2de141d70dce950">pre_header_initialize</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    my $urlpath = $r-&gt;urlpath;
    
    my $setName = $urlpath-&gt;arg(<span class="stringliteral">&quot;setID&quot;</span>);
    my $problemNumber = $r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;problemID&quot;</span>);
    my $userName = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $effectiveUserName = $r-&gt;param(<span class="stringliteral">&#39;effectiveUser&#39;</span>);
    my $key = $r-&gt;param(<span class="stringliteral">&#39;key&#39;</span>);
    my $editMode = $r-&gt;param(<span class="stringliteral">&quot;editMode&quot;</span>);
    
    my $user = $db-&gt;getUser($userName); # checked
    die <span class="stringliteral">&quot;record for user $userName (real user) does not exist.&quot;</span>
        unless defined $user;
    
    my $effectiveUser = $db-&gt;getUser($effectiveUserName); # checked
    die <span class="stringliteral">&quot;record for user $effectiveUserName (effective user) does not exist.&quot;</span>
        unless defined $effectiveUser;
    
<span class="preprocessor">    # obtain the merged set for $effectiveUser</span>
<span class="preprocessor"></span>    my $set = $db-&gt;getMergedSet($effectiveUserName, $setName); # checked

    $self-&gt;set_showOldAnswers_default($ce, $userName, $authz, $set);

<span class="preprocessor">    # Database fix (in case of undefined visiblity state values)</span>
<span class="preprocessor"></span><span class="preprocessor">    # this is only necessary because some people keep holding to ww1.9 which did not have a visible field</span>
<span class="preprocessor"></span><span class="preprocessor">    # make sure visible is set to 0 or 1</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( $set and $set-&gt;visible ne <span class="stringliteral">&quot;0&quot;</span> and $set-&gt;visible ne <span class="stringliteral">&quot;1&quot;</span>) {
        my $globalSet = $db-&gt;getGlobalSet($set-&gt;set_id);
        $globalSet-&gt;visible(<span class="stringliteral">&quot;1&quot;</span>);   # defaults to visible
        $db-&gt;putGlobalSet($globalSet);
        $set = $db-&gt;getMergedSet($effectiveUserName, $setName);
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # don&#39;t do anything just yet, maybe we&#39;re a professor and we&#39;re</span>
<span class="preprocessor"></span><span class="preprocessor">        # fabricating a set or haven&#39;t assigned it to ourselves just yet</span>
<span class="preprocessor"></span>    }
<span class="preprocessor">        # When a set is created enable_reduced_scoring is null, so we have to set it </span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( $set and $set-&gt;enable_reduced_scoring ne <span class="stringliteral">&quot;0&quot;</span> and $set-&gt;enable_reduced_scoring ne <span class="stringliteral">&quot;1&quot;</span>) {
        my $globalSet = $db-&gt;getGlobalSet($set-&gt;set_id);
        $globalSet-&gt;enable_reduced_scoring(<span class="stringliteral">&quot;0&quot;</span>);    # defaults to disabled
        $db-&gt;putGlobalSet($globalSet);
        $set = $db-&gt;getMergedSet($effectiveUserName, $setName);
    }
    
    
<span class="preprocessor">    # obtain the merged problem for $effectiveUser</span>
<span class="preprocessor"></span>    my $problem = $db-&gt;getMergedProblem($effectiveUserName, $setName, $problemNumber); # checked
    
<span class="preprocessor">    # A very hacky and temporary solution to the max_attempts problem</span>
<span class="preprocessor"></span><span class="preprocessor">    # if($problem-&gt;max_attempts == &quot;&quot;){</span>
<span class="preprocessor"></span><span class="preprocessor">        # $problem-&gt;max_attempts = -1;</span>
<span class="preprocessor"></span><span class="preprocessor">    # }</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($userName, <span class="stringliteral">&quot;modify_problem_sets&quot;</span>)) {
<span class="preprocessor">        # professors are allowed to fabricate sets and problems not</span>
<span class="preprocessor"></span><span class="preprocessor">        # assigned to them (or anyone). this allows them to use the</span>
<span class="preprocessor"></span><span class="preprocessor">        # editor to </span>
<span class="preprocessor"></span>
<span class="preprocessor">        # if a User Set does not exist for this user and this set</span>
<span class="preprocessor"></span><span class="preprocessor">        # then we check the Global Set</span>
<span class="preprocessor"></span><span class="preprocessor">        # if that does not exist we create a fake set</span>
<span class="preprocessor"></span><span class="preprocessor">        # if it does, we add fake user data</span>
<span class="preprocessor"></span>        unless (defined $set) {
            my $userSetClass = $db-&gt;{set_user}-&gt;{record};
            my $globalSet = $db-&gt;getGlobalSet($setName); # checked

            <span class="keywordflow">if</span> (not defined $globalSet) {
                $set = fake_set($db);
            } <span class="keywordflow">else</span> {
                $set = global2user($userSetClass, $globalSet);
                $set-&gt;psvn(0);
            }
        }
        
<span class="preprocessor">        # if that is not yet defined obtain the global problem,</span>
<span class="preprocessor"></span><span class="preprocessor">        # convert it to a user problem, and add fake user data</span>
<span class="preprocessor"></span>        unless (defined $problem) {
            my $userProblemClass = $db-&gt;{problem_user}-&gt;{record};
            my $globalProblem = $db-&gt;getGlobalProblem($setName, $problemNumber); # checked
<span class="preprocessor">            # if the global problem doesn&#39;t exist either, bail!</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span>(not defined $globalProblem) {
                my $sourceFilePath = $r-&gt;param(<span class="stringliteral">&quot;sourceFilePath&quot;</span>);
                die <span class="stringliteral">&quot;sourceFilePath is unsafe!&quot;</span> unless path_is_subdir($sourceFilePath, $ce-&gt;{courseDirs}-&gt;{templates}, 1); # 1==path can be relative to dir
<span class="preprocessor">                # These are problems from setmaker.  If declared invalid, they won&#39;t come up</span>
<span class="preprocessor"></span>                $self-&gt;{invalidProblem} = $self-&gt;{invalidSet} = 1 unless defined $sourceFilePath;
<span class="preprocessor">#               die &quot;Problem $problemNumber in set $setName does not exist&quot; unless defined $sourceFilePath;</span>
<span class="preprocessor"></span>                $problem = fake_problem($db);
                $problem-&gt;problem_id(1);
                $problem-&gt;source_file($sourceFilePath);
                $problem-&gt;user_id($effectiveUserName);
            } <span class="keywordflow">else</span> {
                $problem = global2user($userProblemClass, $globalProblem);
                $problem-&gt;user_id($effectiveUserName);
                $problem-&gt;problem_seed(0);
                $problem-&gt;status(0);
                $problem-&gt;attempted(0);
                $problem-&gt;last_answer(<span class="stringliteral">&quot;&quot;</span>);
                $problem-&gt;num_correct(0);
                $problem-&gt;num_incorrect(0);
            }
        }
        
<span class="preprocessor">        # now we&#39;re sure we have valid UserSet and UserProblem objects</span>
<span class="preprocessor"></span><span class="preprocessor">        # yay!</span>
<span class="preprocessor"></span>        
<span class="preprocessor">        # now deal with possible editor overrides:</span>
<span class="preprocessor"></span>        
<span class="preprocessor">        # if the caller is asking to override the source file, and</span>
<span class="preprocessor"></span><span class="preprocessor">        # editMode calls for a temporary file, do so</span>
<span class="preprocessor"></span>        my $sourceFilePath = $r-&gt;param(<span class="stringliteral">&quot;sourceFilePath&quot;</span>);
        <span class="keywordflow">if</span> (defined $editMode and $editMode eq <span class="stringliteral">&quot;temporaryFile&quot;</span> and defined $sourceFilePath) {
            die <span class="stringliteral">&quot;sourceFilePath is unsafe!&quot;</span> unless path_is_subdir($sourceFilePath, $ce-&gt;{courseDirs}-&gt;{templates}, 1); # 1==path can be relative to dir
            $problem-&gt;source_file($sourceFilePath);
        }
        
<span class="preprocessor">        # if the problem does not have a source file or no source file has been passed in </span>
<span class="preprocessor"></span><span class="preprocessor">        # then this is really an invalid problem (probably from a bad URL)</span>
<span class="preprocessor"></span>        $self-&gt;{invalidProblem} = not (defined $sourceFilePath or $problem-&gt;source_file);
        
<span class="preprocessor">        # if the caller is asking to override the problem seed, do so</span>
<span class="preprocessor"></span>        my $problemSeed = $r-&gt;param(<span class="stringliteral">&quot;problemSeed&quot;</span>);
        <span class="keywordflow">if</span> (defined $problemSeed) {
            $problem-&gt;problem_seed($problemSeed);
        }

        my $visiblityStateClass = ($set-&gt;visible) ? $r-&gt;maketext(<span class="stringliteral">&quot;Visible&quot;</span>) : $r-&gt;maketext(<span class="stringliteral">&quot;Hidden&quot;</span>);
        my $visiblityStateText = ($set-&gt;visible) ? $r-&gt;maketext(<span class="stringliteral">&quot;visible to students&quot;</span>).<span class="stringliteral">&quot;.&quot;</span> : $r-&gt;maketext(<span class="stringliteral">&quot;hidden from students&quot;</span>).<span class="stringliteral">&quot;.&quot;</span>;
        $self-&gt;addmessage(CGI::span($r-&gt;maketext(<span class="stringliteral">&quot;This set is [_1]&quot;</span>, CGI::font({<span class="keyword">class</span>=&gt;$visiblityStateClass}, $visiblityStateText))));

<span class="preprocessor">  # test for additional problem validity if it&#39;s not already invalid</span>
<span class="preprocessor"></span>        } <span class="keywordflow">else</span> {
        $self-&gt;{invalidProblem} = !(defined $problem and ($set-&gt;visible || $authz-&gt;hasPermissions($userName, <span class="stringliteral">&quot;view_hidden_sets&quot;</span>)));
        
        $self-&gt;addbadmessage(CGI::p($r-&gt;maketext(<span class="stringliteral">&quot;This problem will not count towards your grade.&quot;</span>))) <span class="keywordflow">if</span> $problem and not $problem-&gt;value and not $self-&gt;{invalidProblem};
    }

    $self-&gt;{userName}          = $userName;
    $self-&gt;{effectiveUserName} = $effectiveUserName;
    $self-&gt;{user}              = $user;
    $self-&gt;{effectiveUser}     = $effectiveUser;
    $self-&gt;{<span class="keyword">set</span>}               = $set;
    $self-&gt;{problem}           = $problem;
    $self-&gt;{editMode}          = $editMode;
    
<span class="preprocessor">    ##### form processing #####</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    # set options from form fields (see comment at top of file for names)</span>
<span class="preprocessor"></span>    my $displayMode        = $r-&gt;param(<span class="stringliteral">&quot;displayMode&quot;</span>) || $ce-&gt;{pg}-&gt;{options}-&gt;{displayMode};
    my $redisplay          = $r-&gt;param(<span class="stringliteral">&quot;redisplay&quot;</span>);
    my $submitAnswers      = $r-&gt;param(<span class="stringliteral">&quot;submitAnswers&quot;</span>);
    my $checkAnswers       = $r-&gt;param(<span class="stringliteral">&quot;checkAnswers&quot;</span>);
    my $previewAnswers     = $r-&gt;param(<span class="stringliteral">&quot;previewAnswers&quot;</span>);
    
    my $formFields = { <a class="code" href="classWeBWorK_1_1Form.html">WeBWorK::Form</a>-&gt;new_from_paramable($r)-&gt;Vars };
    
    $self-&gt;{displayMode}    = $displayMode;
    $self-&gt;{redisplay}      = $redisplay;
    $self-&gt;{submitAnswers}  = $submitAnswers;
    $self-&gt;{checkAnswers}   = $checkAnswers;
    $self-&gt;{previewAnswers} = $previewAnswers;
    $self-&gt;{formFields}     = $formFields;

<span class="preprocessor">    # get result and send to message</span>
<span class="preprocessor"></span>    my $status_message = $r-&gt;param(<span class="stringliteral">&quot;status_message&quot;</span>);
    $self-&gt;addmessage(CGI::p(<span class="stringliteral">&quot;$status_message&quot;</span>)) <span class="keywordflow">if</span> $status_message;

<span class="preprocessor">    # now that we&#39;ve set all the necessary variables quit out if the set or problem is invalid</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="keywordflow">if</span> $self-&gt;{invalidSet} || $self-&gt;{invalidProblem};
    
<span class="preprocessor">    ##### permissions #####</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # what does the user want to do?</span>
<span class="preprocessor"></span><span class="preprocessor">    #FIXME  There is a problem with checkboxes -- if they are not checked they are invisible.  Hence if the default mode in $ce is 1</span>
<span class="preprocessor"></span><span class="preprocessor">    # there is no way to override this.  Probably this is ok for the last three options, but it was definitely not ok for showing</span>
<span class="preprocessor"></span><span class="preprocessor">    # saved answers which is normally on, but you want to be able to turn it off!  This section should be moved to ContentGenerator</span>
<span class="preprocessor"></span><span class="preprocessor">    # so that you can set these options anywhere.  We also need mechanisms for making them sticky.</span>
<span class="preprocessor"></span><span class="preprocessor">    # Note: ProblemSet and ProblemSets might set showOldAnswers to &#39;&#39;, which</span>
<span class="preprocessor"></span><span class="preprocessor">    #       needs to be treated as if it is not set.</span>
<span class="preprocessor"></span>    my %want = (
        showOldAnswers     =&gt; (defined($r-&gt;param(<span class="stringliteral">&quot;showOldAnswers&quot;</span>)) and $r-&gt;param(<span class="stringliteral">&quot;showOldAnswers&quot;</span>) ne <span class="stringliteral">&#39;&#39;</span>) ? $r-&gt;param(<span class="stringliteral">&quot;showOldAnswers&quot;</span>)  : $ce-&gt;{pg}-&gt;{options}-&gt;{showOldAnswers},
        showCorrectAnswers =&gt; $r-&gt;param(<span class="stringliteral">&quot;showCorrectAnswers&quot;</span>) || $ce-&gt;{pg}-&gt;{options}-&gt;{showCorrectAnswers},
        showHints          =&gt; $r-&gt;param(<span class="stringliteral">&quot;showHints&quot;</span>)          || $ce-&gt;{pg}-&gt;{options}-&gt;{showHints},
        showSolutions      =&gt; $r-&gt;param(<span class="stringliteral">&quot;showSolutions&quot;</span>)      || $ce-&gt;{pg}-&gt;{options}-&gt;{showSolutions},
        recordAnswers      =&gt; $submitAnswers,
        checkAnswers       =&gt; $checkAnswers,
        getSubmitButton    =&gt; 1,
    );
    
<span class="preprocessor">    # are certain options enforced?</span>
<span class="preprocessor"></span>    my %must = (
        showOldAnswers     =&gt; 0,
        showCorrectAnswers =&gt; 0,
        showHints          =&gt; 0,
        showSolutions      =&gt; 0,
        recordAnswers      =&gt; ! $authz-&gt;hasPermissions($userName, <span class="stringliteral">&quot;avoid_recording_answers&quot;</span>),
        checkAnswers       =&gt; 0,
        getSubmitButton    =&gt; 0,
    );
     
<span class="preprocessor">    # does the user have permission to use certain options?</span>
<span class="preprocessor"></span>    my @args = ($user, $effectiveUser, $set, $problem);
    my %can = (
        showOldAnswers     =&gt; $self-&gt;can_showOldAnswers(@args),
        showCorrectAnswers =&gt; $self-&gt;can_showCorrectAnswers(@args),
        showHints          =&gt; $self-&gt;can_showHints(@args),
        showSolutions      =&gt; $self-&gt;can_showSolutions(@args),
        recordAnswers      =&gt; $self-&gt;can_recordAnswers(@args, 0),
        checkAnswers       =&gt; $self-&gt;can_checkAnswers(@args, $submitAnswers),
        getSubmitButton    =&gt; $self-&gt;can_recordAnswers(@args, $submitAnswers),
    );
    
<span class="preprocessor">    # final values for options</span>
<span class="preprocessor"></span>    my %will;
    <span class="keywordflow">foreach</span> (keys %must) {
        $will{$_} = $can{$_} &amp;&amp; ($want{$_} || $must{$_});
<span class="preprocessor">        #warn &quot;final values for options $_ is can $can{$_}, want $want{$_}, must $must{$_}, will $will{$_}&quot;;</span>
<span class="preprocessor"></span>    }
    
<span class="preprocessor">    ##### sticky answers #####</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> (not ($submitAnswers or $previewAnswers or $checkAnswers) and $will{showOldAnswers}) {
<span class="preprocessor">        # do this only if new answers are NOT being submitted</span>
<span class="preprocessor"></span>        my %oldAnswers = decodeAnswers($problem-&gt;last_answer);
        $formFields-&gt;{$_} = $oldAnswers{$_} <span class="keywordflow">foreach</span> keys %oldAnswers;
    }
    
<span class="preprocessor">    ##### translation #####</span>
<span class="preprocessor"></span>
    debug(<span class="stringliteral">&quot;begin pg processing&quot;</span>);
    my $pg = <a class="code" href="classWeBWorK_1_1PG.html">WeBWorK::PG</a>-&gt;new(
        $ce,
        $effectiveUser,
        $key,
        $set,
        $problem,
        $set-&gt;psvn, # FIXME: <span class="keyword">this</span> field should be removed
        $formFields,
        { # translation options
            displayMode     =&gt; $displayMode,
            showHints       =&gt; $will{showHints},
            showSolutions   =&gt; $will{showSolutions},
            refreshMath2img =&gt; $will{showHints} || $will{showSolutions},
            processAnswers  =&gt; 1,
            permissionLevel =&gt; $db-&gt;getPermissionLevel($userName)-&gt;permission,
            effectivePermissionLevel =&gt; $db-&gt;getPermissionLevel($effectiveUserName)-&gt;permission,
        },
    );
<span class="preprocessor">    # sometimes, for example if the file can&#39;t be read, $pg-&gt;{pgcore} won&#39;t be defined</span>
<span class="preprocessor"></span><span class="preprocessor">    # because the PG file is never run</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (defined ($pg-&gt;{pgcore}) ) {
        my $debug_msg = CGI::br().join( CGI::br(), @{ $pg-&gt;{pgcore}-&gt;get_debug_messages});
        $self-&gt;addmessage($debug_msg ) <span class="keywordflow">if</span> $debug_msg;
        $self-&gt;{pgdebug}          = $pg-&gt;{pgcore}-&gt;get_debug_messages;
        $self-&gt;{pgwarning}        = $pg-&gt;{pgcore}-&gt;get_warning_messages;
        $self-&gt;{pginternalerrors} = $pg-&gt;{pgcore}-&gt;get_internal_debug_messages ;
        $self-&gt;{pgerrors} = @{$self-&gt;{pgdebug}} || @{$self-&gt;{pgwarning}} || @{$self-&gt;{pginternalerrors}}||0;
    } <span class="keywordflow">else</span> {
        $self-&gt;{pgerrors}=undef;  # unable to obtain errors
    }

    debug(<span class="stringliteral">&quot;end pg processing&quot;</span>);
    
<span class="preprocessor">    ##### fix hint/solution options #####</span>
<span class="preprocessor"></span>    
    $can{showHints}     &amp;&amp;= $pg-&gt;{flags}-&gt;{hintExists}  
                        &amp;&amp;= $pg-&gt;{flags}-&gt;{showHintLimit}&lt;=$pg-&gt;{state}-&gt;{num_of_incorrect_ans};
    $can{showSolutions} &amp;&amp;= $pg-&gt;{flags}-&gt;{solutionExists};
    
<span class="preprocessor">    ##### store fields #####</span>
<span class="preprocessor"></span>    
    $self-&gt;{want} = \%want;
    $self-&gt;{must} = \%must;
    $self-&gt;{can}  = \%can;
    $self-&gt;{will} = \%will;
    $self-&gt;{pg} = $pg;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a00bc76ff83a23a74a2598f46ecb5a3f2"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::previewAnswer" ref="a00bc76ff83a23a74a2598f46ecb5a3f2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::previewAnswer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-previewAnswer' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-previewAnswer-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-previewAnswer-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-previewAnswer-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in previewAnswer: 66</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a00bc76ff83a23a74a2598f46ecb5a3f2">previewAnswer</a> {
    my ($self, $answerResult, $imgGen, $tthPreambleCache) = @_;
    my $ce            = $self-&gt;r-&gt;ce;
    my $effectiveUser = $self-&gt;{effectiveUser};
    my $set           = $self-&gt;{<span class="keyword">set</span>};
    my $problem       = $self-&gt;{problem};
    my $displayMode   = $self-&gt;{displayMode};
    
<span class="preprocessor">    # note: right now, we have to do things completely differently when we are</span>
<span class="preprocessor"></span><span class="preprocessor">    # rendering math from INSIDE the translator and from OUTSIDE the translator.</span>
<span class="preprocessor"></span><span class="preprocessor">    # so we&#39;ll just deal with each case explicitly here. there&#39;s some code</span>
<span class="preprocessor"></span><span class="preprocessor">    # duplication that can be dealt with later by abstracting out tth/dvipng/etc.</span>
<span class="preprocessor"></span>    
    my $tex = $answerResult-&gt;{preview_latex_string};
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span> unless defined $tex and $tex ne <span class="stringliteral">&quot;&quot;</span>;
    
    <span class="keywordflow">if</span> ($displayMode eq <span class="stringliteral">&quot;plainText&quot;</span>) {
        <span class="keywordflow">return</span> $tex;
    } elsif ($displayMode eq <span class="stringliteral">&quot;formattedText&quot;</span>) {
        
<span class="preprocessor">        # read the TTH preamble, or use the cached copy passed in from the caller</span>
<span class="preprocessor"></span>        my $tthPreamble=<span class="stringliteral">&#39;&#39;</span>;
        <span class="keywordflow">if</span> (defined $$tthPreambleCache) {
            $tthPreamble = $$tthPreambleCache;
        } <span class="keywordflow">else</span> {
            my $tthPreambleFile = $ce-&gt;{courseDirs}-&gt;{templates} . <span class="stringliteral">&quot;/tthPreamble.tex&quot;</span>;
            <span class="keywordflow">if</span> (-<a class="code" href="classWeBWorK_1_1ContentGenerator.html#afc1106db125a42082cafaf10746a947b">r</a> $tthPreambleFile) {
                $tthPreamble = readFile($tthPreambleFile);
<span class="preprocessor">                # thanks to Jim Martino. each line in the definition file should end with</span>
<span class="preprocessor"></span><span class="preprocessor">                #a % to prevent adding supurious paragraphs to output:</span>
<span class="preprocessor"></span>                $tthPreamble =~ s/(.)\n/$1%\n/g;
<span class="preprocessor">                # solves the problem if the file doesn&#39;t end with a return:</span>
<span class="preprocessor"></span>                $tthPreamble .=<span class="stringliteral">&quot;%\n&quot;</span>;
<span class="preprocessor">                # store preamble in cache:</span>
<span class="preprocessor"></span>                $$tthPreambleCache = $tthPreamble;
            } <span class="keywordflow">else</span> {
            }
        }
        
<span class="preprocessor">        # construct TTH command line</span>
<span class="preprocessor"></span>        my $tthCommand = $ce-&gt;{externalPrograms}-&gt;{tth}
            . <span class="stringliteral">&quot; -L -f5 -u -r  2&gt; /dev/null &lt;&lt;END_OF_INPUT; echo &gt; /dev/null\n&quot;</span>
            . $tthPreamble . <span class="stringliteral">&quot;\\[&quot;</span> . $tex . <span class="stringliteral">&quot;\\]\n&quot;</span>
            . <span class="stringliteral">&quot;END_OF_INPUT\n&quot;</span>;
        
<span class="preprocessor">        # call tth</span>
<span class="preprocessor"></span>        my $result = `$tthCommand`;
        <span class="keywordflow">if</span> ($?) {
            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;b&gt;[tth failed: $? $@]&lt;/b&gt;&quot;</span>;
        } <span class="keywordflow">else</span> {
<span class="preprocessor">            #  avoid border problems in tables and remove unneeded initial &lt;br&gt;</span>
<span class="preprocessor"></span>            $result =~ s/(&lt;table [^&gt;]*)&gt;/$1 CLASS=<span class="stringliteral">&quot;ArrayLayout&quot;</span>&gt;/gi;
            $result =~ s!\s*&lt;br clear=<span class="stringliteral">&quot;all&quot;</span> /&gt;!!;
            <span class="keywordflow">return</span> $result;
        }
        
    } elsif ($displayMode eq <span class="stringliteral">&quot;images&quot;</span>) {
        $imgGen-&gt;add($tex);
    } elsif ($displayMode eq <span class="stringliteral">&quot;MathJax&quot;</span>) {
        <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;span class=&quot;MathJax_Preview&quot;&gt;[math]&lt;/span&gt;&lt;script type=&quot;math/tex; mode=display&quot;&gt;&#39;</span>.$tex.<span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>;
    } elsif ($displayMode eq <span class="stringliteral">&quot;jsMath&quot;</span>) {
        $tex =~ s/&amp;/&amp;amp;/g; $tex =~ s/&lt;/&amp;lt;/g; $tex =~ s/&gt;/&amp;gt;/g;
        <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;SPAN CLASS=&quot;math&quot;&gt;\\displaystyle{&#39;</span>.$tex.<span class="stringliteral">&#39;}&lt;/SPAN&gt;&#39;</span>;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aba0b03e5353605d8a6dd2fd1eb659e26"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::previewCorrectAnswer" ref="aba0b03e5353605d8a6dd2fd1eb659e26" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::previewCorrectAnswer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-previewCorrectAnswer' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-previewCorrectAnswer-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-previewCorrectAnswer-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-previewCorrectAnswer-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in previewCorrectAnswer: 71</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#aba0b03e5353605d8a6dd2fd1eb659e26">previewCorrectAnswer</a> {
    my ($self, $answerResult, $imgGen, $tthPreambleCache) = @_;
    my $ce            = $self-&gt;r-&gt;ce;
    my $effectiveUser = $self-&gt;{effectiveUser};
    my $set           = $self-&gt;{<span class="keyword">set</span>};
    my $problem       = $self-&gt;{problem};
    my $displayMode   = $self-&gt;{displayMode};
    
<span class="preprocessor">    # note: right now, we have to do things completely differently when we are</span>
<span class="preprocessor"></span><span class="preprocessor">    # rendering math from INSIDE the translator and from OUTSIDE the translator.</span>
<span class="preprocessor"></span><span class="preprocessor">    # so we&#39;ll just deal with each case explicitly here. there&#39;s some code</span>
<span class="preprocessor"></span><span class="preprocessor">    # duplication that can be dealt with later by abstracting out tth/dvipng/etc.</span>
<span class="preprocessor"></span>    
    my $tex = $answerResult-&gt;{correct_ans_latex_string};
    <span class="keywordflow">return</span> $answerResult-&gt;{correct_ans} unless defined $tex and $tex=~/\S/;   # some answers don<span class="stringliteral">&#39;t have latex strings defined</span>
<span class="stringliteral">    # return &quot;&quot; unless defined $tex and $tex ne &quot;&quot;;</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    if ($displayMode eq &quot;plainText&quot;) {</span>
<span class="stringliteral">        return $tex;</span>
<span class="stringliteral">    } elsif ($displayMode eq &quot;formattedText&quot;) {</span>
<span class="stringliteral">        </span>
<span class="stringliteral">        # read the TTH preamble, or use the cached copy passed in from the caller</span>
<span class="stringliteral">        my $tthPreamble=&#39;</span><span class="stringliteral">&#39;;</span>
<span class="stringliteral">        if (defined $$tthPreambleCache) {</span>
<span class="stringliteral">            $tthPreamble = $$tthPreambleCache;</span>
<span class="stringliteral">        } else {</span>
<span class="stringliteral">            my $tthPreambleFile = $ce-&gt;{courseDirs}-&gt;{templates} . &quot;/tthPreamble.tex&quot;;</span>
<span class="stringliteral">            if (-r $tthPreambleFile) {</span>
<span class="stringliteral">                $tthPreamble = readFile($tthPreambleFile);</span>
<span class="stringliteral">                # thanks to Jim Martino. each line in the definition file should end with</span>
<span class="stringliteral">                #a % to prevent adding supurious paragraphs to output:</span>
<span class="stringliteral">                $tthPreamble =~ s/(.)\n/$1%\n/g;</span>
<span class="stringliteral">                # solves the problem if the file doesn&#39;</span>t end with a <span class="keywordflow">return</span>:
                $tthPreamble .=<span class="stringliteral">&quot;%\n&quot;</span>;
<span class="preprocessor">                # store preamble in cache:</span>
<span class="preprocessor"></span>                $$tthPreambleCache = $tthPreamble;
            } <span class="keywordflow">else</span> {
            }
        }
        
<span class="preprocessor">        # construct TTH command line</span>
<span class="preprocessor"></span>        my $tthCommand = $ce-&gt;{externalPrograms}-&gt;{tth}
            . <span class="stringliteral">&quot; -L -f5 -u -r  2&gt; /dev/null &lt;&lt;END_OF_INPUT; echo &gt; /dev/null\n&quot;</span>
            . $tthPreamble . <span class="stringliteral">&quot;\\[&quot;</span> . $tex . <span class="stringliteral">&quot;\\]\n&quot;</span>
            . <span class="stringliteral">&quot;END_OF_INPUT\n&quot;</span>;
        
<span class="preprocessor">        # call tth</span>
<span class="preprocessor"></span>        my $result = `$tthCommand`;
        <span class="keywordflow">if</span> ($?) {
            <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;b&gt;[tth failed: $? $@]&lt;/b&gt;&quot;</span>;
        } <span class="keywordflow">else</span> {
<span class="preprocessor">            #  avoid border problems in tables and remove unneeded initial &lt;br&gt;</span>
<span class="preprocessor"></span>            $result =~ s/(&lt;table [^&gt;]*)&gt;/$1 CLASS=<span class="stringliteral">&quot;ArrayLayout&quot;</span>&gt;/gi;
            $result =~ s!\s*&lt;br clear=<span class="stringliteral">&quot;all&quot;</span> /&gt;!!;
            <span class="keywordflow">return</span> $result;
        }
        
    } elsif ($displayMode eq <span class="stringliteral">&quot;images&quot;</span>) {
        $imgGen-&gt;add($tex);
    } elsif ($displayMode eq <span class="stringliteral">&quot;MathJax&quot;</span>) {
        <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;span class=&quot;MathJax_Preview&quot;&gt;[math]&lt;/span&gt;&lt;script type=&quot;math/tex; mode=display&quot;&gt;&#39;</span>.$tex.<span class="stringliteral">&#39;&lt;/script&gt;&#39;</span>;
    } elsif ($displayMode eq <span class="stringliteral">&quot;jsMath&quot;</span>) {
        $tex =~ s/&amp;/&amp;amp;/g; $tex =~ s/&lt;/&amp;lt;/g; $tex =~ s/&gt;/&amp;gt;/g;
        <span class="keywordflow">return</span> <span class="stringliteral">&#39;&lt;SPAN CLASS=&quot;math&quot;&gt;\\displaystyle{&#39;</span>.$tex.<span class="stringliteral">&#39;}&lt;/SPAN&gt;&#39;</span>;
    }
}

<span class="preprocessor">################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Template escape implementations</span>
<span class="preprocessor">################################################################################</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="afadef18e0ceac6941a41153a66d7dea2"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::set_showOldAnswers_default" ref="afadef18e0ceac6941a41153a66d7dea2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::set_showOldAnswers_default </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-set_showOldAnswers_default' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-set_showOldAnswers_default-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-set_showOldAnswers_default-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-set_showOldAnswers_default-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in set_showOldAnswers_default: 11</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#afadef18e0ceac6941a41153a66d7dea2">set_showOldAnswers_default</a> {
    my ($self, $ce, $userName, $authz, $set) = @_;
<span class="preprocessor">    # these people always use the system/course default, so don&#39;t</span>
<span class="preprocessor"></span><span class="preprocessor">    # override the value of ...-&gt;{showOldAnswers}</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="keywordflow">if</span> $authz-&gt;hasPermissions($userName, <span class="stringliteral">&quot;can_always_use_show_old_answers_default&quot;</span>);
<span class="preprocessor">    # this person should always default to 0</span>
<span class="preprocessor"></span>    $ce-&gt;{pg}-&gt;{options}-&gt;{showOldAnswers} = 0
        unless ($authz-&gt;hasPermissions($userName, <span class="stringliteral">&quot;can_show_old_answers_by_default&quot;</span>));
<span class="preprocessor">    # we are after the due date, so default to not showing it</span>
<span class="preprocessor"></span>    $ce-&gt;{pg}-&gt;{options}-&gt;{showOldAnswers} = 0 <span class="keywordflow">if</span> $set-&gt;{due_date} &amp;&amp; after($set-&gt;{due_date});
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a806e1e3642c7fd46e5dba374551db7ba"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::siblings" ref="a806e1e3642c7fd46e5dba374551db7ba" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::siblings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-siblings' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-siblings-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-siblings-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-siblings-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in siblings: 38</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a806e1e3642c7fd46e5dba374551db7ba">siblings</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $db = $r-&gt;db;
    my $urlpath = $r-&gt;urlpath;
    
<span class="preprocessor">    # can&#39;t show sibling problems if the set is invalid</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">if</span> $self-&gt;{invalidSet};
    
    my $courseID = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $setID = $self-&gt;{<span class="keyword">set</span>}-&gt;set_id;
    my $eUserID = $r-&gt;param(<span class="stringliteral">&quot;effectiveUser&quot;</span>);
    my @problemIDs = sort { $a &lt;=&gt; $b } $db-&gt;listUserProblems($eUserID, $setID);
    
    print CGI::start_div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;info-box&quot;</span>, <span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;fisheye&quot;</span>});
    print CGI::h2($r-&gt;maketext(<span class="stringliteral">&quot;Problems&quot;</span>));
<span class="preprocessor">    #print CGI::start_ul({class=&gt;&quot;LinksMenu&quot;});</span>
<span class="preprocessor"></span><span class="preprocessor">    #print CGI::start_li();</span>
<span class="preprocessor"></span><span class="preprocessor">    #print CGI::span({style=&gt;&quot;font-size:larger&quot;}, &quot;Problems&quot;);</span>
<span class="preprocessor"></span>    print CGI::start_ul();

    <span class="keywordflow">foreach</span> my $problemID (@problemIDs) {
        my $problemPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Problem&quot;</span>, $r, 
            courseID =&gt; $courseID, setID =&gt; $setID, problemID =&gt; $problemID);
        print CGI::li(CGI::a( {href=&gt;$self-&gt;systemLink($problemPage, 
                                                    params=&gt;{  displayMode =&gt; $self-&gt;{displayMode}, 
                                                               showOldAnswers =&gt; $self-&gt;{will}-&gt;{showOldAnswers}
                                                            })},  $r-&gt;maketext(<span class="stringliteral">&quot;Problem [_1]&quot;</span>,$problemID))
       );
    }

    print CGI::end_ul();
<span class="preprocessor">    #print CGI::end_li();</span>
<span class="preprocessor"></span><span class="preprocessor">    #print CGI::end_ul();</span>
<span class="preprocessor"></span>    print CGI::end_div();

    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a92f64bca9b0cc8196d23ecd1e76aab99"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::title" ref="a92f64bca9b0cc8196d23ecd1e76aab99" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::title </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-title' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-title-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-title-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-title-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in title: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html#a92f64bca9b0cc8196d23ecd1e76aab99">title</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
<span class="preprocessor">    # using the url arguments won&#39;t break if the set/problem are invalid</span>
<span class="preprocessor"></span>    my $setID = <a class="code" href="classWeBWorK_1_1ContentGenerator.html#a773245b898171c74901ad1833b09b78d">WeBWorK::ContentGenerator::underscore2nbsp</a>($self-&gt;r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;setID&quot;</span>));
    my $problemID = $self-&gt;r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;problemID&quot;</span>);

    <span class="keywordflow">return</span> $r-&gt;maketext(<span class="stringliteral">&quot;[_1]: Problem [_2]&quot;</span>,$setID, $problemID);
}
</pre></div>  
</div>
 
<p>Reimplemented from <a class="el" href="classWeBWorK_1_1ContentGenerator.html#ad83c346d1b3f70cf42ba4debe6239c9f">WeBWorK::ContentGenerator</a>.</p>

</div>
</div>
<a class="anchor" id="a90da80416ca294368a4d7fa82205f45f"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Problem::warnings" ref="a90da80416ca294368a4d7fa82205f45f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Problem::warnings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-warnings' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-warnings-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-warnings-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-warnings-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in warnings: 28</span>
<span class="preprocessor"></span>sub warnings {
    my $self = shift;
<span class="preprocessor">    # print &quot;entering warnings() subroutine internal messages = &quot;, $self-&gt;{pgerrors},CGI::br();</span>
<span class="preprocessor"></span>    my $r  = $self-&gt;r;
<span class="preprocessor">#   my $pg = $self-&gt;{pg};</span>
<span class="preprocessor"></span><span class="preprocessor">#   warn &quot;type of pg is &quot;,ref($pg);</span>
<span class="preprocessor"></span><span class="preprocessor">#   my $pgerrordiv = $pgdebug||$pgwarning||$pginternalerrors;  # is 1 if any of these are non-empty</span>
<span class="preprocessor"></span><span class="preprocessor">    # print warning messages</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (not defined $self-&gt;{pgerrors} ) {
        print CGI::start_div();
        print CGI::h3({style=&gt;<span class="stringliteral">&quot;color:red;&quot;</span>}, $r-&gt;maketext(<span class="stringliteral">&quot;PG question failed to render&quot;</span>));
        print CGI::p($r-&gt;maketext(<span class="stringliteral">&quot;Unable to obtain error messages from within the PG question.&quot;</span> ));
        print CGI::end_div();
    } elsif ( $self-&gt;{pgerrors} &gt; 0 ) {
        my @pgdebug          = @{ $self-&gt;{pgdebug}           };
        my @pgwarning        = @{ $self-&gt;{pgwarning}         };
        my @pginternalerrors = @{ $self-&gt;{pginternalerrors}  };
        print CGI::start_div();
        print CGI::h3({style=&gt;<span class="stringliteral">&quot;color:red;&quot;</span>}, $r-&gt;maketext(<span class="stringliteral">&quot;PG question processing error messages&quot;</span>));
        print CGI::p(CGI::h3($r-&gt;maketext(<span class="stringliteral">&quot;PG debug messages&quot;</span> ) ),   CGI::br(), join(CGI::br(), @pgdebug  )  )  <span class="keywordflow">if</span> @pgdebug   ;
        print CGI::p(CGI::h3($r-&gt;maketext(<span class="stringliteral">&quot;PG warning messages&quot;</span> ) ), CGI::br(), join(CGI::br(), @pgwarning)  )  <span class="keywordflow">if</span> @pgwarning ; 
        print CGI::p(CGI::h3($r-&gt;maketext(<span class="stringliteral">&quot;PG internal errors&quot;</span> ) ),  CGI::br(), join(CGI::br(), @pginternalerrors )) <span class="keywordflow">if</span> @pginternalerrors;
        print CGI::end_div();
    } 
<span class="preprocessor">    # print &quot;proceeding to SUPER::warnings&quot;;</span>
<span class="preprocessor"></span>    $self-&gt;SUPER::warnings();
    <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
<p>Reimplemented from <a class="el" href="classWeBWorK_1_1ContentGenerator.html#a95e724764fdc1755f19e100da83c6225">WeBWorK::ContentGenerator</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="ContentGenerator_2Problem_8pm_source.html">ContentGenerator/Problem.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:58:46 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
