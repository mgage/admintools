<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::Utils::SortRecords Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1Utils.html">Utils</a>::<a class="el" href="classWeBWorK_1_1Utils_1_1SortRecords.html">SortRecords</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::Utils::SortRecords Class Reference</h1><!-- doxytag: class="WeBWorK::Utils::SortRecords" --><!-- doxytag: inherits="WeBWorK::Utils" --><div class="dynheader">
Inheritance diagram for WeBWorK::Utils::SortRecords:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Utils_1_1SortRecords__inherit__graph.png" border="0" usemap="#WeBWorK_1_1Utils_1_1SortRecords_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1Utils_1_1SortRecords_inherit__map" id="WeBWorK_1_1Utils_1_1SortRecords_inherit__map">
<area shape="rect" href="classWeBWorK_1_1Utils.html" title="WeBWorK::Utils" alt="" coords="45,80,163,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="63,5,145,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::Utils::SortRecords:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Utils_1_1SortRecords__coll__graph.png" border="0" usemap="#WeBWorK_1_1Utils_1_1SortRecords_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1Utils_1_1SortRecords_coll__map" id="WeBWorK_1_1Utils_1_1SortRecords_coll__map">
<area shape="rect" href="classWeBWorK_1_1Utils.html" title="WeBWorK::Utils" alt="" coords="45,80,163,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="63,5,145,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1Utils_1_1SortRecords-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1SortRecords.html#a5a1c472e3ce47aedb9e2cfb5d16a0547">getSortsForClass</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1SortRecords.html#ab7b537cb504a71f33f96bbfdc9a50e43">sortRecords</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1Utils_1_1SortRecords.html">WeBWorK::Utils::SortRecords</a> - utilities for sorting database records.</p>
<h2><a class="anchor" id="SYNOPSIS">
SYNOPSIS</a></h2>
<pre> use <a class="el" href="classWeBWorK_1_1Utils_1_1SortRecords.html">WeBWorK::Utils::SortRecords</a> qw/getSortsForClass/;</pre><pre> # get a list of sorts
 my ($sortsRef, $sortLabelsRef) = getSortsForClass(ref $Users[0]);
 my @sorts      = @$sortsRef;      # sort names
 my %sortLabels = %$sortLabelsRef; # suitable for CGI's "-labels" parameter</pre><pre> use <a class="el" href="classWeBWorK_1_1Utils_1_1SortRecords.html">WeBWorK::Utils::SortRecords</a> qw/sortRecords/;</pre><pre> # start with a list of records
 my @Users = $db-&gt;getUsers($db-&gt;listUsers);</pre><pre> # sort the records using a preset
 @SortedUsers = sortRecords({preset=&gt;"lnfn"}, @Users);</pre><pre> # or provide a custom sort
 @SortedUsers = sortRecords({fields=&gt;[qw/section student_id/]}, @Users);</pre><h2><a class="anchor" id="DESCRIPTION">
DESCRIPTION</a></h2>
<p>This module provides record sorting functions, and a collection of preset sorts for the standard <a class="el" href="classWeBWorK.html">WeBWorK</a> record classes. Sorts are specified by a list of field names. Sorts are performed lexicographically.</p>
<h2><a class="anchor" id="FUNCTIONS">
FUNCTIONS</a></h2>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_getSortsForClass__class_"></a><b>getSortsForClass($class)</b> </p>
<p>Given the name of a record class, returns the preset sorts available for that class. </p>
<p>The return value consists of a two-element list. The first element is a reference to a list of sort names. The second element is a reference to a hash mapping sort names to string descriptions. </p>
<p>Together, these two lists are suitable for passing to the </p>
<div class="fragment"><pre class="fragment">-values
</pre></div><p> and</p>
<div class="fragment"><pre class="fragment">-labels
</pre></div><p> parameters of several <a class="el" href="classWeBWorK_1_1CGI.html">CGI</a> module methods, i.e. popup_menu(), scrolling_list(), checkbox_group(), and radio_group().  </p>
</li>
</ul>
<p>Given a sort specification (or the name of a preset format) and a list of records, returns a list of the same records in order according to the sort. </p>
<p>%options can consist of either: </p>
<pre> preset =&gt; the name of a preset format listed by getFormatsForClass()</pre><p>or: </p>
<pre> fields =&gt; a reference to a list of fields in the records' class</pre><p>If </p>
<div class="fragment"><pre class="fragment">preset
</pre></div><p> is given, and its value does not match any known preset but <em>is</em> the name of a field in the record class, the records will be sorted by that field. </p>
<p>If </p>
<div class="fragment"><pre class="fragment">fields
</pre></div><p> is given, the records are sorted according to the specified fields. If multiple fields are specified, the second field is is consulted if two records are found to have identical first fields, and so on.</p>
<h2><a class="anchor" id="BUGS">
BUGS</a></h2>
<p>No provision for case-insensitive, descending, or numeric sorting. </p>
<p>No provision for programmatic sorts. While a one-time programmatic sort can be done easily without using this module, programmatic preset sorts would be useful, i.e. for intelligent sorting of set IDs. </p>
<p>The fields being compared cannot contain nulls, because of the way packed keys are being generated. </p>

<p>Definition at line <a class="el" href="SortRecords_8pm_source.html#l00094">94</a> of file <a class="el" href="SortRecords_8pm_source.html">SortRecords.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a5a1c472e3ce47aedb9e2cfb5d16a0547"></a><!-- doxytag: member="WeBWorK::Utils::SortRecords::getSortsForClass" ref="a5a1c472e3ce47aedb9e2cfb5d16a0547" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::SortRecords::getSortsForClass </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getSortsForClass' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getSortsForClass-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getSortsForClass-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getSortsForClass-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getSortsForClass: 13</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1SortRecords.html#a5a1c472e3ce47aedb9e2cfb5d16a0547">getSortsForClass</a> {
    my ($class) = @_;
    
    my %class_presets = exists PRESET_SORTS-&gt;{$class} ? %{ PRESET_SORTS-&gt;{$class} } : ();
    
    my @field_order = $class-&gt;FIELDS;
    my @preset_order = sort { $class_presets{$a}{name} cmp $class_presets{$b}{name} } keys %class_presets;
    
    my %fields = map { $_ =&gt; <span class="stringliteral">&quot;Field: $_&quot;</span> } @field_order;
    my %presets = map { $_ =&gt; <span class="stringliteral">&quot;Preset: $class_presets{$_}{name}&quot;</span> } @preset_order;
    
    <span class="keywordflow">return</span> ( [@field_order, @preset_order], {%fields, %presets} );
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab7b537cb504a71f33f96bbfdc9a50e43"></a><!-- doxytag: member="WeBWorK::Utils::SortRecords::sortRecords" ref="ab7b537cb504a71f33f96bbfdc9a50e43" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::SortRecords::sortRecords </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-sortRecords' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-sortRecords-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-sortRecords-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-sortRecords-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in sortRecords: 49</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1SortRecords.html#ab7b537cb504a71f33f96bbfdc9a50e43">sortRecords</a> {
    my ($options, @Records) = @_;
    
<span class="preprocessor">    # nothing to do</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> () unless @Records;
    
<span class="preprocessor">    # get class info (we assume that the records are all of the same type)</span>
<span class="preprocessor"></span>    my $class = ref $Records[0];
    my %class_fields = map { $_ =&gt; 1 } $class-&gt;FIELDS;
    
    my %options = %$options;
    
    <span class="keywordflow">if</span> (exists $options{<span class="stringliteral">&quot;preset&quot;</span>}) {
        my $preset = $options{preset};
        
        <span class="keywordflow">if</span> (exists PRESET_SORTS-&gt;{$class} and exists PRESET_SORTS-&gt;{$class}-&gt;{$preset}) {
<span class="preprocessor">            # an explicit preset exists</span>
<span class="preprocessor"></span><span class="preprocessor">            # replace the contents of %options with the values from the preset</span>
<span class="preprocessor"></span>            %options = %{ PRESET_SORTS-&gt;{$class}-&gt;{$preset} };
        } elsif (exists $class_fields{$preset}) {
<span class="preprocessor">            # it&#39;s the name of a field in the current class, in which case we treat it as</span>
<span class="preprocessor"></span><span class="preprocessor">            # a &quot;fields&quot; sort with a single field</span>
<span class="preprocessor"></span>            %options = ( fields =&gt; [ $preset ] );
        } <span class="keywordflow">else</span> {
            croak <span class="stringliteral">&quot;preset \&quot;$preset\&quot; not found for class \&quot;$class\&quot;&quot;</span>;
        }
    }
    
    <span class="keywordflow">if</span> (exists $options{fields}) {
        my @fields = @{ $options{fields} };
        
<span class="preprocessor">        # test for existence of fields in class</span>
<span class="preprocessor"></span>        <span class="keywordflow">foreach</span> my $field (@fields) {
            croak <span class="stringliteral">&quot;field \&quot;$field\&quot; is not a field in class \&quot;$class\&quot;&quot;</span> unless exists $class_fields{$field};
        }
        my $pack_key = sub { join <span class="stringliteral">&quot;\0&quot;</span>, map { lc $_[0]-&gt;$_ } @fields };
        
<span class="preprocessor">        # use the Orcish Maneuver to pack_key only once per record</span>
<span class="preprocessor"></span>        keys my %or_cache = @Records; # <span class="keyword">set</span> number of hash buckets
        
        <span class="keywordflow">return</span> sort {
            ($or_cache{$a} ||= &amp;$pack_key($a))
                cmp
            ($or_cache{$b} ||= &amp;$pack_key($b))
        } @Records;
    } <span class="keywordflow">else</span> {
        croak <span class="stringliteral">&quot;sort type missing from options. specify one of: preset, fields&quot;</span>;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="SortRecords_8pm_source.html">SortRecords.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 23:00:31 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
