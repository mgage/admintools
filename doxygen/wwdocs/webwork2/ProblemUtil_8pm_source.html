<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: ProblemUtil.pm Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>ProblemUtil.pm</h1><a href="ProblemUtil_8pm.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">################################################################################</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor"># WeBWorK Online Homework Delivery System</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor"># Copyright © 2000-2007 The WeBWorK Project, http://openwebwork.sf.net/</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor"># $CVSHeader: webwork2/lib/WeBWorK/ContentGenerator/Problem.pm,v 1.225 2010/05/28 21:29:48 gage Exp $</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span><span class="preprocessor"># </span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor"># This program is free software; you can redistribute it and/or modify it under</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span><span class="preprocessor"># the terms of either: (a) the GNU General Public License as published by the</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor"># Free Software Foundation; either version 2, or (at your option) any later</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor"># version, or (b) the &quot;Artistic License&quot; which comes with this package.</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor"># </span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor"># This program is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="preprocessor"># ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor"># FOR A PARTICULAR PURPOSE.  See either the GNU General Public License or the</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor"># Artistic License for more details.</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">################################################################################</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span>
<a name="l00017"></a>00017 <span class="preprocessor"># Created to house most output subroutines for Problem.pm to make that module more lightweight</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor"># Now mostly defunct due to having moved most of the output declarations to the template</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor"># -ghe3</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>
<a name="l00021"></a>00021 <span class="keyword">package </span>WeBWorK::ContentGenerator::ProblemUtil::ProblemUtil;
<a name="l00022"></a>00022 use base qw(<a class="code" href="classWeBWorK.html">WeBWorK</a>);
<a name="l00023"></a>00023 use base qw(<a class="code" href="classWeBWorK_1_1ContentGenerator.html">WeBWorK::ContentGenerator</a>);
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 =head1 NAME
<a name="l00026"></a><a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemUtil_1_1ProblemUtil.html">00026</a>  
<a name="l00027"></a>00027 WeBWorK::ContentGenerator::ProblemUtil::ProblemUtil - contains a bunch of subroutines <span class="keywordflow">for</span> generating output <span class="keywordflow">for</span> the problem pages, especially those generated by <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html">Problem</a>.pm
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 =cut
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 use strict;
<a name="l00032"></a>00032 use warnings;
<a name="l00033"></a>00033 <span class="preprocessor">#use CGI qw(-nosticky );</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>use <a class="code" href="classWeBWorK_1_1CGI.html">WeBWorK::CGI</a>;
<a name="l00035"></a>00035 use File::Path qw(rmtree);
<a name="l00036"></a>00036 use <a class="code" href="classWeBWorK_1_1Debug.html">WeBWorK::Debug</a>;
<a name="l00037"></a>00037 use <a class="code" href="classWeBWorK_1_1Form.html">WeBWorK::Form</a>;
<a name="l00038"></a>00038 use <a class="code" href="classWeBWorK_1_1PG.html">WeBWorK::PG</a>;
<a name="l00039"></a>00039 use WeBWorK::PG::ImageGenerator;
<a name="l00040"></a>00040 use WeBWorK::PG::IO;
<a name="l00041"></a>00041 use <a class="code" href="classWeBWorK_1_1Utils.html">WeBWorK::Utils</a> qw(readFile writeLog writeCourseLog encodeAnswers decodeAnswers
<a name="l00042"></a>00042     ref2string makeTempDirectory path_is_subdir sortByName before after between);
<a name="l00043"></a>00043 use <a class="code" href="classWeBWorK_1_1DB_1_1Utils.html">WeBWorK::DB::Utils</a> qw(global2user user2global);
<a name="l00044"></a>00044 use URI::Escape;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 use <a class="code" href="classWeBWorK_1_1Utils_1_1Tasks.html">WeBWorK::Utils::Tasks</a> qw(fake_set fake_problem);
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor"># process_and_log_answer subroutine.</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>
<a name="l00050"></a>00050 <span class="preprocessor"># performs functions of processing and recording the answer given in the page. Also returns the appropriate scoreRecordedMessage.</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span>
<a name="l00052"></a>00052 sub process_and_log_answer{
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     my $self = shift;
<a name="l00055"></a>00055     
<a name="l00056"></a>00056     my $r = $self-&gt;r;
<a name="l00057"></a>00057     my $db = $r-&gt;db;
<a name="l00058"></a>00058     my $effectiveUser = $r-&gt;param(<span class="stringliteral">&#39;effectiveUser&#39;</span>);
<a name="l00059"></a>00059     my $authz = $r-&gt;authz;
<a name="l00060"></a>00060     
<a name="l00061"></a>00061     
<a name="l00062"></a>00062     my %will = %{ $self-&gt;{will} };
<a name="l00063"></a>00063     my $submitAnswers = $self-&gt;{submitAnswers};
<a name="l00064"></a>00064     my $problem = $self-&gt;{problem};
<a name="l00065"></a>00065     my $pg = $self-&gt;{pg};
<a name="l00066"></a>00066     my $set = $self-&gt;{<span class="keyword">set</span>};
<a name="l00067"></a>00067     
<a name="l00068"></a>00068     my $scoreRecordedMessage = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00069"></a>00069     my $pureProblem;
<a name="l00070"></a>00070     <span class="keywordflow">if</span> ($submitAnswers) {
<a name="l00071"></a>00071 <span class="preprocessor">        # get a &quot;pure&quot; (unmerged) UserProblem to modify</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">        # this will be undefined if the problem has not been assigned to this user</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span>        $pureProblem = $db-&gt;getUserProblem($problem-&gt;user_id, $problem-&gt;set_id, $problem-&gt;problem_id); # checked
<a name="l00074"></a>00074         <span class="keywordflow">if</span> (defined $pureProblem) {
<a name="l00075"></a>00075 <span class="preprocessor">            # store answers in DB for sticky answers</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>            my %answersToStore;
<a name="l00077"></a>00077             my %answerHash = %{ $pg-&gt;{answers} };
<a name="l00078"></a>00078             $answersToStore{$_} = $self-&gt;{formFields}-&gt;{$_}  #$answerHash{$_}-&gt;{original_student_ans} -- <span class="keyword">this</span> may have been modified <span class="keywordflow">for</span> fields with multiple values.  Don<span class="stringliteral">&#39;t use it!!</span>
<a name="l00079"></a>00079 <span class="stringliteral">                foreach (keys %answerHash);</span>
<a name="l00080"></a>00080 <span class="stringliteral">            </span>
<a name="l00081"></a>00081 <span class="stringliteral">            # There may be some more answers to store -- one which are auxiliary entries to a primary answer.  Evaluating</span>
<a name="l00082"></a>00082 <span class="stringliteral">            # matrices works in this way, only the first answer triggers an answer evaluator, the rest are just inputs</span>
<a name="l00083"></a>00083 <span class="stringliteral">            # however we need to store them.  Fortunately they are still in the input form.</span>
<a name="l00084"></a>00084 <span class="stringliteral">            my @extra_answer_names  = @{ $pg-&gt;{flags}-&gt;{KEPT_EXTRA_ANSWERS}};</span>
<a name="l00085"></a>00085 <span class="stringliteral">            $answersToStore{$_} = $self-&gt;{formFields}-&gt;{$_} foreach  (@extra_answer_names);</span>
<a name="l00086"></a>00086 <span class="stringliteral">            </span>
<a name="l00087"></a>00087 <span class="stringliteral">            # Now let&#39;</span>s encode these answers to store them -- append the extra answers to the end of answer entry order
<a name="l00088"></a>00088             my @answer_order = (@{$pg-&gt;{flags}-&gt;{ANSWER_ENTRY_ORDER}}, @extra_answer_names);
<a name="l00089"></a>00089             my $answerString = encodeAnswers(%answersToStore,
<a name="l00090"></a>00090                  @answer_order);
<a name="l00091"></a>00091             
<a name="l00092"></a>00092 <span class="preprocessor">            # store last answer to database</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span>            $problem-&gt;last_answer($answerString);
<a name="l00094"></a>00094             $pureProblem-&gt;last_answer($answerString);
<a name="l00095"></a>00095             $db-&gt;putUserProblem($pureProblem);
<a name="l00096"></a>00096             
<a name="l00097"></a>00097 <span class="preprocessor">            # store state in DB if it makes sense</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ($will{recordAnswers}) {
<a name="l00099"></a>00099                 $problem-&gt;status($pg-&gt;{state}-&gt;{recorded_score});
<a name="l00100"></a>00100                 $problem-&gt;sub_status($pg-&gt;{state}-&gt;{sub_recorded_score});
<a name="l00101"></a>00101                 $problem-&gt;attempted(1);
<a name="l00102"></a>00102                 $problem-&gt;num_correct($pg-&gt;{state}-&gt;{num_of_correct_ans});
<a name="l00103"></a>00103                 $problem-&gt;num_incorrect($pg-&gt;{state}-&gt;{num_of_incorrect_ans});
<a name="l00104"></a>00104                 $pureProblem-&gt;status($pg-&gt;{state}-&gt;{recorded_score});
<a name="l00105"></a>00105                 $pureProblem-&gt;sub_status($pg-&gt;{state}-&gt;{sub_recorded_score});
<a name="l00106"></a>00106                 $pureProblem-&gt;attempted(1);
<a name="l00107"></a>00107                 $pureProblem-&gt;num_correct($pg-&gt;{state}-&gt;{num_of_correct_ans});
<a name="l00108"></a>00108                 $pureProblem-&gt;num_incorrect($pg-&gt;{state}-&gt;{num_of_incorrect_ans});
<a name="l00109"></a>00109                 <span class="keywordflow">if</span> ($db-&gt;putUserProblem($pureProblem)) {
<a name="l00110"></a>00110                     $scoreRecordedMessage = <span class="stringliteral">&quot;Your score was recorded.&quot;</span>;
<a name="l00111"></a>00111                 } <span class="keywordflow">else</span> {
<a name="l00112"></a>00112                     $scoreRecordedMessage = <span class="stringliteral">&quot;Your score was not recorded because there was a failure in storing the problem record to the database.&quot;</span>;
<a name="l00113"></a>00113                 }
<a name="l00114"></a>00114 <span class="preprocessor">                # write to the transaction log, just to make sure</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span>                writeLog($self-&gt;{ce}, <span class="stringliteral">&quot;transaction&quot;</span>,
<a name="l00116"></a>00116                     $problem-&gt;problem_id.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00117"></a>00117                     $problem-&gt;set_id.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00118"></a>00118                     $problem-&gt;user_id.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00119"></a>00119                     $problem-&gt;source_file.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00120"></a>00120                     $problem-&gt;value.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00121"></a>00121                     $problem-&gt;max_attempts.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00122"></a>00122                     $problem-&gt;problem_seed.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00123"></a>00123                     $pureProblem-&gt;status.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00124"></a>00124                     $pureProblem-&gt;attempted.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00125"></a>00125                     $pureProblem-&gt;last_answer.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00126"></a>00126                     $pureProblem-&gt;num_correct.<span class="stringliteral">&quot;\t&quot;</span>.
<a name="l00127"></a>00127                     $pureProblem-&gt;num_incorrect
<a name="l00128"></a>00128                 );
<a name="l00129"></a>00129             } <span class="keywordflow">else</span> {
<a name="l00130"></a>00130                 <span class="keywordflow">if</span> (before($set-&gt;open_date) or after($set-&gt;due_date)) {
<a name="l00131"></a>00131                     $scoreRecordedMessage = <span class="stringliteral">&quot;Your score was not recorded because this homework set is closed.&quot;</span>;
<a name="l00132"></a>00132                 } <span class="keywordflow">else</span> {
<a name="l00133"></a>00133                     $scoreRecordedMessage = <span class="stringliteral">&quot;Your score was not recorded.&quot;</span>;
<a name="l00134"></a>00134                 }
<a name="l00135"></a>00135             }
<a name="l00136"></a>00136         } <span class="keywordflow">else</span> {
<a name="l00137"></a>00137             $scoreRecordedMessage = <span class="stringliteral">&quot;Your score was not recorded because this problem has not been assigned to you.&quot;</span>;
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140     
<a name="l00141"></a>00141 <span class="preprocessor">    # logging student answers</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>
<a name="l00143"></a>00143     my $answer_log    = $self-&gt;{ce}-&gt;{courseFiles}-&gt;{logs}-&gt;{<span class="stringliteral">&#39;answer_log&#39;</span>};
<a name="l00144"></a>00144     <span class="keywordflow">if</span> ( defined($answer_log ) and defined($pureProblem)) {
<a name="l00145"></a>00145         <span class="keywordflow">if</span> ($submitAnswers &amp;&amp; !$authz-&gt;hasPermissions($effectiveUser, <span class="stringliteral">&quot;dont_log_past_answers&quot;</span>)) {
<a name="l00146"></a>00146                 my $answerString = <span class="stringliteral">&quot;&quot;</span>; my $scores = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00147"></a>00147             my %answerHash = %{ $pg-&gt;{answers} };
<a name="l00148"></a>00148 <span class="preprocessor">            # FIXME  this is the line 552 error.  make sure original student ans is defined.</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span><span class="preprocessor">            # The fact that it is not defined is probably due to an error in some answer evaluator.</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span><span class="preprocessor">            # But I think it is useful to suppress this error message in the log.</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>            <span class="keywordflow">foreach</span> (sortByName(undef, keys %answerHash)) {
<a name="l00152"></a>00152                 my $orig_ans = $answerHash{$_}-&gt;{original_student_ans};
<a name="l00153"></a>00153                 my $student_ans = defined $orig_ans ? $orig_ans : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00154"></a>00154                 $answerString  .= $student_ans.<span class="stringliteral">&quot;\t&quot;</span>;
<a name="l00155"></a>00155                 $scores .= $answerHash{$_}-&gt;{score} &gt;= 1 ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>;
<a name="l00156"></a>00156             }
<a name="l00157"></a>00157             $answerString = <span class="stringliteral">&#39;&#39;</span> unless defined($answerString); # insure <span class="keywordtype">string</span> is defined.
<a name="l00158"></a>00158             writeCourseLog($self-&gt;{ce}, <span class="stringliteral">&quot;answer_log&quot;</span>,
<a name="l00159"></a>00159                     join(<span class="stringliteral">&quot;&quot;</span>,
<a name="l00160"></a>00160                         <span class="charliteral">&#39;|&#39;</span>, $problem-&gt;user_id,
<a name="l00161"></a>00161                         <span class="charliteral">&#39;|&#39;</span>, $problem-&gt;set_id,
<a name="l00162"></a>00162                         <span class="charliteral">&#39;|&#39;</span>, $problem-&gt;problem_id,
<a name="l00163"></a>00163                         <span class="charliteral">&#39;|&#39;</span>, $scores, <span class="stringliteral">&quot;\t&quot;</span>,
<a name="l00164"></a>00164                         time(),<span class="stringliteral">&quot;\t&quot;</span>,
<a name="l00165"></a>00165                         $answerString,
<a name="l00166"></a>00166                     ),
<a name="l00167"></a>00167             );
<a name="l00168"></a>00168             
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171     
<a name="l00172"></a>00172     $self-&gt;{scoreRecordedMessage} = $scoreRecordedMessage;
<a name="l00173"></a>00173     <span class="keywordflow">return</span> $scoreRecordedMessage;
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="preprocessor"># process_editorLink subroutine</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>
<a name="l00178"></a>00178 <span class="preprocessor"># Creates and returns the proper editor link for the current website.  Also checks for translation errors and prints an error message and returning a false value if one is detected.</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>
<a name="l00180"></a>00180 sub process_editorLink{
<a name="l00181"></a>00181     
<a name="l00182"></a>00182     my $self = shift;
<a name="l00183"></a>00183     
<a name="l00184"></a>00184     my $set = $self-&gt;{<span class="keyword">set</span>};
<a name="l00185"></a>00185     my $problem = $self-&gt;{problem};
<a name="l00186"></a>00186     my $pg = $self-&gt;{pg};
<a name="l00187"></a>00187     
<a name="l00188"></a>00188     my $r = $self-&gt;r;
<a name="l00189"></a>00189     
<a name="l00190"></a>00190     my $authz = $r-&gt;authz;
<a name="l00191"></a>00191     my $urlpath = $r-&gt;urlpath;
<a name="l00192"></a>00192     my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
<a name="l00193"></a>00193     
<a name="l00194"></a>00194     my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
<a name="l00195"></a>00195     
<a name="l00196"></a>00196 <span class="preprocessor">    # FIXME: move editor link to top, next to problem number.</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span><span class="preprocessor">    # format as &quot;[edit]&quot; like we&#39;re doing with course info file, etc.</span>
<a name="l00198"></a>00198 <span class="preprocessor"></span><span class="preprocessor">    # add edit link for set as well.</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span>    my $editorLink = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00200"></a>00200 <span class="preprocessor">    # if we are here without a real homework set, carry that through</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>    my $forced_field = [];
<a name="l00202"></a>00202     $forced_field = [<span class="stringliteral">&#39;sourceFilePath&#39;</span> =&gt;  $r-&gt;param(<span class="stringliteral">&quot;sourceFilePath&quot;</span>)] <span class="keywordflow">if</span>
<a name="l00203"></a>00203         ($set-&gt;set_id eq <span class="stringliteral">&#39;Undefined_Set&#39;</span>);
<a name="l00204"></a>00204     <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;modify_problem_sets&quot;</span>)) {
<a name="l00205"></a>00205         my $editorPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::PGProblemEditor&quot;</span>,
<a name="l00206"></a>00206             courseID =&gt; $courseName, setID =&gt; $set-&gt;set_id, problemID =&gt; $problem-&gt;problem_id);
<a name="l00207"></a>00207         my $editorURL = $self-&gt;systemLink($editorPage, params=&gt;$forced_field);
<a name="l00208"></a>00208         $editorLink = CGI::p(CGI::a({href=&gt;$editorURL,target =&gt;<span class="stringliteral">&#39;WW_Editor&#39;</span>}, <span class="stringliteral">&quot;Edit this problem&quot;</span>));
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210     
<a name="l00211"></a>00211 <span class="preprocessor">    ##### translation errors? #####</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span>
<a name="l00213"></a>00213     <span class="keywordflow">if</span> ($pg-&gt;{flags}-&gt;{error_flag}) {
<a name="l00214"></a>00214         <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_problem_debugging_info&quot;</span>)) {
<a name="l00215"></a>00215             print $self-&gt;errorOutput($pg-&gt;{errors}, $pg-&gt;{body_text});
<a name="l00216"></a>00216         } <span class="keywordflow">else</span> {
<a name="l00217"></a>00217             print $self-&gt;errorOutput($pg-&gt;{errors}, <span class="stringliteral">&quot;You do not have permission to view the details of this error.&quot;</span>);
<a name="l00218"></a>00218         }
<a name="l00219"></a>00219         print $editorLink;
<a name="l00220"></a>00220         <span class="keywordflow">return</span> <span class="stringliteral">&quot;permission_error&quot;</span>;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222     <span class="keywordflow">else</span>{
<a name="l00223"></a>00223         <span class="keywordflow">return</span> $editorLink;
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="preprocessor"># output_JS subroutine</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>
<a name="l00229"></a>00229 <span class="preprocessor"># prints out the wz_tooltip.js script for the current site.</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span>
<a name="l00231"></a>00231 sub output_JS{
<a name="l00232"></a>00232     
<a name="l00233"></a>00233     my $self = shift;
<a name="l00234"></a>00234     my $r = $self-&gt;r;
<a name="l00235"></a>00235     my $ce = $r-&gt;ce;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     my $site_url = $ce-&gt;{webworkURLs}-&gt;{htdocs};
<a name="l00238"></a>00238     print CGI::start_script({type=&gt;<span class="stringliteral">&quot;text/javascript&quot;</span>, src=&gt;<span class="stringliteral">&quot;$site_url/js/wz_tooltip.js&quot;</span>}), CGI::end_script();
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="preprocessor"># output_summary subroutine</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>
<a name="l00243"></a>00243 <span class="preprocessor"># prints out summary information for the problem pages.</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>
<a name="l00245"></a>00245 sub output_summary{
<a name="l00246"></a>00246     
<a name="l00247"></a>00247     my $self = shift;
<a name="l00248"></a>00248     
<a name="l00249"></a>00249     my $editMode = $self-&gt;{editMode};
<a name="l00250"></a>00250     my $problem = $self-&gt;{problem};
<a name="l00251"></a>00251     my $pg = $self-&gt;{pg};
<a name="l00252"></a>00252     my $submitAnswers = $self-&gt;{submitAnswers};
<a name="l00253"></a>00253     my %will = %{ $self-&gt;{will} };
<a name="l00254"></a>00254     my $checkAnswers = $self-&gt;{checkAnswers};
<a name="l00255"></a>00255     my $previewAnswers = $self-&gt;{previewAnswers};
<a name="l00256"></a>00256     
<a name="l00257"></a>00257     my $r = $self-&gt;r;
<a name="l00258"></a>00258     
<a name="l00259"></a>00259     my $authz = $r-&gt;authz;
<a name="l00260"></a>00260     my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
<a name="l00261"></a>00261     
<a name="l00262"></a>00262 <span class="preprocessor">    # custom message for editor</span>
<a name="l00263"></a>00263 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;modify_problem_sets&quot;</span>) and defined $editMode) {
<a name="l00264"></a>00264         <span class="keywordflow">if</span> ($editMode eq <span class="stringliteral">&quot;temporaryFile&quot;</span>) {
<a name="l00265"></a>00265             print CGI::p(CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&#39;temporaryFile&#39;</span>}, <span class="stringliteral">&quot;Viewing temporary file: &quot;</span>, $problem-&gt;source_file));
<a name="l00266"></a>00266         } elsif ($editMode eq <span class="stringliteral">&quot;savedFile&quot;</span>) {
<a name="l00267"></a>00267 <span class="preprocessor">            # taken care of in the initialization phase</span>
<a name="l00268"></a>00268 <span class="preprocessor"></span>        }
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270     print CGI::start_div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;problemHeader&quot;</span>});
<a name="l00271"></a>00271     
<a name="l00272"></a>00272     
<a name="l00273"></a>00273 <span class="preprocessor">    # attempt summary</span>
<a name="l00274"></a>00274 <span class="preprocessor"></span><span class="preprocessor">    #FIXME -- the following is a kludge:  if showPartialCorrectAnswers is negative don&#39;t show anything.</span>
<a name="l00275"></a>00275 <span class="preprocessor"></span><span class="preprocessor">    # until after the due date</span>
<a name="l00276"></a>00276 <span class="preprocessor"></span><span class="preprocessor">    # do I need to check $will{showCorrectAnswers} to make preflight work??</span>
<a name="l00277"></a>00277 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (($pg-&gt;{flags}-&gt;{showPartialCorrectAnswers} &gt;= 0 and $submitAnswers) ) {
<a name="l00278"></a>00278 <span class="preprocessor">        # print this if user submitted answers OR requested correct answers</span>
<a name="l00279"></a>00279 <span class="preprocessor"></span>        
<a name="l00280"></a>00280         print $self-&gt;attemptResults($pg, 1,
<a name="l00281"></a>00281             $will{showCorrectAnswers},
<a name="l00282"></a>00282             $pg-&gt;{flags}-&gt;{showPartialCorrectAnswers}, 1, 1);
<a name="l00283"></a>00283     } elsif ($checkAnswers) {
<a name="l00284"></a>00284 <span class="preprocessor">        # print this if user previewed answers</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span>        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&#39;ResultsWithError&#39;</span>},<span class="stringliteral">&quot;ANSWERS ONLY CHECKED -- ANSWERS NOT RECORDED&quot;</span>), CGI::br();
<a name="l00286"></a>00286         print $self-&gt;attemptResults($pg, 1, $will{showCorrectAnswers}, 1, 1, 1);
<a name="l00287"></a>00287 <span class="preprocessor">            # show attempt answers</span>
<a name="l00288"></a>00288 <span class="preprocessor"></span><span class="preprocessor">            # show correct answers if asked</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span><span class="preprocessor">            # show attempt results (correctness)</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span><span class="preprocessor">            # show attempt previews</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span>    } elsif ($previewAnswers) {
<a name="l00292"></a>00292 <span class="preprocessor">        # print this if user previewed answers</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span>        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&#39;ResultsWithError&#39;</span>},<span class="stringliteral">&quot;PREVIEW ONLY -- ANSWERS NOT RECORDED&quot;</span>),CGI::br(),$self-&gt;attemptResults($pg, 1, 0, 0, 0, 1);
<a name="l00294"></a>00294 <span class="preprocessor">            # show attempt answers</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span><span class="preprocessor">            # don&#39;t show correct answers</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span><span class="preprocessor">            # don&#39;t show attempt results (correctness)</span>
<a name="l00297"></a>00297 <span class="preprocessor"></span><span class="preprocessor">            # show attempt previews</span>
<a name="l00298"></a>00298 <span class="preprocessor"></span>    }
<a name="l00299"></a>00299     
<a name="l00300"></a>00300     print CGI::end_div();
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 <span class="preprocessor"># output_CSS subroutine</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>
<a name="l00305"></a>00305 <span class="preprocessor"># prints the CSS scripts to page.  Does some PERL trickery to form the styles for the correct answers and the incorrect answers (which may be substituted with JS sometime in the future).</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span>
<a name="l00307"></a>00307 sub output_CSS{
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     my $self = shift;
<a name="l00310"></a>00310     my $r = $self-&gt;r;
<a name="l00311"></a>00311     my $ce = $r-&gt;ce;
<a name="l00312"></a>00312     my $pg = $self-&gt;{pg};
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="preprocessor">    # always show colors for checkAnswers</span>
<a name="l00315"></a>00315 <span class="preprocessor"></span><span class="preprocessor">    # show colors for submit answer if </span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (($self-&gt;{checkAnswers}) or ($self-&gt;{submitAnswers} and $pg-&gt;{flags}-&gt;{showPartialCorrectAnswers}) ) {
<a name="l00317"></a>00317         print CGI::start_style({type=&gt;<span class="stringliteral">&quot;text/css&quot;</span>});
<a name="l00318"></a>00318         print   <span class="charliteral">&#39;#&#39;</span>.join(<span class="stringliteral">&#39;, #&#39;</span>, @{ $self-&gt;{correct_ids} }), $ce-&gt;{pg}{options}{correct_answer}   <span class="keywordflow">if</span> ref( $self-&gt;{correct_ids}  )=~/ARRAY/;   #correct  green
<a name="l00319"></a>00319         print   <span class="charliteral">&#39;#&#39;</span>.join(<span class="stringliteral">&#39;, #&#39;</span>, @{ $self-&gt;{incorrect_ids} }), $ce-&gt;{pg}{options}{incorrect_answer} <span class="keywordflow">if</span> ref( $self-&gt;{incorrect_ids})=~/ARRAY/; #incorrect  reddish
<a name="l00320"></a>00320         print   CGI::end_style();
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="preprocessor"># output_main_form subroutine.</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>
<a name="l00326"></a>00326 <span class="preprocessor"># prints out the main form for the page.  This particular subroutine also takes in $editorLink and $scoreRecordedMessage as required parameters. Also uses CGI_labeled_input for its input elements for accessibility reasons.  Also prints out the score summary where applicable.</span>
<a name="l00327"></a>00327 <span class="preprocessor"></span>
<a name="l00328"></a>00328 sub output_main_form{
<a name="l00329"></a>00329     
<a name="l00330"></a>00330     my $self = shift;
<a name="l00331"></a>00331     my $editorLink = shift;
<a name="l00332"></a>00332     
<a name="l00333"></a>00333     my $r = $self-&gt;r;
<a name="l00334"></a>00334     my $pg = $self-&gt;{pg};
<a name="l00335"></a>00335     my $problem = $self-&gt;{problem};
<a name="l00336"></a>00336     my $set = $self-&gt;{<span class="keyword">set</span>};
<a name="l00337"></a>00337     my $submitAnswers = $self-&gt;{submitAnswers};
<a name="l00338"></a>00338     
<a name="l00339"></a>00339     my $db = $r-&gt;db;
<a name="l00340"></a>00340     my $ce = $r-&gt;ce;
<a name="l00341"></a>00341     my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
<a name="l00342"></a>00342     my $effectiveUser = $r-&gt;{<span class="stringliteral">&#39;effectiveUser&#39;</span>};
<a name="l00343"></a>00343     
<a name="l00344"></a>00344     my %can = %{ $self-&gt;{can} };
<a name="l00345"></a>00345     my %will = %{ $self-&gt;{will} };
<a name="l00346"></a>00346     
<a name="l00347"></a>00347     print <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00348"></a>00348     print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt; $r-&gt;uri,-name=&gt;<span class="stringliteral">&quot;problemMainForm&quot;</span>, onsubmit=&gt;<span class="stringliteral">&quot;submitAction()&quot;</span>);
<a name="l00349"></a>00349     print $self-&gt;hidden_authen_fields;
<a name="l00350"></a>00350 <span class="preprocessor">    # print &quot;\n&quot;;</span>
<a name="l00351"></a>00351 <span class="preprocessor"></span><span class="preprocessor">    # print CGI::start_div({class=&gt;&quot;problem&quot;});</span>
<a name="l00352"></a>00352 <span class="preprocessor"></span><span class="preprocessor">    # print CGI::p($pg-&gt;{body_text});</span>
<a name="l00353"></a>00353 <span class="preprocessor"></span><span class="preprocessor">    # print CGI::p(CGI::b(&quot;Note: &quot;). CGI::i($pg-&gt;{result}-&gt;{msg})) if $pg-&gt;{result}-&gt;{msg};</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span><span class="preprocessor">    # print $editorLink; # this is empty unless it is appropriate to have an editor link.</span>
<a name="l00355"></a>00355 <span class="preprocessor"></span><span class="preprocessor">    # print CGI::end_div();</span>
<a name="l00356"></a>00356 <span class="preprocessor"></span>    
<a name="l00357"></a>00357 <span class="preprocessor">    # print CGI::start_p();</span>
<a name="l00358"></a>00358 <span class="preprocessor"></span>    
<a name="l00359"></a>00359 <span class="preprocessor">    # if ($can{showCorrectAnswers}) {</span>
<a name="l00360"></a>00360 <span class="preprocessor"></span><span class="preprocessor">        # print WeBWorK::CGI_labeled_input(</span>
<a name="l00361"></a>00361 <span class="preprocessor"></span><span class="preprocessor">            # -type  =&gt; &quot;checkbox&quot;,</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span><span class="preprocessor">            # -id        =&gt; &quot;showCorrectAnswers_id&quot;,</span>
<a name="l00363"></a>00363 <span class="preprocessor"></span><span class="preprocessor">            # -label_text =&gt; &quot;Show correct answers&quot;,</span>
<a name="l00364"></a>00364 <span class="preprocessor"></span><span class="preprocessor">            # -input_attr =&gt; $will{showCorrectAnswers} ?</span>
<a name="l00365"></a>00365 <span class="preprocessor"></span><span class="preprocessor">            # {</span>
<a name="l00366"></a>00366 <span class="preprocessor"></span><span class="preprocessor">                # -name    =&gt; &quot;showCorrectAnswers&quot;,</span>
<a name="l00367"></a>00367 <span class="preprocessor"></span><span class="preprocessor">                # -checked =&gt; &quot;checked&quot;,</span>
<a name="l00368"></a>00368 <span class="preprocessor"></span><span class="preprocessor">                # -value   =&gt; 1,</span>
<a name="l00369"></a>00369 <span class="preprocessor"></span><span class="preprocessor">            # }</span>
<a name="l00370"></a>00370 <span class="preprocessor"></span><span class="preprocessor">            # :</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span><span class="preprocessor">            # {</span>
<a name="l00372"></a>00372 <span class="preprocessor"></span><span class="preprocessor">                # -name    =&gt; &quot;showCorrectAnswers&quot;,</span>
<a name="l00373"></a>00373 <span class="preprocessor"></span><span class="preprocessor">                # -value   =&gt; 1,</span>
<a name="l00374"></a>00374 <span class="preprocessor"></span><span class="preprocessor">            # }</span>
<a name="l00375"></a>00375 <span class="preprocessor"></span><span class="preprocessor">        # );</span>
<a name="l00376"></a>00376 <span class="preprocessor"></span><span class="preprocessor">    # }</span>
<a name="l00377"></a>00377 <span class="preprocessor"></span><span class="preprocessor">    # if ($can{showHints}) {</span>
<a name="l00378"></a>00378 <span class="preprocessor"></span><span class="preprocessor">        # print CGI::div({style=&gt;&quot;color:red&quot;},</span>
<a name="l00379"></a>00379 <span class="preprocessor"></span><span class="preprocessor">            # WeBWorK::CGI_labeled_input(</span>
<a name="l00380"></a>00380 <span class="preprocessor"></span><span class="preprocessor">                # -type  =&gt; &quot;checkbox&quot;,</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span><span class="preprocessor">                # -id        =&gt; &quot;showHints_id&quot;,</span>
<a name="l00382"></a>00382 <span class="preprocessor"></span><span class="preprocessor">                # -label_text =&gt; &quot;Show Hints&quot;,</span>
<a name="l00383"></a>00383 <span class="preprocessor"></span><span class="preprocessor">                # -input_attr =&gt; $will{showHints} ?</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span><span class="preprocessor">                # {</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span><span class="preprocessor">                    # -name    =&gt; &quot;showHints&quot;,</span>
<a name="l00386"></a>00386 <span class="preprocessor"></span><span class="preprocessor">                    # -checked =&gt; &quot;checked&quot;,</span>
<a name="l00387"></a>00387 <span class="preprocessor"></span><span class="preprocessor">                    # -value   =&gt; 1,</span>
<a name="l00388"></a>00388 <span class="preprocessor"></span><span class="preprocessor">                # }</span>
<a name="l00389"></a>00389 <span class="preprocessor"></span><span class="preprocessor">                # :</span>
<a name="l00390"></a>00390 <span class="preprocessor"></span><span class="preprocessor">                # {</span>
<a name="l00391"></a>00391 <span class="preprocessor"></span><span class="preprocessor">                    # -name    =&gt; &quot;showCorrectAnswers&quot;,</span>
<a name="l00392"></a>00392 <span class="preprocessor"></span><span class="preprocessor">                    # -value   =&gt; 1,</span>
<a name="l00393"></a>00393 <span class="preprocessor"></span><span class="preprocessor">                # }</span>
<a name="l00394"></a>00394 <span class="preprocessor"></span><span class="preprocessor">            # )</span>
<a name="l00395"></a>00395 <span class="preprocessor"></span><span class="preprocessor">        # );</span>
<a name="l00396"></a>00396 <span class="preprocessor"></span><span class="preprocessor">    # }</span>
<a name="l00397"></a>00397 <span class="preprocessor"></span><span class="preprocessor">    # if ($can{showSolutions}) {</span>
<a name="l00398"></a>00398 <span class="preprocessor"></span><span class="preprocessor">        # print WeBWorK::CGI_labeled_input(</span>
<a name="l00399"></a>00399 <span class="preprocessor"></span><span class="preprocessor">            # -type  =&gt; &quot;checkbox&quot;,</span>
<a name="l00400"></a>00400 <span class="preprocessor"></span><span class="preprocessor">            # -id        =&gt; &quot;showSolutions_id&quot;,</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span><span class="preprocessor">            # -label_text =&gt; &quot;Show Solutions&quot;,</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span><span class="preprocessor">            # -input_attr =&gt; $will{showSolutions} ?</span>
<a name="l00403"></a>00403 <span class="preprocessor"></span><span class="preprocessor">            # {</span>
<a name="l00404"></a>00404 <span class="preprocessor"></span><span class="preprocessor">                # -name    =&gt; &quot;showSolutions&quot;,</span>
<a name="l00405"></a>00405 <span class="preprocessor"></span><span class="preprocessor">                # -checked =&gt; &quot;checked&quot;,</span>
<a name="l00406"></a>00406 <span class="preprocessor"></span><span class="preprocessor">                # -value   =&gt; 1,</span>
<a name="l00407"></a>00407 <span class="preprocessor"></span><span class="preprocessor">            # }</span>
<a name="l00408"></a>00408 <span class="preprocessor"></span><span class="preprocessor">            # :</span>
<a name="l00409"></a>00409 <span class="preprocessor"></span><span class="preprocessor">            # {</span>
<a name="l00410"></a>00410 <span class="preprocessor"></span><span class="preprocessor">                # -name    =&gt; &quot;showCorrectAnswers&quot;,</span>
<a name="l00411"></a>00411 <span class="preprocessor"></span><span class="preprocessor">                # -value   =&gt; 1,</span>
<a name="l00412"></a>00412 <span class="preprocessor"></span><span class="preprocessor">            # }</span>
<a name="l00413"></a>00413 <span class="preprocessor"></span><span class="preprocessor">        # );</span>
<a name="l00414"></a>00414 <span class="preprocessor"></span><span class="preprocessor">    # }</span>
<a name="l00415"></a>00415 <span class="preprocessor"></span>    
<a name="l00416"></a>00416 <span class="preprocessor">    # if ($can{showCorrectAnswers} or $can{showHints} or $can{showSolutions}) {</span>
<a name="l00417"></a>00417 <span class="preprocessor"></span><span class="preprocessor">        # print CGI::br();</span>
<a name="l00418"></a>00418 <span class="preprocessor"></span><span class="preprocessor">    # }</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span>        
<a name="l00420"></a>00420 <span class="preprocessor">    # print WeBWorK::CGI_labeled_input(-type=&gt;&quot;submit&quot;, -id=&gt;&quot;previewAnswers_id&quot;, -input_attr=&gt;{-name=&gt;&quot;previewAnswers&quot;, -value=&gt;&quot;Preview Answers&quot;});</span>
<a name="l00421"></a>00421 <span class="preprocessor"></span><span class="preprocessor">    # if ($can{checkAnswers}) {</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span><span class="preprocessor">        # print WeBWorK::CGI_labeled_input(-type=&gt;&quot;submit&quot;, -id=&gt;&quot;checkAnswers_id&quot;, -input_attr=&gt;{-name=&gt;&quot;checkAnswers&quot;, -value=&gt;&quot;Check Answers&quot;});</span>
<a name="l00423"></a>00423 <span class="preprocessor"></span><span class="preprocessor">    # }</span>
<a name="l00424"></a>00424 <span class="preprocessor"></span><span class="preprocessor">    # if ($can{getSubmitButton}) {</span>
<a name="l00425"></a>00425 <span class="preprocessor"></span><span class="preprocessor">        # if ($user ne $effectiveUser) {</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span><span class="preprocessor">            # # if acting as a student, make it clear that answer submissions will</span>
<a name="l00427"></a>00427 <span class="preprocessor"></span><span class="preprocessor">            # # apply to the student&#39;s records, not the professor&#39;s.</span>
<a name="l00428"></a>00428 <span class="preprocessor"></span><span class="preprocessor">            # print WeBWorK::CGI_labeled_input(-type=&gt;&quot;submit&quot;, -id=&gt;&quot;submitAnswers_id&quot;, -input_attr=&gt;{-name=&gt;&quot;submitAnswers&quot;, -value=&gt;&quot;Submit Answers for $effectiveUser&quot;});</span>
<a name="l00429"></a>00429 <span class="preprocessor"></span><span class="preprocessor">        # } else {</span>
<a name="l00430"></a>00430 <span class="preprocessor"></span><span class="preprocessor">            # #print CGI::submit(-name=&gt;&quot;submitAnswers&quot;, -label=&gt;&quot;Submit Answers&quot;, -onclick=&gt;&quot;alert(&#39;submit button clicked&#39;)&quot;);</span>
<a name="l00431"></a>00431 <span class="preprocessor"></span><span class="preprocessor">            # print WeBWorK::CGI_labeled_input(-type=&gt;&quot;submit&quot;, -id=&gt;&quot;submitAnswers_id&quot;, -input_attr=&gt;{-name=&gt;&quot;submitAnswers&quot;, -label=&gt;&quot;Submit Answers&quot;, -onclick=&gt;&quot;&quot;});</span>
<a name="l00432"></a>00432 <span class="preprocessor"></span><span class="preprocessor">            # # FIXME  for unknown reasons the -onclick label seems to have to be there in order to allow the forms onsubmit to trigger</span>
<a name="l00433"></a>00433 <span class="preprocessor"></span><span class="preprocessor">            # # WFT???</span>
<a name="l00434"></a>00434 <span class="preprocessor"></span><span class="preprocessor">        # }</span>
<a name="l00435"></a>00435 <span class="preprocessor"></span><span class="preprocessor">    # }</span>
<a name="l00436"></a>00436 <span class="preprocessor"></span>    
<a name="l00437"></a>00437 <span class="preprocessor">    # print CGI::end_p();</span>
<a name="l00438"></a>00438 <span class="preprocessor"></span>    
<a name="l00439"></a>00439 <span class="preprocessor">    # print CGI::start_div({class=&gt;&quot;scoreSummary&quot;});</span>
<a name="l00440"></a>00440 <span class="preprocessor"></span>    
<a name="l00441"></a>00441 <span class="preprocessor">    # # score summary</span>
<a name="l00442"></a>00442 <span class="preprocessor"></span><span class="preprocessor">    # my $attempts = $problem-&gt;num_correct + $problem-&gt;num_incorrect;</span>
<a name="l00443"></a>00443 <span class="preprocessor"></span><span class="preprocessor">    # my $attemptsNoun = $attempts != 1 ? &quot;times&quot; : &quot;time&quot;;</span>
<a name="l00444"></a>00444 <span class="preprocessor"></span><span class="preprocessor">    # my $problem_status    = $problem-&gt;status || 0;</span>
<a name="l00445"></a>00445 <span class="preprocessor"></span><span class="preprocessor">    # my $lastScore = sprintf(&quot;%.0f%%&quot;, $problem_status * 100); # Round to whole number</span>
<a name="l00446"></a>00446 <span class="preprocessor"></span><span class="preprocessor">    # my ($attemptsLeft, $attemptsLeftNoun);</span>
<a name="l00447"></a>00447 <span class="preprocessor"></span><span class="preprocessor">    # if ($problem-&gt;max_attempts == -1) {</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span><span class="preprocessor">        # # unlimited attempts</span>
<a name="l00449"></a>00449 <span class="preprocessor"></span><span class="preprocessor">        # $attemptsLeft = &quot;unlimited&quot;;</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span><span class="preprocessor">        # $attemptsLeftNoun = &quot;attempts&quot;;</span>
<a name="l00451"></a>00451 <span class="preprocessor"></span><span class="preprocessor">    # } else {</span>
<a name="l00452"></a>00452 <span class="preprocessor"></span><span class="preprocessor">        # $attemptsLeft = $problem-&gt;max_attempts - $attempts;</span>
<a name="l00453"></a>00453 <span class="preprocessor"></span><span class="preprocessor">        # $attemptsLeftNoun = $attemptsLeft == 1 ? &quot;attempt&quot; : &quot;attempts&quot;;</span>
<a name="l00454"></a>00454 <span class="preprocessor"></span><span class="preprocessor">    # }</span>
<a name="l00455"></a>00455 <span class="preprocessor"></span>    
<a name="l00456"></a>00456 <span class="preprocessor">    # my $setClosed = 0;</span>
<a name="l00457"></a>00457 <span class="preprocessor"></span><span class="preprocessor">    # my $setClosedMessage;</span>
<a name="l00458"></a>00458 <span class="preprocessor"></span><span class="preprocessor">    # if (before($set-&gt;open_date) or after($set-&gt;due_date)) {</span>
<a name="l00459"></a>00459 <span class="preprocessor"></span><span class="preprocessor">        # $setClosed = 1;</span>
<a name="l00460"></a>00460 <span class="preprocessor"></span><span class="preprocessor">        # if (before($set-&gt;open_date)) {</span>
<a name="l00461"></a>00461 <span class="preprocessor"></span><span class="preprocessor">            # $setClosedMessage = &quot;This homework set is not yet open.&quot;;</span>
<a name="l00462"></a>00462 <span class="preprocessor"></span><span class="preprocessor">        # } elsif (after($set-&gt;due_date)) {</span>
<a name="l00463"></a>00463 <span class="preprocessor"></span><span class="preprocessor">            # $setClosedMessage = &quot;This homework set is closed.&quot;;</span>
<a name="l00464"></a>00464 <span class="preprocessor"></span><span class="preprocessor">        # }</span>
<a name="l00465"></a>00465 <span class="preprocessor"></span><span class="preprocessor">    # }</span>
<a name="l00466"></a>00466 <span class="preprocessor"></span><span class="preprocessor">    # #if (before($set-&gt;open_date) or after($set-&gt;due_date)) {</span>
<a name="l00467"></a>00467 <span class="preprocessor"></span><span class="preprocessor">    # # $setClosed = 1;</span>
<a name="l00468"></a>00468 <span class="preprocessor"></span><span class="preprocessor">    # # $setClosedMessage = &quot;This homework set is closed.&quot;;</span>
<a name="l00469"></a>00469 <span class="preprocessor"></span><span class="preprocessor">    # # if ($authz-&gt;hasPermissions($user, &quot;view_answers&quot;)) {</span>
<a name="l00470"></a>00470 <span class="preprocessor"></span><span class="preprocessor">    # #     $setClosedMessage .= &quot; However, since you are a privileged user, additional attempts will be recorded.&quot;;</span>
<a name="l00471"></a>00471 <span class="preprocessor"></span><span class="preprocessor">    # # } else {</span>
<a name="l00472"></a>00472 <span class="preprocessor"></span><span class="preprocessor">    # #     $setClosedMessage .= &quot; Additional attempts will not be recorded.&quot;;</span>
<a name="l00473"></a>00473 <span class="preprocessor"></span><span class="preprocessor">    # # }</span>
<a name="l00474"></a>00474 <span class="preprocessor"></span><span class="preprocessor">    # #}</span>
<a name="l00475"></a>00475 <span class="preprocessor"></span><span class="preprocessor">    # unless (defined( $pg-&gt;{state}-&gt;{state_summary_msg}) and $pg-&gt;{state}-&gt;{state_summary_msg}=~/\S/) {</span>
<a name="l00476"></a>00476 <span class="preprocessor"></span><span class="preprocessor">        # my $notCountedMessage = ($problem-&gt;value) ? &quot;&quot; : &quot;(This problem will not count towards your grade.)&quot;;</span>
<a name="l00477"></a>00477 <span class="preprocessor"></span><span class="preprocessor">        # print CGI::p(join(&quot;&quot;,</span>
<a name="l00478"></a>00478 <span class="preprocessor"></span><span class="preprocessor">            # $submitAnswers ? $scoreRecordedMessage . CGI::br() : &quot;&quot;,</span>
<a name="l00479"></a>00479 <span class="preprocessor"></span><span class="preprocessor">            # &quot;You have attempted this problem $attempts $attemptsNoun.&quot;, CGI::br(),</span>
<a name="l00480"></a>00480 <span class="preprocessor"></span><span class="preprocessor">            # $submitAnswers ?&quot;You received a score of &quot;.sprintf(&quot;%.0f%%&quot;, $pg-&gt;{result}-&gt;{score} * 100).&quot; for this attempt.&quot;.CGI::br():&#39;&#39;,</span>
<a name="l00481"></a>00481 <span class="preprocessor"></span><span class="preprocessor">            # $problem-&gt;attempted</span>
<a name="l00482"></a>00482 <span class="preprocessor"></span><span class="preprocessor">                # ? &quot;Your overall recorded score is $lastScore.  $notCountedMessage&quot; . CGI::br()</span>
<a name="l00483"></a>00483 <span class="preprocessor"></span><span class="preprocessor">                # : &quot;&quot;,</span>
<a name="l00484"></a>00484 <span class="preprocessor"></span><span class="preprocessor">            # $setClosed ? $setClosedMessage : &quot;You have $attemptsLeft $attemptsLeftNoun remaining.&quot;</span>
<a name="l00485"></a>00485 <span class="preprocessor"></span><span class="preprocessor">        # ));</span>
<a name="l00486"></a>00486 <span class="preprocessor"></span><span class="preprocessor">    # }else {</span>
<a name="l00487"></a>00487 <span class="preprocessor"></span><span class="preprocessor">        # print CGI::p($pg-&gt;{state}-&gt;{state_summary_msg});</span>
<a name="l00488"></a>00488 <span class="preprocessor"></span><span class="preprocessor">    # }</span>
<a name="l00489"></a>00489 <span class="preprocessor"></span>
<a name="l00490"></a>00490 <span class="preprocessor">    # print CGI::end_div();</span>
<a name="l00491"></a>00491 <span class="preprocessor"></span><span class="preprocessor">    # print CGI::start_div();</span>
<a name="l00492"></a>00492 <span class="preprocessor"></span>    
<a name="l00493"></a>00493 <span class="preprocessor">    # my $pgdebug = join(CGI::br(), @{$pg-&gt;{pgcore}-&gt;{flags}-&gt;{DEBUG_messages}} );</span>
<a name="l00494"></a>00494 <span class="preprocessor"></span><span class="preprocessor">    # my $pgwarning = join(CGI::br(), @{$pg-&gt;{pgcore}-&gt;{flags}-&gt;{WARNING_messages}} );</span>
<a name="l00495"></a>00495 <span class="preprocessor"></span><span class="preprocessor">    # my $pginternalerrors = join(CGI::br(),  @{$pg-&gt;{pgcore}-&gt;get_internal_debug_messages}   );</span>
<a name="l00496"></a>00496 <span class="preprocessor"></span><span class="preprocessor">    # my $pgerrordiv = $pgdebug||$pgwarning||$pginternalerrors;  # is 1 if any of these are non-empty</span>
<a name="l00497"></a>00497 <span class="preprocessor"></span>    
<a name="l00498"></a>00498 <span class="preprocessor">    # print CGI::p({style=&gt;&quot;color:red;&quot;}, &quot;Checking additional error messages&quot;) if $pgerrordiv  ;</span>
<a name="l00499"></a>00499 <span class="preprocessor"></span><span class="preprocessor">    # print CGI::p(&quot;pg debug&lt;br/&gt; $pgdebug&quot;                   ) if $pgdebug ;</span>
<a name="l00500"></a>00500 <span class="preprocessor"></span><span class="preprocessor">    # print CGI::p(&quot;pg warning&lt;br/&gt;$pgwarning&quot;                ) if $pgwarning ; </span>
<a name="l00501"></a>00501 <span class="preprocessor"></span><span class="preprocessor">    # print CGI::p(&quot;pg internal errors&lt;br/&gt; $pginternalerrors&quot;) if $pginternalerrors;</span>
<a name="l00502"></a>00502 <span class="preprocessor"></span><span class="preprocessor">    # print CGI::end_div()                                      if $pgerrordiv ;</span>
<a name="l00503"></a>00503 <span class="preprocessor"></span>    
<a name="l00504"></a>00504 <span class="preprocessor">    # # save state for viewOptions</span>
<a name="l00505"></a>00505 <span class="preprocessor"></span><span class="preprocessor">    # print  CGI::hidden(</span>
<a name="l00506"></a>00506 <span class="preprocessor"></span><span class="preprocessor">               # -name  =&gt; &quot;showOldAnswers&quot;,</span>
<a name="l00507"></a>00507 <span class="preprocessor"></span><span class="preprocessor">               # -value =&gt; $will{showOldAnswers}</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span><span class="preprocessor">           # ),</span>
<a name="l00509"></a>00509 <span class="preprocessor"></span>
<a name="l00510"></a>00510 <span class="preprocessor">           # CGI::hidden(</span>
<a name="l00511"></a>00511 <span class="preprocessor"></span><span class="preprocessor">               # -name  =&gt; &quot;displayMode&quot;,</span>
<a name="l00512"></a>00512 <span class="preprocessor"></span><span class="preprocessor">               # -value =&gt; $self-&gt;{displayMode}</span>
<a name="l00513"></a>00513 <span class="preprocessor"></span><span class="preprocessor">           # );</span>
<a name="l00514"></a>00514 <span class="preprocessor"></span><span class="preprocessor">    # print( CGI::hidden(</span>
<a name="l00515"></a>00515 <span class="preprocessor"></span><span class="preprocessor">               # -name    =&gt; &#39;editMode&#39;,</span>
<a name="l00516"></a>00516 <span class="preprocessor"></span><span class="preprocessor">               # -value   =&gt; $self-&gt;{editMode},</span>
<a name="l00517"></a>00517 <span class="preprocessor"></span><span class="preprocessor">           # )</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span><span class="preprocessor">    # ) if defined($self-&gt;{editMode}) and $self-&gt;{editMode} eq &#39;temporaryFile&#39;;</span>
<a name="l00519"></a>00519 <span class="preprocessor"></span>    
<a name="l00520"></a>00520 <span class="preprocessor">    # # this is a security risk -- students can use this to find the source code for the problem</span>
<a name="l00521"></a>00521 <span class="preprocessor"></span>
<a name="l00522"></a>00522 <span class="preprocessor">    # my $permissionLevel = $db-&gt;getPermissionLevel($user)-&gt;permission;</span>
<a name="l00523"></a>00523 <span class="preprocessor"></span><span class="preprocessor">    # my $professorPermissionLevel = $ce-&gt;{userRoles}-&gt;{professor};</span>
<a name="l00524"></a>00524 <span class="preprocessor"></span><span class="preprocessor">    # print( CGI::hidden(</span>
<a name="l00525"></a>00525 <span class="preprocessor"></span><span class="preprocessor">                # -name   =&gt; &#39;sourceFilePath&#39;,</span>
<a name="l00526"></a>00526 <span class="preprocessor"></span><span class="preprocessor">                # -value  =&gt;  $self-&gt;{problem}-&gt;{source_file}</span>
<a name="l00527"></a>00527 <span class="preprocessor"></span><span class="preprocessor">    # ))  if defined($self-&gt;{problem}-&gt;{source_file}) and $permissionLevel&gt;= $professorPermissionLevel; # only allow this for professors</span>
<a name="l00528"></a>00528 <span class="preprocessor"></span>
<a name="l00529"></a>00529 <span class="preprocessor">    # print( CGI::hidden(</span>
<a name="l00530"></a>00530 <span class="preprocessor"></span><span class="preprocessor">                # -name   =&gt; &#39;problemSeed&#39;,</span>
<a name="l00531"></a>00531 <span class="preprocessor"></span><span class="preprocessor">                # -value  =&gt;  $r-&gt;param(&quot;problemSeed&quot;)</span>
<a name="l00532"></a>00532 <span class="preprocessor"></span><span class="preprocessor">    # ))  if defined($r-&gt;param(&quot;problemSeed&quot;)) and $permissionLevel&gt;= $professorPermissionLevel; # only allow this for professors</span>
<a name="l00533"></a>00533 <span class="preprocessor"></span>
<a name="l00534"></a>00534             
<a name="l00535"></a>00535 <span class="preprocessor">    # end of main form</span>
<a name="l00536"></a>00536 <span class="preprocessor"></span>    print CGI::endform();
<a name="l00537"></a>00537 }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539 <span class="preprocessor"># output_footer subroutine</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span>
<a name="l00541"></a>00541 <span class="preprocessor"># prints out the footer elements to the page.</span>
<a name="l00542"></a>00542 <span class="preprocessor"></span>
<a name="l00543"></a>00543 sub output_footer{
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     my $self = shift;
<a name="l00546"></a>00546     my $r = $self-&gt;r;
<a name="l00547"></a>00547     my $problem = $self-&gt;{problem};
<a name="l00548"></a>00548     my $pg = $self-&gt;{pg};
<a name="l00549"></a>00549     my %will = %{ $self-&gt;{will} };
<a name="l00550"></a>00550     
<a name="l00551"></a>00551     my $authz = $r-&gt;authz;
<a name="l00552"></a>00552     my $urlpath = $r-&gt;urlpath;
<a name="l00553"></a>00553     my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
<a name="l00554"></a>00554     
<a name="l00555"></a>00555     my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
<a name="l00556"></a>00556     
<a name="l00557"></a>00557     print CGI::start_div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;problemFooter&quot;</span>});
<a name="l00558"></a>00558     
<a name="l00559"></a>00559     
<a name="l00560"></a>00560     my $pastAnswersPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::ShowAnswers&quot;</span>,
<a name="l00561"></a>00561         courseID =&gt; $courseName);
<a name="l00562"></a>00562     my $showPastAnswersURL = $self-&gt;systemLink($pastAnswersPage, authen =&gt; 0); # no authen info <span class="keywordflow">for</span> form action
<a name="l00563"></a>00563         
<a name="l00564"></a>00564 <span class="preprocessor">    # print answer inspection button</span>
<a name="l00565"></a>00565 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_answers&quot;</span>)) {
<a name="l00566"></a>00566         print <span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00567"></a>00567             CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>,-action=&gt;$showPastAnswersURL,-target=&gt;<span class="stringliteral">&quot;WW_Info&quot;</span>),<span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00568"></a>00568             $self-&gt;hidden_authen_fields,<span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00569"></a>00569             CGI::hidden(-name =&gt; <span class="stringliteral">&#39;courseID&#39;</span>,  -value=&gt;$courseName), <span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00570"></a>00570             CGI::hidden(-name =&gt; <span class="stringliteral">&#39;problemID&#39;</span>, -value=&gt;$problem-&gt;problem_id), <span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00571"></a>00571             CGI::hidden(-name =&gt; <span class="stringliteral">&#39;setID&#39;</span>,  -value=&gt;$problem-&gt;set_id), <span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00572"></a>00572             CGI::hidden(-name =&gt; <span class="stringliteral">&#39;studentUser&#39;</span>,    -value=&gt;$problem-&gt;user_id), <span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00573"></a>00573             CGI::p( {-align=&gt;<span class="stringliteral">&quot;left&quot;</span>},
<a name="l00574"></a>00574                 CGI::submit(-name =&gt; <span class="stringliteral">&#39;action&#39;</span>,  -value=&gt;<span class="stringliteral">&#39;Show Past Answers&#39;</span>)
<a name="l00575"></a>00575             ), <span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00576"></a>00576             CGI::endform();
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578     
<a name="l00579"></a>00579     
<a name="l00580"></a>00580     print $self-&gt;feedbackMacro(
<a name="l00581"></a>00581         module             =&gt; __PACKAGE__,
<a name="l00582"></a>00582         <span class="keyword">set</span>                =&gt; $self-&gt;{<span class="keyword">set</span>}-&gt;set_id,
<a name="l00583"></a>00583         problem            =&gt; $problem-&gt;problem_id,
<a name="l00584"></a>00584         displayMode        =&gt; $self-&gt;{displayMode},
<a name="l00585"></a>00585         showOldAnswers     =&gt; $will{showOldAnswers},
<a name="l00586"></a>00586         showCorrectAnswers =&gt; $will{showCorrectAnswers},
<a name="l00587"></a>00587         showHints          =&gt; $will{showHints},
<a name="l00588"></a>00588         showSolutions      =&gt; $will{showSolutions},
<a name="l00589"></a>00589         pg_object          =&gt; $pg,
<a name="l00590"></a>00590     );
<a name="l00591"></a>00591     
<a name="l00592"></a>00592     print CGI::end_div();
<a name="l00593"></a>00593 }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 <span class="preprocessor"># check_invalid subroutine</span>
<a name="l00596"></a>00596 <span class="preprocessor"></span>
<a name="l00597"></a>00597 <span class="preprocessor"># checks to see if the current problem set is valid for the current user, returns &quot;valid&quot; if it is and an error message if it&#39;s not.</span>
<a name="l00598"></a>00598 <span class="preprocessor"></span>
<a name="l00599"></a>00599 sub check_invalid{
<a name="l00600"></a>00600     
<a name="l00601"></a>00601     my $self = shift;
<a name="l00602"></a>00602     my $r = $self-&gt;r;
<a name="l00603"></a>00603     my $urlpath = $r-&gt;urlpath;
<a name="l00604"></a>00604     my $effectiveUser = $r-&gt;param(<span class="stringliteral">&#39;effectiveUser&#39;</span>);
<a name="l00605"></a>00605     
<a name="l00606"></a>00606     <span class="keywordflow">if</span> ( $self-&gt;{invalidSet} ) { 
<a name="l00607"></a>00607         <span class="keywordflow">return</span> CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
<a name="l00608"></a>00608                 CGI::p(<span class="stringliteral">&quot;The selected problem set (&quot;</span> .
<a name="l00609"></a>00609                        $urlpath-&gt;arg(<span class="stringliteral">&quot;setID&quot;</span>) . <span class="stringliteral">&quot;) is not &quot;</span> .
<a name="l00610"></a>00610                        <span class="stringliteral">&quot;a valid set for $effectiveUser:&quot;</span>),
<a name="l00611"></a>00611                 CGI::p($self-&gt;{invalidSet}));
<a name="l00612"></a>00612     }
<a name="l00613"></a>00613     
<a name="l00614"></a>00614     elsif ($self-&gt;{invalidProblem}) {
<a name="l00615"></a>00615         <span class="keywordflow">return</span> CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
<a name="l00616"></a>00616             CGI::p(<span class="stringliteral">&quot;The selected problem (&quot;</span> . $urlpath-&gt;arg(<span class="stringliteral">&quot;problemID&quot;</span>) . <span class="stringliteral">&quot;) is not a valid problem for set &quot;</span> . $self-&gt;{<span class="keyword">set</span>}-&gt;set_id . <span class="stringliteral">&quot;.&quot;</span>));
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618     <span class="keywordflow">else</span>{
<a name="l00619"></a>00619         <span class="keywordflow">return</span> <span class="stringliteral">&quot;valid&quot;</span>;
<a name="l00620"></a>00620     }
<a name="l00621"></a>00621     
<a name="l00622"></a>00622 }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 sub test{
<a name="l00625"></a>00625     print <span class="stringliteral">&quot;test&quot;</span>;
<a name="l00626"></a>00626 }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 1;
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:55:35 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
