<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WebworkWebservice::SetActions Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWebworkWebservice.html">WebworkWebservice</a>::<a class="el" href="classWebworkWebservice_1_1SetActions.html">SetActions</a>
  </div>
</div>
<div class="contents">
<h1>WebworkWebservice::SetActions Class Reference</h1><!-- doxytag: class="WebworkWebservice::SetActions" --><!-- doxytag: inherits="WebworkWebservice" --><div class="dynheader">
Inheritance diagram for WebworkWebservice::SetActions:</div>
<div class="dynsection">
<div class="center"><img src="classWebworkWebservice_1_1SetActions__inherit__graph.png" border="0" usemap="#WebworkWebservice_1_1SetActions_inherit__map" alt="Inheritance graph"/></div>
<map name="WebworkWebservice_1_1SetActions_inherit__map" id="WebworkWebservice_1_1SetActions_inherit__map">
<area shape="rect" href="classWebworkWebservice.html" title="WebworkWebservice" alt="" coords="41,5,183,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WebworkWebservice::SetActions:</div>
<div class="dynsection">
<div class="center"><img src="classWebworkWebservice_1_1SetActions__coll__graph.png" border="0" usemap="#WebworkWebservice_1_1SetActions_coll__map" alt="Collaboration graph"/></div>
<map name="WebworkWebservice_1_1SetActions_coll__map" id="WebworkWebservice_1_1SetActions_coll__map">
<area shape="rect" href="classWebworkWebservice.html" title="WebworkWebservice" alt="" coords="41,5,183,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWebworkWebservice_1_1SetActions-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#ada2bd316074dfd801f5453e314fe4190">addProblem</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#a614d662fe5c0c5679fbb992f85b06cdc">assignProblemToUser</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#af16969e55b6164cf5293acb9fa3646b0">addProblemToSet</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#ac1d50b7823a65a447395956a7fe8ae4b">assignProblemToAllSetUsers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#ac9c10e49a791f8e4c088beee21178b51">get_set_defs</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#a9cb6925e69b554f5abe22e85fb3937b6">listLocalSets</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#ad33b475dd983131b7978c0b0e36d81e1">munge_pg_file_path</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#a158d2bbb8ea632d4dd8e0999c6b97956">deleteProblem</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#a18de78aca655af8e711c40dea4313cd3">reorderProblems</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#ad910c7eaa60de5e7959b8b477411b12e">read_set_def</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#ad8ac780d9c79ea584c7a5451375d2727">createNewSet</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWebworkWebservice_1_1SetActions.html#aca297897b471034c7cd1713826adbb17">listLocalSetProblems</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>

<p>Definition at line <a class="el" href="SetActions_8pm_source.html#l00025">25</a> of file <a class="el" href="SetActions_8pm_source.html">SetActions.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ada2bd316074dfd801f5453e314fe4190"></a><!-- doxytag: member="WebworkWebservice::SetActions::addProblem" ref="ada2bd316074dfd801f5453e314fe4190" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::addProblem </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-addProblem' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-addProblem-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-addProblem-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-addProblem-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in addProblem: 16</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#ada2bd316074dfd801f5453e314fe4190">addProblem</a> {
    my $self = shift;
    my $in = shift;
    my $db = $self-&gt;{db};
    my $setName = $in-&gt;{<span class="keyword">set</span>};
    my $file = $in-&gt;{path};
    my $topdir = $self-&gt;{ce}-&gt;{courseDirs}{templates};
    $file =~ s|^$topdir<span class="comment">/*||;</span>
<span class="comment">    my $freeProblemID;</span>
<span class="comment">    # DBFIXME count would work just as well</span>
<span class="comment">    $freeProblemID = max($db-&gt;listGlobalProblems($setName)) + 1;</span>
<span class="comment">    my $problemRecord = addProblemToSet($self, {setName =&gt; $setName, sourceFile =&gt; $file, problemID =&gt; $freeProblemID});</span>
<span class="comment">    assignProblemToAllSetUsers($self, $problemRecord);</span>
<span class="comment">    my $out-&gt;{text} = encode_base64(&quot;Problem added to &quot;.$setName);</span>
<span class="comment">    return $out;</span>
<span class="comment">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="af16969e55b6164cf5293acb9fa3646b0"></a><!-- doxytag: member="WebworkWebservice::SetActions::addProblemToSet" ref="af16969e55b6164cf5293acb9fa3646b0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::addProblemToSet </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-addProblemToSet' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-addProblemToSet-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-addProblemToSet-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-addProblemToSet-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in addProblemToSet: 37</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#af16969e55b6164cf5293acb9fa3646b0">addProblemToSet</a> {
    my $self = shift;
    my $args = shift;
    my $db = $self-&gt;{db};
    my $value_default = $self-&gt;{ce}-&gt;{problemDefaults}-&gt;{value};
    my $max_attempts_default = $self-&gt;{ce}-&gt;{problemDefaults}-&gt;{max_attempts};  
    

    die <span class="stringliteral">&quot;addProblemToSet called without specifying the set name.&quot;</span> <span class="keywordflow">if</span> $args-&gt;{setName} eq <span class="stringliteral">&quot;&quot;</span>;
    my $setName = $args-&gt;{setName};

    my $sourceFile = $args-&gt;{sourceFile} or 
        die <span class="stringliteral">&quot;addProblemToSet called without specifying the sourceFile.&quot;</span>;

<span class="preprocessor">    # The rest of the arguments are optional</span>
<span class="preprocessor"></span>    
<span class="preprocessor">#   my $value = $args{value} || $value_default;</span>
<span class="preprocessor"></span>    my $value = $value_default;
    <span class="keywordflow">if</span> (defined($args-&gt;{value})){$value = $args-&gt;{value};}  # 0 is a valid value <span class="keywordflow">for</span> $args{value}  

    my $maxAttempts = $args-&gt;{maxAttempts} || $max_attempts_default;
    my $problemID = $args-&gt;{problemID};

    unless ($problemID) {
        $problemID = <a class="code" href="classWeBWorK_1_1Utils.html#a3d364a4d0cb81eef75c34845afb179e3">WeBWorK::Utils::max</a>($db-&gt;listGlobalProblems($setName)) + 1;
    }

    my $problemRecord = $db-&gt;newGlobalProblem;
    $problemRecord-&gt;problem_id($problemID);
    $problemRecord-&gt;set_id($setName);
    $problemRecord-&gt;source_file($sourceFile);
    $problemRecord-&gt;value($value);
    $problemRecord-&gt;max_attempts($maxAttempts);
    $db-&gt;addGlobalProblem($problemRecord);

    <span class="keywordflow">return</span> $problemRecord;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac1d50b7823a65a447395956a7fe8ae4b"></a><!-- doxytag: member="WebworkWebservice::SetActions::assignProblemToAllSetUsers" ref="ac1d50b7823a65a447395956a7fe8ae4b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::assignProblemToAllSetUsers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-assignProblemToAllSetUsers' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-assignProblemToAllSetUsers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-assignProblemToAllSetUsers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-assignProblemToAllSetUsers-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in assignProblemToAllSetUsers: 16</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#ac1d50b7823a65a447395956a7fe8ae4b">assignProblemToAllSetUsers</a> {
    my $self = shift;
    my $GlobalProblem = shift;
    my $db = $self-&gt;{db};
    my $setID = $GlobalProblem-&gt;set_id;
    my @userIDs = $db-&gt;listSetUsers($setID);
    
    my @results;
    
    <span class="keywordflow">foreach</span> my $userID (@userIDs) {
        my @result = <a class="code" href="classWebworkWebservice_1_1SetActions.html#a614d662fe5c0c5679fbb992f85b06cdc">assignProblemToUser</a>($self, $userID, $GlobalProblem);
        push @results, @result <span class="keywordflow">if</span> @result;
    }
    
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a614d662fe5c0c5679fbb992f85b06cdc"></a><!-- doxytag: member="WebworkWebservice::SetActions::assignProblemToUser" ref="a614d662fe5c0c5679fbb992f85b06cdc" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::assignProblemToUser </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-assignProblemToUser' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-assignProblemToUser-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-assignProblemToUser-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-assignProblemToUser-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in assignProblemToUser: 26</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#a614d662fe5c0c5679fbb992f85b06cdc">assignProblemToUser</a> {
    my $self = shift;
    my $userID = shift;
    my $GlobalProblem = shift;
    my $seed = shift;;
    my $db = $self-&gt;{db};
    
    my $UserProblem = $db-&gt;newUserProblem;
    $UserProblem-&gt;user_id($userID);
    $UserProblem-&gt;set_id($GlobalProblem-&gt;set_id);
    $UserProblem-&gt;problem_id($GlobalProblem-&gt;problem_id);
    initializeUserProblem($UserProblem, $seed);
    
    eval { $db-&gt;addUserProblem($UserProblem) };
    <span class="keywordflow">if</span> ($@) {
        <span class="keywordflow">if</span> ($@ =~ m/user problem exists/) {
            <span class="keywordflow">return</span> <span class="stringliteral">&quot;problem &quot;</span> . $GlobalProblem-&gt;problem_id
                . <span class="stringliteral">&quot; in set &quot;</span> . $GlobalProblem-&gt;set_id
                . <span class="stringliteral">&quot; is already assigned to user $userID.&quot;</span>;
        } <span class="keywordflow">else</span> {
            die $@;
        }
    }
    
    <span class="keywordflow">return</span> ();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad8ac780d9c79ea584c7a5451375d2727"></a><!-- doxytag: member="WebworkWebservice::SetActions::createNewSet" ref="ad8ac780d9c79ea584c7a5451375d2727" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::createNewSet </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-createNewSet' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-createNewSet-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-createNewSet-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-createNewSet-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in createNewSet: 43</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#ad8ac780d9c79ea584c7a5451375d2727">createNewSet</a>{
    my $self = shift;
    my $in = shift;
    my $db = $self-&gt;{db};
    my $out;
    <span class="keywordflow">if</span> ($in-&gt;{new_set_name} !~ /^[\w .-]*$/) {
        $out-&gt;{text} = <span class="stringliteral">&quot;need a different name&quot;</span>;#not sure the best way to handle and error
    } <span class="keywordflow">else</span> {
            my $newSetName = $in-&gt;{new_set_name};
<span class="preprocessor">            # if we want to munge the input set name, do it here</span>
<span class="preprocessor"></span>            $newSetName =~ s/\s/_/g;
<span class="preprocessor">            #debug(&quot;local_sets was &quot;, $r-&gt;param(&#39;local_sets&#39;));</span>
<span class="preprocessor"></span><span class="preprocessor">            #$r-&gt;param(&#39;local_sets&#39;,$newSetName);  ## use of two parameter param</span>
<span class="preprocessor"></span><span class="preprocessor">            #debug(&quot;new value of local_sets is &quot;, $r-&gt;param(&#39;local_sets&#39;));</span>
<span class="preprocessor"></span>            my $newSetRecord = $db-&gt;getGlobalSet($newSetName);
            <span class="keywordflow">if</span> (defined($newSetRecord)) {
                $out-&gt;{text} = encode_base64(<span class="stringliteral">&quot;Failed to create set, you may need to try another name.&quot;</span>);
            } <span class="keywordflow">else</span> {            # Do it!
<span class="preprocessor">                # DBFIXME use $db-&gt;newGlobalSet</span>
<span class="preprocessor"></span>                $newSetRecord = $db-&gt;{<span class="keyword">set</span>}-&gt;{record}-&gt;new();
                $newSetRecord-&gt;set_id($newSetName);
                $newSetRecord-&gt;set_header(<span class="stringliteral">&quot;defaultHeader&quot;</span>);
                $newSetRecord-&gt;hardcopy_header(<span class="stringliteral">&quot;defaultHeader&quot;</span>);
                $newSetRecord-&gt;open_date(time()+60*60*24*7); # in one week
                $newSetRecord-&gt;due_date(time()+60*60*24*7*2); # in two weeks
                $newSetRecord-&gt;answer_date(time()+60*60*24*7*3); # in three weeks
                eval {$db-&gt;addGlobalSet($newSetRecord)};
                <span class="keywordflow">if</span> ($@) {
                    $out-&gt;{text} = encode_base64(<span class="stringliteral">&quot;Failed to create set, you may need to try another name.&quot;</span>);
<span class="preprocessor">                    #$self-&gt;addbadmessage(&quot;Problem creating set $newSetName&lt;br&gt; $@&quot;);</span>
<span class="preprocessor"></span>                } <span class="keywordflow">else</span> {
<span class="preprocessor">                    #figure this bit out later</span>
<span class="preprocessor"></span><span class="preprocessor">                    #$self-&gt;addgoodmessage(&quot;Set $newSetName has been created.&quot;);</span>
<span class="preprocessor"></span>                    my $selfassign = $in-&gt;{selfassign};
                    $selfassign = <span class="stringliteral">&quot;&quot;</span> <span class="keywordflow">if</span>($selfassign =~ /<span class="keyword">false</span>/i); # deal with javascript <span class="keyword">false</span>
                    <span class="keywordflow">if</span>($selfassign) {
                        $self-&gt;assignSetToUser($self-&gt;{user}, $newSetRecord);
<span class="preprocessor">                        #$self-&gt;addgoodmessage(&quot;Set $newSetName was assigned to $userName.&quot;);</span>
<span class="preprocessor"></span>                    }
                }
            }
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a158d2bbb8ea632d4dd8e0999c6b97956"></a><!-- doxytag: member="WebworkWebservice::SetActions::deleteProblem" ref="a158d2bbb8ea632d4dd8e0999c6b97956" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::deleteProblem </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-deleteProblem' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-deleteProblem-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-deleteProblem-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-deleteProblem-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in deleteProblem: 21</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#a158d2bbb8ea632d4dd8e0999c6b97956">deleteProblem</a> {
    my $self = shift;
    my $in = shift;
    my $db = $self-&gt;{db};
    my $setName = $in-&gt;{<span class="keyword">set</span>};
    
    my $file = $in-&gt;{path};
    my $topdir = $self-&gt;{ce}-&gt;{courseDirs}{templates};
    $file =~ s|^$topdir<span class="comment">/*||;</span>
<span class="comment">    # DBFIXME count would work just as well</span>
<span class="comment">    foreach my $problem ($db-&gt;listGlobalProblems($setName)) {</span>
<span class="comment">        my $problemRecord = $db-&gt;getGlobalProblem($setName, $problem);</span>
<span class="comment">        </span>
<span class="comment">        if($problemRecord-&gt;source_file eq $file){</span>
<span class="comment">            #print &quot;found it&quot;;</span>
<span class="comment">            $db-&gt;deleteGlobalProblem($setName, $problemRecord-&gt;problem_id);</span>
<span class="comment">        }</span>
<span class="comment">    }</span>
<span class="comment">    my $out-&gt;{text} = encode_base64(&quot;Problem removed from &quot;.$setName);</span>
<span class="comment">    return $out;</span>
<span class="comment">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac9c10e49a791f8e4c088beee21178b51"></a><!-- doxytag: member="WebworkWebservice::SetActions::get_set_defs" ref="ac9c10e49a791f8e4c088beee21178b51" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::get_set_defs </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_set_defs' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-get_set_defs-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_set_defs-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_set_defs-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in get_set_defs: 19</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#ac9c10e49a791f8e4c088beee21178b51">get_set_defs</a> {
    my $self = shift;
    my $topdir = $self-&gt;{ce}-&gt;{courseDirs}{templates};#shift #sort of hard coded <span class="keywordflow">for</span> now;
    my @found_set_defs;
<span class="preprocessor">    # get_set_defs_wanted is a closure over @found_set_defs</span>
<span class="preprocessor"></span>    my $get_set_defs_wanted = sub {
<span class="preprocessor">        #my $fn = $_;</span>
<span class="preprocessor"></span><span class="preprocessor">        #my $fdir = $File::Find::dir;</span>
<span class="preprocessor"></span><span class="preprocessor">        #return() if($fn !~ /^set.*\.def$/);</span>
<span class="preprocessor"></span><span class="preprocessor">        ##return() if(not -T $fn);</span>
<span class="preprocessor"></span><span class="preprocessor">        #push @found_set_defs, &quot;$fdir/$fn&quot;;</span>
<span class="preprocessor"></span>        push @found_set_defs, $_ <span class="keywordflow">if</span> m|/<span class="keyword">set</span>[^/]*\.def$|;
    };
    find({ wanted =&gt; $get_set_defs_wanted, follow_fast=&gt;1, no_chdir=&gt;1}, $topdir);
    map { $_ =~ s|^$topdir/?|| } @found_set_defs;
    my $out = {};
    $out-&gt;{ra_out} = \@found_set_defs;
    <span class="keywordflow">return</span> $out;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aca297897b471034c7cd1713826adbb17"></a><!-- doxytag: member="WebworkWebservice::SetActions::listLocalSetProblems" ref="aca297897b471034c7cd1713826adbb17" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::listLocalSetProblems </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-listLocalSetProblems' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-listLocalSetProblems-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-listLocalSetProblems-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-listLocalSetProblems-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in listLocalSetProblems: 25</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#aca297897b471034c7cd1713826adbb17">listLocalSetProblems</a>{
    my $self = shift;
    my $in = shift;
    my $db = $self-&gt;{db};
    my @found_problems;
    my $selectedSet = $in-&gt;{<span class="keyword">set</span>};
    warn <span class="stringliteral">&quot;Finding problems for set &quot;</span>, $in-&gt;{<span class="keyword">set</span>} <span class="keywordflow">if</span> $UNIT_TESTS_ON;
    my $templateDir = $self-&gt;{ce}-&gt;{courseDirs}-&gt;{templates};
    @found_problems = $db-&gt;listGlobalProblems($selectedSet);
    my $problem;
    my @pg_files=();
    <span class="keywordflow">for</span> $problem (@found_problems) {
        my $problemRecord = $db-&gt;getGlobalProblem($selectedSet, $problem); # checked
        die <span class="stringliteral">&quot;global $problem for set $selectedSet not found.&quot;</span> unless
        $problemRecord;
        push @pg_files, $templateDir.<span class="stringliteral">&quot;/&quot;</span>.$problemRecord-&gt;source_file;

    }
<span class="preprocessor">    #@pg_files = sortByName(undef,@pg_files);</span>
<span class="preprocessor"></span>    
    my $out = {};
    $out-&gt;{ra_out} = \@pg_files;
    $out-&gt;{text} = encode_base64(<span class="stringliteral">&quot;Sets for course: &quot;</span>.$self-&gt;{courseName});
    <span class="keywordflow">return</span> $out;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a9cb6925e69b554f5abe22e85fb3937b6"></a><!-- doxytag: member="WebworkWebservice::SetActions::listLocalSets" ref="a9cb6925e69b554f5abe22e85fb3937b6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::listLocalSets </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-listLocalSets' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-listLocalSets-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-listLocalSets-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-listLocalSets-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in listLocalSets: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#a9cb6925e69b554f5abe22e85fb3937b6">listLocalSets</a>{
  my $self = shift;
  my $db = $self-&gt;{db};
  my @found_sets;
  @found_sets = $db-&gt;listGlobalSets;
  my $out = {};
  $out-&gt;{ra_out} = \@found_sets;
  $out-&gt;{text} = encode_base64(<span class="stringliteral">&quot;Sets for course: &quot;</span>.$self-&gt;{courseName});
  <span class="keywordflow">return</span> $out;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad33b475dd983131b7978c0b0e36d81e1"></a><!-- doxytag: member="WebworkWebservice::SetActions::munge_pg_file_path" ref="ad33b475dd983131b7978c0b0e36d81e1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::munge_pg_file_path </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-munge_pg_file_path' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-munge_pg_file_path-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-munge_pg_file_path-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-munge_pg_file_path-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in munge_pg_file_path: 17</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#ad33b475dd983131b7978c0b0e36d81e1">munge_pg_file_path</a> {
    my $self = shift;
    my $pg_path = shift;
    my $path_to_set_def = shift;
    my $end_path = $pg_path;
<span class="preprocessor">    # if the path is ok, don&#39;t fix it</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span>($pg_path) <span class="keywordflow">if</span>(-e $self-&gt;r-&gt;ce-&gt;{courseDirs}{templates}.<span class="stringliteral">&quot;/$pg_path&quot;</span>);
<span class="preprocessor">    # if we have followed a link into a self contained course to get</span>
<span class="preprocessor"></span><span class="preprocessor">    # to the set.def file, we need to insert the start of the path to</span>
<span class="preprocessor"></span><span class="preprocessor">    # the set.def file</span>
<span class="preprocessor"></span>    $end_path = <span class="stringliteral">&quot;$path_to_set_def/$pg_path&quot;</span>;
    <span class="keywordflow">return</span>($end_path) <span class="keywordflow">if</span>(-e $self-&gt;r-&gt;ce-&gt;{courseDirs}{templates}.<span class="stringliteral">&quot;/$end_path&quot;</span>);
<span class="preprocessor">    # if we got this far, this path is bad, but we let it produce</span>
<span class="preprocessor"></span><span class="preprocessor">    # an error so the user knows there is a troublesome path in the</span>
<span class="preprocessor"></span><span class="preprocessor">    # set.def file.</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span>($pg_path);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad910c7eaa60de5e7959b8b477411b12e"></a><!-- doxytag: member="WebworkWebservice::SetActions::read_set_def" ref="ad910c7eaa60de5e7959b8b477411b12e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::read_set_def </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-read_set_def' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-read_set_def-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-read_set_def-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-read_set_def-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in read_set_def: 31</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#ad910c7eaa60de5e7959b8b477411b12e">read_set_def</a> {
    my $self = shift;
    my $r = $self-&gt;r;
    my $filePathOrig = shift;
    my $filePath = $r-&gt;ce-&gt;{courseDirs}{templates}.<span class="stringliteral">&quot;/$filePathOrig&quot;</span>;
    $filePathOrig =~ s/<span class="keyword">set</span>.*\.def$<span class="comment">//;</span>
    $filePathOrig =~ s|/$||;
    $filePathOrig = <span class="stringliteral">&quot;.&quot;</span> <span class="keywordflow">if</span> ($filePathOrig !~ /\S/);
    my @pg_files = ();
    my ($line, $got_to_pgs, $name, @rest) = (<span class="stringliteral">&quot;&quot;</span>, 0, <span class="stringliteral">&quot;&quot;</span>);
    <span class="keywordflow">if</span> ( open (SETFILENAME, <span class="stringliteral">&quot;$filePath&quot;</span>) )    {
        <span class="keywordflow">while</span>($line = &lt;SETFILENAME&gt;) {
            chomp($line);
            $line =~ s|(#.*)||; # don<span class="stringliteral">&#39;t read past comments</span>
<span class="stringliteral">            if($got_to_pgs) {</span>
<span class="stringliteral">                unless ($line =~ /\S/) {next;} # skip blank lines</span>
<span class="stringliteral">                ($name,@rest) = split (/\s*,\s*/,$line);</span>
<span class="stringliteral">                $name =~ s/\s*//g;</span>
<span class="stringliteral">                push @pg_files, $name;</span>
<span class="stringliteral">            } else {</span>
<span class="stringliteral">                $got_to_pgs = 1 if ($line =~ /problemList\s*=/);</span>
<span class="stringliteral">            }</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">    } else {</span>
<span class="stringliteral">        $self-&gt;addbadmessage(&quot;Cannot open $filePath&quot;);</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    # This is where we would potentially munge the pg file paths</span>
<span class="stringliteral">    # One possibility</span>
<span class="stringliteral">    @pg_files = map { $self-&gt;munge_pg_file_path($_, $filePathOrig) } @pg_files;</span>
<span class="stringliteral">    return(@pg_files);</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a18de78aca655af8e711c40dea4313cd3"></a><!-- doxytag: member="WebworkWebservice::SetActions::reorderProblems" ref="a18de78aca655af8e711c40dea4313cd3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WebworkWebservice::SetActions::reorderProblems </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-reorderProblems' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-reorderProblems-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-reorderProblems-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-reorderProblems-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in reorderProblems: 50</span>
<span class="preprocessor"></span>sub <a class="code" href="classWebworkWebservice_1_1SetActions.html#a18de78aca655af8e711c40dea4313cd3">reorderProblems</a> {
    my $self = shift;
    my $in = shift;
    my $db = $self-&gt;{db};
    my $setID = $in-&gt;{<span class="keyword">set</span>};
    my $problemListString = $in-&gt;{probList};
    my @problemList = split(/,/, $problemListString);
    my $topdir = $self-&gt;{ce}-&gt;{courseDirs}{templates};
<span class="preprocessor">    #my (@problemIDList) = @_;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my ($prob1, $prob2, $prob);</span>
<span class="preprocessor"></span>    my $index = 1;
<span class="preprocessor">    #get all the problems</span>
<span class="preprocessor"></span>    my @problems = ();
    <span class="keywordflow">foreach</span> my $path (@problemList) {
        $path =~ s|^$topdir<span class="comment">/*||;</span>
<span class="comment">        #this will work if i can get problems by name</span>
<span class="comment">        my $problemRecord; # checked</span>
<span class="comment">        foreach my $problem ($db-&gt;listGlobalProblems($setID)) {</span>
<span class="comment">            my $tempProblem = $db-&gt;getGlobalProblem($setID, $problem);</span>
<span class="comment">            if($tempProblem-&gt;source_file eq $path){</span>
<span class="comment">                $problemRecord = $tempProblem;</span>
<span class="comment">            }</span>
<span class="comment">        }</span>
<span class="comment">        die &quot;global &quot; .$path .&quot; for set $setID not found.&quot; unless $problemRecord;</span>
<span class="comment">        #print &quot;found this problem to be reordered: &quot;.$problemRecord.&quot;\n&quot;;</span>
<span class="comment">        push @problems, $problemRecord;</span>
<span class="comment">        $index = $index + 1;</span>
<span class="comment">    }</span>
<span class="comment">    #then change their info</span>
<span class="comment">    my @setUsers = $db-&gt;listSetUsers($setID);</span>
<span class="comment">    my $user;</span>
<span class="comment">    $index = 1;</span>
<span class="comment">    foreach my $problem (@problems) {</span>
<span class="comment">        $problem-&gt;problem_id($index);</span>
<span class="comment">        die &quot;global $problem not found.&quot; unless $problem;</span>
<span class="comment">        #print &quot;problem to be reordered: &quot;.$problem.&quot;\n&quot;;</span>
<span class="comment">        $db-&gt;putGlobalProblem($problem);</span>
<span class="comment">      </span>
<span class="comment">        #need to deal with users?</span>
<span class="comment">        foreach $user (@setUsers) {</span>
<span class="comment">            #my $prob1 = $db-&gt;getUserProblem($user, $setID, $index);</span>
<span class="comment">            #die &quot; problem $index for set $setID and effective user $user not found&quot;    unless $prob1;</span>
<span class="comment">            #$prob1-&gt;problem_id($index);</span>
<span class="comment">            #$db-&gt;putUserProblem($prob1);</span>
<span class="comment">        }</span>
<span class="comment">        $index = $index + 1;</span>
<span class="comment">    }</span>
<span class="comment">    my $out-&gt;{text} = encode_base64(&quot;Successfully reordered problems&quot;);</span>
<span class="comment">    return $out;</span>
<span class="comment">}</span>
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="SetActions_8pm_source.html">SetActions.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 23:00:52 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
