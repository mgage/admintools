<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::Utils::ListingDB Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1Utils.html">Utils</a>::<a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html">ListingDB</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::Utils::ListingDB Class Reference</h1><!-- doxytag: class="WeBWorK::Utils::ListingDB" --><!-- doxytag: inherits="WeBWorK::Utils" --><div class="dynheader">
Inheritance diagram for WeBWorK::Utils::ListingDB:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Utils_1_1ListingDB__inherit__graph.png" border="0" usemap="#WeBWorK_1_1Utils_1_1ListingDB_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1Utils_1_1ListingDB_inherit__map" id="WeBWorK_1_1Utils_1_1ListingDB_inherit__map">
<area shape="rect" href="classWeBWorK_1_1Utils.html" title="WeBWorK::Utils" alt="" coords="37,80,155,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="55,5,137,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::Utils::ListingDB:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1Utils_1_1ListingDB__coll__graph.png" border="0" usemap="#WeBWorK_1_1Utils_1_1ListingDB_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1Utils_1_1ListingDB_coll__map" id="WeBWorK_1_1Utils_1_1ListingDB_coll__map">
<area shape="rect" href="classWeBWorK_1_1Utils.html" title="WeBWorK::Utils" alt="" coords="37,80,155,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="55,5,137,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1Utils_1_1ListingDB-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a649123f178c3f7c5a7b21da91a6826fc">getAllListings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#aa4a6da962c1806c5cbeced6c2e9a4c5f">searchListings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a4a60e628bf097cb41dcf9127b26312cb">getAllSections</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a7cb1f0dbf7a411fcdc52dbccaadfa973">getAllDBchapters</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a79a2bf797e937c8ba66cdbbd45688e91">keywordCleaner</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#aa123cb54a87316f0c6dd3f1e5ea3dfbe">getDBListings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a597b85b668135f2a0dc195d5fdde8d80">kwtidy</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ab2497dfd9b492cff812c62822c1b920d">deleteListing</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a66276f4eb55fad6830f96047bb4432ab">getAllChapters</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#acd1125778019bd6b18eaf22d272ea92e">createListing</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#aafb855edcaf6e8ce23d31ea062b9a0ea">getAllDBsubjects</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a7b5c8a0fc4cf41ff3f203d5fd24b4fba">indirectSortByName</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a294a0631d0ca92c30ce27933876a2af6">countDBListings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a871c37ed734e46fb2733268cb6f128f5">getAllDBsections</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a206520a6a6f3bbdaa1beceaeb71c3cf2">makeKeywordWhere</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a3caa8853d828a97533f464888257fa7a">getSectionListings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a369869561b43921431a01f9bdba9674f">getDBTextbooks</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>$r is a <a class="el" href="classApache.html">Apache</a> request object so we can extract whatever parameters we want </p>
<p>$thing is a string of either 'textbook', 'textchapter', or 'textsection' to specify what to return. </p>
<p>If we are to return textbooks, then return an array of textbook names consistent with the <a class="el" href="classWeBWorK_1_1DB.html">DB</a> subject, chapter, section selected. </p>
<p>$r is the <a class="el" href="classApache.html">Apache</a> request object </p>
<p>$r is the <a class="el" href="classApache.html">Apache</a> request object </p>
<p>$r is the <a class="el" href="classApache.html">Apache</a> request object </p>
<p>$r is an <a class="el" href="classApache.html">Apache</a> request object that has all needed data inside of it </p>
<p>Here, we search on all known fields out of r</p>
<h2><a class="anchor" id="DESCRIPTION">
DESCRIPTION</a></h2>
<p>This module provides access to the database of classify in the system. This includes the filenames, along with the table of search terms.</p>
<h2><a class="anchor" id="FUNCTION_REFERENCE">
FUNCTION REFERENCE</a></h2>
<ul>
<li>
<p class="startli"><a class="anchor" id="item__result___createListing____listing_data___"></a><b>$result = createListing( %listing_data );</b> </p>
<p class="endli">Creates a new listing populated with data from %listing_data. On success, 1 is returned, 0 is returned on failure. The %listing_data hash has the following format: =cut  </p>
</li>
</ul>
<h2><a class="anchor" id="AUTHOR">
AUTHOR</a></h2>
<p>Written by Bill Ziemer. Modified by John Jones. </p>

<p>Definition at line <a class="el" href="ListingDB_8pm_source.html#l00044">44</a> of file <a class="el" href="ListingDB_8pm_source.html">ListingDB.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a294a0631d0ca92c30ce27933876a2af6"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::countDBListings" ref="a294a0631d0ca92c30ce27933876a2af6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::countDBListings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-countDBListings' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-countDBListings-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-countDBListings-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-countDBListings-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in countDBListings: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a294a0631d0ca92c30ce27933876a2af6">countDBListings</a> {
    my $r = shift;
    <span class="keywordflow">return</span> (<a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#aa123cb54a87316f0c6dd3f1e5ea3dfbe">getDBListings</a>($r,1));
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="acd1125778019bd6b18eaf22d272ea92e"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::createListing" ref="acd1125778019bd6b18eaf22d272ea92e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::createListing </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-createListing' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-createListing-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-createListing-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-createListing-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in createListing: 45</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#acd1125778019bd6b18eaf22d272ea92e">createListing</a> {
    my $ce = shift;
    my %listing_data = @_; 
    my $classify_id;
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($ce);
<span class="preprocessor">    #   my $dbh = WeBWorK::ProblemLibrary::DB::getDB();</span>
<span class="preprocessor"></span>    my $query = <span class="stringliteral">&quot;INSERT INTO classify</span>
<span class="stringliteral">        (filename,chapter,section,keywords)</span>
<span class="stringliteral">        VALUES</span>
<span class="stringliteral">        ($listing_data{filename},$listing_data{chapter},$listing_data{section},$listing_data{keywords})&quot;</span>;
    $dbh-&gt;do($query);    #TODO: watch out <span class="keywordflow">for</span> comma delimited keywords, sections, chapters!

    $query = <span class="stringliteral">&quot;SELECT id FROM classify WHERE filename = $listing_data{filename}&quot;</span>;
    my $sth = $dbh-&gt;prepare($query);
    $sth-&gt;execute();
    <span class="keywordflow">if</span> ($sth-&gt;rows())
    {
        ($classify_id) = $sth-&gt;fetchrow_array;
    }
    <span class="keywordflow">else</span>
    {
<span class="preprocessor">        #print STDERR &quot;ListingDB::createListingPGfiles: $listing_data{filename} failed insert into classify table&quot;;</span>
<span class="preprocessor"></span>        <span class="keywordflow">return</span> 0;
    };

    $query = <span class="stringliteral">&quot;INSERT INTO pgfiles</span>
<span class="stringliteral">   (</span>
<span class="stringliteral">   classify_id,</span>
<span class="stringliteral">   path,</span>
<span class="stringliteral">   author,</span>
<span class="stringliteral">   institution,</span>
<span class="stringliteral">   history</span>
<span class="stringliteral">   )</span>
<span class="stringliteral">   VALUES</span>
<span class="stringliteral">  (</span>
<span class="stringliteral">   $classify_id,</span>
<span class="stringliteral">   $listing_data{path},</span>
<span class="stringliteral">   $listing_data{author},</span>
<span class="stringliteral">   $listing_data{institution},</span>
<span class="stringliteral">   $listing_data{history}</span>
<span class="stringliteral">   )&quot;</span>;
    
    $dbh-&gt;do($query);
    <span class="keywordflow">return</span> 1;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab2497dfd9b492cff812c62822c1b920d"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::deleteListing" ref="ab2497dfd9b492cff812c62822c1b920d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::deleteListing </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-deleteListing' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-deleteListing-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-deleteListing-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-deleteListing-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in deleteListing: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ab2497dfd9b492cff812c62822c1b920d">deleteListing</a> {
    my $ce = shift;
    my $listing_id = shift;
<span class="preprocessor">    #print STDERR &quot;ListingDB::deleteListing(): listing == &#39;$listing_id&#39;\n&quot;;</span>
<span class="preprocessor"></span>
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($ce);

    <span class="keywordflow">return</span> undef;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a66276f4eb55fad6830f96047bb4432ab"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getAllChapters" ref="a66276f4eb55fad6830f96047bb4432ab" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getAllChapters </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getAllChapters' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getAllChapters-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getAllChapters-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getAllChapters-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getAllChapters: 25</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a66276f4eb55fad6830f96047bb4432ab">getAllChapters</a> {
<span class="preprocessor">    #print STDERR &quot;ListingDB::getAllChapters\n&quot;;</span>
<span class="preprocessor"></span>    my $ce = shift;
    my @results=();
    my ($row,$listing);
    my $query = <span class="stringliteral">&quot;SELECT DISTINCT chapter FROM classify&quot;</span>;
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($ce);
    my $sth = $dbh-&gt;prepare($query);
    $sth-&gt;execute();
    <span class="keywordflow">while</span> (1)
    {
        $row = $sth-&gt;fetchrow_array;
        <span class="keywordflow">if</span> (!defined($row))
        {
            last;
        }
        <span class="keywordflow">else</span>
        {
            my $listing = $row;
            push @results, $listing;
<span class="preprocessor">            #print STDERR &quot;ListingDB::getAllChapters $listing\n&quot;;</span>
<span class="preprocessor"></span>        }
    }
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7cb1f0dbf7a411fcdc52dbccaadfa973"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getAllDBchapters" ref="a7cb1f0dbf7a411fcdc52dbccaadfa973" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getAllDBchapters </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getAllDBchapters' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getAllDBchapters-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getAllDBchapters-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getAllDBchapters-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getAllDBchapters: 14</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a7cb1f0dbf7a411fcdc52dbccaadfa973">getAllDBchapters</a> {
    my $r = shift;
    my $subject = $r-&gt;param(<span class="stringliteral">&#39;library_subjects&#39;</span>);
    <span class="keywordflow">return</span> () unless($subject);
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($r-&gt;ce);
    my $query = <span class="stringliteral">&quot;SELECT DISTINCT c.name FROM `NPL-DBchapter` c, </span>
<span class="stringliteral">                `NPL-DBsubject` t</span>
<span class="stringliteral">                 WHERE c.DBsubject_id = t.DBsubject_id AND</span>
<span class="stringliteral">                 t.name = \&quot;$subject\&quot;&quot;</span>;
    my $all_chaps_ref = $dbh-&gt;selectall_arrayref($query);
    my @results = map { $_-&gt;[0] } @{$all_chaps_ref};
    @results = <a class="code" href="classWeBWorK_1_1Utils.html#a765334eb4484125d0ea5ad2a68b3b1f2">sortByName</a>(undef, @results);
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a871c37ed734e46fb2733268cb6f128f5"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getAllDBsections" ref="a871c37ed734e46fb2733268cb6f128f5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getAllDBsections </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getAllDBsections' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getAllDBsections-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getAllDBsections-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getAllDBsections-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getAllDBsections: 17</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a871c37ed734e46fb2733268cb6f128f5">getAllDBsections</a> {
    my $r = shift;
    my $subject = $r-&gt;param(<span class="stringliteral">&#39;library_subjects&#39;</span>);
    <span class="keywordflow">return</span> () unless($subject);
    my $chapter = $r-&gt;param(<span class="stringliteral">&#39;library_chapters&#39;</span>);
    <span class="keywordflow">return</span> () unless($chapter);
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($r-&gt;ce);
    my $query = <span class="stringliteral">&quot;SELECT DISTINCT s.name FROM `NPL-DBsection` s,</span>
<span class="stringliteral">                 `NPL-DBchapter` c, `NPL-DBsubject` t</span>
<span class="stringliteral">                 WHERE s.DBchapter_id = c.DBchapter_id AND</span>
<span class="stringliteral">                 c.DBsubject_id = t.DBsubject_id AND</span>
<span class="stringliteral">                 t.name = \&quot;$subject\&quot; AND c.name = \&quot;$chapter\&quot;&quot;</span>;
    my $all_sections_ref = $dbh-&gt;selectall_arrayref($query);
    my @results = map { $_-&gt;[0] } @{$all_sections_ref};
    @results = <a class="code" href="classWeBWorK_1_1Utils.html#a765334eb4484125d0ea5ad2a68b3b1f2">sortByName</a>(undef, @results);
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aafb855edcaf6e8ce23d31ea062b9a0ea"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getAllDBsubjects" ref="aafb855edcaf6e8ce23d31ea062b9a0ea" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getAllDBsubjects </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getAllDBsubjects' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getAllDBsubjects-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getAllDBsubjects-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getAllDBsubjects-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getAllDBsubjects: 14</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#aafb855edcaf6e8ce23d31ea062b9a0ea">getAllDBsubjects</a> {
    my $r = shift;
    my @results=();
    my $row;
    my $query = <span class="stringliteral">&quot;SELECT DISTINCT name FROM `NPL-DBsubject`&quot;</span>;
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($r-&gt;ce);
    my $sth = $dbh-&gt;prepare($query);
    $sth-&gt;execute();
    <span class="keywordflow">while</span> ($row = $sth-&gt;fetchrow_array()) {
        push @results, $row;
    }
    @results = <a class="code" href="classWeBWorK_1_1Utils.html#a765334eb4484125d0ea5ad2a68b3b1f2">sortByName</a>(undef, @results);
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a649123f178c3f7c5a7b21da91a6826fc"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getAllListings" ref="a649123f178c3f7c5a7b21da91a6826fc" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getAllListings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getAllListings' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getAllListings-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getAllListings-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getAllListings-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getAllListings: 21</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a649123f178c3f7c5a7b21da91a6826fc">getAllListings</a> {
<span class="preprocessor">    #print STDERR &quot;ListingDB::getAllListings\n&quot;;</span>
<span class="preprocessor"></span>    my $ce = shift;
    my @results;
    my ($row,$key);
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($ce);
    my $query = <span class="stringliteral">&quot;SELECT c.*, p.path</span>
<span class="stringliteral">            FROM classify c, pgfiles p</span>
<span class="stringliteral">            WHERE c.pgfiles_id = p.pgfiles_id&quot;</span>;
    my $sth = $dbh-&gt;prepare($query);
    $sth-&gt;execute();
    <span class="keywordflow">while</span> (1)
    {
        $row = $sth-&gt;fetchrow_hashref();
        last <span class="keywordflow">if</span> (!defined($row));
        my $listing = $row;
        push @results, $listing;
<span class="preprocessor">        #print STDERR &quot;ListingDB::getAllListings $listing\n&quot;;</span>
<span class="preprocessor"></span>    }
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4a60e628bf097cb41dcf9127b26312cb"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getAllSections" ref="a4a60e628bf097cb41dcf9127b26312cb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getAllSections </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getAllSections' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getAllSections-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getAllSections-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getAllSections-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getAllSections: 27</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a4a60e628bf097cb41dcf9127b26312cb">getAllSections</a> {
<span class="preprocessor">    #print STDERR &quot;ListingDB::getAllSections\n&quot;;</span>
<span class="preprocessor"></span>    my $ce = shift;
    my $chapter = shift;
    my @results=();
    my ($row,$listing);
    my $query = <span class="stringliteral">&quot;SELECT DISTINCT section FROM classify</span>
<span class="stringliteral">                WHERE chapter = \&#39;$chapter\&#39;&quot;</span>;
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($ce);
    my $sth = $dbh-&gt;prepare($query);
    $sth-&gt;execute();
    <span class="keywordflow">while</span> (1)
    {
        $row = $sth-&gt;fetchrow_array;
        <span class="keywordflow">if</span> (!defined($row))
        {
            last;
        }
        <span class="keywordflow">else</span>
        {
            my $listing = $row;
            push @results, $listing;
<span class="preprocessor">            #print STDERR &quot;ListingDB::getAllSections $listing\n&quot;;</span>
<span class="preprocessor"></span>        }
    }
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae67a998710517d467b0025b764c7c86b"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getDB" ref="ae67a998710517d467b0025b764c7c86b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getDB </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getDB' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getDB-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getDB-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getDB-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getDB: 14</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a> {
    my $ce = shift;
    my $dbh = DBI-&gt;connect(
        $ce-&gt;{problemLibrary_db}-&gt;{dbsource},
        $ce-&gt;{problemLibrary_db}-&gt;{user},
        $ce-&gt;{problemLibrary_db}-&gt;{passwd},
        {
            PrintError =&gt; 0,
            RaiseError =&gt; 1,
        },
    );
    die <span class="stringliteral">&quot;Cannot connect to problem library database&quot;</span> unless $dbh;
    <span class="keywordflow">return</span>($dbh);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa123cb54a87316f0c6dd3f1e5ea3dfbe"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getDBListings" ref="aa123cb54a87316f0c6dd3f1e5ea3dfbe" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getDBListings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getDBListings' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getDBListings-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getDBListings-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getDBListings-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getDBListings: 85</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#aa123cb54a87316f0c6dd3f1e5ea3dfbe">getDBListings</a> {
    my $r = shift;
    my $amcounter = shift;
    my $ce = $r-&gt;ce;
    my $subj = $r-&gt;param(<span class="stringliteral">&#39;library_subjects&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
    my $chap = $r-&gt;param(<span class="stringliteral">&#39;library_chapters&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
    my $sec = $r-&gt;param(<span class="stringliteral">&#39;library_sections&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
    my $keywords = $r-&gt;param(<span class="stringliteral">&#39;library_keywords&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
    my ($kw1, $kw2) = (<span class="stringliteral">&#39;&#39;</span>,<span class="stringliteral">&#39;&#39;</span>);
    <span class="keywordflow">if</span>($keywords) {
        $kw1 = <span class="stringliteral">&quot;, `NPL-keyword` kw, `NPL-pgfile-keyword` pgkey&quot;</span>;
        $kw2 = <span class="stringliteral">&quot; AND kw.keyword_id=pgkey.keyword_id AND</span>
<span class="stringliteral">             pgkey.pgfile_id=pgf.pgfile_id &quot;</span>. 
            <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a206520a6a6f3bbdaa1beceaeb71c3cf2">makeKeywordWhere</a>($keywords) ;
    }

    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($ce);

    my $extrawhere = <span class="stringliteral">&#39;&#39;</span>;
    <span class="keywordflow">if</span>($subj) {
        $subj =~ s/<span class="stringliteral">&#39;/\\&#39;</span>/g;
        $extrawhere .= <span class="stringliteral">&quot; AND dbsj.name=\&quot;$subj\&quot; &quot;</span>;
    }
    <span class="keywordflow">if</span>($chap) {
        $chap =~ s/<span class="stringliteral">&#39;/\\&#39;</span>/g;
        $extrawhere .= <span class="stringliteral">&quot; AND dbc.name=\&quot;$chap\&quot; &quot;</span>;
    }
    <span class="keywordflow">if</span>($sec) {
        $sec =~ s/<span class="stringliteral">&#39;/\\&#39;</span>/g;
        $extrawhere .= <span class="stringliteral">&quot; AND dbsc.name=\&quot;$sec\&quot; &quot;</span>;
    }
    my $textextrawhere = <span class="stringliteral">&#39;&#39;</span>;
    my $haveTextInfo=0;
    <span class="keywordflow">for</span> my $j (qw( textbook textchapter textsection )) {
        my $foo = $r-&gt;param(LIBRARY_STRUCTURE-&gt;{$j}{name}) || <span class="stringliteral">&#39;&#39;</span>;
        $foo =~ s/^\s*\d+\.\s*<span class="comment">//;</span>
        <span class="keywordflow">if</span>($foo) {
            $haveTextInfo=1;
            $foo =~ s/<span class="stringliteral">&#39;/\\&#39;</span>/g;
            $textextrawhere .= <span class="stringliteral">&quot; AND &quot;</span>.LIBRARY_STRUCTURE-&gt;{$j}{where}.<span class="stringliteral">&quot;=\&quot;$foo\&quot; &quot;</span>;
        }
    }

    my $selectwhat = <span class="stringliteral">&#39;DISTINCT pgf.pgfile_id&#39;</span>;
    $selectwhat = <span class="stringliteral">&#39;COUNT(&#39;</span> . $selectwhat . <span class="charliteral">&#39;)&#39;</span> <span class="keywordflow">if</span> ($amcounter);

    my $query = <span class="stringliteral">&quot;SELECT $selectwhat from `NPL-pgfile` pgf, </span>
<span class="stringliteral">         `NPL-DBsection` dbsc, `NPL-DBchapter` dbc, `NPL-DBsubject` dbsj $kw1</span>
<span class="stringliteral">        WHERE dbsj.DBsubject_id = dbc.DBsubject_id AND</span>
<span class="stringliteral">              dbc.DBchapter_id = dbsc.DBchapter_id AND</span>
<span class="stringliteral">              dbsc.DBsection_id = pgf.DBsection_id </span>
<span class="stringliteral">              \n $extrawhere </span>
<span class="stringliteral">              $kw2&quot;</span>;
    <span class="keywordflow">if</span>($haveTextInfo) {
      $query = <span class="stringliteral">&quot;SELECT $selectwhat from `NPL-pgfile` pgf, </span>
<span class="stringliteral">        `NPL-DBsection` dbsc, `NPL-DBchapter` dbc, `NPL-DBsubject` dbsj,</span>
<span class="stringliteral">        `NPL-pgfile-problem` pgp, `NPL-problem` prob, `NPL-textbook` tbk ,</span>
<span class="stringliteral">        `NPL-chapter` tc, `NPL-section` ts $kw1</span>
<span class="stringliteral">        WHERE dbsj.DBsubject_id = dbc.DBsubject_id AND</span>
<span class="stringliteral">              dbc.DBchapter_id = dbsc.DBchapter_id AND</span>
<span class="stringliteral">              dbsc.DBsection_id = pgf.DBsection_id AND</span>
<span class="stringliteral">              pgf.pgfile_id = pgp.pgfile_id AND</span>
<span class="stringliteral">              pgp.problem_id = prob.problem_id AND</span>
<span class="stringliteral">              tc.textbook_id = tbk.textbook_id AND</span>
<span class="stringliteral">              ts.chapter_id = tc.chapter_id AND</span>
<span class="stringliteral">              prob.section_id = ts.section_id \n $extrawhere \n $textextrawhere</span>
<span class="stringliteral">              $kw2&quot;</span>;
     }
<span class="preprocessor">#$query =~ s/\n/ /g;</span>
<span class="preprocessor"></span><span class="preprocessor">#warn $query;</span>
<span class="preprocessor"></span>    my $pg_id_ref = $dbh-&gt;selectall_arrayref($query);
    my @pg_ids = map { $_-&gt;[0] } @{$pg_id_ref};
    <span class="keywordflow">if</span>($amcounter) {
        <span class="keywordflow">return</span>(@pg_ids[0]);
    }
    my @results=();
    <span class="keywordflow">for</span> my $pgid (@pg_ids) {
        $query = <span class="stringliteral">&quot;SELECT path, filename FROM `NPL-pgfile` pgf, `NPL-path` p </span>
<span class="stringliteral">          WHERE p.path_id = pgf.path_id AND pgf.pgfile_id=\&quot;$pgid\&quot;&quot;</span>;
        my $row = $dbh-&gt;selectrow_arrayref($query);
        push @results, {<span class="stringliteral">&#39;path&#39;</span> =&gt; $row-&gt;[0], <span class="stringliteral">&#39;filename&#39;</span> =&gt; $row-&gt;[1] };
        
    }
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a369869561b43921431a01f9bdba9674f"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getDBTextbooks" ref="a369869561b43921431a01f9bdba9674f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getDBTextbooks </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getDBTextbooks' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getDBTextbooks-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getDBTextbooks-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getDBTextbooks-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getDBTextbooks: 70</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a369869561b43921431a01f9bdba9674f">getDBTextbooks</a> {
    my $r = shift;
    my $thing = shift || <span class="stringliteral">&#39;textbook&#39;</span>;
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($r-&gt;ce);
    my $extrawhere = <span class="stringliteral">&#39;&#39;</span>;
<span class="preprocessor">    # Handle DB* restrictions</span>
<span class="preprocessor"></span>    my $subj = $r-&gt;param(<span class="stringliteral">&#39;library_subjects&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
    my $chap = $r-&gt;param(<span class="stringliteral">&#39;library_chapters&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
    my $sec = $r-&gt;param(<span class="stringliteral">&#39;library_sections&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
    <span class="keywordflow">if</span>($subj) {
        $subj =~ s/<span class="stringliteral">&#39;/\\&#39;</span>/g;
        $extrawhere .= <span class="stringliteral">&quot; AND t.name = \&#39;$subj\&#39;\n&quot;</span>;
    }
    <span class="keywordflow">if</span>($chap) {
        $chap =~ s/<span class="stringliteral">&#39;/\\&#39;</span>/g;
        $extrawhere .= <span class="stringliteral">&quot; AND c.name = \&#39;$chap\&#39; AND c.DBsubject_id=t.DBsubject_id\n&quot;</span>;
    }
    <span class="keywordflow">if</span>($sec) {
        $sec =~ s/<span class="stringliteral">&#39;/\\&#39;</span>/g;
        $extrawhere .= <span class="stringliteral">&quot; AND s.name = \&#39;$sec\&#39; AND s.DBchapter_id = c.DBchapter_id AND s.DBsection_id=pgf.DBsection_id&quot;</span>;
    }
    my $textextrawhere = <span class="stringliteral">&#39;&#39;</span>;
    my $textid = $r-&gt;param(<span class="stringliteral">&#39;library_textbook&#39;</span>) || <span class="stringliteral">&#39;&#39;</span>;
    <span class="keywordflow">if</span>($textid and $thing ne <span class="stringliteral">&#39;textbook&#39;</span>) {
        $textextrawhere .= <span class="stringliteral">&quot; AND tbk.textbook_id=\&quot;$textid\&quot; &quot;</span>;
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">return</span>([]) <span class="keywordflow">if</span>($thing ne <span class="stringliteral">&#39;textbook&#39;</span>);
    }

    my $textchap = $r-&gt;param(<span class="stringliteral">&#39;library_textchapter&#39;</span>) || <span class="stringliteral">&#39;&#39;</span>;
    $textchap =~ s/^\s*\d+\.\s*<span class="comment">//;</span>
    <span class="keywordflow">if</span>($textchap and $thing eq <span class="stringliteral">&#39;textsection&#39;</span>) {
        $textextrawhere .= <span class="stringliteral">&quot; AND tc.name=\&quot;$textchap\&quot; &quot;</span>;
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">return</span>([]) <span class="keywordflow">if</span>($thing eq <span class="stringliteral">&#39;textsection&#39;</span>);
    }

    my $selectwhat = LIBRARY_STRUCTURE-&gt;{$thing}{select};
    
    my $query = <span class="stringliteral">&quot;SELECT DISTINCT $selectwhat</span>
<span class="stringliteral">          FROM `NPL-textbook` tbk, `NPL-problem` prob, </span>
<span class="stringliteral">            `NPL-pgfile-problem` pg, `NPL-pgfile` pgf,</span>
<span class="stringliteral">            `NPL-DBsection` s, `NPL-DBchapter` c, `NPL-DBsubject` t,</span>
<span class="stringliteral">            `NPL-chapter` tc, `NPL-section` ts</span>
<span class="stringliteral">          WHERE ts.section_id=prob.section_id AND </span>
<span class="stringliteral">            prob.problem_id=pg.problem_id AND</span>
<span class="stringliteral">            s.DBchapter_id=c.DBchapter_id AND </span>
<span class="stringliteral">            c.DBsubject_id=t.DBsubject_id AND</span>
<span class="stringliteral">            pgf.DBsection_id=s.DBsection_id AND</span>
<span class="stringliteral">            pgf.pgfile_id=pg.pgfile_id AND</span>
<span class="stringliteral">            ts.chapter_id=tc.chapter_id AND</span>
<span class="stringliteral">            tc.textbook_id=tbk.textbook_id</span>
<span class="stringliteral">            $extrawhere $textextrawhere &quot;</span>;
<span class="preprocessor">#$query =~ s/\n/ /g;</span>
<span class="preprocessor"></span><span class="preprocessor">#warn $query;</span>
<span class="preprocessor"></span>    my $text_ref = $dbh-&gt;selectall_arrayref($query);
    my @texts = @{$text_ref};
    <span class="keywordflow">if</span>( $thing eq <span class="stringliteral">&#39;textbook&#39;</span>) {
        @texts = grep { $_-&gt;[1] =~ /\S/ } @texts;
        my @sortarray = map { $_-&gt;[1] . $_-&gt;[2] . $_-&gt;[3] } @texts;
        @texts = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a7b5c8a0fc4cf41ff3f203d5fd24b4fba">indirectSortByName</a>( \@sortarray, @texts );
        <span class="keywordflow">return</span>(\@texts);
    } <span class="keywordflow">else</span> {
        @texts = grep { $_-&gt;[1] =~ /\S/ } @texts;
        my @sortarray = map { $_-&gt;[0] .<span class="stringliteral">&quot;. &quot;</span> . $_-&gt;[1] } @texts;
        @texts = map { [ $_ ] } @sortarray;
        @texts = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a7b5c8a0fc4cf41ff3f203d5fd24b4fba">indirectSortByName</a>(\@sortarray, @texts);
        <span class="keywordflow">return</span>(\@texts);
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3caa8853d828a97533f464888257fa7a"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::getSectionListings" ref="a3caa8853d828a97533f464888257fa7a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::getSectionListings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getSectionListings' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getSectionListings-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getSectionListings-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getSectionListings-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getSectionListings: 44</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a3caa8853d828a97533f464888257fa7a">getSectionListings</a>  {
<span class="preprocessor">    #print STDERR &quot;ListingDB::getSectionListings(chapter,section)\n&quot;;</span>
<span class="preprocessor"></span>    my $r = shift;
    my $ce = $r-&gt;ce;
    my $version = $ce-&gt;{problemLibrary}-&gt;{version} || 1;
    <span class="keywordflow">if</span>($version == 2) { <span class="keywordflow">return</span>(<a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#aa123cb54a87316f0c6dd3f1e5ea3dfbe">getDBListings</a>($r, 0))}
    my $subj = $r-&gt;param(<span class="stringliteral">&#39;library_subjects&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
    my $chap = $r-&gt;param(<span class="stringliteral">&#39;library_chapters&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
    my $sec = $r-&gt;param(<span class="stringliteral">&#39;library_sections&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;

    my $chapstring = <span class="stringliteral">&#39;&#39;</span>;
    <span class="keywordflow">if</span>($chap) {
        $chap =~ s/<span class="stringliteral">&#39;/\\&#39;</span>/g;
        $chapstring = <span class="stringliteral">&quot; c.chapter = \&#39;$chap\&#39; AND &quot;</span>;
    }
    my $secstring = <span class="stringliteral">&#39;&#39;</span>;
    <span class="keywordflow">if</span>($sec) {
        $sec =~ s/<span class="stringliteral">&#39;/\\&#39;</span>/g;
        $secstring = <span class="stringliteral">&quot; c.section = \&#39;$sec\&#39; AND &quot;</span>;
    }

    my @results; #returned
    my $query = <span class="stringliteral">&quot;SELECT c.*, p.path</span>
<span class="stringliteral">    FROM classify c, pgfiles p</span>
<span class="stringliteral">    WHERE $chapstring $secstring c.pgfiles_id = p.pgfiles_id&quot;</span>;
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($ce);
    my $sth = $dbh-&gt;prepare($query);
    
    $sth-&gt;execute();
    <span class="keywordflow">while</span> (1)
    {
        my $row = $sth-&gt;fetchrow_hashref();
        <span class="keywordflow">if</span> (!defined($row))
        {
            last;
        }
        <span class="keywordflow">else</span>
        {
            push @results, $row;
<span class="preprocessor">            #print STDERR &quot;ListingDB::getSectionListings $row\n&quot;;</span>
<span class="preprocessor"></span>        }
    }
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7b5c8a0fc4cf41ff3f203d5fd24b4fba"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::indirectSortByName" ref="a7b5c8a0fc4cf41ff3f203d5fd24b4fba" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::indirectSortByName </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-indirectSortByName' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-indirectSortByName-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-indirectSortByName-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-indirectSortByName-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in indirectSortByName: 12</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a7b5c8a0fc4cf41ff3f203d5fd24b4fba">indirectSortByName</a> {
    my $aref = shift ;
    my @a = @$aref;
    my @b = @_;
    my %pairs ;
    <span class="keywordflow">for</span> my $j (1..scalar(@a)) {
        $pairs{$a[$j-1]} = $b[$j-1];
    }
    my @list = <a class="code" href="classWeBWorK_1_1Utils.html#a765334eb4484125d0ea5ad2a68b3b1f2">sortByName</a>(undef, @a);
    @list = map { $pairs{$_} } @list;
    <span class="keywordflow">return</span>(@list);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a79a2bf797e937c8ba66cdbbd45688e91"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::keywordCleaner" ref="a79a2bf797e937c8ba66cdbbd45688e91" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::keywordCleaner </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-keywordCleaner' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-keywordCleaner-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-keywordCleaner-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-keywordCleaner-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in keywordCleaner: 6</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a79a2bf797e937c8ba66cdbbd45688e91">keywordCleaner</a> {
    my $string = shift;
    my @spl1 = split /\s*,\s*/, $string;
    my @spl2 = map(<a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a597b85b668135f2a0dc195d5fdde8d80">kwtidy</a>($_), @spl1);
    <span class="keywordflow">return</span>(@spl2);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a597b85b668135f2a0dc195d5fdde8d80"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::kwtidy" ref="a597b85b668135f2a0dc195d5fdde8d80" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::kwtidy </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-kwtidy' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-kwtidy-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-kwtidy-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-kwtidy-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in kwtidy: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a597b85b668135f2a0dc195d5fdde8d80">kwtidy</a> {
    my $s = shift;
    $s =~ s/\W<span class="comment">//g;</span>
    $s =~ s/_<span class="comment">//g;</span>
    $s = lc($s);
    <span class="keywordflow">return</span>($s);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a206520a6a6f3bbdaa1beceaeb71c3cf2"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::makeKeywordWhere" ref="a206520a6a6f3bbdaa1beceaeb71c3cf2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::makeKeywordWhere </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-makeKeywordWhere' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-makeKeywordWhere-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-makeKeywordWhere-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-makeKeywordWhere-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in makeKeywordWhere: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a206520a6a6f3bbdaa1beceaeb71c3cf2">makeKeywordWhere</a> {
    my $kwstring = shift;
    my @kwlist = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#a79a2bf797e937c8ba66cdbbd45688e91">keywordCleaner</a>($kwstring);
    @kwlist = map { <span class="stringliteral">&quot;kw.keyword = \&quot;$_\&quot;&quot;</span> } @kwlist;
    my $where = join(<span class="stringliteral">&quot; OR &quot;</span>, @kwlist);
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;AND ( $where )&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa4a6da962c1806c5cbeced6c2e9a4c5f"></a><!-- doxytag: member="WeBWorK::Utils::ListingDB::searchListings" ref="aa4a6da962c1806c5cbeced6c2e9a4c5f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::Utils::ListingDB::searchListings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-searchListings' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-searchListings-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-searchListings-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-searchListings-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in searchListings: 34</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#aa4a6da962c1806c5cbeced6c2e9a4c5f">searchListings</a> {
    my $ce = shift;
    my %searchterms = @_;
<span class="preprocessor">    #print STDERR &quot;ListingDB::searchListings  input array @_\n&quot;;</span>
<span class="preprocessor"></span>    my @results;
    my ($row,$key);
    my $dbh = <a class="code" href="classWeBWorK_1_1Utils_1_1ListingDB.html#ae67a998710517d467b0025b764c7c86b">getDB</a>($ce);
    my $query = <span class="stringliteral">&quot;SELECT c.filename, p.path</span>
<span class="stringliteral">        FROM classify c, pgfiles p</span>
<span class="stringliteral">        WHERE c.id = p.classify_id&quot;</span>;
    <span class="keywordflow">foreach</span> $key (keys %searchterms) {
        $query .= <span class="stringliteral">&quot; AND c.$key = $searchterms{$key}&quot;</span>;
    };
    my $sth = $dbh-&gt;prepare($query);
    $sth-&gt;execute();
    <span class="keywordflow">if</span> ($sth-&gt;rows())
    {
        <span class="keywordflow">while</span> (1)
        {
            $row = $sth-&gt;fetchrow_hashref();
            <span class="keywordflow">if</span> (!defined($row))
            {
                last;
            }
            <span class="keywordflow">else</span>
            {
<span class="preprocessor">                #print STDERR &quot;ListingDB::searchListings(): found $row-&gt;{id}\n&quot;;</span>
<span class="preprocessor"></span>                my $listing = $row;
                push @results, $listing;
            }
        }
    }
    <span class="keywordflow">return</span> @results;
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="ListingDB_8pm_source.html">ListingDB.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 23:00:26 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
