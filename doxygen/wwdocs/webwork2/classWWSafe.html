<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WWSafe Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>WWSafe Class Reference</h1><!-- doxytag: class="WWSafe" -->
<p><a href="classWWSafe-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a443eb802c79bbe85cfcc986638cf8761">deny_only</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a712474ce84bb7672f5d678e76c849368">rdo</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a47e5d38ee4838dd6631f9c5e4c56abbe">untrap</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a507116694965a18e21d507cbd3e6a55a">reinit</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a52ecd7c4d5a204ba647c8f7e61f9e92e">reval</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#aedac0ad22742f35a398ccb00a2d76a56">share</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#acf5262366ee344e7b46ee5338e8a1472">trap</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a17aa436b406e066ce6f0dd5022001e7b">new</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a01a7e1a154f0097762cd07f2095c93e6">erase</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a7762f4e51ade3fb6a3349ff1fd0a9e2b">root</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a30f64d819e5692c709fe8539df5090e0">permit_only</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#adf03f02ecc99e45ff95f5efc69e15d59">mask</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a5f0b0a6a58aa5320ebe10cb114a71059">share_from</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#adbda28bcad22433debd80ad297ebba3f">dump_mask</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#aa178ca274ce2415e1656df4ae61f5469">permit</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a145c93f680dc87f8c9c68f9b4e2403b9">share_redo</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a27ffb2edb138f60ebed8097c3225cc87">deny</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#ac0b2e893655ce93dd7ada6c290013092">DESTROY</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a05535596ce6f469195807fe8b04d93ba">share_forget</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a7b76c6312d6d756b024b5baa50ab5a45">share_record</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#a17bae4bb70b3de08c47f256f384b53f5">lexless_anon_sub</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWWSafe.html#ac194c56abd0fb1ecc8baa0a41c54813f">varglob</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p>Safe - Compile and execute code in restricted compartments</p>
<h2><a class="anchor" id="SYNOPSIS">
SYNOPSIS</a></h2>
<pre>  use <a class="el" href="classWWSafe.html">WWSafe</a>;</pre><pre>  $compartment = new Safe;</pre><pre>  $compartment-&gt;permit(qw(time sort :browse));</pre><pre>  $result = $compartment-&gt;reval($unsafe_code);</pre><h2><a class="anchor" id="DESCRIPTION">
DESCRIPTION</a></h2>
<p>The Safe extension module allows the creation of compartments in which perl code can be evaluated. Each compartment has </p>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_a_new_namespace"></a><b>a new namespace</b> </p>
<p>The "root" of the namespace (i.e. "main::") is changed to a different package and code evaluated in the compartment cannot refer to variables outside this namespace, even with run-time glob lookups and other tricks. </p>
<p>Code which is compiled outside the compartment can choose to place variables into (or <em>share</em> variables with) the compartment's namespace and only that data will be visible to code evaluated in the compartment. </p>
<p class="endli">By default, the only variables shared with compartments are the "underscore" variables $_ and @_ (and, technically, the less frequently used %_, the _ filehandle and so on). This is because otherwise perl operators which default to $_ will not work and neither will the assignment of arguments to @_ on subroutine entry.  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_an_operator_mask"></a><b>an operator mask</b> </p>
<p>Each compartment has an associated "operator mask". Recall that perl code is compiled into an internal format before execution. Evaluating perl code (e.g. via "eval" or "do 'file'") causes the code to be compiled into an internal format and then, provided there was no error in the compilation, executed. Code evaluated in a compartment compiles subject to the compartment's operator mask. Attempting to evaluate code in a compartment which contains a masked operator will cause the compilation to fail with an error. The code will not be executed. </p>
<p>The default operator mask for a newly created compartment is the ':default' optag. </p>
<p>It is important that you read the <em>Opcode</em> module documentation for more information, especially for detailed definitions of opnames, optags and opsets. </p>
<p>Since it is only at the compilation stage that the operator mask applies, controlled access to potentially unsafe operations can be achieved by having a handle to a wrapper subroutine (written outside the compartment) placed into the compartment. For example, </p>
<pre>    $cpt = new Safe;
    sub wrapper {
        # vet arguments and perform potentially unsafe operations
    }
    $cpt-&gt;share('&amp;wrapper');</pre><p class="endli"></p>
</li>
</ul>
<h2><a class="anchor" id="WARNING">
WARNING</a></h2>
<p>The authors make <b>no warranty</b>, implied or otherwise, about the suitability of this software for safety or security purposes. </p>
<p>The authors shall not in any case be liable for special, incidental, consequential, indirect or other similar damages arising from the use of this software. </p>
<p>Your mileage will vary. If in any doubt <b>do not use it</b>.</p>
<h3><a class="anchor" id="RECENT_CHANGES">
RECENT CHANGES</a></h3>
<p>The interface to the Safe module has changed quite dramatically since version 1 (as supplied with Perl5.002). Study these pages carefully if you have code written to use Safe version 1 because you will need to makes changes.</p>
<h3><a class="anchor" id="Methods_in_class_Safe">
Methods in class Safe</a></h3>
<p>To create a new compartment, use </p>
<pre>    $cpt = new Safe;</pre><p>Optional argument is (NAMESPACE), where NAMESPACE is the root namespace to use for the compartment (defaults to "Safe::Root0", incremented for each new compartment). </p>
<p>Note that version 1.00 of the Safe module supported a second optional parameter, MASK. That functionality has been withdrawn pending deeper consideration. Use the permit and deny methods described below. </p>
<p>The following methods can then be used on the compartment object returned by the above constructor. The object argument is implicit in each case. </p>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_permit__OP______"></a><b>permit (OP, ...)</b> </p>
<p>Permit the listed operators to be used when compiling code in the compartment (in <em>addition</em> to any operators already permitted). </p>
<p class="endli">You can list opcodes by names, or use a tag name; see <em>Opcode/"Predefined Opcode Tags"</em>.  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_permit_only__OP______"></a><b>permit_only (OP, ...)</b> </p>
<p class="endli">Permit <em>only</em> the listed operators to be used when compiling code in the compartment (<em>no</em> other operators are permitted).  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_deny__OP______"></a><b>deny (OP, ...)</b> </p>
<p class="endli">Deny the listed operators from being used when compiling code in the compartment (other operators may still be permitted).  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_deny_only__OP______"></a><b>deny_only (OP, ...)</b> </p>
<p class="endli">Deny <em>only</em> the listed operators from being used when compiling code in the compartment (<em>all</em> other operators will be permitted).  </p>
</li>
<li>
<a class="anchor" id="item_trap__OP______"></a><b>trap (OP, ...)</b>  </li>
<li>
<p class="startli"><a class="anchor" id="item_untrap__OP______"></a><b>untrap (OP, ...)</b> </p>
<p class="endli">The trap and untrap methods are synonyms for deny and permit respectfully.  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_share__NAME______"></a><b>share (NAME, ...)</b> </p>
<p>This shares the variable(s) in the argument list with the compartment. This is almost identical to exporting variables using the <em>Exporter</em> module. </p>
<p>Each NAME must be the <b>name</b> of a non-lexical variable, typically with the leading type identifier included. A bareword is treated as a function name. </p>
<p>Examples of legal names are '$foo' for a scalar, '@foo' for an array, '%foo' for a hash, '&amp;foo' or 'foo' for a subroutine and '*foo' for a glob (i.e. all symbol table entries associated with "foo", including scalar, array, hash, sub and filehandle). </p>
<p class="endli">Each NAME is assumed to be in the calling package. See share_from for an alternative method (which share uses).  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_share_from__PACKAGE__ARRAYREF_"></a><b>share_from (PACKAGE, ARRAYREF)</b> </p>
<p>This method is similar to <a class="el" href="classWWSafe.html#aedac0ad22742f35a398ccb00a2d76a56">share()</a> but allows you to explicitly name the package that symbols should be shared from. The symbol names (including type characters) are supplied as an array reference. </p>
<pre>    $safe-&gt;share_from('main', [ '$foo', '%bar', 'func' ]);</pre><p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_varglob__VARNAME_"></a><b>varglob (VARNAME)</b> </p>
<p>This returns a glob reference for the symbol table entry of VARNAME in the package of the compartment. VARNAME must be the <b>name</b> of a variable without any leading type marker. For example, </p>
<pre>    $cpt = new Safe 'Root';
    $Root::foo = "Hello world";
    # Equivalent version which doesn't need to know $cpt's package name:
    ${$cpt-&gt;varglob('foo')} = "Hello world";</pre><p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_reval__STRING_"></a><b>reval (STRING)</b> </p>
<p>This evaluates STRING as perl code inside the compartment. </p>
<p>The code can only see the compartment's namespace (as returned by the <b>root</b> method). The compartment's root package appears to be the</p>
<div class="fragment"><pre class="fragment"><a class="code" href="classmain.html">main</a>::
</pre></div><p> package to the code inside the compartment. </p>
<p>Any attempt by the code in STRING to use an operator which is not permitted by the compartment will cause an error (at run-time of the main program but at compile-time for the code in STRING). The error is of the form "'\%s' trapped by operation mask...". </p>
<p>If an operation is trapped in this way, then the code in STRING will not be executed. If such a trapped operation occurs or any other compile-time or return error, then $@ is set to the error message, just as with an eval(). </p>
<p>If there is no error, then the method returns the value of the last expression evaluated, or a return statement may be used, just as with subroutines and <b>eval()</b>. The context (list or scalar) is determined by the caller as usual. </p>
<p>This behaviour differs from the beta distribution of the Safe extension where earlier versions of perl made it hard to mimic the return behaviour of the eval() command and the context was always scalar. </p>
<p>Some points to note: </p>
<p>If the entereval op is permitted then the code can use eval "..." to 'hide' code which might use denied ops. This is not a major problem since when the code tries to execute the eval it will fail because the opmask is still in effect. However this technique would allow clever, and possibly harmful, code to 'probe' the boundaries of what is possible. </p>
<p>Any string eval which is executed by code executing in a compartment, or by code called from code executing in a compartment, will be eval'd in the namespace of the compartment. This is potentially a serious problem. </p>
<p>Consider a function foo() in package pkg compiled outside a compartment but shared with it. Assume the compartment has a root package called 'Root'. If foo() contains an eval statement like eval '$foo = 1' then, normally, $pkg::foo will be set to 1. If foo() is called from the compartment (by whatever means) then instead of setting $pkg::foo, the eval will actually set $Root::pkg::foo. </p>
<p>This can easily be demonstrated by using a module, such as the Socket module, which uses eval "..." as part of an AUTOLOAD function. You can 'use' the module outside the compartment and share an (autoloaded) function with the compartment. If an autoload is triggered by code in the compartment, or by any code anywhere that is called by any means from the compartment, then the eval in the Socket module's AUTOLOAD function happens in the namespace of the compartment. Any variables created or used by the eval'd code are now under the control of the code in the compartment. </p>
<p class="endli">A similar effect applies to <em>all</em> runtime symbol lookups in code called from a compartment but not compiled within it.  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_rdo__FILENAME_"></a><b>rdo (FILENAME)</b> </p>
<p class="endli">This evaluates the contents of file FILENAME inside the compartment. See above documentation on the <b>reval</b> method for further details.  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_root__NAMESPACE_"></a><b>root (NAMESPACE)</b> </p>
<p>This method returns the name of the package that is the root of the compartment's namespace. </p>
<p class="endli">Note that this behaviour differs from version 1.00 of the Safe module where the root module could be used to change the namespace. That functionality has been withdrawn pending deeper consideration.  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_mask__MASK_"></a><b>mask (MASK)</b> </p>
<p>This is a get-or-set method for the compartment's operator mask. </p>
<p>With no MASK argument present, it returns the current operator mask of the compartment. </p>
<p class="endli">With the MASK argument present, it sets the operator mask for the compartment (equivalent to calling the deny_only method).  </p>
</li>
</ul>
<h3><a class="anchor" id="Some_Safety_Issues">
Some Safety Issues</a></h3>
<p>This section is currently just an outline of some of the things code in a compartment might do (intentionally or unintentionally) which can have an effect outside the compartment. </p>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_Memory"></a><b>Memory</b> </p>
<p class="endli">Consuming all (or nearly all) available memory.  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_CPU"></a><b>CPU</b> </p>
<p class="endli">Causing infinite loops etc.  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_Snooping"></a><b>Snooping</b> </p>
<p class="endli">Copying private information out of your system. Even something as simple as your user name is of value to others. Much useful information could be gleaned from your environment variables for example.  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_Signals"></a><b>Signals</b> </p>
<p>Causing signals (especially SIGFPE and SIGALARM) to affect your process. </p>
<p class="endli">Setting up a signal handler will need to be carefully considered and controlled. What mask is in effect when a signal handler gets called? If a user can get an imported function to get an exception and call the user's signal handler, does that user's restricted mask get re-instated before the handler is called? Does an imported handler get called with its original mask or the user's one?  </p>
</li>
<li>
<p class="startli"><a class="anchor" id="item_State_Changes"></a><b>State Changes</b> </p>
<p class="endli">Ops such as chdir obviously effect the process as a whole and not just the code in the compartment. Ops such as rand and srand have a similar but more subtle effect.  </p>
</li>
</ul>
<h3><a class="anchor" id="AUTHOR">
AUTHOR</a></h3>
<p>Originally designed and implemented by Malcolm Beattie. </p>
<p>Reworked to use the Opcode module and other changes added by Tim Bunce. </p>
<p>Currently maintained by the Perl 5 Porters, &lt;perl5-porters@perl.org&gt;. </p>

<p>Definition at line <a class="el" href="WWSafe_8pm_source.html#l00270">270</a> of file <a class="el" href="WWSafe_8pm_source.html">WWSafe.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a27ffb2edb138f60ebed8097c3225cc87"></a><!-- doxytag: member="WWSafe::deny" ref="a27ffb2edb138f60ebed8097c3225cc87" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::deny </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-deny' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-deny-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-deny-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-deny-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in deny: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a27ffb2edb138f60ebed8097c3225cc87">deny</a> {
    my $obj = shift;
    $obj-&gt;{Mask} |= opset(@_);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a443eb802c79bbe85cfcc986638cf8761"></a><!-- doxytag: member="WWSafe::deny_only" ref="a443eb802c79bbe85cfcc986638cf8761" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::deny_only </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-deny_only' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-deny_only-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-deny_only-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-deny_only-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in deny_only: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a443eb802c79bbe85cfcc986638cf8761">deny_only</a> {
    my $obj = shift;
    $obj-&gt;{Mask} = opset(@_);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac0b2e893655ce93dd7ada6c290013092"></a><!-- doxytag: member="WWSafe::DESTROY" ref="ac0b2e893655ce93dd7ada6c290013092" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::DESTROY </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-DESTROY' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-DESTROY-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-DESTROY-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-DESTROY-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in DESTROY: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#ac0b2e893655ce93dd7ada6c290013092">DESTROY</a> {
    my $obj = shift;
    $obj-&gt;erase(<span class="stringliteral">&#39;DESTROY&#39;</span>) <span class="keywordflow">if</span> $obj-&gt;{Erase};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="adbda28bcad22433debd80ad297ebba3f"></a><!-- doxytag: member="WWSafe::dump_mask" ref="adbda28bcad22433debd80ad297ebba3f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::dump_mask </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-dump_mask' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-dump_mask-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-dump_mask-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-dump_mask-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in dump_mask: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#adbda28bcad22433debd80ad297ebba3f">dump_mask</a> {
    my $obj = shift;
    print opset_to_hex($obj-&gt;{Mask}),<span class="stringliteral">&quot;\n&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a01a7e1a154f0097762cd07f2095c93e6"></a><!-- doxytag: member="WWSafe::erase" ref="a01a7e1a154f0097762cd07f2095c93e6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::erase </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-erase' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-erase-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-erase-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-erase-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in erase: 35</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a01a7e1a154f0097762cd07f2095c93e6">erase</a> {
    my ($obj, $action) = @_;
    my $pkg = $obj-&gt;root();
    my ($stem, $leaf);

    no strict <span class="stringliteral">&#39;refs&#39;</span>;
    $pkg = <span class="stringliteral">&quot;main::$pkg\::&quot;</span>; # expand to full symbol table name
    ($stem, $leaf) = $pkg =~ m/(.*::)(\w+::)$/;

<span class="preprocessor">    # The &#39;my $foo&#39; is needed! Without it you get an</span>
<span class="preprocessor"></span><span class="preprocessor">    # &#39;Attempt to free unreferenced scalar&#39; warning!</span>
<span class="preprocessor"></span>    my $stem_symtab = *{$stem}{HASH};

<span class="preprocessor">    #warn &quot;erase($pkg) stem=$stem, leaf=$leaf&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #warn &quot; stem_symtab hash &quot;.scalar(%$stem_symtab).&quot;\n&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    # &quot;, join(&#39;, &#39;, %$stem_symtab),&quot;\n&quot;;</span>
<span class="preprocessor"></span>
<span class="preprocessor">#    delete $stem_symtab-&gt;{$leaf};</span>
<span class="preprocessor"></span>
    my $leaf_glob   = $stem_symtab-&gt;{$leaf};
    my $leaf_symtab = *{$leaf_glob}{HASH};
<span class="preprocessor">#    warn &quot; leaf_symtab &quot;, join(&#39;, &#39;, %$leaf_symtab),&quot;\n&quot;;</span>
<span class="preprocessor"></span>    %$leaf_symtab = ();
<span class="preprocessor">    #delete $leaf_symtab-&gt;{&#39;__ANON__&#39;};</span>
<span class="preprocessor"></span><span class="preprocessor">    #delete $leaf_symtab-&gt;{&#39;foo&#39;};</span>
<span class="preprocessor"></span><span class="preprocessor">    #delete $leaf_symtab-&gt;{&#39;main::&#39;};</span>
<span class="preprocessor"></span><span class="preprocessor">#    my $foo = undef ${&quot;$stem\::&quot;}{&quot;$leaf\::&quot;};</span>
<span class="preprocessor"></span>
    <span class="keywordflow">if</span> ($action and $action eq <span class="stringliteral">&#39;DESTROY&#39;</span>) {
        <span class="keyword">delete</span> $stem_symtab-&gt;{$leaf};
    } <span class="keywordflow">else</span> {
        $obj-&gt;share_from(<span class="stringliteral">&#39;main&#39;</span>, $default_share);
    }
    1;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a17bae4bb70b3de08c47f256f384b53f5"></a><!-- doxytag: member="WWSafe::lexless_anon_sub" ref="a17bae4bb70b3de08c47f256f384b53f5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::lexless_anon_sub </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-lexless_anon_sub' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-lexless_anon_sub-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-lexless_anon_sub-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-lexless_anon_sub-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in lexless_anon_sub: 14</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a17bae4bb70b3de08c47f256f384b53f5">lexless_anon_sub</a> {
<span class="preprocessor">         # $_[0] is package;</span>
<span class="preprocessor"></span><span class="preprocessor">         # $_[1] is strict flag;</span>
<span class="preprocessor"></span>    my $__ExPr__ = $_[2];   # must be a lexical to create the closure that
<span class="preprocessor">                # can be used to pass the value into the safe</span>
<span class="preprocessor"></span><span class="preprocessor">                # world</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # Create anon sub ref in root of compartment.</span>
<span class="preprocessor"></span><span class="preprocessor">    # Uses a closure (on $__ExPr__) to pass in the code to be executed.</span>
<span class="preprocessor"></span><span class="preprocessor">    # (eval on one line to keep line numbers as expected by caller)</span>
<span class="preprocessor"></span>    eval sprintf
    <span class="stringliteral">&#39;package %s; %s strict; sub { @_=(); eval q[my $__ExPr__;] . $__ExPr__; }&#39;</span>,
        $_[0], $_[1] ? <span class="stringliteral">&#39;use&#39;</span> : <span class="stringliteral">&#39;no&#39;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="adf03f02ecc99e45ff95f5efc69e15d59"></a><!-- doxytag: member="WWSafe::mask" ref="adf03f02ecc99e45ff95f5efc69e15d59" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::mask </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-mask' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-mask-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-mask-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-mask-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in mask: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#adf03f02ecc99e45ff95f5efc69e15d59">mask</a> {
    my $obj = shift;
    <span class="keywordflow">return</span> $obj-&gt;{Mask} unless @_;
    $obj-&gt;deny_only(@_);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a17aa436b406e066ce6f0dd5022001e7b"></a><!-- doxytag: member="WWSafe::new" ref="a17aa436b406e066ce6f0dd5022001e7b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::new </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-new' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-new-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-new-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-new-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in new: 31</span>
<span class="preprocessor"></span>sub <span class="keyword">new</span> {
    my($class, $root, $mask) = @_;
    my $obj = {};
    bless $obj, $class;

    <span class="keywordflow">if</span> (defined($root)) {
    croak <span class="stringliteral">&quot;Can&#39;t use \&quot;$root\&quot; as root name&quot;</span>
        <span class="keywordflow">if</span> $root =~ /^<a class="code" href="classmain.html">main</a>\b/ or $root !~ /^\w[:\w]*$/;
    $obj-&gt;{Root}  = $root;
    $obj-&gt;{Erase} = 0;
    }
    <span class="keywordflow">else</span> {
    $obj-&gt;{Root}  = <span class="stringliteral">&quot;Safe::Root&quot;</span>.$default_root++;
    $obj-&gt;{Erase} = 1;
    }

<span class="preprocessor">    # use permit/deny methods instead till interface issues resolved</span>
<span class="preprocessor"></span><span class="preprocessor">    # XXX perhaps new Safe &#39;Root&#39;, mask =&gt; $mask, foo =&gt; bar, ...;</span>
<span class="preprocessor"></span>    croak <span class="stringliteral">&quot;Mask parameter to new no longer supported&quot;</span> <span class="keywordflow">if</span> defined $mask;
    $obj-&gt;permit_only(<span class="stringliteral">&#39;:default&#39;</span>);

<span class="preprocessor">    # We must share $_ and @_ with the compartment or else ops such</span>
<span class="preprocessor"></span><span class="preprocessor">    # as split, length and so on won&#39;t default to $_ properly, nor</span>
<span class="preprocessor"></span><span class="preprocessor">    # will passing argument to subroutines work (via @_). In fact,</span>
<span class="preprocessor"></span><span class="preprocessor">    # for reasons I don&#39;t completely understand, we need to share</span>
<span class="preprocessor"></span><span class="preprocessor">    # the whole glob *_ rather than $_ and @_ separately, otherwise</span>
<span class="preprocessor"></span><span class="preprocessor">    # @_ in non default packages within the compartment don&#39;t work.</span>
<span class="preprocessor"></span>    $obj-&gt;share_from(<span class="stringliteral">&#39;main&#39;</span>, $default_share);
    Opcode::_safe_pkg_prep($obj-&gt;{Root}) <span class="keywordflow">if</span>($Opcode::VERSION &gt; 1.04);
    <span class="keywordflow">return</span> $obj;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa178ca274ce2415e1656df4ae61f5469"></a><!-- doxytag: member="WWSafe::permit" ref="aa178ca274ce2415e1656df4ae61f5469" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::permit </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-permit' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-permit-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-permit-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-permit-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in permit: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#aa178ca274ce2415e1656df4ae61f5469">permit</a> {
    my $obj = shift;
<span class="preprocessor">    # XXX needs testing</span>
<span class="preprocessor"></span>    $obj-&gt;{Mask} &amp;= invert_opset opset(@_);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a30f64d819e5692c709fe8539df5090e0"></a><!-- doxytag: member="WWSafe::permit_only" ref="a30f64d819e5692c709fe8539df5090e0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::permit_only </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-permit_only' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-permit_only-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-permit_only-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-permit_only-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in permit_only: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a30f64d819e5692c709fe8539df5090e0">permit_only</a> {
    my $obj = shift;
    $obj-&gt;{Mask} = invert_opset opset(@_);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a712474ce84bb7672f5d678e76c849368"></a><!-- doxytag: member="WWSafe::rdo" ref="a712474ce84bb7672f5d678e76c849368" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::rdo </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rdo' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rdo-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rdo-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rdo-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rdo: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a712474ce84bb7672f5d678e76c849368">rdo</a> {
    my ($obj, $file) = @_;
    my $root = $obj-&gt;{Root};

    my $evalsub = eval
        sprintf(<span class="stringliteral">&#39;package %s; sub { @_ = (); do $file }&#39;</span>, $root);
    <span class="keywordflow">return</span> Opcode::_safe_call_sv($root, $obj-&gt;{Mask}, $evalsub);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a507116694965a18e21d507cbd3e6a55a"></a><!-- doxytag: member="WWSafe::reinit" ref="a507116694965a18e21d507cbd3e6a55a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::reinit </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-reinit' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-reinit-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-reinit-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-reinit-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in reinit: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a507116694965a18e21d507cbd3e6a55a">reinit</a> {
    my $obj= shift;
    $obj-&gt;erase;
    $obj-&gt;share_redo;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a52ecd7c4d5a204ba647c8f7e61f9e92e"></a><!-- doxytag: member="WWSafe::reval" ref="a52ecd7c4d5a204ba647c8f7e61f9e92e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::reval </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-reval' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-reval-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-reval-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-reval-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in reval: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a52ecd7c4d5a204ba647c8f7e61f9e92e">reval</a> {
    my ($obj, $expr, $strict) = @_;
    my $root = $obj-&gt;{Root};

    my $evalsub = <a class="code" href="classWWSafe.html#a17bae4bb70b3de08c47f256f384b53f5">lexless_anon_sub</a>($root,$strict, $expr);
    <span class="keywordflow">return</span> Opcode::_safe_call_sv($root, $obj-&gt;{Mask}, $evalsub);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7762f4e51ade3fb6a3349ff1fd0a9e2b"></a><!-- doxytag: member="WWSafe::root" ref="a7762f4e51ade3fb6a3349ff1fd0a9e2b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::root </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-root' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-root-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-root-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-root-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in root: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a7762f4e51ade3fb6a3349ff1fd0a9e2b">root</a> {
    my $obj = shift;
    croak(<span class="stringliteral">&quot;Safe root method now read-only&quot;</span>) if @_;
    return $obj-&gt;{Root};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aedac0ad22742f35a398ccb00a2d76a56"></a><!-- doxytag: member="WWSafe::share" ref="aedac0ad22742f35a398ccb00a2d76a56" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::share </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-share' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-share-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-share-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-share-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in share: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#aedac0ad22742f35a398ccb00a2d76a56">share</a> {
    my($obj, @vars) = @_;
    $obj-&gt;share_from(scalar(caller), \@vars);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a05535596ce6f469195807fe8b04d93ba"></a><!-- doxytag: member="WWSafe::share_forget" ref="a05535596ce6f469195807fe8b04d93ba" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::share_forget </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-share_forget' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-share_forget-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-share_forget-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-share_forget-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in share_forget: 3</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a05535596ce6f469195807fe8b04d93ba">share_forget</a> {
    <span class="keyword">delete</span> shift-&gt;{Shares};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a5f0b0a6a58aa5320ebe10cb114a71059"></a><!-- doxytag: member="WWSafe::share_from" ref="a5f0b0a6a58aa5320ebe10cb114a71059" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::share_from </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-share_from' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-share_from-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-share_from-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-share_from-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in share_from: 27</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a5f0b0a6a58aa5320ebe10cb114a71059">share_from</a> {
    my $obj = shift;
    my $pkg = shift;
    my $vars = shift;
    my $no_record = shift || 0;
    my $root = $obj-&gt;root();
    croak(<span class="stringliteral">&quot;vars not an array ref&quot;</span>) unless ref $vars eq &#39;ARRAY&#39;;
    no strict &#39;refs&#39;;
    <span class="preprocessor"># Check that &#39;from&#39; package actually exists</span>
<span class="preprocessor"></span>    croak(<span class="stringliteral">&quot;Package \&quot;$pkg\&quot; does not exist&quot;</span>)
    unless keys %{<span class="stringliteral">&quot;$pkg\::&quot;</span>};
    my $arg;
    <span class="keywordflow">foreach</span> $arg (@$vars) {
<span class="preprocessor">    # catch some $safe-&gt;share($var) errors:</span>
<span class="preprocessor"></span>    my ($var, $type);
    $type = $1 <span class="keywordflow">if</span> ($var = $arg) =~ s/^(\W)<span class="comment">//;</span>
    # warn <span class="stringliteral">&quot;share_from $pkg $type $var&quot;</span>;
    *{$root.<span class="stringliteral">&quot;::$var&quot;</span>} = (!$type)       ? \&amp;{$pkg.<span class="stringliteral">&quot;::$var&quot;</span>}
              : ($type eq <span class="charliteral">&#39;&amp;&#39;</span>) ? \&amp;{$pkg.<span class="stringliteral">&quot;::$var&quot;</span>}
              : ($type eq <span class="charliteral">&#39;$&#39;</span>) ? \${$pkg.<span class="stringliteral">&quot;::$var&quot;</span>}
              : ($type eq <span class="charliteral">&#39;@&#39;</span>) ? \@{$pkg.<span class="stringliteral">&quot;::$var&quot;</span>}
              : ($type eq <span class="charliteral">&#39;%&#39;</span>) ? \%{$pkg.<span class="stringliteral">&quot;::$var&quot;</span>}
              : ($type eq <span class="charliteral">&#39;*&#39;</span>) ?  *{$pkg.<span class="stringliteral">&quot;::$var&quot;</span>}
              : croak(qq(Can<span class="stringliteral">&#39;t share &quot;$type$var&quot; of unknown type));</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    $obj-&gt;share_record($pkg, $vars) unless $no_record or !$vars;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7b76c6312d6d756b024b5baa50ab5a45"></a><!-- doxytag: member="WWSafe::share_record" ref="a7b76c6312d6d756b024b5baa50ab5a45" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::share_record </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-share_record' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-share_record-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-share_record-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-share_record-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in share_record: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a7b76c6312d6d756b024b5baa50ab5a45">share_record</a> {
    my $obj = shift;
    my $pkg = shift;
    my $vars = shift;
    my $shares = \%{$obj-&gt;{Shares} ||= {}};
<span class="preprocessor">    # Record shares using keys of $obj-&gt;{Shares}. See reinit.</span>
<span class="preprocessor"></span>    @{$shares}{@$vars} = ($pkg) x @$vars <span class="keywordflow">if</span> @$vars;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a145c93f680dc87f8c9c68f9b4e2403b9"></a><!-- doxytag: member="WWSafe::share_redo" ref="a145c93f680dc87f8c9c68f9b4e2403b9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::share_redo </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-share_redo' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-share_redo-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-share_redo-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-share_redo-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in share_redo: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#a145c93f680dc87f8c9c68f9b4e2403b9">share_redo</a> {
    my $obj = shift;
    my $shares = \%{$obj-&gt;{Shares} ||= {}};
    my($var, $pkg);
    <span class="keywordflow">while</span>(($var, $pkg) = each %$shares) {
<span class="preprocessor">    # warn &quot;share_redo $pkg\:: $var&quot;;</span>
<span class="preprocessor"></span>    $obj-&gt;share_from($pkg,  [ $var ], 1);
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="acf5262366ee344e7b46ee5338e8a1472"></a><!-- doxytag: member="WWSafe::trap" ref="acf5262366ee344e7b46ee5338e8a1472" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::trap </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-trap' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-trap-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-trap-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-trap-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in trap: 1</span>
<span class="preprocessor">sub trap   { shift-&gt;deny(@_)   }</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a47e5d38ee4838dd6631f9c5e4c56abbe"></a><!-- doxytag: member="WWSafe::untrap" ref="a47e5d38ee4838dd6631f9c5e4c56abbe" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::untrap </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-untrap' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-untrap-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-untrap-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-untrap-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in untrap: 1</span>
<span class="preprocessor">sub untrap { shift-&gt;permit(@_) }</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac194c56abd0fb1ecc8baa0a41c54813f"></a><!-- doxytag: member="WWSafe::varglob" ref="ac194c56abd0fb1ecc8baa0a41c54813f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WWSafe::varglob </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-varglob' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-varglob-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-varglob-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-varglob-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in varglob: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWWSafe.html#ac194c56abd0fb1ecc8baa0a41c54813f">varglob</a> {
    my ($obj, $var) = @_;
    no strict <span class="stringliteral">&#39;refs&#39;</span>;
    <span class="keywordflow">return</span> *{$obj-&gt;root().<span class="stringliteral">&quot;::$var&quot;</span>};
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="WWSafe_8pm_source.html">WWSafe.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 23:00:54 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
