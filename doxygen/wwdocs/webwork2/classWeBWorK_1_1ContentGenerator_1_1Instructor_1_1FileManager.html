<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::ContentGenerator::Instructor::FileManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator.html">ContentGenerator</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html">Instructor</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html">FileManager</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::ContentGenerator::Instructor::FileManager Class Reference</h1><!-- doxytag: class="WeBWorK::ContentGenerator::Instructor::FileManager" --><!-- doxytag: inherits="WeBWorK::ContentGenerator::Instructor" --><div class="dynheader">
Inheritance diagram for WeBWorK::ContentGenerator::Instructor::FileManager:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager__inherit__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager_inherit__map" id="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager_inherit__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html" title="WeBWorK::ContentGenerator::Instructor" alt="" coords="44,155,300,181"/><area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="76,80,268,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="131,5,213,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::ContentGenerator::Instructor::FileManager:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager__coll__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager_coll__map" id="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager_coll__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html" title="WeBWorK::ContentGenerator::Instructor" alt="" coords="44,155,300,181"/><area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="76,80,268,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="131,5,213,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ab2d5775fa15698e40275989db79b4d2a">SaveAs</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a7e8b52e8c6aca48af21ad6eccce5e138">getDate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ac29883ee8f6fa0fa38b4d875e6a85b8e">View</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ab8df856e8810a40f8dab3034c5ba86e5">sp2nbsp</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a4976b50963677e1a408d35f671260b7a">verifyPath</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ac22fb87a5b5fdb76529339c0d99ce5c6">downloadFile</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a4703cfab203a45e8ce0ff71b2fcd27cf">directoryMenu</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a8076b493b4cc41c94b90392758a0629d">uniqueName</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a25bf2e01d88419a4481b30f557da9961">Init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a8b2ec884c20f0c2852d825b21629d670">Delete</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2eaf47d70000deb118b78b31c08628fa">NewFolder</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a45ec891c05418f828ac7245979fd4e1a">Download</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ad56f4986fe04922717160a2ed30d1534">Edit</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ad081b641c8e29a1af9eaf66c6ebea00c">Rename</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ad3be0c25fad5b9fc06c9376fb531c5bf">fixSpaces</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2835bdd24478b0161aa2948411a7841a">Save</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a5111a98b96b3a6adba3eaade2e2e958b">systemError</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a27aee48f2cf3d15528c6994863811217">checkName</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ae77512861f20c96fe0b0085da5ddeb66">ParentDir</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a62756edd5417cd2527c9687fd4fd225a">isSymLink</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2741651eb51075d60b3c201013a7179e">Upload</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a8ab26fae2698aca8e7760f09cd74ab8e">UnpackArchive</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ac7820359148cbdb6cf7f542fc5b5b6ef">NewFile</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a9c7a23dc4214cf24d6dc8a3cf79083fa">pre_header_initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a4db9467d0d65d98b8812e4e63b809416">unpack</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ac19d8c73908b501a6c04560573d8777d">directoryListing</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2db5169e1cd03304a63504e2a527a90b">body</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a45c1110a6adef062a00382aa215a6c73">Go</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ae23d8249fbdcb9306e038680e6a5797a">Confirm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a83e326402c801069ef029f8f29f1b9b8">checkPWD</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a9c150140989da2efaae36d9cdf727167">HiddenFlags</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a65e6375b8d4362e6979b97e70872cc59">isText</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#af9ab3050a0fa72c7d167c03746a3d28d">MakeArchive</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a5e6591d404bdb35bebc62065038100ed">RefreshEdit</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a589550ca6ff711346266db0cde65b70b">getFlag</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#aa25272f09a702ec88e35685b1a1ecba7">Copy</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a1089d40ea9ef0cbb699da891ca8cf0f9">checkFileLocation</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2251231449a4929825b845bd6822f8ca">showHTML</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2c2af82ff4c67d42841d94a0ec8f6f17">verifyName</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a86128918a77137ac7f4b6ca48dfde5e5">Refresh</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a561f264d466a99f5ad18b0b29f28dcca">getFile</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ab318a419e7248b0593b1e813f762e5ac">getSize</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p>WeBWorK::ContentGenerator::Instructor::FileManager.pm -- simple directory manager for WW files </p>

<p>Definition at line <a class="el" href="FileManager_8pm_source.html#l00024">24</a> of file <a class="el" href="FileManager_8pm_source.html">FileManager.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a2db5169e1cd03304a63504e2a527a90b"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::body" ref="a2db5169e1cd03304a63504e2a527a90b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::body </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-body' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-body-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-body-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-body-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in body: 74</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2db5169e1cd03304a63504e2a527a90b">body</a> {
    my $self       = shift;
    my $r          = $self-&gt;r;
    my $urlpath    = $r-&gt;urlpath;
    my $db         = $r-&gt;db;
    my $ce         = $r-&gt;ce;
    my $authz      = $r-&gt;authz;
    my $courseRoot = $ce-&gt;{courseDirs}{root};
    my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&#39;courseID&#39;</span>);
    my $user       = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $key        = $r-&gt;param(<span class="stringliteral">&#39;key&#39;</span>);
    
    <span class="keywordflow">return</span> CGI::em(<span class="stringliteral">&quot;You are not authorized to manage course files&quot;</span>)
        unless $authz-&gt;hasPermissions($user, &quot;manage_course_files&quot;);

    $self-&gt;{pwd} = $self-&gt;checkPWD($r-&gt;param(<span class="stringliteral">&#39;pwd&#39;</span>) || HOME);
    <span class="keywordflow">return</span> CGI::em(<span class="stringliteral">&quot;You have specified an illegal working directory!&quot;</span>) unless defined $self-&gt;{pwd};

    my $fileManagerPage = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, courseID =&gt; $courseName);
    my $fileManagerURL  = $self-&gt;systemLink($fileManagerPage, authen =&gt; 0);

    print CGI::start_form(
        -method=&gt;<span class="stringliteral">&quot;POST&quot;</span>,
        -action=&gt;$fileManagerURL,
        -<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;FileManager&quot;</span>,
        -enctype=&gt; <span class="stringliteral">&#39;multipart/form-data&#39;</span>,
        -name=&gt;<span class="stringliteral">&quot;FileManager&quot;</span>,
         -style=&gt;<span class="stringliteral">&quot;margin:0&quot;</span>,
    );
    print $self-&gt;hidden_authen_fields;

    $self-&gt;{courseRoot} = $courseRoot;
    $self-&gt;{courseName} = $courseName;

    my $action = $r-&gt;param(<span class="stringliteral">&#39;action&#39;</span>) || $r-&gt;param(<span class="stringliteral">&#39;formAction&#39;</span>) || $r-&gt;param(<span class="stringliteral">&quot;confirmed&quot;</span>) || <span class="stringliteral">&#39;Init&#39;</span>;

    <span class="keywordflow">for</span> ($action) {
        /^Refresh/i    and <span class="keywordflow">do</span> {$self-&gt;Refresh; last};
        /^Cancel/i     and <span class="keywordflow">do</span> {$self-&gt;Refresh; last};
        /^\^/i         and <span class="keywordflow">do</span> {$self-&gt;ParentDir; last};
        /^Directory/i  and <span class="keywordflow">do</span> {$self-&gt;Go; last};
        /^Go/i         and <span class="keywordflow">do</span> {$self-&gt;Go; last};
        /^View/i       and <span class="keywordflow">do</span> {$self-&gt;View; last};
        /^Edit/i       and <span class="keywordflow">do</span> {$self-&gt;Edit; last};
        /^Download/i   and <span class="keywordflow">do</span> {$self-&gt;Refresh; last};
        /^Copy/i       and <span class="keywordflow">do</span> {$self-&gt;Copy; last};
        /^Rename/i     and <span class="keywordflow">do</span> {$self-&gt;Rename; last};
        /^Delete/i     and <span class="keywordflow">do</span> {$self-&gt;Delete; last};
        /^Make/i       and <span class="keywordflow">do</span> {$self-&gt;MakeArchive; last};
        /^Unpack/i     and <span class="keywordflow">do</span> {$self-&gt;UnpackArchive; last};
        /^New Folder/i and <span class="keywordflow">do</span> {$self-&gt;NewFolder; last};
        /^New <a class="code" href="classWeBWorK_1_1File.html">File</a>/i   and <span class="keywordflow">do</span> {$self-&gt;NewFile; last};
        /^Upload/i     and <span class="keywordflow">do</span> {$self-&gt;Upload; last};
        /^Revert/i     and <span class="keywordflow">do</span> {$self-&gt;Edit; last};
        /^Save As/i    and <span class="keywordflow">do</span> {$self-&gt;SaveAs; last};
        /^Save/i       and <span class="keywordflow">do</span> {$self-&gt;Save; last};
        /^Init/i       and <span class="keywordflow">do</span> {$self-&gt;Init; last};
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;Unknown action.&quot;</span>);
        $self-&gt;Refresh;
    }
    <span class="keywordflow">if</span> ($r-&gt;param(<span class="stringliteral">&#39;archiveCourse&#39;</span>) ) {
         my %options = %{$self-&gt;{archive_options}};
        my $courseID = $options{courseID};
        $self-&gt;addgoodmessage(<span class="stringliteral">&quot;Archiving course as $courseID.tar.gz. Reload FileManager to see it.&quot;</span>);
        <a class="code" href="classWeBWorK_1_1Utils_1_1CourseManagement.html#a1dc2740fc57733be708c89a7def1ef9e">WeBWorK::Utils::CourseManagement::archiveCourse</a>(%options);
        $self-&gt;addgoodmessage(<span class="stringliteral">&quot;Course archived.&quot;</span>);
        
    }
    print CGI::hidden({name=&gt;<span class="stringliteral">&#39;pwd&#39;</span>,value=&gt;$self-&gt;{pwd}});
    print CGI::hidden({name=&gt;<span class="stringliteral">&#39;formAction&#39;</span>,value=&gt;<span class="stringliteral">&quot;&quot;</span>});
    print CGI::end_form();

    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1089d40ea9ef0cbb699da891ca8cf0f9"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::checkFileLocation" ref="a1089d40ea9ef0cbb699da891ca8cf0f9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::checkFileLocation </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-checkFileLocation' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-checkFileLocation-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-checkFileLocation-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-checkFileLocation-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in checkFileLocation: 15</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a1089d40ea9ef0cbb699da891ca8cf0f9">checkFileLocation</a> {
    my $self = shift;
    my $extension = shift; $extension =~ s/.*\.<span class="comment">//;</span>
    my $dir = shift; my $location = $uploadDir{$extension};
    <span class="keywordflow">return</span> unless defined($location);
    <span class="keywordflow">return</span> <span class="keywordflow">if</span> $dir =~ m/^$location$/;
    $location =~ s!/\.\*!!;
    <span class="keywordflow">return</span> <span class="keywordflow">if</span> $dir =~ m/^$location$/;
    $self-&gt;addbadmessage(<span class="stringliteral">&quot;Files with extension &#39;.$extension&#39; usually belong in &#39;$location&#39;&quot;</span>);
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Check a name for bad characters, etc.</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a27aee48f2cf3d15528c6994863811217"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::checkName" ref="a27aee48f2cf3d15528c6994863811217" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::checkName </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-checkName' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-checkName-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-checkName-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-checkName-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in checkName: 13</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a27aee48f2cf3d15528c6994863811217">checkName</a> {
    my $file = shift;
    $file =~ s!.*[/\\]!!;               # <span class="keyword">remove</span> directory
    $file =~ s/[^-_.a-zA-Z0-9 ]/_/g;    # no illegal characters
    $file =~ s/^\./_/;                  # no initial dot
    $file = <span class="stringliteral">&quot;newfile.txt&quot;</span> unless $file; # no blank names
    <span class="keywordflow">return</span> $file;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Get a unique name (in case it already exists)</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a83e326402c801069ef029f8f29f1b9b8"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::checkPWD" ref="a83e326402c801069ef029f8f29f1b9b8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::checkPWD </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-checkPWD' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-checkPWD-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-checkPWD-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-checkPWD-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in checkPWD: 38</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a83e326402c801069ef029f8f29f1b9b8">checkPWD</a> {
    my $self = shift;
    my $pwd = shift;
    my $renameError = shift;

    $pwd =~ s!<span class="comment">//+!/!g;               # remove duplicate slashes</span>
    $pwd =~ s!(^|/)~!$1_!g;          # <span class="keyword">remove</span> ~user references
    $pwd =~ s!(^|/)(\.(/|$))+!$1!g;  # <span class="keyword">remove</span> dot directories
    
<span class="preprocessor">    # remove dir/.. constructions</span>
<span class="preprocessor"></span>    <span class="keywordflow">while</span> ($pwd =~ s!((\.[^./]+|\.\.[^/]+|[^./][^/]*)/\.\.(/|$))!!) {};
    
    $pwd =~ s!/$!!;                        # <span class="keyword">remove</span> trailing /
    <span class="keywordflow">return</span> <span class="keywordflow">if</span> ($pwd =~ m!(^|/)\.\.(/|$)!); # Error <span class="keywordflow">if</span> outside the root

<span class="preprocessor">    # check for bad symbolic links</span>
<span class="preprocessor"></span>    my @dirs = split(<span class="charliteral">&#39;/&#39;</span>,$pwd);
    pop(@dirs) if $renameError;      <span class="preprocessor"># don&#39;t check file iteself in this case</span>
<span class="preprocessor"></span>    my @path = ($self-&gt;{ce}{courseDirs}{root});
    <span class="keywordflow">foreach</span> my $dir (@dirs) {
        push @path,$dir;
        <span class="keywordflow">return</span> <span class="keywordflow">if</span> ($self-&gt;isSymLink(join(<span class="charliteral">&#39;/&#39;</span>,@path)));
    }

    my $original = $pwd;
    $pwd =~ s!(^|/)\.!$1_!g;         # don<span class="stringliteral">&#39;t enter hidden directories</span>
<span class="stringliteral">    $pwd =~ s!^/!!;                  # remove leading /</span>
<span class="stringliteral">    $pwd =~ s![^-_./A-Z0-9~, ]!_!gi; # no illegal characters</span>
<span class="stringliteral">    return if $renameError &amp;&amp; $original ne $pwd;</span>
<span class="stringliteral"></span>
<span class="stringliteral">    $pwd = &#39;</span>.<span class="stringliteral">&#39; if $pwd eq &#39;</span><span class="stringliteral">&#39;;</span>
<span class="stringliteral">    return $pwd;</span>
<span class="stringliteral">}</span>
<span class="stringliteral"></span>
<span class="stringliteral">##################################################</span>
<span class="stringliteral">#</span>
<span class="stringliteral"># Check that a file is uploaded to the correct directory</span>
<span class="stringliteral">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae23d8249fbdcb9306e038680e6a5797a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Confirm" ref="ae23d8249fbdcb9306e038680e6a5797a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Confirm </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Confirm' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Confirm-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Confirm-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Confirm-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Confirm: 31</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ae23d8249fbdcb9306e038680e6a5797a">Confirm</a> {
    my $self = shift;
    my $message = shift; my $value = shift;
    my $button = shift; my $button2 = shift;

    print CGI::p();
    print CGI::start_table({border=&gt;1,cellspacing=&gt;2,cellpadding=&gt;20, style=&gt;<span class="stringliteral">&quot;margin: 1em 0 0 3em&quot;</span>});
    print CGI::Tr(
        CGI::td({align=&gt;<span class="stringliteral">&quot;CENTER&quot;</span>},
          $message,
          CGI::input({type=&gt;<span class="stringliteral">&quot;text&quot;</span>,name=&gt;<span class="stringliteral">&quot;name&quot;</span>,size=&gt;50,value=&gt;$value}),
          CGI::p(), CGI::center(
            CGI::div({style=&gt;<span class="stringliteral">&quot;float:right; padding-right:3ex&quot;</span>},
              CGI::input({type=&gt;<span class="stringliteral">&quot;submit&quot;</span>,name=&gt;<span class="stringliteral">&quot;formAction&quot;</span>,value=&gt;$button})), # <span class="keyword">this</span> will be the <span class="keywordflow">default</span>
            CGI::div({style=&gt;<span class="stringliteral">&quot;float:left; padding-left:3ex&quot;</span>},
            CGI::input({type=&gt;<span class="stringliteral">&quot;submit&quot;</span>,name=&gt;<span class="stringliteral">&quot;formAction&quot;</span>,value=&gt;<span class="stringliteral">&quot;Cancel&quot;</span>})),
            ($button2 ? CGI::input({type=&gt;<span class="stringliteral">&quot;submit&quot;</span>,name=&gt;<span class="stringliteral">&quot;formAction&quot;</span>,value=&gt;$button2}): ()),
          ),
        ),
          );
    print CGI::end_table();
    print CGI::hidden({name=&gt;<span class="stringliteral">&quot;confirmed&quot;</span>, value=&gt;$button});
    $self-&gt;HiddenFlags;
    print CGI::script(<span class="stringliteral">&quot;window.document.FileManager.name.focus()&quot;</span>);
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Check that there is exactly one valid file</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa25272f09a702ec88e35685b1a1ecba7"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Copy" ref="aa25272f09a702ec88e35685b1a1ecba7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Copy </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Copy' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Copy-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Copy-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Copy-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Copy: 31</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#aa25272f09a702ec88e35685b1a1ecba7">Copy</a> {
    my $self = shift;
        my $dir = <span class="stringliteral">&quot;$self-&gt;{courseRoot}/$self-&gt;{pwd}&quot;</span>;
    my $original = $self-&gt;getFile(<span class="stringliteral">&#39;copy&#39;</span>); <span class="keywordflow">return</span> unless $original;
    my $oldfile = <span class="stringliteral">&quot;$dir/$original&quot;</span>;

    <span class="keywordflow">if</span> (-d $oldfile) {
<span class="preprocessor">        # FIXME: need to do recursive directory copy</span>
<span class="preprocessor"></span>        $self-&gt;addbadmessage(<span class="stringliteral">&quot;Directory copies are not yet implemented&quot;</span>);
        $self-&gt;Refresh;
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span> ($self-&gt;r-&gt;param(<span class="stringliteral">&#39;confirmed&#39;</span>)) {
        my $newfile = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;name&#39;</span>);
        <span class="keywordflow">if</span> ($newfile = $self-&gt;verifyPath($newfile,$original)) {
            <span class="keywordflow">if</span> (copy($oldfile, $newfile)) {
                $self-&gt;addgoodmessage(<span class="stringliteral">&quot;File successfully copied&quot;</span>);
                $self-&gt;Refresh; <span class="keywordflow">return</span>;
            } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t copy file: $!&quot;</span>)}
        }
    }

    $self-&gt;Confirm(<span class="stringliteral">&quot;Copy file as:&quot;</span>,$original,<span class="stringliteral">&quot;Copy&quot;</span>);
    print CGI::hidden({name=&gt;<span class="stringliteral">&quot;files&quot;</span>,value=&gt;$original});
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Rename a file</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a8b2ec884c20f0c2852d825b21629d670"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Delete" ref="a8b2ec884c20f0c2852d825b21629d670" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Delete </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Delete' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Delete-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Delete-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Delete-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Delete: 97</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a8b2ec884c20f0c2852d825b21629d670">Delete</a> {
    my $self = shift;
    my @files = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;files&#39;</span>);
    <span class="keywordflow">if</span> (scalar(@files) == 0) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You must select at least one file to delete&quot;</span>);
        $self-&gt;Refresh; <span class="keywordflow">return</span>;
    }

    my $pwd = $self-&gt;{pwd};
    my $dir = $self-&gt;{courseRoot}.<span class="charliteral">&#39;/&#39;</span>.$pwd;
    <span class="keywordflow">if</span> ($self-&gt;r-&gt;param(<span class="stringliteral">&#39;confirmed&#39;</span>)) {

<span class="preprocessor">        #</span>
<span class="preprocessor"></span><span class="preprocessor">        # If confirmed, go ahead and delete the files</span>
<span class="preprocessor"></span><span class="preprocessor">        #</span>
<span class="preprocessor"></span>        <span class="keywordflow">foreach</span> my $file (@files) {
            <span class="keywordflow">if</span> (defined $self-&gt;checkPWD(<span class="stringliteral">&quot;$pwd/$file&quot;</span>,1)) {
                <span class="keywordflow">if</span> (-d <span class="stringliteral">&quot;$dir/$file&quot;</span> &amp;&amp; !-l <span class="stringliteral">&quot;$dir/$file&quot;</span>) {
                    my $removed = eval {rmtree(<span class="stringliteral">&quot;$dir/$file&quot;</span>,0,1)};
                    <span class="keywordflow">if</span> ($removed) {$self-&gt;addgoodmessage(<span class="stringliteral">&quot;Directory &#39;$file&#39; removed (items deleted: $removed)&quot;</span>)}
                    <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Directory &#39;$file&#39; not removed: $!&quot;</span>)}
                } <span class="keywordflow">else</span> {
                    <span class="keywordflow">if</span> (unlink(<span class="stringliteral">&quot;$dir/$file&quot;</span>)) {$self-&gt;addgoodmessage(<span class="stringliteral">&quot;File &#39;$file&#39; successfully removed&quot;</span>)}
                    <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;File &#39;$file&#39; not removed: $!&quot;</span>)}
                }
            } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Illegal file &#39;$file&#39; specified&quot;</span>); last}
        }
        $self-&gt;Refresh;

    } <span class="keywordflow">else</span> {

<span class="preprocessor">        #</span>
<span class="preprocessor"></span><span class="preprocessor">        #  Look up the files to be deleted, and for directories, add / and the contents of the directory</span>
<span class="preprocessor"></span><span class="preprocessor">        #</span>
<span class="preprocessor"></span>        my @filelist = ();
        <span class="keywordflow">foreach</span> my $file (@files) {
            <span class="keywordflow">if</span> (defined $self-&gt;checkPWD(<span class="stringliteral">&quot;$pwd/$file&quot;</span>,1)) {
                <span class="keywordflow">if</span> (-l <span class="stringliteral">&quot;$dir/$file&quot;</span>) {
                    push(@filelist,<span class="stringliteral">&quot;$file@&quot;</span>);
                } elsif (-d <span class="stringliteral">&quot;$dir/$file&quot;</span>) {
                    my @contents = (); my $dcount = 0;
                    <span class="keywordflow">foreach</span> my $item (readDirectory(<span class="stringliteral">&quot;$dir/$file&quot;</span>)) {
                        next <span class="keywordflow">if</span> $item eq <span class="stringliteral">&quot;.&quot;</span> || $item eq <span class="stringliteral">&quot;..&quot;</span>;
                        <span class="keywordflow">if</span> (-l <span class="stringliteral">&quot;$dir/$file/$item&quot;</span>) {
                            push(@contents, <span class="stringliteral">&quot;$item@&quot;</span>);
                        } elsif (-d <span class="stringliteral">&quot;$dir/$file/$item&quot;</span>) {
                            my $count = scalar(listFilesRecursive(<span class="stringliteral">&quot;$dir/$file/$item&quot;</span>,<span class="stringliteral">&quot;.*&quot;</span>));
                            my $s = ($count == 1 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;s&quot;</span>); $dcount += $count;
                            push (@contents, <span class="stringliteral">&quot;$item/&quot;</span>.CGI::small({style=&gt;<span class="stringliteral">&quot;float:right;margin-right:3em&quot;</span>},CGI::i(<span class="stringliteral">&quot;($count item$s)&quot;</span>)));
                        } <span class="keywordflow">else</span> {
                            push(@contents, $item);
                        }
                        $dcount += 1;
                    }
                    my $s = ($dcount == 1 ? <span class="stringliteral">&quot;&quot;</span>: <span class="stringliteral">&quot;s&quot;</span>);
                    @contents = (@contents[0..10],<span class="stringliteral">&quot;&amp;nbsp; .&quot;</span>,<span class="stringliteral">&quot;&amp;nbsp; .&quot;</span>,<span class="stringliteral">&quot;&amp;nbsp; .&quot;</span>) <span class="keywordflow">if</span> scalar(@contents) &gt; 15;
                    push (@filelist,$file.<span class="stringliteral">&quot;/&quot;</span>.
                                CGI::small({style=&gt;<span class="stringliteral">&quot;float:right;margin-right:4em&quot;</span>},CGI::i(<span class="stringliteral">&quot;($dcount item$s total)&quot;</span>)).
                                CGI::div({style=&gt;<span class="stringliteral">&quot;margin-left:1ex&quot;</span>},join(CGI::br(),@contents)));
                } <span class="keywordflow">else</span> {
                    push(@filelist,$file);
                }
            }
        }

<span class="preprocessor">        #</span>
<span class="preprocessor"></span><span class="preprocessor">        # Put up the confirmation dialog box</span>
<span class="preprocessor"></span><span class="preprocessor">        #</span>
<span class="preprocessor"></span>        print CGI::start_table({border=&gt;1,cellspacing=&gt;2,cellpadding=&gt;20, style=&gt;<span class="stringliteral">&quot;margin: 1em 0 0 5em&quot;</span>});
        print CGI::Tr(
            CGI::td(
              CGI::b(<span class="stringliteral">&quot;Warning:&quot;</span>),<span class="stringliteral">&quot; You have requested that the following items be deleted\n&quot;</span>,
              CGI::ul(CGI::li(\@filelist)),
                ((grep { -d <span class="stringliteral">&quot;$dir/$_&quot;</span> } @files)?
                     CGI::p({style=&gt;<span class="stringliteral">&quot;width:500&quot;</span>},<span class="stringliteral">&quot;Some of these files are directories. &quot;</span>,
                                    <span class="stringliteral">&quot;Only delete directories if you really know what you are doing. &quot;</span>,
                                    <span class="stringliteral">&quot;You can seriously damage your course if you delete the wrong thing.&quot;</span>): <span class="stringliteral">&quot;&quot;</span>),
              CGI::p({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot;There is no undo for deleting files or directories!&quot;</span>),
              CGI::p(<span class="stringliteral">&quot;Really delete the items listed above?&quot;</span>),
              CGI::div({style=&gt;<span class="stringliteral">&quot;float:left; padding-left:3ex&quot;</span>},
                CGI::input({type=&gt;<span class="stringliteral">&quot;submit&quot;</span>,name=&gt;<span class="stringliteral">&quot;action&quot;</span>,value=&gt;<span class="stringliteral">&quot;Cancel&quot;</span>})),
              CGI::div({style=&gt;<span class="stringliteral">&quot;float:right; padding-right:3ex&quot;</span>},
                CGI::input({type=&gt;<span class="stringliteral">&quot;submit&quot;</span>,name=&gt;<span class="stringliteral">&quot;action&quot;</span>,value=&gt;<span class="stringliteral">&quot;Delete&quot;</span>})),
            ),
        );
        print CGI::end_table();

        print CGI::hidden({name=&gt;<span class="stringliteral">&quot;confirmed&quot;</span>,value=&gt;<span class="stringliteral">&quot;Delete&quot;</span>});
        <span class="keywordflow">foreach</span> my $file (@files) {print CGI::hidden({name=&gt;<span class="stringliteral">&quot;files&quot;</span>,value=&gt;$file})}
        $self-&gt;HiddenFlags;
    }
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Make a gzipped tar archive</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac19d8c73908b501a6c04560573d8777d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::directoryListing" ref="ac19d8c73908b501a6c04560573d8777d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::directoryListing </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-directoryListing' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-directoryListing-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-directoryListing-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-directoryListing-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in directoryListing: 30</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ac19d8c73908b501a6c04560573d8777d">directoryListing</a> {
    my $root = shift; my $pwd = shift; my $showdates = shift;
    my $dir = $root.<span class="charliteral">&#39;/&#39;</span>.$pwd;
    my (@values,%labels,$size,$data);

    <span class="keywordflow">return</span> unless -d $dir;
        my $len = 24;
    my @names = sortByName(undef,grep(/^[^.]/,readDirectory($dir)));
    <span class="keywordflow">foreach</span> my $name (@names) {
        unless ($name eq <span class="stringliteral">&#39;DATA&#39;</span>) {   #FIXME don<span class="stringliteral">&#39;t view the DATA directory</span>
<span class="stringliteral">            my $file = &quot;$dir/$name&quot;;</span>
<span class="stringliteral">            push(@values,$name); $labels{$name} = $name;</span>
<span class="stringliteral">            $labels{$name} .= &#39;</span>@<span class="stringliteral">&#39; if (-l $file);</span>
<span class="stringliteral">            $labels{$name} .= &#39;</span>/<span class="stringliteral">&#39; if (-d $file &amp;&amp; !-l $file);</span>
<span class="stringliteral">            $len = length($labels{$name}) if length($labels{$name}) &gt; $len;</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    if ($showdates) {</span>
<span class="stringliteral">        $len += 3;</span>
<span class="stringliteral">        foreach my $name (@values) {</span>
<span class="stringliteral">            my $file = &quot;$dir/$name&quot;;</span>
<span class="stringliteral">            my ($size,$date) = (lstat($file))[7,9];</span>
<span class="stringliteral">            $labels{$name} = sprintf(&quot;%-${len}s%-16s%10s&quot;,$labels{$name},</span>
<span class="stringliteral">                         ((-d $file)? (&quot;&quot;,&quot;&quot;):</span>
<span class="stringliteral">                          (getDate($date),getSize($size))));</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    return (\@values,\%labels);</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4703cfab203a45e8ce0ff71b2fcd27cf"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::directoryMenu" ref="a4703cfab203a45e8ce0ff71b2fcd27cf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::directoryMenu </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-directoryMenu' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-directoryMenu-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-directoryMenu-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-directoryMenu-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in directoryMenu: 20</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a4703cfab203a45e8ce0ff71b2fcd27cf">directoryMenu</a> {
    my $course = shift;
    my $dir  = shift; $dir =~ s!^\.(/|$)!!;
    my @dirs = split(<span class="charliteral">&#39;/&#39;</span>,$dir);
    my $menu = <span class="stringliteral">&quot;&quot;</span>; my $pwd;
    
    my (@values,%labels);
    <span class="keywordflow">while</span> (scalar(@dirs)) {
        $pwd = join(<span class="charliteral">&#39;/&#39;</span>,(@dirs)[0..$#dirs]);
        $dir = pop(@dirs);
        push(@values,$pwd); $labels{$pwd} = $dir;
    }
    push(@values,<span class="charliteral">&#39;.&#39;</span>); $labels{<span class="charliteral">&#39;.&#39;</span>} = $course;
    <span class="keywordflow">return</span> (\@values,\%labels);
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Get the directory listing</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a45ec891c05418f828ac7245979fd4e1a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Download" ref="a45ec891c05418f828ac7245979fd4e1a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Download </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Download' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Download-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Download-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Download-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Download: 17</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a45ec891c05418f828ac7245979fd4e1a">Download</a> {
    my $self = shift;
    my $pwd = $self-&gt;checkPWD($self-&gt;r-&gt;param(<span class="stringliteral">&#39;pwd&#39;</span>) || HOME);
    <span class="keywordflow">return</span> unless $pwd;
    my $filename = $self-&gt;getFile(<span class="stringliteral">&quot;download&quot;</span>); <span class="keywordflow">return</span> unless $filename;
    my $file = $self-&gt;{ce}{courseDirs}{root}.<span class="charliteral">&#39;/&#39;</span>.$pwd.<span class="charliteral">&#39;/&#39;</span>.$filename;

    <span class="keywordflow">if</span> (-d $file) {$self-&gt;addbadmessage(<span class="stringliteral">&quot;You can&#39;t download directories&quot;</span>); <span class="keywordflow">return</span>}
    unless (-f $file) {$self-&gt;addbadmessage(<span class="stringliteral">&quot;You can&#39;t download files of that type&quot;</span>); <span class="keywordflow">return</span>}

    $self-&gt;r-&gt;param(<span class="stringliteral">&#39;download&#39;</span>,$filename);
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Upload a file to the server</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac22fb87a5b5fdb76529339c0d99ce5c6"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::downloadFile" ref="ac22fb87a5b5fdb76529339c0d99ce5c6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::downloadFile </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-downloadFile' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-downloadFile-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-downloadFile-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-downloadFile-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in downloadFile: 21</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ac22fb87a5b5fdb76529339c0d99ce5c6">downloadFile</a> {
    my $self = shift;
    my $file = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a27aee48f2cf3d15528c6994863811217">checkName</a>(shift);
    my $pwd = $self-&gt;checkPWD(shift || $self-&gt;r-&gt;param(<span class="stringliteral">&#39;pwd&#39;</span>) || HOME);
    <span class="keywordflow">return</span> unless $pwd;
    $pwd = $self-&gt;{ce}{courseDirs}{root} . <span class="charliteral">&#39;/&#39;</span> . $pwd;
    unless (-e <span class="stringliteral">&quot;$pwd/$file&quot;</span>) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;The file you are trying to download doesn&#39;t exist&quot;</span>);
        <span class="keywordflow">return</span>;
    }
    unless (-f <span class="stringliteral">&quot;$pwd/$file&quot;</span>) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You can only download regular files.&quot;</span>);
        <span class="keywordflow">return</span>;
    }
    my $type = <span class="stringliteral">&quot;application/octet-stream&quot;</span>;
    $type = <span class="stringliteral">&quot;text/plain&quot;</span> <span class="keywordflow">if</span> $file =~ m/\.(pg|pl|pm|txt|def|csv|lst)/;
    $type = <span class="stringliteral">&quot;image/gif&quot;</span>  <span class="keywordflow">if</span> $file =~ m/\.gif/;
    $type = <span class="stringliteral">&quot;image/jpeg&quot;</span> <span class="keywordflow">if</span> $file =~ m/\.(jpg|jpeg)/;
    $type = <span class="stringliteral">&quot;image/png&quot;</span>  <span class="keywordflow">if</span> $file =~ m/\.png/;
    $self-&gt;reply_with_file($type, <span class="stringliteral">&quot;$pwd/$file&quot;</span>, $file, 0);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad56f4986fe04922717160a2ed30d1534"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Edit" ref="ad56f4986fe04922717160a2ed30d1534" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Edit </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Edit' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Edit-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Edit-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Edit-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Edit: 21</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ad56f4986fe04922717160a2ed30d1534">Edit</a> {
    my $self = shift;
    my $filename = $self-&gt;getFile(<span class="stringliteral">&#39;edit&#39;</span>); <span class="keywordflow">return</span> unless $filename;
    my $file = <span class="stringliteral">&quot;$self-&gt;{courseRoot}/$self-&gt;{pwd}/$filename&quot;</span>;

    <span class="keywordflow">if</span> (-d $file) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You can&#39;t edit a directory&quot;</span>);
        $self-&gt;Refresh; <span class="keywordflow">return</span>;
    }
    unless (-f $file) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You can only edit text files&quot;</span>);
        $self-&gt;Refresh; <span class="keywordflow">return</span>;
    }
    my $data = readFile($file);
    <span class="keywordflow">if</span> (!<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a65e6375b8d4362e6979b97e70872cc59">isText</a>($data)) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;The file does not appear to be a text file&quot;</span>);
        $self-&gt;Refresh; <span class="keywordflow">return</span>;
    }

    $self-&gt;RefreshEdit($data,$filename);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad3be0c25fad5b9fc06c9376fb531c5bf"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::fixSpaces" ref="ad3be0c25fad5b9fc06c9376fb531c5bf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::fixSpaces </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-fixSpaces' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-fixSpaces-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fixSpaces-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fixSpaces-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in fixSpaces: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ad3be0c25fad5b9fc06c9376fb531c5bf">fixSpaces</a> {
    my $s = shift;
    $s =~ s!(&lt;option[^&gt;]*&gt;)(.*?)(&lt;/option&gt;)!$1.<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ab8df856e8810a40f8dab3034c5ba86e5">sp2nbsp</a>($2).$3!gei;
    <span class="keywordflow">return</span> $s;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  Interpret command return errors</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7e8b52e8c6aca48af21ad6eccce5e138"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::getDate" ref="a7e8b52e8c6aca48af21ad6eccce5e138" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::getDate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getDate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getDate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getDate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getDate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getDate: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a7e8b52e8c6aca48af21ad6eccce5e138">getDate</a> {
  my ($sec,$min,$hour,$day,$month,$year) = localtime(shift);
  sprintf(<span class="stringliteral">&quot;%02d-%02d-%04d %02d:%02d&quot;</span>,$month+1,$day,$year+1900,$hour,$min);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a561f264d466a99f5ad18b0b29f28dcca"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::getFile" ref="a561f264d466a99f5ad18b0b29f28dcca" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::getFile </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getFile' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getFile-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getFile-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getFile-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getFile: 31</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a561f264d466a99f5ad18b0b29f28dcca">getFile</a> {
    my $self = shift; my $action = shift;
    my @files = $self-&gt;r-&gt;param(<span class="stringliteral">&quot;files&quot;</span>);
    <span class="keywordflow">if</span> (scalar(@files) &gt; 1) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You can only $action one file at a time.&quot;</span>);
        $self-&gt;Refresh unless $action eq <span class="stringliteral">&#39;download&#39;</span>;
        <span class="keywordflow">return</span>;
    }
    <span class="keywordflow">if</span> (scalar(@files) == 0 || $files[0] eq <span class="stringliteral">&quot;&quot;</span>) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You need to select a file to $action.&quot;</span>);
        $self-&gt;Refresh unless $action eq <span class="stringliteral">&#39;download&#39;</span>;
        <span class="keywordflow">return</span>;
    }
    my $pwd = $self-&gt;checkPWD($self-&gt;{pwd} || $self-&gt;r-&gt;param(<span class="stringliteral">&#39;pwd&#39;</span>) || HOME) || <span class="charliteral">&#39;.&#39;</span>;
    <span class="keywordflow">if</span> ($self-&gt;isSymLink($pwd.<span class="charliteral">&#39;/&#39;</span>.$files[0])) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;That symbolic link takes you outside your course directory&quot;</span>);
        $self-&gt;Refresh unless $action eq <span class="stringliteral">&#39;download&#39;</span>;
        <span class="keywordflow">return</span>;
    }
    unless ($self-&gt;checkPWD($pwd.<span class="charliteral">&#39;/&#39;</span>.$files[0],1)) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You have specified an illegal file&quot;</span>);
        $self-&gt;Refresh unless $action eq <span class="stringliteral">&#39;download&#39;</span>;
        <span class="keywordflow">return</span>;
    }
    <span class="keywordflow">return</span> $files[0];
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Get the entries for the directory menu</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a589550ca6ff711346266db0cde65b70b"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::getFlag" ref="a589550ca6ff711346266db0cde65b70b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::getFlag </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getFlag' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getFlag-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getFlag-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getFlag-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getFlag: 12</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a589550ca6ff711346266db0cde65b70b">getFlag</a> {
  my $self = shift; my $flag = shift;
  my $default = shift; $default = 0 unless defined $default;
  my $value = $self-&gt;r-&gt;param($flag);
  $value = $default unless defined $value;
  <span class="keywordflow">return</span> $value;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Make HTML symbols printable</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab318a419e7248b0593b1e813f762e5ac"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::getSize" ref="ab318a419e7248b0593b1e813f762e5ac" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::getSize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-getSize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-getSize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-getSize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-getSize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in getSize: 14</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ab318a419e7248b0593b1e813f762e5ac">getSize</a> {
  my $size = shift;
  <span class="keywordflow">return</span> $size.<span class="stringliteral">&quot; B &quot;</span>                        <span class="keywordflow">if</span> $size &lt; 1024;
  <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&quot;%.1f KB&quot;</span>,$size/1024)      if $size &lt; 1024*100;
  return sprintf(&quot;%d KB&quot;,<span class="keywordtype">int</span>($size/1024))   if $size &lt; 1024*1024;
  return sprintf(&quot;%.1f MB&quot;,$size/1024/1024) if $size &lt; 1024*1024*100;
  return sprintf(&quot;%d MB&quot;,$size/1024/1024);
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  Check if a file is a symbolic link that we</span>
<span class="preprocessor"></span><span class="preprocessor">#  are not allowed to follow.</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a45c1110a6adef062a00382aa215a6c73"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Go" ref="a45c1110a6adef062a00382aa215a6c73" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Go </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Go' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Go-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Go-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Go-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Go: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a45c1110a6adef062a00382aa215a6c73">Go</a> {
    my $self = shift;
    $self-&gt;{pwd} = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;directory&#39;</span>);
    $self-&gt;Refresh;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a9c150140989da2efaae36d9cdf727167"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::HiddenFlags" ref="a9c150140989da2efaae36d9cdf727167" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::HiddenFlags </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-HiddenFlags' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-HiddenFlags-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-HiddenFlags-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-HiddenFlags-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in HiddenFlags: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a9c150140989da2efaae36d9cdf727167">HiddenFlags</a> {
    my $self = shift;
    print CGI::hidden({name=&gt;<span class="stringliteral">&quot;dates&quot;</span>,     value=&gt;$self-&gt;getFlag(<span class="stringliteral">&#39;dates&#39;</span>)});
    print CGI::hidden({name=&gt;<span class="stringliteral">&quot;overwrite&quot;</span>, value=&gt;$self-&gt;getFlag(<span class="stringliteral">&#39;overwrite&#39;</span>)});
    print CGI::hidden({name=&gt;<span class="stringliteral">&quot;unpack&quot;</span>,    value=&gt;$self-&gt;getFlag(<span class="stringliteral">&#39;unpack&#39;</span>)});
    print CGI::hidden({name=&gt;<span class="stringliteral">&quot;autodelete&quot;</span>,value=&gt;$self-&gt;getFlag(<span class="stringliteral">&#39;autodelete&#39;</span>)});
    print CGI::hidden({name=&gt;<span class="stringliteral">&quot;format&quot;</span>,    value=&gt;$self-&gt;getFlag(<span class="stringliteral">&#39;format&#39;</span>,<span class="stringliteral">&#39;Automatic&#39;</span>)});
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a25bf2e01d88419a4481b30f557da9961"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Init" ref="a25bf2e01d88419a4481b30f557da9961" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Init' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Init-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Init-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Init-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Init: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a25bf2e01d88419a4481b30f557da9961">Init</a> {
    my $self = shift;
    $self-&gt;r-&gt;param(<span class="stringliteral">&#39;unpack&#39;</span>,1);
    $self-&gt;r-&gt;param(<span class="stringliteral">&#39;autodelete&#39;</span>,1);
    $self-&gt;r-&gt;param(<span class="stringliteral">&#39;format&#39;</span>,<span class="stringliteral">&#39;Automatic&#39;</span>);
    $self-&gt;Refresh;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a62756edd5417cd2527c9687fd4fd225a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::isSymLink" ref="a62756edd5417cd2527c9687fd4fd225a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::isSymLink </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-isSymLink' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-isSymLink-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-isSymLink-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-isSymLink-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in isSymLink: 36</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a62756edd5417cd2527c9687fd4fd225a">isSymLink</a> {
    my $self = shift; my $file = shift;
    <span class="keywordflow">return</span> 0 unless -l $file;

    my $courseRoot = $self-&gt;{ce}{courseDirs}{root};
    $courseRoot = readlink($courseRoot) if -l $courseRoot;
    my $pwd = $self-&gt;{pwd} || $self-&gt;r-&gt;param(<span class="stringliteral">&#39;pwd&#39;</span>) || HOME;
    my $link = File::Spec-&gt;rel2abs(readlink($file),<span class="stringliteral">&quot;$courseRoot/$pwd&quot;</span>);
<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Remove /./ and dir/../ constructs</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    $link =~ s!(^|/)(\.(/|$))+!$1!g;
    <span class="keywordflow">while</span> ($link =~ s!((\.[^./]+|\.\.[^/]+|[^./][^/]*)/\.\.(/|$))!!) {};

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Link is OK if it is in the course directory</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> 0 <span class="keywordflow">if</span> substr($link,0,length($courseRoot)) eq $courseRoot;

    <span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">    # Look through the list of valid paths to see if this link is OK</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    my $valid = $self-&gt;{ce}{webworkDirs}{valid_symlinks};
    <span class="keywordflow">if</span> (defined $valid &amp;&amp; $valid) {
        <span class="keywordflow">foreach</span> my $path (@{$valid}) {
            <span class="keywordflow">return</span> 0 <span class="keywordflow">if</span> substr($link,0,length($path)) eq $path;
        }
    }

    return 1;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Normalize the working directory and check if it is OK.</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a65e6375b8d4362e6979b97e70872cc59"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::isText" ref="a65e6375b8d4362e6979b97e70872cc59" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::isText </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-isText' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-isText-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-isText-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-isText-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in isText: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a65e6375b8d4362e6979b97e70872cc59">isText</a> {
    my $string = shift;
    <span class="keywordflow">return</span> $string !~ m/[^\s\x20-\x7E]{4}/;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  Convert spaces to &amp;nbsp;, but only REAL spaces</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="af9ab3050a0fa72c7d167c03746a3d28d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::MakeArchive" ref="af9ab3050a0fa72c7d167c03746a3d28d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::MakeArchive </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-MakeArchive' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-MakeArchive-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-MakeArchive-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-MakeArchive-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in MakeArchive: 26</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#af9ab3050a0fa72c7d167c03746a3d28d">MakeArchive</a> {
    my $self = shift;
    my @files = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;files&#39;</span>);
    <span class="keywordflow">if</span> (scalar(@files) == 0) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You must select at least one file for the archive&quot;</span>);
        $self-&gt;Refresh; <span class="keywordflow">return</span>;
    }

    my $dir = $self-&gt;{courseRoot}.<span class="charliteral">&#39;/&#39;</span>.$self-&gt;{pwd};
    my $archive = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a8076b493b4cc41c94b90392758a0629d">uniqueName</a>($dir,(scalar(@files) == 1)?
                 $files[0].<span class="stringliteral">&quot;.tgz&quot;</span>: $self-&gt;{courseName}.<span class="stringliteral">&quot;.tgz&quot;</span>);
    my $tar = <span class="stringliteral">&quot;cd &quot;</span>.shell_quote($dir).<span class="stringliteral">&quot; &amp;&amp; $self-&gt;{ce}{externalPrograms}{tar} -cvzf &quot;</span>.shell_quote($archive,@files);
    @files = readpipe $tar.<span class="stringliteral">&quot; 2&gt;&amp;1&quot;</span>;
    <span class="keywordflow">if</span> ($? == 0) {
        my $n = scalar(@files); my $s = ($n == 1? <span class="stringliteral">&quot;&quot;</span>: <span class="stringliteral">&quot;s&quot;</span>);
        $self-&gt;addgoodmessage(<span class="stringliteral">&quot;Archive &#39;$archive&#39; created successfully ($n file$s)&quot;</span>);
    } <span class="keywordflow">else</span> {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t create archive &#39;$archive&#39;: command returned &quot;</span>.<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a5111a98b96b3a6adba3eaade2e2e958b">systemError</a>($?));
    }
    $self-&gt;Refresh;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Unpack a gzipped tar archive</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac7820359148cbdb6cf7f542fc5b5b6ef"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::NewFile" ref="ac7820359148cbdb6cf7f542fc5b5b6ef" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::NewFile </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-NewFile' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-NewFile-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-NewFile-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-NewFile-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in NewFile: 22</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ac7820359148cbdb6cf7f542fc5b5b6ef">NewFile</a> {
    my $self = shift;

    <span class="keywordflow">if</span> ($self-&gt;r-&gt;param(<span class="stringliteral">&#39;confirmed&#39;</span>)) {
        my $name = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;name&#39;</span>);
        <span class="keywordflow">if</span> (my $file = $self-&gt;verifyName($name,<span class="stringliteral">&quot;file&quot;</span>)) {
            local (*NEWFILE);
            <span class="keywordflow">if</span> (open(NEWFILE,<span class="stringliteral">&quot;&gt;$file&quot;</span>)) {
                close(NEWFILE);
                $self-&gt;RefreshEdit(<span class="stringliteral">&quot;&quot;</span>,$name);
                <span class="keywordflow">return</span>;
            } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t create file: $!&quot;</span>)}
        }
    }

    $self-&gt;Confirm(<span class="stringliteral">&quot;New file name:&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;New File&quot;</span>);
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Make a new directory</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2eaf47d70000deb118b78b31c08628fa"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::NewFolder" ref="a2eaf47d70000deb118b78b31c08628fa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::NewFolder </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-NewFolder' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-NewFolder-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-NewFolder-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-NewFolder-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in NewFolder: 20</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2eaf47d70000deb118b78b31c08628fa">NewFolder</a> {
    my $self = shift;

    <span class="keywordflow">if</span> ($self-&gt;r-&gt;param(<span class="stringliteral">&#39;confirmed&#39;</span>)) {
        my $name = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;name&#39;</span>);
        <span class="keywordflow">if</span> (my $dir = $self-&gt;verifyName($name,<span class="stringliteral">&quot;directory&quot;</span>)) {
            <span class="keywordflow">if</span> (mkdir $dir, 0750) {
                $self-&gt;{pwd} .= <span class="charliteral">&#39;/&#39;</span>.$name;
                $self-&gt;Refresh; <span class="keywordflow">return</span>;
            } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t create directory: $!&quot;</span>)}
        }
    }

    $self-&gt;Confirm(<span class="stringliteral">&quot;New folder name:&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;New Folder&quot;</span>);
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Download a file</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae77512861f20c96fe0b0085da5ddeb66"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::ParentDir" ref="ae77512861f20c96fe0b0085da5ddeb66" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::ParentDir </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-ParentDir' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-ParentDir-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-ParentDir-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-ParentDir-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in ParentDir: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ae77512861f20c96fe0b0085da5ddeb66">ParentDir</a> {
    my $self = shift;
    $self-&gt;{pwd} = <span class="charliteral">&#39;.&#39;</span> unless ($self-&gt;{pwd} =~ s!/[^/]*$!!);
    $self-&gt;Refresh;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a9c7a23dc4214cf24d6dc8a3cf79083fa"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::pre_header_initialize" ref="a9c7a23dc4214cf24d6dc8a3cf79083fa" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::pre_header_initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-pre_header_initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-pre_header_initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-pre_header_initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-pre_header_initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in pre_header_initialize: 22</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a9c7a23dc4214cf24d6dc8a3cf79083fa">pre_header_initialize</a> {
    my $self = shift;
    my $r = $self-&gt;r;
    my $authz = $r-&gt;authz;
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
<span class="preprocessor">    # we don&#39;t need to return an error here, because body() will print an error for us :)</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;manage_course_files&quot;</span>);
    
    my $action = $r-&gt;param(<span class="stringliteral">&#39;action&#39;</span>);
    $self-&gt;Download <span class="keywordflow">if</span> ($action &amp;&amp; $action eq <span class="stringliteral">&#39;Download&#39;</span>);
    my $file = $r-&gt;param(<span class="stringliteral">&#39;download&#39;</span>);
    $self-&gt;downloadFile($file) <span class="keywordflow">if</span> (defined $file);
    my $ce = $r-&gt;ce;
    my $urlpath = $r-&gt;urlpath;
    my $courseID = $r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
<span class="preprocessor">    # removed archived_course_ prefix -- it is important that path matches the $courseID for consitency with the database dump</span>
<span class="preprocessor"></span>    my $archive_path = $ce-&gt;{webworkDirs}{courses} . <span class="stringliteral">&quot;/$courseID/templates/$courseID.tar.gz&quot;</span>;
    my %options = (courseID =&gt; $courseID, archive_path =&gt; $archive_path, ce=&gt;$ce );
    $self-&gt;{archive_options}= \%options;

}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a86128918a77137ac7f4b6ca48dfde5e5"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Refresh" ref="a86128918a77137ac7f4b6ca48dfde5e5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Refresh </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Refresh' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Refresh-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Refresh-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Refresh-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Refresh: 157</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a86128918a77137ac7f4b6ca48dfde5e5">Refresh</a> {
    my $self = shift;
    my $pwd = shift || $self-&gt;{pwd};
    my $isTop = $pwd eq <span class="charliteral">&#39;.&#39;</span> || $pwd eq <span class="stringliteral">&#39;&#39;</span>;

    my ($dirs,$dirlabels) = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a4703cfab203a45e8ce0ff71b2fcd27cf">directoryMenu</a>($self-&gt;{courseName},$pwd);
    my ($files,$filelabels) = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ac19d8c73908b501a6c04560573d8777d">directoryListing</a>($self-&gt;{courseRoot},$pwd,$self-&gt;getFlag(<span class="stringliteral">&#39;dates&#39;</span>));

    unless ($files) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;The directory you specified doesn&#39;t exist&quot;</span>);
        $files = []; $filelabels = {};
    }

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Some JavaScript to make things easier for the user</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    print CGI::script(&lt;&lt;EOF);
        function doForm(action) {
            var form = window.document.getElementById(<span class="stringliteral">&#39;FileManager&#39;</span>);
            form.formAction.value = action;
            form.submit();
        }
        function disableButton(<span class="keywordtype">id</span>,state) {
            var element = window.document.getElementById(<span class="keywordtype">id</span>);
            element.disabled = state;
        }
        function checkFiles() {
            var files = window.document.getElementById(<span class="stringliteral">&#39;files&#39;</span>);
            var state = files.selectedIndex &lt; 0;
            disableButton(<span class="stringliteral">&#39;View&#39;</span>,state);
            disableButton(<span class="stringliteral">&#39;Edit&#39;</span>,state);
            disableButton(<span class="stringliteral">&#39;Download&#39;</span>,state);
            disableButton(<span class="stringliteral">&#39;Rename&#39;</span>,state);
            disableButton(<span class="stringliteral">&#39;Copy&#39;</span>,state);
            disableButton(<span class="stringliteral">&#39;Delete&#39;</span>,state);
            disableButton(<span class="stringliteral">&#39;MakeArchive&#39;</span>,state);
            checkArchive(files,state);
        }
        function checkFile() {
            var file = window.document.getElementById(<span class="stringliteral">&#39;file&#39;</span>);
            <span class="keywordflow">if</span> (navigator.vendor &amp;&amp; navigator.vendorSub &amp;&amp; navigator.vendor == <span class="stringliteral">&quot;Netscape&quot;</span>) {
              <span class="keywordflow">if</span> (navigator.vendorSub.match(/(\\d+)\.(\\d+)/)) {
                <span class="keywordflow">if</span> (RegExp.\$1 &lt; 7 || (RegExp.\$1 == 7 &amp;&amp; RegExp.\$2 &lt; 2)) <span class="keywordflow">return</span>;
              }
            }
            var state = (file.value == <span class="stringliteral">&quot;&quot;</span>);
            disableButton(<span class="stringliteral">&#39;Upload&#39;</span>,state);
        }
        function checkArchive(files,disabled) {
            var button = document.getElementById(<span class="stringliteral">&#39;MakeArchive&#39;</span>);
            button.value = <span class="stringliteral">&#39;Make Archive&#39;</span>;
            <span class="keywordflow">if</span> (disabled) <span class="keywordflow">return</span>;
            <span class="keywordflow">if</span> (!files.childNodes[files.selectedIndex].value.match(/\\.(tar|tar\\.gz|tgz)\$/)) <span class="keywordflow">return</span>;
            <span class="keywordflow">for</span> (var i = files.selectedIndex+1; i &lt; files.length; i++)
              {<span class="keywordflow">if</span> (files.childNodes[i].selected) <span class="keywordflow">return</span>}
            button.value = <span class="stringliteral">&#39;Unpack Archive&#39;</span>;
        }
EOF

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Start the table</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    print CGI::start_table({border=&gt;0,cellpadding=&gt;0,cellspacing=&gt;3, style=&gt;<span class="stringliteral">&quot;margin:1em 0 0 3em&quot;</span>});

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Directory menu and date/size checkbox</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    print CGI::Tr({},
        CGI::td({colspan=&gt;2},
            CGI::input({type=&gt;<span class="stringliteral">&quot;submit&quot;</span>, name=&gt;<span class="stringliteral">&quot;action&quot;</span>, value =&gt; <span class="stringliteral">&quot;^&quot;</span>, ($isTop? (disabled=&gt;1): ())}),
            CGI::popup_menu(
                -name =&gt; <span class="stringliteral">&quot;directory&quot;</span>,
                -values =&gt; $dirs,
                -labels =&gt; $dirlabels,
                -style =&gt; <span class="stringliteral">&quot;width:25em&quot;</span>,
                -onChange =&gt; <span class="stringliteral">&quot;doForm(&#39;Go&#39;)&quot;</span>
            ),
            CGI::noscript(CGI::input({type=&gt;<span class="stringliteral">&quot;submit&quot;</span>,name=&gt;<span class="stringliteral">&quot;action&quot;</span>,value=&gt;<span class="stringliteral">&quot;Go&quot;</span>}))
        ),
        CGI::td(CGI::small(CGI::checkbox(
            -name =&gt; <span class="stringliteral">&#39;dates&#39;</span>,
            -checked =&gt; $self-&gt;getFlag(<span class="stringliteral">&#39;dates&#39;</span>),
            -value =&gt; 1,
            -label =&gt; <span class="stringliteral">&#39;Show Date &amp; Size&#39;</span>,
            -onClick =&gt; <span class="stringliteral">&#39;doForm(&quot;Refresh&quot;)&#39;</span>,
        ))),
    );

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Directory Listing and column of buttons</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    my %button = (type=&gt;<span class="stringliteral">&quot;submit&quot;</span>,name=&gt;<span class="stringliteral">&quot;action&quot;</span>,style=&gt;<span class="stringliteral">&quot;width:10em&quot;</span>);
    my $width = ($self-&gt;getFlag(<span class="stringliteral">&#39;dates&#39;</span>) &amp;&amp; scalar(@{$files}) &gt; 0) ? <span class="stringliteral">&quot;&quot;</span>: <span class="stringliteral">&quot; width:30em&quot;</span>;
    print CGI::Tr({valign=&gt;<span class="stringliteral">&quot;middle&quot;</span>},
        <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ad3be0c25fad5b9fc06c9376fb531c5bf">fixSpaces</a>(CGI::td(CGI::scrolling_list(
            -name =&gt; <span class="stringliteral">&quot;files&quot;</span>, <span class="keywordtype">id</span> =&gt; <span class="stringliteral">&quot;files&quot;</span>,
            -style =&gt; <span class="stringliteral">&quot;font-family:monospace; $width&quot;</span>,
            -size =&gt; 17,
            -multiple =&gt; 1,
            -values =&gt; $files,
            -labels =&gt; $filelabels,
            -onDblClick =&gt; <span class="stringliteral">&quot;doForm(&#39;View&#39;)&quot;</span>,
            -onChange =&gt; <span class="stringliteral">&quot;checkFiles()&quot;</span>
        ))),
        CGI::td({width=&gt;15}),
        CGI::td({},
            CGI::start_table({border=&gt;0,cellpadding=&gt;0,cellspacing=&gt;3}),
            CGI::Tr([
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;View&quot;</span>,<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;View&quot;</span>})),
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;Edit&quot;</span>,<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;Edit&quot;</span>})),
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;Download&quot;</span>,<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;Download&quot;</span>})),
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;Rename&quot;</span>,<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;Rename&quot;</span>})),
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;Copy&quot;</span>,<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;Copy&quot;</span>})),
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;Delete&quot;</span>,<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;Delete&quot;</span>})),
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;Make Archive&quot;</span>,<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;MakeArchive&quot;</span>})),
                CGI::td({height=&gt;10}),
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;New File&quot;</span>})),
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;New Folder&quot;</span>})),
                CGI::td(CGI::input({%button,value=&gt;<span class="stringliteral">&quot;Refresh&quot;</span>})),
            ]),
            CGI::end_table(),
        ),
    );

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Upload button and checkboxes</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    print CGI::Tr([
        CGI::td(),
        CGI::td({colspan=&gt;3},
          CGI::input({type=&gt;<span class="stringliteral">&quot;submit&quot;</span>,name=&gt;<span class="stringliteral">&quot;action&quot;</span>,style=&gt;<span class="stringliteral">&quot;width:7em&quot;</span>,value=&gt;<span class="stringliteral">&quot;Upload:&quot;</span>,<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;Upload&quot;</span>}),
          CGI::input({type=&gt;<span class="stringliteral">&quot;file&quot;</span>,name=&gt;<span class="stringliteral">&quot;file&quot;</span>,<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;file&quot;</span>,size=&gt;40,onChange=&gt;<span class="stringliteral">&quot;checkFile()&quot;</span>}),
          CGI::br(),
          CGI::small(join(<span class="stringliteral">&#39; &amp;nbsp; &#39;</span>,<span class="stringliteral">&quot;Format:&quot;</span>,
            CGI::radio_group(-name=&gt;<span class="stringliteral">&#39;format&#39;</span>, -value=&gt;[<span class="stringliteral">&#39;Text&#39;</span>,<span class="stringliteral">&#39;Binary&#39;</span>,<span class="stringliteral">&#39;Automatic&#39;</span>],
                     -<span class="keywordflow">default</span>=&gt;$self-&gt;getFlag(<span class="stringliteral">&#39;format&#39;</span>,<span class="stringliteral">&#39;Automatic&#39;</span>)))),
        ),
    ]);
    print CGI::Tr([
        CGI::td(),
        CGI::td({colspan=&gt;3},
          CGI::small(CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;overwrite&#39;</span>,-checked=&gt;$self-&gt;getFlag(<span class="stringliteral">&#39;overwrite&#39;</span>),-value=&gt;1,
                       -label=&gt;<span class="stringliteral">&#39;Overwrite existing files silently&#39;</span>)),
          CGI::br(),
          CGI::small(CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;unpack&#39;</span>,-checked=&gt;$self-&gt;getFlag(<span class="stringliteral">&#39;unpack&#39;</span>),-value=&gt;1,
                       -label=&gt;<span class="stringliteral">&#39;Unpack archives automatically&#39;</span>)),
          CGI::small(CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;autodelete&#39;</span>,-checked=&gt;$self-&gt;getFlag(<span class="stringliteral">&#39;autodelete&#39;</span>),-value=&gt;1,
                       -label=&gt;<span class="stringliteral">&#39;then delete them&#39;</span>)),
        ),
    ]);

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # End the table</span>
<span class="preprocessor"></span><span class="preprocessor">    # </span>
<span class="preprocessor"></span>    print CGI::end_table();
    print CGI::script(<span class="stringliteral">&quot;checkFiles(); checkFile();&quot;</span>);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a5e6591d404bdb35bebc62065038100ed"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::RefreshEdit" ref="a5e6591d404bdb35bebc62065038100ed" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::RefreshEdit </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-RefreshEdit' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-RefreshEdit-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-RefreshEdit-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-RefreshEdit-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in RefreshEdit: 29</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a5e6591d404bdb35bebc62065038100ed">RefreshEdit</a> {
    my $self = shift; my $data = shift; my $file = shift;
    my $pwd = shift || $self-&gt;{pwd};
    my $name = <span class="stringliteral">&quot;$pwd/$file&quot;</span>; $name =~ s!^\./?!!;

    my %button = (type=&gt;<span class="stringliteral">&quot;submit&quot;</span>,name=&gt;<span class="stringliteral">&quot;action&quot;</span>,style=&gt;<span class="stringliteral">&quot;width:6em&quot;</span>);
    print CGI::p();
    print CGI::start_table({border=&gt;0,cellspacing=&gt;0,cellpadding=&gt;2, width=&gt;<span class="stringliteral">&quot;95%&quot;</span>, align=&gt;<span class="stringliteral">&quot;center&quot;</span>});
    print CGI::Tr([
        CGI::td({align=&gt;<span class="stringliteral">&quot;center&quot;</span>,style=&gt;<span class="stringliteral">&quot;background-color:#CCCCCC&quot;</span>},CGI::b($name)),
        CGI::td(CGI::textarea(-name=&gt;<span class="stringliteral">&quot;data&quot;</span>,-<span class="keywordflow">default</span>=&gt;$data,-<span class="keyword">override</span>=&gt;1,-rows=&gt;30,-columns=&gt;80,
                -style=&gt;<span class="stringliteral">&quot;width:100%&quot;</span>)), ## can<span class="stringliteral">&#39;t seem to get variable height to work</span>
<span class="stringliteral">        CGI::td({align=&gt;&quot;center&quot;, nowrap=&gt;1},</span>
<span class="stringliteral">            CGI::input({%button,value=&gt;&quot;Cancel&quot;}),&quot;&amp;nbsp;&quot;,</span>
<span class="stringliteral">            CGI::input({%button,value=&gt;&quot;Revert&quot;}),&quot;&amp;nbsp;&quot;,</span>
<span class="stringliteral">            CGI::input({%button,value=&gt;&quot;Save&quot;}),,&quot;&amp;nbsp;&quot;,</span>
<span class="stringliteral">            CGI::input({%button,value=&gt;&quot;Save As:&quot;}),</span>
<span class="stringliteral">            CGI::input({type=&gt;&quot;text&quot;,name=&gt;&quot;name&quot;,size=&gt;20,style=&gt;&quot;width:50%&quot;}),</span>
<span class="stringliteral">        ),</span>
<span class="stringliteral">    ]);</span>
<span class="stringliteral">    print CGI::end_table();</span>
<span class="stringliteral">    print CGI::hidden({name=&gt;&quot;files&quot;, value=&gt;$file});</span>
<span class="stringliteral">    $self-&gt;HiddenFlags;</span>
<span class="stringliteral">}</span>
<span class="stringliteral"></span>
<span class="stringliteral">##################################################</span>
<span class="stringliteral">#</span>
<span class="stringliteral"># Copy a file</span>
<span class="stringliteral">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad081b641c8e29a1af9eaf66c6ebea00c"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Rename" ref="ad081b641c8e29a1af9eaf66c6ebea00c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Rename </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Rename' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Rename-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Rename-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Rename-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Rename: 24</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ad081b641c8e29a1af9eaf66c6ebea00c">Rename</a> {
    my $self = shift;
        my $dir = <span class="stringliteral">&quot;$self-&gt;{courseRoot}/$self-&gt;{pwd}&quot;</span>;
    my $original = $self-&gt;getFile(<span class="stringliteral">&#39;rename&#39;</span>); <span class="keywordflow">return</span> unless $original;
    my $oldfile = <span class="stringliteral">&quot;$dir/$original&quot;</span>;

    <span class="keywordflow">if</span> ($self-&gt;r-&gt;param(<span class="stringliteral">&#39;confirmed&#39;</span>)) {
        my $newfile = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;name&#39;</span>);
        <span class="keywordflow">if</span> ($newfile = $self-&gt;verifyPath($newfile,$original)) {
            <span class="keywordflow">if</span> (rename $oldfile, $newfile) {
                $self-&gt;addgoodmessage(<span class="stringliteral">&quot;File successfully renamed&quot;</span>);
                $self-&gt;Refresh; <span class="keywordflow">return</span>;
            } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t rename file: $!&quot;</span>)}
        }
    }

    $self-&gt;Confirm(<span class="stringliteral">&quot;Rename file as:&quot;</span>,<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a8076b493b4cc41c94b90392758a0629d">uniqueName</a>($dir,$original),<span class="stringliteral">&quot;Rename&quot;</span>);
    print CGI::hidden({name=&gt;<span class="stringliteral">&quot;files&quot;</span>,value=&gt;$original});
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Delete a file</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2835bdd24478b0161aa2948411a7841a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Save" ref="a2835bdd24478b0161aa2948411a7841a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::Save </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Save' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Save-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Save-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Save-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Save: 26</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2835bdd24478b0161aa2948411a7841a">Save</a> {
    my $self = shift; my $filename = shift;
    my $pwd = $self-&gt;{pwd};
    <span class="keywordflow">if</span> ($filename) {
        $pwd = substr($filename,length($self-&gt;{courseRoot})+1);
        $pwd =~ s!(/|^)([^/]*)$!!; $filename = $2;
                $pwd = <span class="charliteral">&#39;.&#39;</span> <span class="keywordflow">if</span> $pwd eq <span class="stringliteral">&#39;&#39;</span>;
    } <span class="keywordflow">else</span> {
        $filename = $self-&gt;getFile(<span class="stringliteral">&quot;save&quot;</span>); <span class="keywordflow">return</span> unless $filename;
    }
    my $file = <span class="stringliteral">&quot;$self-&gt;{courseRoot}/$pwd/$filename&quot;</span>;
    my $data = $self-&gt;r-&gt;param(<span class="stringliteral">&quot;data&quot;</span>);

    <span class="keywordflow">if</span> (defined($data)) {
        $data =~ s/\<a class="code" href="classWeBWorK_1_1ContentGenerator.html#afc1106db125a42082cafaf10746a947b">r</a>\n?/\n/g;  # convert DOS and Mac line ends to unix
        local (*OUTFILE);
        <span class="keywordflow">if</span> (open(OUTFILE,<span class="stringliteral">&quot;&gt;$file&quot;</span>)) {
            eval {print OUTFILE $data; close(OUTFILE)};
            <span class="keywordflow">if</span> ($@) {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Failed to save: $@&quot;</span>)}
               <span class="keywordflow">else</span> {$self-&gt;addgoodmessage(<span class="stringliteral">&quot;File saved&quot;</span>)}
        } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t write to file: $!&quot;</span>)}
    } <span class="keywordflow">else</span> {$data = <span class="stringliteral">&quot;&quot;</span>; $self-&gt;addbadmessage(<span class="stringliteral">&quot;Error: no file data was submitted!&quot;</span>)}

    $self-&gt;{pwd} = $pwd;
    $self-&gt;RefreshEdit($data,$filename);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab2d5775fa15698e40275989db79b4d2a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::SaveAs" ref="ab2d5775fa15698e40275989db79b4d2a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::SaveAs </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-SaveAs' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-SaveAs-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-SaveAs-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-SaveAs-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in SaveAs: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ab2d5775fa15698e40275989db79b4d2a">SaveAs</a> {
    my $self = shift;

    my $newfile = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;name&#39;</span>);
    my $original = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;files&#39;</span>);
    $newfile = $self-&gt;verifyPath($newfile,$original);
    <span class="keywordflow">if</span> ($newfile) {$self-&gt;Save($newfile); <span class="keywordflow">return</span>}
    $self-&gt;RefreshEdit($self-&gt;r-&gt;param(<span class="stringliteral">&#39;data&#39;</span>),$original);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2251231449a4929825b845bd6822f8ca"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::showHTML" ref="a2251231449a4929825b845bd6822f8ca" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::showHTML </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-showHTML' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-showHTML-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-showHTML-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-showHTML-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in showHTML: 15</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2251231449a4929825b845bd6822f8ca">showHTML</a> {
    my $string = shift;
    <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span> unless defined $string;
    $string =~ s/&amp;/\&amp;amp;/g;
    $string =~ s/&lt;/\&amp;lt;/g;
    $string =~ s/&gt;/\&amp;gt;/g;
    $string;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Check if a string is plain text</span>
<span class="preprocessor"></span><span class="preprocessor"># (i.e., doesn&#39;t contain four non-regular</span>
<span class="preprocessor"></span><span class="preprocessor"># characters in a row.)</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab8df856e8810a40f8dab3034c5ba86e5"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::sp2nbsp" ref="ab8df856e8810a40f8dab3034c5ba86e5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::sp2nbsp </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-sp2nbsp' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-sp2nbsp-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-sp2nbsp-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-sp2nbsp-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in sp2nbsp: 16</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ab8df856e8810a40f8dab3034c5ba86e5">sp2nbsp</a> {
    my $s = shift;
    $s =~ s/ /\&amp;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#a0b04a9c84777c525b5d1a7683331f7ee">nbsp</a>;/g;
    <span class="keywordflow">return</span> $s;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  Hack to convert multiple spaces in the file</span>
<span class="preprocessor"></span><span class="preprocessor">#  selection box into &amp;nbsp; so that the columns</span>
<span class="preprocessor"></span><span class="preprocessor">#  will allign properly in fixed-width fonts.</span>
<span class="preprocessor"></span><span class="preprocessor">#  We have to do it agter the fact, since CGI::</span>
<span class="preprocessor"></span><span class="preprocessor">#  is being &quot;helpful&quot; by turning &amp; in the labels</span>
<span class="preprocessor"></span><span class="preprocessor">#  into &amp;amp; for us.  So we have to convert</span>
<span class="preprocessor"></span><span class="preprocessor">#  after the &lt;SELECT&gt; is created (ugh).</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
<p>Reimplemented from <a class="el" href="classWeBWorK_1_1ContentGenerator.html#a686ea25ccbd95b76241ce0a4f28fc14d">WeBWorK::ContentGenerator</a>.</p>

</div>
</div>
<a class="anchor" id="a5111a98b96b3a6adba3eaade2e2e958b"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::systemError" ref="a5111a98b96b3a6adba3eaade2e2e958b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::systemError </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-systemError' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-systemError-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-systemError-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-systemError-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in systemError: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a5111a98b96b3a6adba3eaade2e2e958b">systemError</a> {
  my $status = shift;
  <span class="keywordflow">return</span> <span class="stringliteral">&quot;error: $!&quot;</span> <span class="keywordflow">if</span> $status == 0xFF00;
  <span class="keywordflow">return</span> <span class="stringliteral">&quot;exit status &quot;</span>.($status &gt;&gt; 8) <span class="keywordflow">if</span> ($status &amp; 0xFF) == 0;
  <span class="keywordflow">return</span> <span class="stringliteral">&quot;signal &quot;</span>.($status &amp;= ~0x80);
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span>
1;
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a8076b493b4cc41c94b90392758a0629d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::uniqueName" ref="a8076b493b4cc41c94b90392758a0629d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::uniqueName </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-uniqueName' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-uniqueName-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-uniqueName-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-uniqueName-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in uniqueName: 15</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a8076b493b4cc41c94b90392758a0629d">uniqueName</a> {
    my $dir = shift; my $name = shift;
    <span class="keywordflow">return</span> $name unless (-e <span class="stringliteral">&quot;$dir/$name&quot;</span>);
    my $type = <span class="stringliteral">&quot;&quot;</span>; my $n = 1;
    $type = $1 <span class="keywordflow">if</span> ($name =~ s/(\.[^.]*)$<span class="comment">//);</span>
    $n = $1 <span class="keywordflow">if</span> ($name =~ s/_(\d+)$/_/);
    <span class="keywordflow">while</span> (-e <span class="stringliteral">&quot;$dir/${name}_$n$type&quot;</span>) {$n++}
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;${name}_$n$type&quot;</span>;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Verify that a name can be added to the current</span>
<span class="preprocessor"></span><span class="preprocessor"># directory.</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4db9467d0d65d98b8812e4e63b809416"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::unpack" ref="a4db9467d0d65d98b8812e4e63b809416" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::unpack </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-unpack' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-unpack-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-unpack-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-unpack-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in unpack: 20</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a4db9467d0d65d98b8812e4e63b809416">unpack</a> {
    my $self = shift;
    my $archive = shift; my $z = <span class="charliteral">&#39;z&#39;</span>; $z = <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">if</span> $archive =~ m/\.tar$/;
    my $dir = $self-&gt;{courseRoot}.<span class="charliteral">&#39;/&#39;</span>.$self-&gt;{pwd};
    my $tar = <span class="stringliteral">&quot;cd &quot;</span>.shell_quote($dir).<span class="stringliteral">&quot; &amp;&amp; $self-&gt;{ce}{externalPrograms}{tar} -vx${z}f &quot;</span>.shell_quote($archive);
    my @files = readpipe $tar.<span class="stringliteral">&quot; 2&gt;&amp;1&quot;</span>;
    <span class="keywordflow">if</span> ($? == 0) {
        my $n = scalar(@files); my $s = ($n == 1? <span class="stringliteral">&quot;&quot;</span>: <span class="stringliteral">&quot;s&quot;</span>);
        $self-&gt;addgoodmessage(<span class="stringliteral">&quot;$n file$s unpacked successfully&quot;</span>);
        <span class="keywordflow">return</span> 1;
    } <span class="keywordflow">else</span> {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t unpack &#39;$archive&#39;: command returned &quot;</span>.<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a5111a98b96b3a6adba3eaade2e2e958b">systemError</a>($?));
        <span class="keywordflow">return</span> 0;
    }
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Make a new file and edit it</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a8ab26fae2698aca8e7760f09cd74ab8e"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::UnpackArchive" ref="a8ab26fae2698aca8e7760f09cd74ab8e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::UnpackArchive </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-UnpackArchive' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-UnpackArchive-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-UnpackArchive-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-UnpackArchive-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in UnpackArchive: 11</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a8ab26fae2698aca8e7760f09cd74ab8e">UnpackArchive</a> {
    my $self = shift;
    my $archive = $self-&gt;getFile(<span class="stringliteral">&quot;unpack&quot;</span>); <span class="keywordflow">return</span> unless $archive;
    <span class="keywordflow">if</span> ($archive !~ m/\.(tar|tar\.gz|tgz)$/) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You can only unpack files ending in &#39;.tgz&#39;, &#39;.tar&#39; or &#39;.tar.gz&#39;&quot;</span>);
    } <span class="keywordflow">else</span> {
        $self-&gt;unpack($archive);
    }
    $self-&gt;Refresh;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2741651eb51075d60b3c201013a7179e"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::Upload" ref="a2741651eb51075d60b3c201013a7179e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method <a class="el" href="classWeBWorK_1_1Upload.html">WeBWorK::ContentGenerator::Instructor::FileManager::Upload</a> </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-Upload' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-Upload-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-Upload-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-Upload-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in Upload: 74</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2741651eb51075d60b3c201013a7179e">Upload</a> {
    my $self = shift;
    my $dir = <span class="stringliteral">&quot;$self-&gt;{courseRoot}/$self-&gt;{pwd}&quot;</span>;
    my $fileIDhash = $self-&gt;r-&gt;param(<span class="stringliteral">&#39;file&#39;</span>);
    unless ($fileIDhash) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You have not chosen a file to upload.&quot;</span>);
        $self-&gt;Refresh;
        <span class="keywordflow">return</span>;
    }

    my ($id,$hash) = split(/\s+/,$fileIDhash);
    my $upload = <a class="code" href="classWeBWorK_1_1Upload.html">WeBWorK::Upload</a>-&gt;retrieve($id,$hash,dir=&gt;$self-&gt;{ce}{webworkDirs}{uploadCache});

    my $name = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a27aee48f2cf3d15528c6994863811217">checkName</a>($upload-&gt;filename);
    my $action = $self-&gt;r-&gt;param(<span class="stringliteral">&quot;formAction&quot;</span>) || <span class="stringliteral">&quot;Cancel&quot;</span>;
    <span class="keywordflow">if</span> ($self-&gt;r-&gt;param(<span class="stringliteral">&quot;confirmed&quot;</span>)) {
        <span class="keywordflow">if</span> ($action eq <span class="stringliteral">&quot;Cancel&quot;</span>) {
            $upload-&gt;dispose;
            $self-&gt;Refresh;
            <span class="keywordflow">return</span>;
        }
        $name = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a27aee48f2cf3d15528c6994863811217">checkName</a>($self-&gt;r-&gt;param(<span class="stringliteral">&#39;name&#39;</span>)) <span class="keywordflow">if</span> ($action eq <span class="stringliteral">&quot;Rename&quot;</span>);
    }

    <span class="keywordflow">if</span> (-e <span class="stringliteral">&quot;$dir/$name&quot;</span>) {
        unless ($self-&gt;r-&gt;param(<span class="stringliteral">&#39;overwrite&#39;</span>) || $action eq <span class="stringliteral">&quot;Overwrite&quot;</span>) {
            $self-&gt;Confirm(<span class="stringliteral">&quot;File &quot;</span>.CGI::b($name).<span class="stringliteral">&quot; already exists. Overwrite it, or rename it as:&quot;</span>.
                       CGI::p(),<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a8076b493b4cc41c94b90392758a0629d">uniqueName</a>($dir,$name),<span class="stringliteral">&quot;Rename&quot;</span>,<span class="stringliteral">&quot;Overwrite&quot;</span>);
            print CGI::hidden({name=&gt;<span class="stringliteral">&quot;action&quot;</span>,value=&gt;<span class="stringliteral">&quot;Upload&quot;</span>});
            print CGI::hidden({name=&gt;<span class="stringliteral">&quot;file&quot;</span>,value=&gt;$fileIDhash});
            <span class="keywordflow">return</span>;
        }
    }
    $self-&gt;checkFileLocation($name,$self-&gt;{pwd});

    my $file = <span class="stringliteral">&quot;$dir/$name&quot;</span>;
    my $type = $self-&gt;getFlag(<span class="stringliteral">&#39;format&#39;</span>,<span class="stringliteral">&#39;Automatic&#39;</span>);
    my $data;
    
<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    #  Check if we need to convert linebreaks</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($type ne <span class="stringliteral">&#39;Binary&#39;</span>) {
        my $fh = $upload-&gt;fileHandle;
        my @lines = &lt;$fh&gt;; $data = join(<span class="stringliteral">&#39;&#39;</span>,@lines);
        <span class="keywordflow">if</span> ($type eq <span class="stringliteral">&#39;Automatic&#39;</span>) {$type = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a65e6375b8d4362e6979b97e70872cc59">isText</a>($data) ? <span class="stringliteral">&#39;Text&#39;</span> : <span class="stringliteral">&#39;Binary&#39;</span>}
    }
    <span class="keywordflow">if</span> ($type eq <span class="stringliteral">&#39;Text&#39;</span>) {
        $upload-&gt;dispose;
        $data =~ s/\<a class="code" href="classWeBWorK_1_1ContentGenerator.html#afc1106db125a42082cafaf10746a947b">r</a>\n?/\n/g;
        <span class="keywordflow">if</span> (open(UPLOAD,<span class="stringliteral">&quot;&gt;$file&quot;</span>)) {print UPLOAD $data; close(UPLOAD)}
          <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t create file &#39;$name&#39;: $!&quot;</span>)}
    } <span class="keywordflow">else</span> {
        $upload-&gt;disposeTo($file);
    }

    <span class="keywordflow">if</span> (-e $file) {
      $self-&gt;addgoodmessage(<span class="stringliteral">&quot;$type file &#39;$name&#39; uploaded successfully&quot;</span>);
      <span class="keywordflow">if</span> ($name =~ m/\.(tar|tar\.gz|tgz)$/ &amp;&amp; $self-&gt;getFlag(<span class="stringliteral">&#39;unpack&#39;</span>)) {
        <span class="keywordflow">if</span> ($self-&gt;unpack($name) &amp;&amp; $self-&gt;getFlag(<span class="stringliteral">&#39;autodelete&#39;</span>)) {
          <span class="keywordflow">if</span> (unlink($file)) {$self-&gt;addgoodmessage(<span class="stringliteral">&quot;Archive &#39;$name&#39; deleted&quot;</span>)}
            <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t delete archive &#39;$name&#39;: $!&quot;</span>)}
        }
      }
    }

    $self-&gt;Refresh;
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Print a confirmation dialog box</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2c2af82ff4c67d42841d94a0ec8f6f17"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::verifyName" ref="a2c2af82ff4c67d42841d94a0ec8f6f17" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::verifyName </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-verifyName' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-verifyName-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-verifyName-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-verifyName-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in verifyName: 20</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2c2af82ff4c67d42841d94a0ec8f6f17">verifyName</a> {
    my $self = shift; my $name = shift; my $object = shift;
    <span class="keywordflow">if</span> ($name) {
        unless ($name =~ m!/!) {
            unless ($name =~ m!^\.!) {
                unless ($name =~ m![^-_.a-zA-Z0-9 ]!) {
                    my $file = <span class="stringliteral">&quot;$self-&gt;{courseRoot}/$self-&gt;{pwd}/$name&quot;</span>;
                    <span class="keywordflow">return</span> $file unless (-e $file);
                    $self-&gt;addbadmessage(<span class="stringliteral">&quot;A file with that name already exists&quot;</span>);
                } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Your $object name contains illegal characters&quot;</span>)}
            } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Your $object name may not begin with a dot&quot;</span>)}
        } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Your $object name may not contain a path component&quot;</span>)}
    } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;You must specify a $object name&quot;</span>)}
    <span class="keywordflow">return</span>
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Verify that a file path is valid</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4976b50963677e1a408d35f671260b7a"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::verifyPath" ref="a4976b50963677e1a408d35f671260b7a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::verifyPath </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-verifyPath' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-verifyPath-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-verifyPath-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-verifyPath-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in verifyPath: 23</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a4976b50963677e1a408d35f671260b7a">verifyPath</a> {
    my $self = shift; my $path = shift; my $name = shift;

    <span class="keywordflow">if</span> ($path) {
        unless ($path =~ m![^-_.a-zA-Z0-9 /]!) {
            unless ($path =~ m!^/!) {
                $path = $self-&gt;checkPWD($self-&gt;{pwd}.<span class="charliteral">&#39;/&#39;</span>.$path,1);
                <span class="keywordflow">if</span> ($path) {
                    $path = $self-&gt;{courseRoot}.<span class="charliteral">&#39;/&#39;</span>.$path;
                    $path .= <span class="charliteral">&#39;/&#39;</span>.$name <span class="keywordflow">if</span> -d $path &amp;&amp; $name;
                    <span class="keywordflow">return</span> $path unless (-e $path);
                    $self-&gt;addbadmessage(<span class="stringliteral">&quot;A file with that name already exists&quot;</span>);
                } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;You have specified an illegal path&quot;</span>)}
            } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;You can not specify an absolute path&quot;</span>)}
        } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;Your file name contains illegal characters&quot;</span>)}
    } <span class="keywordflow">else</span> {$self-&gt;addbadmessage(<span class="stringliteral">&quot;You must specify a file name&quot;</span>)}
    <span class="keywordflow">return</span>
}

<span class="preprocessor">##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Get the value of a parameter flag</span>
<span class="preprocessor">#</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac29883ee8f6fa0fa38b4d875e6a85b8e"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::FileManager::View" ref="ac29883ee8f6fa0fa38b4d875e6a85b8e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::FileManager::View </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-View' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-View-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-View-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-View-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in View: 53</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#ac29883ee8f6fa0fa38b4d875e6a85b8e">View</a> {
    my $self = shift; my $pwd = $self-&gt;{pwd};
    my $r = $self-&gt;r;
    my $filename = $self-&gt;getFile(<span class="stringliteral">&quot;view&quot;</span>); <span class="keywordflow">return</span> unless $filename;
    my $name = <span class="stringliteral">&quot;$pwd/$filename&quot;</span>; $name =~ s!^\./?!!;
    my $file = <span class="stringliteral">&quot;$self-&gt;{courseRoot}/$pwd/$filename&quot;</span>;

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Don&#39;t follow symbolic links</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($self-&gt;isSymLink($file)) {
      $self-&gt;addbadmessage(<span class="stringliteral">&quot;That symbolic link takes you outside your course directory&quot;</span>);
      $self-&gt;Refresh; <span class="keywordflow">return</span>;
    }

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Handle directories by making them the working directory</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (-d $file) {
        $self-&gt;{pwd} .= <span class="charliteral">&#39;/&#39;</span>.$filename;
        $self-&gt;Refresh; <span class="keywordflow">return</span>;
    }

    unless (-f $file) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;You can&#39;t view files of that type&quot;</span>);
        $self-&gt;Refresh; <span class="keywordflow">return</span>;
    }

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Include a download link</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    my $urlpath = $self-&gt;r-&gt;urlpath;
    my $fileManagerPage = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, courseID =&gt; $self-&gt;{courseName});
    my $fileManagerURL  = $self-&gt;systemLink($fileManagerPage, params =&gt; {download =&gt; $filename, pwd =&gt; $pwd});
    print CGI::div({style=&gt;<span class="stringliteral">&quot;float:right&quot;</span>},
         CGI::a({href=&gt;$fileManagerURL},<span class="stringliteral">&quot;Download&quot;</span>));
    print CGI::p(),CGI::b($name),CGI::p();
    print CGI::hr();

<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # For files, display the file, if possible.</span>
<span class="preprocessor"></span><span class="preprocessor">    # If the file is an image, display it as an image.</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    my $data = readFile($file);
    <span class="keywordflow">if</span> (<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a65e6375b8d4362e6979b97e70872cc59">isText</a>($data)) {
        print CGI::pre(<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1FileManager.html#a2251231449a4929825b845bd6822f8ca">showHTML</a>($data));
    } elsif ($file =~ m/\.(gif|jpg|png)/i) {
        print CGI::img({src=&gt;$fileManagerURL, border=&gt;0});
    } <span class="keywordflow">else</span> {
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
            <span class="stringliteral">&quot;The file does not appear to be a text file.&quot;</span>);
    }
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="FileManager_8pm_source.html">FileManager.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:57:29 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
