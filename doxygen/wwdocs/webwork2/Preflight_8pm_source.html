<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: Preflight.pm Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>Preflight.pm</h1><a href="Preflight_8pm.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">################################################################################</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor"># WeBWorK Online Homework Delivery System</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor"># Copyright © 2000-2007 The WeBWorK Project, http://openwebwork.sf.net/</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor"># $CVSHeader: webwork2/lib/WeBWorK/ContentGenerator/Instructor/Preflight.pm,v 1.8 2006/09/25 22:14:53 sh002i Exp $</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span><span class="preprocessor"># </span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor"># This program is free software; you can redistribute it and/or modify it under</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span><span class="preprocessor"># the terms of either: (a) the GNU General Public License as published by the</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor"># Free Software Foundation; either version 2, or (at your option) any later</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor"># version, or (b) the &quot;Artistic License&quot; which comes with this package.</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor"># </span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor"># This program is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="preprocessor"># ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor"># FOR A PARTICULAR PURPOSE.  See either the GNU General Public License or the</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor"># Artistic License for more details.</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">################################################################################</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span>
<a name="l00017"></a>00017 <span class="keyword">package </span>WeBWorK::ContentGenerator::Instructor::Preflight;
<a name="l00018"></a><a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Preflight.html">00018</a> use base qw(<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html">WeBWorK::ContentGenerator::Instructor</a>);
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 =head1 NAME
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Preflight.html">WeBWorK::ContentGenerator::Instructor::Preflight</a>.pm  -- display past answers of many students
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 =cut
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 use strict;
<a name="l00027"></a>00027 use warnings;
<a name="l00028"></a>00028 use <a class="code" href="classWeBWorK_1_1CGI.html">CGI</a> qw(-nosticky );
<a name="l00029"></a>00029 use WeBWorK::HTML::OptionList qw/optionList/;
<a name="l00030"></a>00030 use WeBWorK::HTML::ScrollingRecordList qw/scrollingRecordList/;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 sub initialize {
<a name="l00033"></a>00033     my $self       = shift;
<a name="l00034"></a>00034     my $r          = $self-&gt;r;
<a name="l00035"></a>00035     my $urlpath    = $r-&gt;urlpath;
<a name="l00036"></a>00036     my $db         = $r-&gt;db;
<a name="l00037"></a>00037     my $ce         = $r-&gt;ce;
<a name="l00038"></a>00038     my $authz      = $r-&gt;authz;
<a name="l00039"></a>00039     my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
<a name="l00040"></a>00040     my $user       = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
<a name="l00041"></a>00041     
<a name="l00042"></a>00042 <span class="preprocessor">    # Check permissions</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>    <span class="keywordflow">return</span> unless ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>));
<a name="l00044"></a>00044 }
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 sub body {
<a name="l00048"></a>00048     my $self          = shift;
<a name="l00049"></a>00049     my $r             = $self-&gt;r;
<a name="l00050"></a>00050     my $urlpath       = $r-&gt;urlpath;
<a name="l00051"></a>00051     my $db            = $r-&gt;db;
<a name="l00052"></a>00052     my $ce            = $r-&gt;ce;
<a name="l00053"></a>00053     my $authz         = $r-&gt;authz;
<a name="l00054"></a>00054     my $root          = $ce-&gt;{webworkURLs}-&gt;{root};
<a name="l00055"></a>00055     my $courseName    = $urlpath-&gt;arg(<span class="stringliteral">&#39;courseID&#39;</span>);  
<a name="l00056"></a>00056     my $setName       = $r-&gt;param(<span class="stringliteral">&#39;setID&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;     # these are passed in the search args in <span class="keyword">this</span> <span class="keywordflow">case</span>
<a name="l00057"></a>00057     my $problemNumber = $r-&gt;param(<span class="stringliteral">&#39;problemID&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
<a name="l00058"></a>00058     <span class="keywordflow">if</span> ($problemNumber =~ /\!(\d+)/) { $problemNumber = $1 };
<a name="l00059"></a>00059     my $user          = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
<a name="l00060"></a>00060     my $key           = $r-&gt;param(<span class="stringliteral">&#39;key&#39;</span>);
<a name="l00061"></a>00061     my $studentUser   = $r-&gt;param(<span class="stringliteral">&#39;studentUser&#39;</span>) || <span class="stringliteral">&quot;&quot;</span>;
<a name="l00062"></a>00062     
<a name="l00063"></a>00063 <span class="preprocessor">    # Check permissions</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>    <span class="keywordflow">return</span> CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, <span class="stringliteral">&quot;You are not authorized to access the Instructor tools.&quot;</span>)
<a name="l00065"></a>00065         unless $authz-&gt;hasPermissions($r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>), <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     
<a name="l00068"></a>00068     my $showAnswersPage   = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, courseID =&gt; $courseName);
<a name="l00069"></a>00069     my $showAnswersURL    = $self-&gt;systemLink($showAnswersPage,authen =&gt; 0 );
<a name="l00070"></a>00070     
<a name="l00071"></a>00071     my ($safeUser, $safeCourse) = (showHTML($studentUser), showHTML($courseName));
<a name="l00072"></a>00072     my ($safeSet, $safeProb) = (showHTML($setName), showHTML($problemNumber));
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     my @defaultOrder = qw(user_id set_id problem_id date answers);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     my %prettyFieldNames;
<a name="l00077"></a>00077     
<a name="l00078"></a>00078     @prettyFieldNames{qw(
<a name="l00079"></a>00079         user_id
<a name="l00080"></a>00080         set_id
<a name="l00081"></a>00081         problem_id
<a name="l00082"></a>00082         date
<a name="l00083"></a>00083         answers
<a name="l00084"></a>00084     )} = (
<a name="l00085"></a>00085         <span class="stringliteral">&quot;User ID&quot;</span>,
<a name="l00086"></a>00086         <span class="stringliteral">&quot;Set Name&quot;</span>,
<a name="l00087"></a>00087         <span class="stringliteral">&quot;Problem Number&quot;</span>,
<a name="l00088"></a>00088         <span class="stringliteral">&quot;Date&quot;</span>, 
<a name="l00089"></a>00089         <span class="stringliteral">&quot;Answers&quot;</span>,
<a name="l00090"></a>00090     );
<a name="l00091"></a>00091     $prettyFieldNames{nofield} = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00092"></a>00092     
<a name="l00093"></a>00093 <span class="preprocessor">    #####################################################################</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">    # print form</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">    #####################################################################</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>    
<a name="l00097"></a>00097 <span class="preprocessor">    # FIXME why are we filtering out users with non-word characters in their userIDs?</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>    my @userIDs = grep /\w/, sort $db-&gt;listUsers();
<a name="l00099"></a>00099 <span class="preprocessor">    # DBFIXME for these &quot;get all&quot; type queries, we shouldn&#39;t need the lists of setIDs</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>    my @Users = $db-&gt;getUsers(@userIDs);
<a name="l00101"></a>00101     my %users = map { $_ =&gt; $db-&gt;getUser($_)-&gt;first_name } @userIDs;
<a name="l00102"></a>00102     my @setIDs = sort $db-&gt;listGlobalSets();
<a name="l00103"></a>00103     my @GlobalSets = $db-&gt;getGlobalSets(@setIDs);
<a name="l00104"></a>00104     my @GlobalProblems = $db-&gt;getAllGlobalProblems($setName);
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     my $scrolling_user_list = scrollingRecordList({
<a name="l00107"></a>00107         name =&gt; <span class="stringliteral">&quot;studentUser&quot;</span>,
<a name="l00108"></a>00108         request =&gt; $r,
<a name="l00109"></a>00109         default_sort =&gt; <span class="stringliteral">&quot;lnfn&quot;</span>,
<a name="l00110"></a>00110         default_format =&gt; <span class="stringliteral">&quot;lnfn_uid&quot;</span>,
<a name="l00111"></a>00111         default_filters =&gt; [<span class="stringliteral">&quot;all&quot;</span>],
<a name="l00112"></a>00112         <span class="keywordflow">default</span> =&gt; <span class="stringliteral">&quot;Select one or more users: &quot;</span>,
<a name="l00113"></a>00113 <span class="preprocessor">#       hide_sort =&gt; 1,</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="preprocessor">#       hide_format =&gt; 1,</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span><span class="preprocessor">#       hide_filter =&gt; 1,</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>        size =&gt; 10,
<a name="l00117"></a>00117 <span class="preprocessor">#       multiple =&gt; 0,</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>    }, @Users);
<a name="l00119"></a>00119     
<a name="l00120"></a>00120     my $scrolling_set_list = scrollingRecordList({
<a name="l00121"></a>00121         name =&gt; <span class="stringliteral">&quot;setID&quot;</span>,
<a name="l00122"></a>00122         request =&gt; $r,
<a name="l00123"></a>00123         default_sort =&gt; <span class="stringliteral">&quot;set_id&quot;</span>,
<a name="l00124"></a>00124         default_format =&gt; <span class="stringliteral">&quot;set_id&quot;</span>,
<a name="l00125"></a>00125         default_filters =&gt; [<span class="stringliteral">&quot;all&quot;</span>],
<a name="l00126"></a>00126         <span class="keywordflow">default</span> =&gt; <span class="stringliteral">&quot;Select one or more sets: &quot;</span>,
<a name="l00127"></a>00127 <span class="preprocessor">#       hide_sort =&gt; 1,</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span><span class="preprocessor">#       hide_format =&gt; 1,</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span><span class="preprocessor">#       hide_filter =&gt; 1,       </span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>        size =&gt; 10,
<a name="l00131"></a>00131 <span class="preprocessor">#       multiple =&gt; 0,</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span>    }, @GlobalSets);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134     my $scrolling_problem_list = scrollingRecordList({
<a name="l00135"></a>00135         name =&gt; <span class="stringliteral">&quot;problemID&quot;</span>,
<a name="l00136"></a>00136         request =&gt; $r,
<a name="l00137"></a>00137         <span class="keywordflow">default</span> =&gt; <span class="stringliteral">&quot;Select one or more problems: &quot;</span>,
<a name="l00138"></a>00138         default_filters =&gt; [<span class="stringliteral">&quot;all&quot;</span>],     
<a name="l00139"></a>00139 <span class="preprocessor">#       hide_sort =&gt; 1,</span>
<a name="l00140"></a>00140 <span class="preprocessor"></span><span class="preprocessor">#       hide_format =&gt; 1,</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span><span class="preprocessor">#       hide_filter =&gt; 1,       </span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>        size =&gt; 10,
<a name="l00143"></a>00143 <span class="preprocessor">#       multiple =&gt; 0,</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>    }, @GlobalProblems);
<a name="l00145"></a>00145     
<a name="l00146"></a>00146     my @selected_fields = $r-&gt;param(<span class="stringliteral">&quot;selected_fields&quot;</span>);
<a name="l00147"></a>00147     my @selected_answers = $r-&gt;param(<span class="stringliteral">&quot;selected_answers&quot;</span>);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     print join (<span class="stringliteral">&quot;&quot;</span>,
<a name="l00150"></a>00150         CGI::br(),
<a name="l00151"></a>00151         <span class="stringliteral">&quot;\n\n&quot;</span>,
<a name="l00152"></a>00152         CGI::hr(),
<a name="l00153"></a>00153         CGI::start_form(
<a name="l00154"></a>00154             -method =&gt; <span class="stringliteral">&quot;post&quot;</span>, 
<a name="l00155"></a>00155             -action =&gt; $showAnswersURL, 
<a name="l00156"></a>00156             -target =&gt; <span class="stringliteral">&#39;information&#39;</span>,
<a name="l00157"></a>00157         ),
<a name="l00158"></a>00158             CGI::start_table(
<a name="l00159"></a>00159                 -border =&gt; <span class="stringliteral">&quot;0&quot;</span>, 
<a name="l00160"></a>00160                 -cellpadding =&gt; <span class="stringliteral">&quot;0&quot;</span>, 
<a name="l00161"></a>00161                 -cellspacing =&gt; <span class="stringliteral">&quot;0&quot;</span>,
<a name="l00162"></a>00162             ),
<a name="l00163"></a>00163                 CGI::Tr(
<a name="l00164"></a>00164                     CGI::td({style=&gt;<span class="stringliteral">&quot;width:33%&quot;</span>}, $scrolling_user_list),
<a name="l00165"></a>00165                     CGI::td({style=&gt;<span class="stringliteral">&quot;width:33%&quot;</span>}, $scrolling_set_list),
<a name="l00166"></a>00166                     CGI::td({style=&gt;<span class="stringliteral">&quot;width:33%&quot;</span>}, $scrolling_problem_list),                 
<a name="l00167"></a>00167                 ),
<a name="l00168"></a>00168                 CGI::Tr({}, 
<a name="l00169"></a>00169                     CGI::submit(
<a name="l00170"></a>00170                         -name =&gt; <span class="stringliteral">&#39;action&#39;</span>,
<a name="l00171"></a>00171                         -value =&gt; <span class="stringliteral">&#39;Past Answers for&#39;</span>,
<a name="l00172"></a>00172                     ), <span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00173"></a>00173 <span class="preprocessor">#                   $self-&gt;hidden_authen_fields,</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span><span class="preprocessor">#                   &quot; &amp;nbsp; \n User: &amp;nbsp;&quot;,</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span><span class="preprocessor">#                   CGI::textfield(</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span><span class="preprocessor">#                       -name =&gt; &#39;studentUser1&#39;,</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span><span class="preprocessor">#                       -value =&gt; $safeUser,</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span><span class="preprocessor">#                       -size =&gt; 10,</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span><span class="preprocessor">#                   ),</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span><span class="preprocessor">#                   &quot; &amp;nbsp; \n Set: &amp;nbsp;&quot;,</span>
<a name="l00181"></a>00181 <span class="preprocessor"></span><span class="preprocessor">#                   CGI::textfield(</span>
<a name="l00182"></a>00182 <span class="preprocessor"></span><span class="preprocessor">#                       -name =&gt; &#39;setID1&#39;,</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span><span class="preprocessor">#                       -value =&gt; $safeSet,</span>
<a name="l00184"></a>00184 <span class="preprocessor"></span><span class="preprocessor">#                       -size =&gt; 10, </span>
<a name="l00185"></a>00185 <span class="preprocessor"></span><span class="preprocessor">#                   ),</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span><span class="preprocessor">#                   &quot; &amp;nbsp; \n Problem:  &amp;nbsp;&quot;,</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span><span class="preprocessor">#                   CGI::textfield(</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span><span class="preprocessor">#                       -name =&gt; &#39;problemID&#39;,</span>
<a name="l00189"></a>00189 <span class="preprocessor"></span><span class="preprocessor">#                       -value =&gt; $safeProb,</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span><span class="preprocessor">#                       -size =&gt; 10,</span>
<a name="l00191"></a>00191 <span class="preprocessor"></span><span class="preprocessor">#                   ),</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span><span class="preprocessor">#                   &quot; &amp;nbsp; \n&quot;,</span>
<a name="l00193"></a>00193 <span class="preprocessor"></span><span class="preprocessor">#                   CGI::br(),CGI::br(),</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>                ),
<a name="l00195"></a>00195 #               CGI::Tr({},
<a name="l00196"></a>00196 <span class="preprocessor">#                   CGI::popup_menu(</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span><span class="preprocessor">#                       -name =&gt; &#39;studentUser&#39;,</span>
<a name="l00198"></a>00198 <span class="preprocessor"></span><span class="preprocessor">#                       -size =&gt; 10,</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span><span class="preprocessor">#                       -values =&gt; \@userIDs,</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span><span class="preprocessor">#                       -multiple =&gt; 1,</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span><span class="preprocessor">#                   ),</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span><span class="preprocessor">#                   CGI::popup_menu(</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span><span class="preprocessor">#                       -name =&gt; &#39;setID&#39;,</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span><span class="preprocessor">#                       -values =&gt; \@setIDs,</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span><span class="preprocessor">#                       -size =&gt; 10,</span>
<a name="l00206"></a>00206 <span class="preprocessor"></span><span class="preprocessor">#                       -multiple =&gt; 1,</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span><span class="preprocessor">#                   ),</span>
<a name="l00208"></a>00208 <span class="preprocessor"></span><span class="preprocessor">#               ),</span>
<a name="l00209"></a>00209 <span class="preprocessor"></span>                CGI::Tr({},
<a name="l00210"></a>00210                     CGI::td({}, 
<a name="l00211"></a>00211                         <span class="stringliteral">&quot;Select which fields to show: &quot;</span> . CGI::br(),
<a name="l00212"></a>00212                         CGI::scrolling_list(
<a name="l00213"></a>00213                             -name =&gt; <span class="stringliteral">&quot;selected_fields&quot;</span>,
<a name="l00214"></a>00214                             -values =&gt; \@defaultOrder,
<a name="l00215"></a>00215                             -labels =&gt; \%prettyFieldNames,
<a name="l00216"></a>00216                             -<span class="keywordflow">default</span> =&gt; \@selected_fields,
<a name="l00217"></a>00217                             -size =&gt; 5,
<a name="l00218"></a>00218                             -multiple =&gt; 1,
<a name="l00219"></a>00219                         ),
<a name="l00220"></a>00220                     ),
<a name="l00221"></a>00221                     CGI::td({},
<a name="l00222"></a>00222                         <span class="stringliteral">&quot;and which answers to show: &quot;</span> . CGI::br(),
<a name="l00223"></a>00223                         CGI::scrolling_list(
<a name="l00224"></a>00224                             -name =&gt; <span class="stringliteral">&quot;selected_answers&quot;</span>,
<a name="l00225"></a>00225                             -values =&gt; [1..100],
<a name="l00226"></a>00226                             -<span class="keywordflow">default</span> =&gt; \@selected_answers,
<a name="l00227"></a>00227                             -size =&gt; 5,
<a name="l00228"></a>00228                             -multiple =&gt; 1,
<a name="l00229"></a>00229                         )
<a name="l00230"></a>00230                     ),
<a name="l00231"></a>00231                 ),
<a name="l00232"></a>00232             CGI::end_table({}),
<a name="l00233"></a>00233         CGI::end_form({}),  
<a name="l00234"></a>00234     );
<a name="l00235"></a>00235     
<a name="l00236"></a>00236 <span class="preprocessor">    #####################################################################</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span><span class="preprocessor">    # create ordering system</span>
<a name="l00238"></a>00238 <span class="preprocessor"></span><span class="preprocessor">    #####################################################################</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span>
<a name="l00240"></a>00240 <span class="preprocessor">    # FIXME: We need a way to choose the order as well as the fields!</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>    my (@fieldOrder) = @selected_fields ? @selected_fields : @defaultOrder;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (defined($setName) and defined($problemNumber) )  {
<a name="l00244"></a>00244 <span class="preprocessor">        #####################################################################</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span><span class="preprocessor">        # print result table of answers</span>
<a name="l00246"></a>00246 <span class="preprocessor"></span><span class="preprocessor">        #####################################################################</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span>        my $answer_log    = $self-&gt;{ce}-&gt;{courseFiles}-&gt;{logs}-&gt;{<span class="stringliteral">&#39;answer_log&#39;</span>};
<a name="l00248"></a>00248     
<a name="l00249"></a>00249         $studentUser = $r-&gt;param(<span class="stringliteral">&#39;studentUser&#39;</span>) <span class="keywordflow">if</span> ( defined($r-&gt;param(<span class="stringliteral">&#39;studentUser&#39;</span>)) );
<a name="l00250"></a>00250         my ($safeUser, $safeCourse) = (showHTML($studentUser), showHTML($courseName));
<a name="l00251"></a>00251         my ($safeSet, $safeProb) = (showHTML($setName), showHTML($problemNumber));
<a name="l00252"></a>00252     
<a name="l00253"></a>00253         
<a name="l00254"></a>00254         print CGI::h3( <span class="stringliteral">&quot;Past Answers for &quot;</span> . ($safeUser ? <span class="stringliteral">&quot;user $safeUser &quot;</span> : <span class="stringliteral">&#39;&#39;</span> ) . ($safeSet ? <span class="stringliteral">&quot;set $safeSet &quot;</span> : <span class="stringliteral">&#39;&#39;</span> ) . ($safeSet and $safeProb ? <span class="stringliteral">&#39;, &#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . ($safeProb ? <span class="stringliteral">&quot;problem $safeProb&quot;</span> : <span class="stringliteral">&#39;&#39;</span>));
<a name="l00255"></a>00255     
<a name="l00256"></a>00256         $studentUser = <span class="stringliteral">&quot;[^|]*&quot;</span>    <span class="keywordflow">if</span> (not defined $studentUser or $studentUser eq <span class="stringliteral">&quot;&quot;</span>    or $studentUser eq <span class="stringliteral">&quot;*&quot;</span>);
<a name="l00257"></a>00257         $setName = <span class="stringliteral">&quot;[^|]*&quot;</span>  <span class="keywordflow">if</span> ($setName eq <span class="stringliteral">&quot;&quot;</span>  or $setName eq <span class="stringliteral">&quot;*&quot;</span>);
<a name="l00258"></a>00258         $problemNumber = <span class="stringliteral">&quot;[^|]*&quot;</span> <span class="keywordflow">if</span> ($problemNumber eq <span class="stringliteral">&quot;&quot;</span> or $problemNumber eq <span class="stringliteral">&quot;*&quot;</span>);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="preprocessor">        #my $pattern = &quot;^[[^]]*]|[^|]*\\|$setName\\|$problemNumber\\|&quot;;</span>
<a name="l00261"></a>00261 <span class="preprocessor"></span>        my $pattern = <span class="stringliteral">&quot;\\|$studentUser\\|$setName\\|$problemNumber\\|&quot;</span>;
<a name="l00262"></a>00262         
<a name="l00263"></a>00263         our ($lastdate, $lasttime, $lastID, $lastn);
<a name="l00264"></a>00264         
<a name="l00265"></a>00265         
<a name="l00266"></a>00266         <span class="keywordflow">if</span> (open(LOG,<span class="stringliteral">&quot;$answer_log&quot;</span>)) {
<a name="l00267"></a>00267             my $line;
<a name="l00268"></a>00268             local ($lastdate, $lasttime, $lastID, $lastn) = (<span class="stringliteral">&quot;&quot;</span>,0,<span class="stringliteral">&quot;&quot;</span>,0);
<a name="l00269"></a>00269             $self-&gt;{lastdate}       = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00270"></a>00270             $self-&gt;{lasttime}       = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00271"></a>00271             $self-&gt;{lastID}         = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00272"></a>00272             $self-&gt;{lastn}          = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00273"></a>00273           
<a name="l00274"></a>00274 <span class="preprocessor">            # get data from file</span>
<a name="l00275"></a>00275 <span class="preprocessor"></span>            
<a name="l00276"></a>00276             my @lines = grep(/$pattern/,&lt;LOG&gt;); close(LOG);
<a name="l00277"></a>00277             chomp(@lines);
<a name="l00278"></a>00278                         
<a name="l00279"></a>00279             my $maxcount = 0;
<a name="l00280"></a>00280             <span class="keywordflow">foreach</span> my $newline (@lines) {
<a name="l00281"></a>00281                 my @words = split /\t/, $newline;
<a name="l00282"></a>00282                 my $count = @words;
<a name="l00283"></a>00283                 $maxcount = $count <span class="keywordflow">if</span> $count &gt; $maxcount;
<a name="l00284"></a>00284             }
<a name="l00285"></a>00285             @selected_answers = (1..$maxcount) unless @selected_answers;
<a name="l00286"></a>00286             
<a name="l00287"></a>00287 <span class="preprocessor">#           print &quot;&lt;CENTER&gt;\n&quot;;</span>
<a name="l00288"></a>00288 <span class="preprocessor"></span>            print CGI::start_table({
<a name="l00289"></a>00289                     -border =&gt; <span class="stringliteral">&quot;1&quot;</span>,
<a name="l00290"></a>00290 <span class="preprocessor">#                   -cellpadding =&gt; &#39;3&#39;,</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span><span class="preprocessor">#                   -cellspacing =&gt; &#39;0&#39;,</span>
<a name="l00292"></a>00292 <span class="preprocessor"></span>                    -onload =&gt; <span class="stringliteral">&quot;&quot;</span>,
<a name="l00293"></a>00293                 }) . <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00294"></a>00294             
<a name="l00295"></a>00295             my @tableHeaders;
<a name="l00296"></a>00296             <span class="keywordflow">foreach</span> (@fieldOrder) {
<a name="l00297"></a>00297                 push @tableHeaders, $prettyFieldNames{$_} unless $_ eq <span class="stringliteral">&quot;answers&quot;</span>;
<a name="l00298"></a>00298             }
<a name="l00299"></a>00299             print CGI::Tr({}, CGI::th({}, \@tableHeaders) , CGI::th({-colspan =&gt; 200}, $prettyFieldNames{answers}));
<a name="l00300"></a>00300 
<a name="l00301"></a>00301             my @Records;
<a name="l00302"></a>00302 <span class="preprocessor">            #####################################################################</span>
<a name="l00303"></a>00303 <span class="preprocessor"></span><span class="preprocessor">            # create array of records</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span><span class="preprocessor">            #####################################################################</span>
<a name="l00305"></a>00305 <span class="preprocessor"></span>            <span class="keywordflow">foreach</span> $line ( @lines ) {
<a name="l00306"></a>00306                 my %fakeRecord = ();
<a name="l00307"></a>00307 <span class="preprocessor">                #print CGI::br() . $line;</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span>                next <span class="keywordflow">if</span> not $line =~ /\|(\w+)\|([\w\d_-]+)\|(\d+)\|\s*(\d+)(.*?)\t?$/;
<a name="l00309"></a>00309                 $fakeRecord{user_id} = <span class="stringliteral">&quot;$1&quot;</span>;
<a name="l00310"></a>00310                 $fakeRecord{set_id} = <span class="stringliteral">&quot;$2&quot;</span>;
<a name="l00311"></a>00311                 $fakeRecord{problem_id} = <span class="stringliteral">&quot;$3&quot;</span>;
<a name="l00312"></a>00312                 $fakeRecord{date} = $4; #$self-&gt;formatDateTime($4);
<a name="l00313"></a>00313                 $fakeRecord{answers} = [ split <span class="stringliteral">&quot;\t&quot;</span>, <span class="stringliteral">&quot;$5&quot;</span>, -1 ] <span class="keywordflow">if</span> $5; # the -1 stops split from dropping any trailing null fields
<a name="l00314"></a>00314                 my @answers = map { $_ ? showHTML($_) : CGI::small(CGI::i(<span class="stringliteral">&quot;empty&quot;</span>)) } @{ $fakeRecord{answers} }; 
<a name="l00315"></a>00315                 shift @answers; # first field is always empty
<a name="l00316"></a>00316                 $fakeRecord{answers} = \@answers;
<a name="l00317"></a>00317                 
<a name="l00318"></a>00318 
<a name="l00319"></a>00319                 my @tableCells;
<a name="l00320"></a>00320                 <span class="keywordflow">foreach</span> (@fieldOrder) {
<a name="l00321"></a>00321                 
<a name="l00322"></a>00322 <span class="preprocessor">                    #push @tableCells, showHTML($fakeRecord{$_});</span>
<a name="l00323"></a>00323 <span class="preprocessor"></span>                }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325                 push @Records, \%fakeRecord;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327 <span class="preprocessor">                #print join &quot; &quot;, map { &quot;$_ = $fakeRecord{$_}&quot; } keys %fakeRecord;</span>
<a name="l00328"></a>00328 <span class="preprocessor"></span><span class="preprocessor">                #print CGI::br();</span>
<a name="l00329"></a>00329 <span class="preprocessor"></span><span class="preprocessor">#               print CGI::Tr({}, CGI::td({}, \@tableCells));</span>
<a name="l00330"></a>00330 <span class="preprocessor"></span>            
<a name="l00331"></a>00331 <span class="preprocessor">                #print $self-&gt;tableRow(split(&quot;\t&quot;,$line.&quot;\tx&quot;));</span>
<a name="l00332"></a>00332 <span class="preprocessor"></span>            }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="preprocessor">            #####################################################################</span>
<a name="l00335"></a>00335 <span class="preprocessor"></span><span class="preprocessor">            # sort array of records</span>
<a name="l00336"></a>00336 <span class="preprocessor"></span><span class="preprocessor">            #####################################################################</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>
<a name="l00338"></a>00338             @Records = sort byUSPD @Records;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 <span class="preprocessor">            #####################################################################</span>
<a name="l00341"></a>00341 <span class="preprocessor"></span><span class="preprocessor">            # print array of records</span>
<a name="l00342"></a>00342 <span class="preprocessor"></span><span class="preprocessor">            #####################################################################</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span>            
<a name="l00344"></a>00344             <span class="keywordflow">foreach</span> my $record (@Records) {
<a name="l00345"></a>00345                 my @tableCells;
<a name="l00346"></a>00346                 <span class="keywordflow">foreach</span> (@fieldOrder) {
<a name="l00347"></a>00347                     <span class="keywordflow">if</span> ($_ eq <span class="stringliteral">&quot;answers&quot;</span>) {
<a name="l00348"></a>00348                         my $i = 0;
<a name="l00349"></a>00349                         my %answers = map { ++$i =&gt; $_ } @{ $record-&gt;{$_} };
<a name="l00350"></a>00350                         push @tableCells, @answers{@selected_answers};
<a name="l00351"></a>00351                     } elsif ($_ eq <span class="stringliteral">&quot;date&quot;</span>) {
<a name="l00352"></a>00352                         my ( $sec, $min, $hour, $mday, $mon, $year, $wday, $yday, $isdst) = localtime $record-&gt;{$_};
<a name="l00353"></a>00353                         $wday = (<span class="stringliteral">&quot;Sun&quot;</span>, <span class="stringliteral">&quot;Mon&quot;</span>, <span class="stringliteral">&quot;Tue&quot;</span>, <span class="stringliteral">&quot;Wed&quot;</span>, <span class="stringliteral">&quot;Thu&quot;</span>, <span class="stringliteral">&quot;Fri&quot;</span>, <span class="stringliteral">&quot;Sat&quot;</span>)[$wday];
<a name="l00354"></a>00354                         $mon = (<span class="stringliteral">&quot;Jan&quot;</span>, <span class="stringliteral">&quot;Feb&quot;</span>, <span class="stringliteral">&quot;Mar&quot;</span>, <span class="stringliteral">&quot;Apr&quot;</span>, <span class="stringliteral">&quot;May&quot;</span>, <span class="stringliteral">&quot;Jun&quot;</span>, <span class="stringliteral">&quot;Jul&quot;</span>, <span class="stringliteral">&quot;Aug&quot;</span>, <span class="stringliteral">&quot;Sep&quot;</span>, <span class="stringliteral">&quot;Oct&quot;</span>, <span class="stringliteral">&quot;Nov&quot;</span>, <span class="stringliteral">&quot;Dec&quot;</span>)[$mon];
<a name="l00355"></a>00355                         $year += 1900;
<a name="l00356"></a>00356                         my $ampm = (<span class="stringliteral">&quot;am&quot;</span>, <span class="stringliteral">&quot;pm&quot;</span>)[$hour &gt; 12];
<a name="l00357"></a>00357                         $hour = $hour % 12;
<a name="l00358"></a>00358                         push @tableCells, showHTML(<span class="stringliteral">&quot;$wday $mday $mon $year $hour:$min $ampm&quot;</span>);
<a name="l00359"></a>00359                     } <span class="keywordflow">else</span> {
<a name="l00360"></a>00360                         push @tableCells, $record-&gt;{$_};
<a name="l00361"></a>00361                     }
<a name="l00362"></a>00362                 }
<a name="l00363"></a>00363                 
<a name="l00364"></a>00364                 print CGI::Tr({}, CGI::td({}, \@tableCells));
<a name="l00365"></a>00365             }
<a name="l00366"></a>00366                 
<a name="l00367"></a>00367 <span class="preprocessor">            # print a horizontal line </span>
<a name="l00368"></a>00368 <span class="preprocessor"></span><span class="preprocessor">            #print CGI::Tr({}, CGI::td({colspan =&gt; $lastn}, CGI::hr({size =&gt; 3})));</span>
<a name="l00369"></a>00369 <span class="preprocessor"></span>            print CGI::end_table({});
<a name="l00370"></a>00370 <span class="preprocessor">#           print &quot;\n&lt;/CENTER&gt;\n\n&quot;;</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>            print CGI::p(
<a name="l00372"></a>00372                       CGI::i(<span class="stringliteral">&quot;No entries for &quot;</span> . ($safeUser ? <span class="stringliteral">&quot;user $safeUser &quot;</span> : <span class="stringliteral">&#39;&#39;</span> ) . ($safeSet ? <span class="stringliteral">&quot;set $safeSet &quot;</span> : <span class="stringliteral">&#39;&#39;</span> ) . ($safeSet and $safeProb ? <span class="stringliteral">&#39;, &#39;</span> : <span class="stringliteral">&#39;&#39;</span>) . ($safeProb ? <span class="stringliteral">&quot;problem $safeProb&quot;</span> : <span class="stringliteral">&#39;&#39;</span>))
<a name="l00373"></a>00373             ) unless @lines;
<a name="l00374"></a>00374             
<a name="l00375"></a>00375         } else {
<a name="l00376"></a>00376             print CGI::em(<span class="stringliteral">&quot;Can&#39;t open the access log $answer_log&quot;</span>);
<a name="l00377"></a>00377         }
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         
<a name="l00381"></a>00381     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 sub tableRow {
<a name="l00385"></a>00385     my $self       = shift;
<a name="l00386"></a>00386     my $lastID     = $self-&gt;{lastID};
<a name="l00387"></a>00387     my $lastn      = $self-&gt;{lastn};
<a name="l00388"></a>00388     my $lasttime   = $self-&gt;{lasttime};
<a name="l00389"></a>00389     my $lastdate   = $self-&gt;{lastdate};
<a name="l00390"></a>00390     my ($out,$answer,$studentUser,$set,$prob) = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00391"></a>00391     my ($ID,$rtime,@answers) = @_; pop(@answers);
<a name="l00392"></a>00392     my $date = scalar(localtime($rtime)); $date =~ s/\s+/ /g;
<a name="l00393"></a>00393     my ($day,$month,$mdate,$time,$year) = split(<span class="stringliteral">&quot; &quot;</span>,$date);
<a name="l00394"></a>00394     $date = <span class="stringliteral">&quot;$mdate $month $year&quot;</span>;
<a name="l00395"></a>00395     my $n = 2*(scalar(@answers)+1);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397     <span class="keywordflow">if</span> ($lastID ne $ID) {
<a name="l00398"></a>00398         <span class="keywordflow">if</span> ($lastn) {
<a name="l00399"></a>00399             print qq{&lt;TR&gt;&lt;TD COLSPAN=<span class="stringliteral">&quot;$lastn&quot;</span>&gt;&lt;HR SIZE=<span class="stringliteral">&quot;3&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;\n&lt;P&gt;\n\n};
<a name="l00400"></a>00400             print <span class="stringliteral">&#39;&lt;TABLE BORDER=&quot;0&quot; CELLPADDING=&quot;0&quot; CELLSPACING=&quot;3&quot;&gt;&#39;</span>,<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00401"></a>00401         }
<a name="l00402"></a>00402         ($studentUser,$set,$prob) = (split(<span class="charliteral">&#39;\|&#39;</span>,$ID))[1,2,3];
<a name="l00403"></a>00403         $out .= qq{&lt;TR ALIGN=<span class="stringliteral">&quot;CENTER&quot;</span>&gt;&lt;TD COLSPAN=<span class="stringliteral">&quot;$n&quot;</span>&gt;&lt;HR SIZE=<span class="stringliteral">&quot;3&quot;</span>&gt;
<a name="l00404"></a>00404             User: &lt;B&gt;$studentUser&lt;/B&gt; &amp;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#a0b04a9c84777c525b5d1a7683331f7ee">nbsp</a>;
<a name="l00405"></a>00405             Set: &lt;B&gt;$set&lt;/B&gt; &amp;nbsp;
<a name="l00406"></a>00406             Problem: &lt;B&gt;$prob&lt;/B&gt;&lt;/TD&gt;&lt;/TR&gt;\n};
<a name="l00407"></a>00407         $lastID = $ID; $lasttime = 0; $lastdate = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     $out .= qq{&lt;TR&gt;&lt;TD COLSPAN=<span class="stringliteral">&quot;$n&quot;</span>&gt;&lt;HR SIZE=<span class="stringliteral">&quot;1&quot;</span>&gt;&lt;/TD&gt;&lt;/TR&gt;\n}
<a name="l00411"></a>00411     <span class="keywordflow">if</span> ($rtime - $lasttime &gt; 30*60);
<a name="l00412"></a>00412     $lasttime = $rtime; $lastn = $n;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     <span class="keywordflow">if</span> ($lastdate ne $date) {
<a name="l00415"></a>00415         $out .= qq{&lt;TR&gt;&lt;TD COLSPAN=<span class="stringliteral">&quot;$n&quot;</span>&gt;&lt;SMALL&gt;&lt;I&gt;$date&lt;/I&gt;&lt;/SMALL&gt;&lt;/TD&gt;&lt;/TR&gt;\n};
<a name="l00416"></a>00416         $lastdate = $date;
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     $out .= <span class="stringliteral">&#39;&lt;TR&gt;&lt;TD WIDTH=&quot;10&quot;&gt;&lt;/TD&gt;&#39;</span>.
<a name="l00420"></a>00420         <span class="stringliteral">&#39;&lt;TD&gt;&lt;FONT COLOR=&quot;#808080&quot;&gt;&lt;SMALL&gt;&#39;</span>.$time.<span class="stringliteral">&#39;&lt;/SMALL&gt;&lt;/FONT&gt;&lt;/TD&gt;&#39;</span>;
<a name="l00421"></a>00421     <span class="keywordflow">foreach</span> $answer (@answers) {
<a name="l00422"></a>00422         $answer =~ s/(^\s+|\s+$)<span class="comment">//g;</span>
<a name="l00423"></a>00423         $answer = showHTML($answer);
<a name="l00424"></a>00424         $answer = <span class="stringliteral">&quot;&lt;SMALL&gt;&lt;I&gt;empty&lt;/I&gt;&lt;/SMALL&gt;&quot;</span> <span class="keywordflow">if</span> ($answer eq <span class="stringliteral">&quot;&quot;</span>);
<a name="l00425"></a>00425         $out .= qq{&lt;TD WIDTH=<span class="stringliteral">&quot;20&quot;</span>&gt;&lt;/TD&gt;&lt;TD NOWRAP&gt;$answer&lt;/TD&gt;};
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427     $out .= <span class="stringliteral">&quot;&lt;/TR&gt;\n&quot;</span>;
<a name="l00428"></a>00428     $out;
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 <span class="preprocessor">################################################################################</span>
<a name="l00432"></a>00432 <span class="preprocessor"></span><span class="preprocessor"># sorts</span>
<a name="l00433"></a>00433 <span class="preprocessor"></span><span class="preprocessor">################################################################################</span>
<a name="l00434"></a>00434 <span class="preprocessor"></span>
<a name="l00435"></a>00435 sub byUserID      { $a-&gt;{user_id}      cmp $b-&gt;{user_id}    }
<a name="l00436"></a>00436 sub bySetID       { lc($a-&gt;{set_id})   cmp lc($b-&gt;{set_id})     }
<a name="l00437"></a>00437 sub byProblemID   { $a-&gt;{problem_id}   &lt;=&gt; $b-&gt;{problem_id} }  
<a name="l00438"></a>00438 sub byDate        { $a-&gt;{date}         cmp $b-&gt;{date}       }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 sub byUSPD  { &amp;byUserID || &amp;bySetID || &amp;byProblemID || &amp;byDate }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 <span class="preprocessor">##################################################</span>
<a name="l00443"></a>00443 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00444"></a>00444 <span class="preprocessor"></span><span class="preprocessor">#  Make HTML symbols printable</span>
<a name="l00445"></a>00445 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00446"></a>00446 <span class="preprocessor"></span>sub showHTML {
<a name="l00447"></a>00447     my $string = shift;
<a name="l00448"></a>00448     <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span> unless defined $string;
<a name="l00449"></a>00449     $string =~ s/&amp;/\&amp;amp;/g;
<a name="l00450"></a>00450     $string =~ s/&lt;/\&amp;lt;/g;
<a name="l00451"></a>00451     $string =~ s/&gt;/\&amp;gt;/g;
<a name="l00452"></a>00452     $string =~ s/\0/,/g;
<a name="l00453"></a>00453     $string =~ s/ /&amp;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#a0b04a9c84777c525b5d1a7683331f7ee">nbsp</a>;/g;
<a name="l00454"></a>00454     <span class="keywordflow">return</span> $string;
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 1;
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:55:34 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
