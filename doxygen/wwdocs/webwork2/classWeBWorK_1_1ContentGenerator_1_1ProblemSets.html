<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::ContentGenerator::ProblemSets Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator.html">ContentGenerator</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html">ProblemSets</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::ContentGenerator::ProblemSets Class Reference</h1><!-- doxytag: class="WeBWorK::ContentGenerator::ProblemSets" --><!-- doxytag: inherits="WeBWorK::ContentGenerator" --><div class="dynheader">
Inheritance diagram for WeBWorK::ContentGenerator::ProblemSets:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1ProblemSets__inherit__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1ProblemSets_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1ProblemSets_inherit__map" id="WeBWorK_1_1ContentGenerator_1_1ProblemSets_inherit__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="47,80,239,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="101,5,184,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::ContentGenerator::ProblemSets:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1ProblemSets__coll__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1ProblemSets_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1ProblemSets_coll__map" id="WeBWorK_1_1ContentGenerator_1_1ProblemSets_coll__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="47,80,239,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="101,5,184,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#a2fcde7b2c36ae2067cc1165859137450">body</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#af9219d0e8b814c65610235cf6c71730b">info</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#ac7bfab29e7a2a504d573d8d75ac4780d">byUrgency</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#a1fd331b6f96ba5831c0912a4d59558e3">byname</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#a8d5e20be983af40e16cd048c66e6a5df">setListRow</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#ab03d7aacf4183991adba672b516ef840">help</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#a073a5242562bfbcb2b7ebfd24925e17b">initialize</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html">WeBWorK::ContentGenerator::ProblemSets</a> - Display a list of built problem sets. </p>

<p>Definition at line <a class="el" href="ProblemSets_8pm_source.html#l00020">20</a> of file <a class="el" href="ProblemSets_8pm_source.html">ProblemSets.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a2fcde7b2c36ae2067cc1165859137450"></a><!-- doxytag: member="WeBWorK::ContentGenerator::ProblemSets::body" ref="a2fcde7b2c36ae2067cc1165859137450" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::ProblemSets::body </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-body' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-body-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-body-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-body-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in body: 206</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#a2fcde7b2c36ae2067cc1165859137450">body</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    my $urlpath = $r-&gt;urlpath;
    
    my $user            = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    my $effectiveUser   = $r-&gt;param(<span class="stringliteral">&quot;effectiveUser&quot;</span>);
    my $sort            = $r-&gt;param(<span class="stringliteral">&quot;sort&quot;</span>) || <span class="stringliteral">&quot;status&quot;</span>;
    
    my $courseName      = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    
    my $hardcopyPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Hardcopy&quot;</span>,  $r, courseID =&gt; $courseName);
    my $actionURL = $self-&gt;systemLink($hardcopyPage, authen =&gt; 0); # no authen <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#af9219d0e8b814c65610235cf6c71730b">info</a> <span class="keywordflow">for</span> form action
    
<span class="preprocessor"># we have to get sets and versioned sets separately</span>
<span class="preprocessor"></span><span class="preprocessor">    # DBFIXME don&#39;t get ID lists, use WHERE clauses and iterators</span>
<span class="preprocessor"></span>    my @setIDs = $db-&gt;listUserSets($effectiveUser);
    my @userSetIDs = map {[$effectiveUser, $_]} @setIDs;

    debug(<span class="stringliteral">&quot;Begin collecting merged sets&quot;</span>);
    my @sets = $db-&gt;getMergedSets( @userSetIDs );

    debug(<span class="stringliteral">&quot;Begin fixing merged sets&quot;</span>);
    
<span class="preprocessor">    # Database fix (in case of undefined visible values)</span>
<span class="preprocessor"></span><span class="preprocessor">    # this may take some extra time the first time but should NEVER need to be run twice</span>
<span class="preprocessor"></span><span class="preprocessor">    # this is only necessary because some people keep holding to ww1.9 which did not have a visible field</span>
<span class="preprocessor"></span><span class="preprocessor">    # DBFIXME this should be in the database layer (along with other &quot;fixes&quot; of its ilk)</span>
<span class="preprocessor"></span>    <span class="keywordflow">foreach</span> my $set (@sets) {
<span class="preprocessor">        # make sure visible is set to 0 or 1</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( $set and $set-&gt;visible ne <span class="stringliteral">&quot;0&quot;</span> and $set-&gt;visible ne <span class="stringliteral">&quot;1&quot;</span>) {
            my $globalSet = $db-&gt;getGlobalSet($set-&gt;set_id);
            $globalSet-&gt;visible(<span class="stringliteral">&quot;1&quot;</span>);   # defaults to visible
            $db-&gt;putGlobalSet($globalSet);
            $set = $db-&gt;getMergedSet($effectiveUser, $set-&gt;set_id);
        } <span class="keywordflow">else</span> {
            die <span class="stringliteral">&quot;set $set not defined&quot;</span> unless $set;
        }
    }

    <span class="keywordflow">foreach</span> my $set (@sets) {
<span class="preprocessor">        # make sure enable_reduced_scoring is set to 0 or 1</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( $set and $set-&gt;enable_reduced_scoring ne <span class="stringliteral">&quot;0&quot;</span> and $set-&gt;enable_reduced_scoring ne <span class="stringliteral">&quot;1&quot;</span>) {
            my $globalSet = $db-&gt;getGlobalSet($set-&gt;set_id);
            $globalSet-&gt;enable_reduced_scoring(<span class="stringliteral">&quot;0&quot;</span>);    # defaults to disabled
            $db-&gt;putGlobalSet($globalSet);
            $set = $db-&gt;getMergedSet($effectiveUser, $set-&gt;set_id);
        } <span class="keywordflow">else</span> {
            die <span class="stringliteral">&quot;set $set not defined&quot;</span> unless $set;
        }
    }

<span class="preprocessor"># gateways/versioned sets require dealing with output data slightly </span>
<span class="preprocessor"></span><span class="preprocessor"># differently, so check for those here  </span>
<span class="preprocessor"></span>    debug(<span class="stringliteral">&quot;Begin set-type check&quot;</span>);
    my $existVersions = 0;
    my @gwSets = ();
    my @nonGWsets = ();
    my %gwSetNames = ();  # <span class="keyword">this</span> is necessary because we <span class="keyword">get</span> a setname
<span class="preprocessor">                          #    for all versions of g/w tests</span>
<span class="preprocessor"></span>    <span class="keywordflow">foreach</span> ( @sets ) {
        <span class="keywordflow">if</span> ( defined( $_-&gt;assignment_type() ) &amp;&amp; 
         $_-&gt;assignment_type() =~ /gateway/ ) {
        $existVersions = 1; 

        push( @gwSets, $_ ) if ( ! defined($gwSetNames{$_-&gt;set_id}) );
        $gwSetNames{$_-&gt;set_id} = 1;
        } <span class="keywordflow">else</span> {
        push( @nonGWsets, $_ );
        }
    }
<span class="preprocessor"># now get all user set versions that we need</span>
<span class="preprocessor"></span>    my @vSets = ();
<span class="preprocessor"># we need the template sets below, so also make an indexed list of those</span>
<span class="preprocessor"></span>    my %gwSetsBySetID = ();
    <span class="keywordflow">foreach</span> my $set ( @gwSets ) {
        $gwSetsBySetID{$set-&gt;set_id} = $set;

        my @setVer = $db-&gt;listSetVersions( $effectiveUser, $set-&gt;set_id );
        my @setVerIDs = map { [ $effectiveUser, $set-&gt;set_id, $_ ] } @setVer;
        push( @vSets, $db-&gt;getMergedSetVersions( @setVerIDs ) );
    }

<span class="preprocessor"># set sort method</span>
<span class="preprocessor"></span>    $sort = <span class="stringliteral">&quot;status&quot;</span> unless $sort eq <span class="stringliteral">&quot;status&quot;</span> or $sort eq <span class="stringliteral">&quot;name&quot;</span>;

<span class="preprocessor"># now set the headers for the table</span>
<span class="preprocessor"></span>    my $nameHeader = $sort eq <span class="stringliteral">&quot;name&quot;</span>
        ? CGI::u($r-&gt;maketext(<span class="stringliteral">&quot;Name&quot;</span>))
        : CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{sort=&gt;<span class="stringliteral">&quot;name&quot;</span>})}, $r-&gt;maketext(<span class="stringliteral">&quot;Name&quot;</span>));
    my $statusHeader = $sort eq <span class="stringliteral">&quot;status&quot;</span>
        ? CGI::u($r-&gt;maketext(<span class="stringliteral">&quot;Status&quot;</span>))
        : CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{sort=&gt;<span class="stringliteral">&quot;status&quot;</span>})}, $r-&gt;maketext(<span class="stringliteral">&quot;Status&quot;</span>));
<span class="preprocessor"># print the start of the form</span>
<span class="preprocessor"></span>
    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>,-action=&gt;$actionURL),
          $self-&gt;hidden_authen_fields;
    
<span class="preprocessor"># and send the start of the table</span>
<span class="preprocessor"></span><span class="preprocessor"># UPDATE - ghe3</span>
<span class="preprocessor"></span><span class="preprocessor"># This table now contains a summary and a caption, scope attributes for the column headers, and no longer prints a column for &#39;Sel.&#39; (due to it having been merged with the second column for accessibility purposes).</span>
<span class="preprocessor"></span>    print CGI::start_table({ -<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;problem_set_table&quot;</span>, -summary=&gt;<span class="stringliteral">&quot;This table lists out the available homework sets for this class, along with its current status. Click on the link on the name of the homework sets to take you to the problems in that homework set.  Clicking on the links in the table headings will sort the table by the field it corresponds to.  You can also select sets for download to PDF or TeX format using the radio buttons or checkboxes next to the problem set names, and then clicking on the &#39;Download PDF or TeX Hardcopy for Selected Sets&#39; button at the end of the table.  There is also a clear button and an Email instructor button at the end of the table.&quot;</span>});
    print CGI::caption($r-&gt;maketext(<span class="stringliteral">&quot;Homework Sets&quot;</span>));
    <span class="keywordflow">if</span> ( ! $existVersions ) {
        print CGI::Tr({},
            CGI::th({-scope=&gt;<span class="stringliteral">&quot;col&quot;</span>},$nameHeader),
            CGI::th({-scope=&gt;<span class="stringliteral">&quot;col&quot;</span>},$statusHeader),
            );
    } <span class="keywordflow">else</span> {
        print CGI::Tr(
            CGI::th({-scope=&gt;<span class="stringliteral">&quot;col&quot;</span>},$nameHeader),
            CGI::th({-scope=&gt;<span class="stringliteral">&quot;col&quot;</span>},$r-&gt;maketext(<span class="stringliteral">&quot;Test Score&quot;</span>)),
            CGI::th({-scope=&gt;<span class="stringliteral">&quot;col&quot;</span>},$r-&gt;maketext(<span class="stringliteral">&quot;Test Date&quot;</span>)),
            CGI::th({-scope=&gt;<span class="stringliteral">&quot;col&quot;</span>},$statusHeader),
            );
    }

    debug(<span class="stringliteral">&quot;Begin sorting merged sets&quot;</span>);

<span class="preprocessor"># before building final set lists, exclude proctored gateway sets </span>
<span class="preprocessor"></span><span class="preprocessor">#    for users without permission to view them</span>
<span class="preprocessor"></span>    my $viewPr = $authz-&gt;hasPermissions( $user, <span class="stringliteral">&quot;view_proctored_tests&quot;</span> );
    @gwSets = grep {$_-&gt;assignment_type !~ /proctored/ || $viewPr} @gwSets;
    
    <span class="keywordflow">if</span> ( $sort eq <span class="stringliteral">&#39;name&#39;</span> ) {
        @nonGWsets = sortByName(<span class="stringliteral">&quot;set_id&quot;</span>, @nonGWsets);
        @gwSets = sortByName(<span class="stringliteral">&quot;set_id&quot;</span>, @gwSets);
    } elsif ( $sort eq <span class="stringliteral">&#39;status&#39;</span> ) {
        @nonGWsets = sort <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#ac7bfab29e7a2a504d573d8d75ac4780d">byUrgency</a>  @nonGWsets;
        @gwSets = sort <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#ac7bfab29e7a2a504d573d8d75ac4780d">byUrgency</a> @gwSets;
    }
<span class="preprocessor"># we sort set versions by name</span>
<span class="preprocessor"></span>    @vSets = sortByName([<span class="stringliteral">&quot;set_id&quot;</span>, <span class="stringliteral">&quot;version_id&quot;</span>], @vSets);

<span class="preprocessor"># put together a complete list of sorted sets to consider</span>
<span class="preprocessor"></span>    @sets = (@nonGWsets, @gwSets );
    
    debug(<span class="stringliteral">&quot;End preparing merged sets&quot;</span>);

<span class="preprocessor"># we do regular sets and the gateway set templates separately</span>
<span class="preprocessor"></span><span class="preprocessor"># from the actual set-versions, to avoid managing a tricky test</span>
<span class="preprocessor"></span><span class="preprocessor"># for a version number that may not exist</span>
<span class="preprocessor"></span>    <span class="keywordflow">foreach</span> my $set (@sets) {
        die <span class="stringliteral">&quot;set $set not defined&quot;</span> unless $set;
        
        <span class="keywordflow">if</span> ($set-&gt;visible || $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_hidden_sets&quot;</span>)) {
            print $self-&gt;setListRow($set, $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_multiple_sets&quot;</span>), $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_unopened_sets&quot;</span>),$existVersions,$db);
        }
    }
    <span class="keywordflow">foreach</span> my $set (@vSets) {
        die <span class="stringliteral">&quot;set $set not defined&quot;</span> unless $set;
        
        <span class="keywordflow">if</span> ($set-&gt;visible || $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_hidden_sets&quot;</span>)) {
            print $self-&gt;setListRow($set, $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_multiple_sets&quot;</span>), $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_unopened_sets&quot;</span>),$existVersions,$db,1, $gwSetsBySetID{$set-&gt;{set_id}}, <span class="stringliteral">&quot;ethet&quot;</span> );  # 1 = gateway, versioned <span class="keyword">set</span>
        }
    }
    
    print CGI::end_table();
    my $pl = ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_multiple_sets&quot;</span>) ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<span class="preprocessor">#   print CGI::p(CGI::submit(-name=&gt;&quot;hardcopy&quot;, -label=&gt;$r-&gt;maketext(&quot;Download Hardcopy for Selected [plural,_1,Set,Sets]&quot;,$pl)));</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # UPDATE - ghe3</span>
<span class="preprocessor"></span><span class="preprocessor">    # Added reset button to form.</span>
<span class="preprocessor"></span>    print CGI::start_div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;problem_set_options&quot;</span>});
    print CGI::p(<a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(-type=&gt;<span class="stringliteral">&quot;reset&quot;</span>, -input_attr=&gt;{-value=&gt;$r-&gt;maketext(<span class="stringliteral">&quot;Clear&quot;</span>)}));
    print CGI::p(<a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(-type=&gt;<span class="stringliteral">&quot;submit&quot;</span>, -input_attr=&gt;{-name=&gt;<span class="stringliteral">&quot;hardcopy&quot;</span>, -value=&gt;$r-&gt;maketext(<span class="stringliteral">&quot;Download PDF or TeX Hardcopy for Selected Sets&quot;</span>)}));
    print CGI::endform();
    
<span class="preprocessor">    ## feedback form url</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $feedbackPage = $urlpath-&gt;newFromModule(&quot;WeBWorK::ContentGenerator::Feedback&quot;,  $r, courseID =&gt; $courseName);</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $feedbackURL = $self-&gt;systemLink($feedbackPage, authen =&gt; 0); # no authen info for form action</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    ##print feedback form</span>
<span class="preprocessor"></span><span class="preprocessor">    #print</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::start_form(-method=&gt;&quot;POST&quot;, -action=&gt;$feedbackURL),&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   $self-&gt;hidden_authen_fields,&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::hidden(&quot;module&quot;,             __PACKAGE__),&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::hidden(&quot;set&quot;,                &#39;&#39;),&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::hidden(&quot;problem&quot;,            &#39;&#39;),&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::hidden(&quot;displayMode&quot;,        &#39;&#39;),&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::hidden(&quot;showOldAnswers&quot;,     &#39;&#39;),&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::hidden(&quot;showCorrectAnswers&quot;, &#39;&#39;),&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::hidden(&quot;showHints&quot;,          &#39;&#39;),&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::hidden(&quot;showSolutions&quot;,      &#39;&#39;),&quot;\n&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::p({-align=&gt;&quot;left&quot;},</span>
<span class="preprocessor"></span><span class="preprocessor">    #       CGI::submit(-name=&gt;&quot;feedbackForm&quot;, -label=&gt;&quot;Email instructor&quot;)</span>
<span class="preprocessor"></span><span class="preprocessor">    #   ),</span>
<span class="preprocessor"></span><span class="preprocessor">    #   CGI::endform(),&quot;\n&quot;;</span>
<span class="preprocessor"></span>    
    print $self-&gt;feedbackMacro(
        module =&gt; __PACKAGE__,
        <span class="keyword">set</span> =&gt; <span class="stringliteral">&quot;&quot;</span>,
        problem =&gt; <span class="stringliteral">&quot;&quot;</span>,
        displayMode =&gt; <span class="stringliteral">&quot;&quot;</span>,
        showOldAnswers =&gt; <span class="stringliteral">&quot;&quot;</span>,
        showCorrectAnswers =&gt; <span class="stringliteral">&quot;&quot;</span>,
        showHints =&gt; <span class="stringliteral">&quot;&quot;</span>,
        showSolutions =&gt; <span class="stringliteral">&quot;&quot;</span>,
    );
    print CGI::end_div();
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1fd331b6f96ba5831c0912a4d59558e3"></a><!-- doxytag: member="WeBWorK::ContentGenerator::ProblemSets::byname" ref="a1fd331b6f96ba5831c0912a4d59558e3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::ProblemSets::byname </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-byname' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-byname-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-byname-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-byname-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in byname: 1</span>
<span class="preprocessor">sub byname { $a-&gt;set_id cmp $b-&gt;set_id; }</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac7bfab29e7a2a504d573d8d75ac4780d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::ProblemSets::byUrgency" ref="ac7bfab29e7a2a504d573d8d75ac4780d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::ProblemSets::byUrgency </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-byUrgency' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-byUrgency-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-byUrgency-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-byUrgency-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in byUrgency: 20</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#ac7bfab29e7a2a504d573d8d75ac4780d">byUrgency</a> {
    my $mytime = time;
    my @a_parts = ($a-&gt;answer_date + RECENT &lt;= $mytime) ?  (4, $a-&gt;open_date, $a-&gt;due_date, $a-&gt;set_id) 
        : ($a-&gt;answer_date &lt;= $mytime and $mytime &lt; $a-&gt;answer_date + RECENT) ? (3, $a-&gt; answer_date, $a-&gt; due_date, $a-&gt;set_id)
        : ($a-&gt;due_date &lt;= $mytime and $mytime &lt; $a-&gt;answer_date ) ? (2, $a-&gt;answer_date, $a-&gt;due_date, $a-&gt;set_id)
        : ($mytime &lt; $a-&gt;open_date) ? (1, $a-&gt;open_date, $a-&gt;due_date, $a-&gt;set_id) 
        : (0, $a-&gt;due_date, $a-&gt;open_date, $a-&gt;set_id);
    my @b_parts = ($b-&gt;answer_date + RECENT &lt;= $mytime) ?  (4, $b-&gt;open_date, $b-&gt;due_date, $b-&gt;set_id) 
        : ($b-&gt;answer_date &lt;= $mytime and $mytime &lt; $b-&gt;answer_date + RECENT) ? (3, $b-&gt; answer_date, $b-&gt; due_date, $b-&gt;set_id)
        : ($b-&gt;due_date &lt;= $mytime and $mytime &lt; $b-&gt;answer_date ) ? (2, $b-&gt;answer_date, $b-&gt;due_date, $b-&gt;set_id)
        : ($mytime &lt; $b-&gt;open_date) ? (1, $b-&gt;open_date, $b-&gt;due_date, $b-&gt;set_id) 
        : (0, $b-&gt;due_date, $b-&gt;open_date, $b-&gt;set_id);
    my $returnIt=0;
    <span class="keywordflow">while</span> (scalar(@a_parts) &gt; 1) {
        <span class="keywordflow">if</span> ($returnIt = ( (shift @a_parts) &lt;=&gt; (shift @b_parts) ) ) {
            <span class="keywordflow">return</span>($returnIt);
        }
    }
    <span class="keywordflow">return</span> (  $a_parts[0] cmp  $b_parts[0] );
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab03d7aacf4183991adba672b516ef840"></a><!-- doxytag: member="WeBWorK::ContentGenerator::ProblemSets::help" ref="ab03d7aacf4183991adba672b516ef840" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::ProblemSets::help </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-help' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-help-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-help-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-help-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in help: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#ab03d7aacf4183991adba672b516ef840">help</a> {   # non-standard <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#ab03d7aacf4183991adba672b516ef840">help</a>, since the file path includes the course name
    my $self = shift;
    my $args = shift;
    my $name = $args-&gt;{name};
    $name = lc(<span class="stringliteral">&#39;course home&#39;</span>) unless defined($name);
    $name =~ s/\s/_/g;
    $self-&gt;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#a1be610734417d821e70a6ea3aacc2d2c">helpMacro</a>($name);
}
</pre></div>  
</div>
 
<p>Reimplemented from <a class="el" href="classWeBWorK_1_1ContentGenerator.html#ad368add880776c30947f30884d01a2cc">WeBWorK::ContentGenerator</a>.</p>

</div>
</div>
<a class="anchor" id="af9219d0e8b814c65610235cf6c71730b"></a><!-- doxytag: member="WeBWorK::ContentGenerator::ProblemSets::info" ref="af9219d0e8b814c65610235cf6c71730b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::ProblemSets::info </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-info' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-info-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-info-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-info-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in info: 56</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#af9219d0e8b814c65610235cf6c71730b">info</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $urlpath = $r-&gt;urlpath;
    my $authz = $r-&gt;authz;
    
    my $courseID = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $user = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    
    my $course_info = $ce-&gt;{courseFiles}-&gt;{course_info};
    
    <span class="keywordflow">if</span> (defined $course_info and $course_info) {
        my $course_info_path = $ce-&gt;{courseDirs}-&gt;{templates} . <span class="stringliteral">&quot;/$course_info&quot;</span>;
        
        print CGI::start_div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;info-wrapper&quot;</span>});
        print CGI::start_div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;info-box&quot;</span>, <span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;InfoPanel&quot;</span>});
        
<span class="preprocessor">        # deal with instructor crap</span>
<span class="preprocessor"></span>        my $editorURL;
        <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>)) {
            <span class="keywordflow">if</span> (defined $r-&gt;param(<span class="stringliteral">&quot;editMode&quot;</span>) and $r-&gt;param(<span class="stringliteral">&quot;editMode&quot;</span>) eq <span class="stringliteral">&quot;temporaryFile&quot;</span>) {
                $course_info_path = $r-&gt;param(<span class="stringliteral">&quot;sourceFilePath&quot;</span>);
                $course_info_path = $ce-&gt;{courseDirs}{templates}.<span class="charliteral">&#39;/&#39;</span>.$course_info_path unless $course_info_path =~ m!^/!;
                die <span class="stringliteral">&quot;sourceFilePath is unsafe!&quot;</span> unless path_is_subdir($course_info_path, $ce-&gt;{courseDirs}-&gt;{templates});
                $self-&gt;addmessage(CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&#39;temporaryFile&#39;</span>}, $r-&gt;maketext(<span class="stringliteral">&quot;Viewing temporary file: &quot;</span>), $course_info_path));
            }
            
            my $editorPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::PGProblemEditor&quot;</span>,  $r, courseID =&gt; $courseID);
            $editorURL = $self-&gt;systemLink($editorPage, params =&gt; { file_type =&gt; <span class="stringliteral">&quot;course_info&quot;</span> });
        }
        
        <span class="keywordflow">if</span> ($editorURL) {
            print CGI::h2($r-&gt;maketext(<span class="stringliteral">&quot;Course Info&quot;</span>), CGI::a({href=&gt;$editorURL, target=&gt;<span class="stringliteral">&quot;WW_Editor&quot;</span>}, $r-&gt;maketext(<span class="stringliteral">&quot;~[edit~]&quot;</span>)));
        } <span class="keywordflow">else</span> {
            print CGI::h2($r-&gt;maketext(<span class="stringliteral">&quot;Course Info&quot;</span>));
        }
        
        <span class="keywordflow">if</span> (-f $course_info_path) { #check that it<span class="stringliteral">&#39;s a plain  file</span>
<span class="stringliteral">            my $text = eval { readFile($course_info_path) };</span>
<span class="stringliteral">            if ($@) {</span>
<span class="stringliteral">                print CGI::div({class=&gt;&quot;ResultsWithError&quot;},</span>
<span class="stringliteral">                    CGI::p(&quot;$@&quot;),</span>
<span class="stringliteral">                );</span>
<span class="stringliteral">            } else {</span>
<span class="stringliteral">                print $text;</span>
<span class="stringliteral">            }</span>
<span class="stringliteral">        }</span>
<span class="stringliteral"></span>
<span class="stringliteral">        print CGI::end_div();</span>
<span class="stringliteral">        print CGI::end_div();</span>
<span class="stringliteral">        </span>
<span class="stringliteral">        return &quot;&quot;;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a073a5242562bfbcb2b7ebfd24925e17b"></a><!-- doxytag: member="WeBWorK::ContentGenerator::ProblemSets::initialize" ref="a073a5242562bfbcb2b7ebfd24925e17b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::ProblemSets::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in initialize: 20</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#a073a5242562bfbcb2b7ebfd24925e17b">initialize</a> {



<span class="preprocessor"># get result and send to message</span>
<span class="preprocessor"></span>    my ($self) = @_;
    my $r = $self-&gt;r;
    my $authz = $r-&gt;authz;
    my $urlpath = $r-&gt;urlpath;
    
    my $user               = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    my $effectiveUser      = $r-&gt;param(<span class="stringliteral">&quot;effectiveUser&quot;</span>);
    <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>)) {
<span class="preprocessor">        # get result and send to message</span>
<span class="preprocessor"></span>        my $status_message = $r-&gt;param(<span class="stringliteral">&quot;status_message&quot;</span>);
        $self-&gt;addmessage(CGI::p(<span class="stringliteral">&quot;$status_message&quot;</span>)) <span class="keywordflow">if</span> $status_message;
    

    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a8d5e20be983af40e16cd048c66e6a5df"></a><!-- doxytag: member="WeBWorK::ContentGenerator::ProblemSets::setListRow" ref="a8d5e20be983af40e16cd048c66e6a5df" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::ProblemSets::setListRow </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-setListRow' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-setListRow-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-setListRow-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-setListRow-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in setListRow: 223</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1ProblemSets.html#a8d5e20be983af40e16cd048c66e6a5df">setListRow</a> {
    my ($self, $set, $multiSet, $preOpenSets, $existVersions, $db,
        $gwtype, $tmplSet) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $authz = $r-&gt;authz;
    my $user = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    my $urlpath = $r-&gt;urlpath;
    $gwtype = 0 <span class="keywordflow">if</span> ( ! defined( $gwtype ) );
    $tmplSet = $set <span class="keywordflow">if</span> ( ! defined( $tmplSet ) );
    
    my $name = $set-&gt;set_id;
    my $urlname = ( $gwtype == 1 ) ? <span class="stringliteral">&quot;$name,v&quot;</span> . $set-&gt;version_id : $name;

    my $courseName      = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    
    my $problemSetPage;

    <span class="keywordflow">if</span> ( ! defined( $set-&gt;assignment_type() ) || 
         $set-&gt;assignment_type() !~ /gateway/ ) {
        $problemSetPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::ProblemSet&quot;</span>, $r, 
                      courseID =&gt; $courseName, setID =&gt; $urlname);
    } elsif( $set-&gt;assignment_type() !~ /proctored/ ) {

        $problemSetPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::GatewayQuiz&quot;</span>, $r, 
                      courseID =&gt; $courseName, setID =&gt; $urlname);
    } <span class="keywordflow">else</span> {

        $problemSetPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::GatewayQuiz&quot;</span>, $r, 
                      courseID =&gt; $courseName, setID =&gt; $urlname);
    }

    my $interactiveURL = $self-&gt;systemLink($problemSetPage,
                                           params=&gt;{  displayMode =&gt; $self-&gt;{displayMode}, 
                                                      showOldAnswers =&gt; $self-&gt;{will}-&gt;{showOldAnswers}
                                           }
    );

<span class="preprocessor">  # check to see if this is a template gateway assignment</span>
<span class="preprocessor"></span>    $gwtype = 2 <span class="keywordflow">if</span> ( defined( $set-&gt;assignment_type() ) &amp;&amp; 
             $set-&gt;assignment_type() =~ /gateway/ &amp;&amp; ! $gwtype );
<span class="preprocessor">  # and get problemRecords if we&#39;re dealing with a versioned set, so that</span>
<span class="preprocessor"></span><span class="preprocessor">  #    we can test status and scores</span>
<span class="preprocessor"></span><span class="preprocessor">  # FIXME: should we really have to get the merged </span>
<span class="preprocessor"></span><span class="preprocessor">  # problem_versions here?  it looks that way, because</span>
<span class="preprocessor"></span><span class="preprocessor">  # otherwise we don&#39;t inherit things like the problem</span>
<span class="preprocessor"></span><span class="preprocessor">  # value properly.</span>
<span class="preprocessor"></span>    my @problemRecords = 
        $db-&gt;getAllProblemVersions($set-&gt;user_id(), $set-&gt;set_id(),
                       $set-&gt;version_id()) 
        <span class="keywordflow">if</span> ( $gwtype == 1 );

<span class="preprocessor">  # the conditional here should be redundant.  ah well.</span>
<span class="preprocessor"></span>    $interactiveURL =~ s|/quiz_mode/|/proctored_quiz_mode/| <span class="keywordflow">if</span> 
        ( defined( $set-&gt;assignment_type() ) &amp;&amp; 
          $set-&gt;assignment_type() eq <span class="stringliteral">&#39;proctored_gateway&#39;</span> );
    
    $name =~ s/_/&amp;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#a0b04a9c84777c525b5d1a7683331f7ee">nbsp</a>;/g;
<span class="preprocessor"># this is the link to the homework assignment</span>
<span class="preprocessor"></span>    my $interactive = CGI::a({-href=&gt;$interactiveURL}, <span class="stringliteral">&quot;$name&quot;</span>);
    
    my $control = <span class="stringliteral">&quot;&quot;</span>;
    
    my $setIsOpen = 0;
    my $status = <span class="stringliteral">&#39;&#39;</span>;
    <span class="keywordflow">if</span> ( $gwtype ) {
        <span class="keywordflow">if</span> ( $gwtype == 1 ) {
          unless (ref($problemRecords[0]) ) {warn <span class="stringliteral">&quot;Error: problem not defined in set $name&quot;</span>; <span class="keywordflow">return</span>()}
            <span class="keywordflow">if</span> ( $problemRecords[0]-&gt;num_correct() + 
                 $problemRecords[0]-&gt;num_incorrect() &gt;= 
                 ( ( !($set-&gt;attempts_per_version()) ) ? 0 : $set-&gt;attempts_per_version() ) ) {
                $status = $r-&gt;maketext(<span class="stringliteral">&quot;completed.&quot;</span>);
            } elsif ( time() &gt; $set-&gt;due_date() + 
                  $self-&gt;r-&gt;ce-&gt;{gatewayGracePeriod} ) {
                $status = $r-&gt;maketext(<span class="stringliteral">&quot;over time: closed.&quot;</span>);
            } <span class="keywordflow">else</span> {
                $status = $r-&gt;maketext(<span class="stringliteral">&quot;open: complete by [_1]&quot;</span>,  
                    $self-&gt;formatDateTime($set-&gt;due_date()));
            }
<span class="preprocessor">            # we let people go back to old tests</span>
<span class="preprocessor"></span>            $setIsOpen = 1;

<span class="preprocessor">            # reset the link to give the test number</span>
<span class="preprocessor"></span>            my $vnum = $set-&gt;version_id;
            $interactive = CGI::a({-href=&gt;$interactiveURL},
                          $r-&gt;maketext(<span class="stringliteral">&quot;[_1] (test [_2])&quot;</span>, $name, $vnum));
        } <span class="keywordflow">else</span> {
            my $t = time();
            <span class="keywordflow">if</span> ( $t &lt; $set-&gt;open_date() ) {
                $status = $r-&gt;maketext(<span class="stringliteral">&quot;will open on [_1]&quot;</span>, $self-&gt;formatDateTime($set-&gt;open_date));
                <span class="keywordflow">if</span> ( $preOpenSets ) {
<span class="preprocessor">                    # reset the link</span>
<span class="preprocessor"></span>                    $interactive = CGI::a({-href=&gt;$interactiveURL},
                                  $r-&gt;maketext(<span class="stringliteral">&quot;Take [_1] test&quot;</span>, $name));
                } <span class="keywordflow">else</span> {
                    $control = <span class="stringliteral">&quot;&quot;</span>;
                    $interactive = $r-&gt;maketext(<span class="stringliteral">&quot;[_1] test&quot;</span>, $name);
                }
            } elsif ( $t &lt; $set-&gt;due_date() ) {
                $status = $r-&gt;maketext(<span class="stringliteral">&quot;now open, due &quot;</span>) . $self-&gt;formatDateTime($set-&gt;due_date);
                $setIsOpen = 1;
                $interactive = CGI::a({-href=&gt;$interactiveURL},
                              $r-&gt;maketext(<span class="stringliteral">&quot;Take [_1] test&quot;</span>, $name));
            } <span class="keywordflow">else</span> {
                $status = $r-&gt;maketext(<span class="stringliteral">&quot;Closed&quot;</span>);

                <span class="keywordflow">if</span> ( $authz-&gt;hasPermissions( $user, <span class="stringliteral">&quot;record_answers_after_due_date&quot;</span> ) ) {
                    $interactive = CGI::a({-href=&gt;$interactiveURL},
                                  $r-&gt;maketext(<span class="stringliteral">&quot;Take [_1] test&quot;</span>, $name));
                } <span class="keywordflow">else</span> {
                    $interactive = $r-&gt;maketext(<span class="stringliteral">&quot;[_1] test&quot;</span>, $name);
                }
            }
        }

<span class="preprocessor"># old conditional</span>
<span class="preprocessor"></span>    } elsif (time &lt; $set-&gt;open_date) {
        $status = $r-&gt;maketext(<span class="stringliteral">&quot;will open on [_1]&quot;</span>, $self-&gt;formatDateTime($set-&gt;open_date));
        $control = <span class="stringliteral">&quot;&quot;</span> unless $preOpenSets;
        $interactive = $name unless $preOpenSets;
    } elsif (time &lt; $set-&gt;due_date) {
            $status = $r-&gt;maketext(<span class="stringliteral">&quot;now open, due &quot;</span>) . $self-&gt;formatDateTime($set-&gt;due_date);
            my $enable_reduced_scoring = $set-&gt;enable_reduced_scoring;
            my $reducedScoringPeriod = $ce-&gt;{pg}-&gt;{ansEvalDefaults}-&gt;{reducedScoringPeriod};
            <span class="keywordflow">if</span> ($reducedScoringPeriod &gt; 0 and $enable_reduced_scoring ) {
                my $reducedScoringPeriodSec = $reducedScoringPeriod*60;   # $reducedScoringPeriod is in minutes
                my $beginReducedScoringPeriod =  $self-&gt;formatDateTime($set-&gt;due_date() - $reducedScoringPeriodSec);
<span class="preprocessor">#               $status .= &#39;. &lt;FONT COLOR=&quot;#cc6600&quot;&gt;Reduced Credit starts &#39; . $beginReducedScoringPeriod . &#39;&lt;/FONT&gt;&#39;;</span>
<span class="preprocessor"></span>                $status .= CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsAlert&quot;</span>}, $r-&gt;maketext(<span class="stringliteral">&quot;Reduced Credit Starts: [_1]&quot;</span>, $beginReducedScoringPeriod));

            }
        $setIsOpen = 1;
    } elsif (time &lt; $set-&gt;answer_date) {
        $status = $r-&gt;maketext(<span class="stringliteral">&quot;closed, answers on [_1]&quot;</span>, $self-&gt;formatDateTime($set-&gt;answer_date));
    } elsif ($set-&gt;answer_date &lt;= time and time &lt; $set-&gt;answer_date +RECENT ) {
        $status = $r-&gt;maketext(<span class="stringliteral">&quot;closed, answers recently available&quot;</span>);
    } <span class="keywordflow">else</span> {
        $status = $r-&gt;maketext(<span class="stringliteral">&quot;closed, answers available&quot;</span>);
    }
    
    <span class="keywordflow">if</span> ($multiSet) {
        <span class="keywordflow">if</span> ( $gwtype &lt; 2 ) {
            $control = <a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(
                -type=&gt;<span class="stringliteral">&quot;checkbox&quot;</span>,
                -<span class="keywordtype">id</span>=&gt;$name . ($gwtype ? <span class="stringliteral">&quot;,v&quot;</span> . $set-&gt;version_id : <span class="stringliteral">&#39;&#39;</span>),
                -label_text=&gt;$interactive,
                -input_attr=&gt;{
                    -name=&gt;<span class="stringliteral">&quot;selected_sets&quot;</span>,
                    -value=&gt;$name . ($gwtype ? <span class="stringliteral">&quot;,v&quot;</span> . $set-&gt;version_id : <span class="stringliteral">&#39;&#39;</span>)
                    }
            );
        } <span class="keywordflow">else</span> {
            $control = $interactive;
        }
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">if</span> ( $gwtype &lt; 2 ) {
            my $n = $name  . ($gwtype ? <span class="stringliteral">&quot;,v&quot;</span> . $set-&gt;version_id : <span class="stringliteral">&#39;&#39;</span>);
            $control = <a class="code" href="classWeBWorK.html#a0e533467c35899fd4d882a3a36fc04b5">WeBWorK::CGI_labeled_input</a>(
                -type=&gt;<span class="stringliteral">&quot;radio&quot;</span>,
                -<span class="keywordtype">id</span>=&gt;$n,
                -label_text=&gt;$interactive,
                -input_attr=&gt;{
                    -name=&gt;<span class="stringliteral">&quot;selected_sets&quot;</span>,
                    -value=&gt;$n
                    }
            );
        } <span class="keywordflow">else</span> {
            $control = $interactive;
        }
    }

    my $visiblityStateClass = ($set-&gt;visible) ? <span class="stringliteral">&quot;visible&quot;</span> : <span class="stringliteral">&quot;hidden&quot;</span>;

    $status = CGI::font({<span class="keyword">class</span>=&gt;$visiblityStateClass}, $status) <span class="keywordflow">if</span> $preOpenSets;
    
<span class="preprocessor"># check to see if we need to return a score and a date column</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ! $existVersions ) {
        <span class="keywordflow">return</span> CGI::Tr(CGI::td([
                 $control,
                     $status,
        ]));
    } <span class="keywordflow">else</span> {
        my ( $startTime, $score );

        <span class="keywordflow">if</span> ( defined( $set-&gt;assignment_type() ) &amp;&amp; 
             $set-&gt;assignment_type() =~ /gateway/ &amp;&amp; $gwtype == 1 ) {
            $startTime = localtime($set-&gt;version_creation_time() || 0); #fixes error <a class="code" href="classWeBWorK_1_1ContentGenerator.html#a265ffdacc7577cf63e2ad7519dbdb0a2">message</a> <span class="keywordflow">for</span> undefined creation_time

            <span class="keywordflow">if</span> ( $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;view_hidden_work&quot;</span>) || 
                 $set-&gt;hide_score_by_problem eq <span class="charliteral">&#39;Y&#39;</span> ||
                 $set-&gt;hide_score() eq <span class="charliteral">&#39;N&#39;</span> || 
                 ( $set-&gt;hide_score eq <span class="stringliteral">&#39;BeforeAnswerDate&#39;</span> &amp;&amp; time &gt; $tmplSet-&gt;answer_date() ) ) {
<span class="preprocessor">                # find score</span>
<span class="preprocessor"></span>
<span class="preprocessor">            # DBFIXME we can do this math in the database, i think</span>
<span class="preprocessor"></span>                my $possible = 0;
                $score = 0;
                <span class="keywordflow">foreach</span> my $pRec ( @problemRecords ) {
                    my $pval = $pRec-&gt;value() ? $pRec-&gt;value() : 1;
                        <span class="keywordflow">if</span> ( defined( $pRec ) &amp;&amp; 
                         $score ne <span class="stringliteral">&#39;undef&#39;</span> ) {
                        $score += $pRec-&gt;status()*$pval || 0;
                    } <span class="keywordflow">else</span> {
                        $score = <span class="stringliteral">&#39;undef&#39;</span>;
                    }
                    $possible += $pval;
                }
                $score = <span class="stringliteral">&quot;$score/$possible&quot;</span>;
            } <span class="keywordflow">else</span> {
                $score = <span class="stringliteral">&quot;n/a&quot;</span>;
            }
        } <span class="keywordflow">else</span> {
            $startTime = <span class="stringliteral">&#39;&amp;nbsp;&#39;</span>;
            $score = $startTime;
        }
        <span class="keywordflow">return</span> CGI::Tr(CGI::td([
                             $control,
                             $score,
                             $startTime,
                             $status,
        ]));
    }
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="ProblemSets_8pm_source.html">ProblemSets.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:58:49 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
