<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::ContentGenerator::Instructor::Stats Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator.html">ContentGenerator</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html">Instructor</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html">Stats</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::ContentGenerator::Instructor::Stats Class Reference</h1><!-- doxytag: class="WeBWorK::ContentGenerator::Instructor::Stats" --><!-- doxytag: inherits="WeBWorK::ContentGenerator::Instructor" --><div class="dynheader">
Inheritance diagram for WeBWorK::ContentGenerator::Instructor::Stats:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats__inherit__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats_inherit__map" id="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats_inherit__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html" title="WeBWorK::ContentGenerator::Instructor" alt="" coords="24,155,280,181"/><area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="56,80,248,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="111,5,193,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::ContentGenerator::Instructor::Stats:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats__coll__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats_coll__map" id="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats_coll__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html" title="WeBWorK::ContentGenerator::Instructor" alt="" coords="24,155,280,181"/><area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="56,80,248,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="111,5,193,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a7037799a4cfa6d1752f160bfd2d328db">prevent_repeats</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a2802b5d58fef67a14e82bf042bcf7b72">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#ae9d4fffc5b50f85a64a825143cacc198">siblings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a7747184a2ebc16ed2de0e09e8640f0e4">body</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#ab23a55c1390e84e4cc4fb968f02c2a5e">displaySets</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#ae1b3bdce87e9463c05548ef24b5596e7">index</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a186a5b734f7cb8854c94b6f209f813f9">threeSpaceFill</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#afea71cd9d2cf54e33fab0f2467784de8">determine_percentiles</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a3953fcaddca72a27a5e8c6c2c176c5db">round_score</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a3ffc9b8b69c6f6a6f9aa155ae88342e4">title</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html">WeBWorK::ContentGenerator::Instructor::Stats</a> - Display statistics by user or homework set. </p>

<p>Definition at line <a class="el" href="Stats_8pm_source.html#l00020">20</a> of file <a class="el" href="Stats_8pm_source.html">Stats.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a7747184a2ebc16ed2de0e09e8640f0e4"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::body" ref="a7747184a2ebc16ed2de0e09e8640f0e4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::body </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-body' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-body-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-body-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-body-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in body: 46</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a7747184a2ebc16ed2de0e09e8640f0e4">body</a> {
    my $self       = shift;
    my $r          = $self-&gt;r;
    my $urlpath    = $r-&gt;urlpath;
    my $db         = $r-&gt;db;
    my $ce         = $r-&gt;ce;
    my $authz      = $r-&gt;authz;
    my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $user       = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $type       = $self-&gt;{type};

<span class="preprocessor">    # Check permissions</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, CGI::p($r-&gt;maketext(<span class="stringliteral">&quot;You are not authorized to access instructor tools&quot;</span>)))
        unless $authz-&gt;hasPermissions($user, &quot;access_instructor_tools&quot;);
    
    if ($type eq &#39;student&#39;) {
        my $studentName = $self-&gt;{studentName};
        my $studentRecord = $db-&gt;getUser($studentName) # checked
            or die $r-&gt;maketext(<span class="stringliteral">&quot;record for user [_1] not found&quot;</span>, $studentName);
        my $fullName = $studentRecord-&gt;full_name;
        my $courseHomePage = $urlpath-&gt;new(type  =&gt; <span class="stringliteral">&#39;set_list&#39;</span>,
            args =&gt; {courseID=&gt;$courseName});
        my $email = $studentRecord-&gt;email_address;
        
        print CGI::a({-href=&gt;<span class="stringliteral">&quot;mailto:$email&quot;</span>}, $email), CGI::br(),
            $r-&gt;maketext(<span class="stringliteral">&quot;Section:&quot;</span>).<span class="stringliteral">&quot; &quot;</span>, $studentRecord-&gt;section, CGI::br(),
            $r-&gt;maketext(<span class="stringliteral">&quot;Recitation:&quot;</span>).<span class="stringliteral">&quot; &quot;</span>, $studentRecord-&gt;recitation, CGI::br();
        
        <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;become_student&quot;</span>)) {
            my $act_as_student_url = $self-&gt;systemLink($courseHomePage,
                params =&gt; {effectiveUser=&gt;$studentName});
            
            print $r-&gt;maketext(<span class="stringliteral">&#39;Act as:&#39;</span>).<span class="stringliteral">&quot; &quot;</span>, CGI::a({-href=&gt;$act_as_student_url},$studentRecord-&gt;user_id);
        }
        
        print <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Grades.html#ae4abb37ae251c756b26b293643982811">WeBWorK::ContentGenerator::Grades::displayStudentStats</a>($self,$studentName);
    } elsif( $type eq <span class="stringliteral">&#39;set&#39;</span>) {
        $self-&gt;displaySets($self-&gt;{setName});
    } elsif ($type eq <span class="stringliteral">&#39;&#39;</span>) {
        $self-&gt;index;
    } <span class="keywordflow">else</span> {
        warn $r-&gt;maketext(<span class="stringliteral">&quot;Don&#39;t recognize statistics display type: |[_1]|&quot;</span>, $type);
    }
    
    <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="afea71cd9d2cf54e33fab0f2467784de8"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::determine_percentiles" ref="afea71cd9d2cf54e33fab0f2467784de8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::determine_percentiles </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-determine_percentiles' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-determine_percentiles-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-determine_percentiles-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-determine_percentiles-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in determine_percentiles: 15</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#afea71cd9d2cf54e33fab0f2467784de8">determine_percentiles</a> {
    my $percent_brackets  = shift;
    my @list_of_scores    = @_;
    @list_of_scores       = sort {$a&lt;=&gt;$b} @list_of_scores;
    my %percentiles          = ();
    my $num_students      = $#list_of_scores;
    <span class="keywordflow">foreach</span> my $percentage (@{$percent_brackets}) {
        $percentiles{$percentage} = @list_of_scores[int( (100-$percentage)*$num_students/100)];
        $percentiles{$percentage} =0 unless defined($percentiles{$percentage});  #in <span class="keywordflow">case</span> no students have tried <span class="keyword">this</span> question
    }
<span class="preprocessor">    # for example</span>
<span class="preprocessor"></span><span class="preprocessor">    # $percentiles{75}  = @list_of_scores[int( 25*$num_students/100)]; </span>
<span class="preprocessor"></span><span class="preprocessor">    # means that 75% of the students received this score ($percentiles{75}) or higher</span>
<span class="preprocessor"></span>    %percentiles;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab23a55c1390e84e4cc4fb968f02c2a5e"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::displaySets" ref="ab23a55c1390e84e4cc4fb968f02c2a5e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::displaySets </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-displaySets' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-displaySets-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-displaySets-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-displaySets-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in displaySets: 338</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#ab23a55c1390e84e4cc4fb968f02c2a5e">displaySets</a> {
    my $self             = shift;   
    my $r                = $self-&gt;r;
    my $urlpath          = $r-&gt;urlpath;
    my $db               = $r-&gt;db;
    my $ce               = $r-&gt;ce;
    my $authz            = $r-&gt;authz;
    my $courseName       = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $setName          = $urlpath-&gt;arg(<span class="stringliteral">&quot;setID&quot;</span>);
    my $user             = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $setRecord        = $self-&gt;{setRecord};
    my $root             = $ce-&gt;{webworkURLs}-&gt;{root};
    
    my $setStatsPage     = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, courseID=&gt;$courseName,statType=&gt;<span class="stringliteral">&#39;sets&#39;</span>,setID=&gt;$setName);
    my $sort_method_name = $r-&gt;param(<span class="stringliteral">&#39;sort&#39;</span>);  
<span class="preprocessor">    # DBFIXME duplicate call</span>
<span class="preprocessor"></span>    my @studentList      = $db-&gt;listUsers;
    
    my @index_list                           = ();  # list of all student <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#ae1b3bdce87e9463c05548ef24b5596e7">index</a> 
    my @score_list                           = ();  # list of all student total percentage scores 
    my %attempts_list_for_problem            = ();  # a list of the number of attempts <span class="keywordflow">for each</span> problem
    my %number_of_attempts_for_problem       = ();  # the total number of attempst <span class="keywordflow">for</span> <span class="keyword">this</span> problem (sum of above list)
    my %number_of_students_attempting_problem = ();  # the number of students attempting <span class="keyword">this</span> problem.
    my %correct_answers_for_problem          = ();  # the number of students correctly answering <span class="keyword">this</span> problem (partial correctness allowed)
    my $sort_method = sub {
        my ($a,$b) = @_;
        <span class="keywordflow">return</span> 0 unless defined($sort_method_name);
        <span class="keywordflow">return</span> $b-&gt;{score} &lt;=&gt; $a-&gt;{score} <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;score&#39;</span>;
        <span class="keywordflow">return</span> $b-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#ae1b3bdce87e9463c05548ef24b5596e7">index</a>} &lt;=&gt; $a-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#ae1b3bdce87e9463c05548ef24b5596e7">index</a>} <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;index&#39;</span>;
        <span class="keywordflow">return</span> $a-&gt;{section} cmp $b-&gt;{section} <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;section&#39;</span>;
        <span class="keywordflow">if</span> ($sort_method_name =~/p(\d+)/) {
            my $left  =  $b-&gt;{problemData}-&gt;{$1} ||0;
            my $right =  $a-&gt;{problemData}-&gt;{$1} ||0;
            <span class="keywordflow">return</span> $left &lt;=&gt; $right;  # sort by number of attempts.
        }

    };

<span class="preprocessor">###############################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#  Print tables</span>
<span class="preprocessor"></span><span class="preprocessor">###############################################################</span>
<span class="preprocessor"></span>    
    my $max_num_problems  = 0;
<span class="preprocessor">    # get user records</span>
<span class="preprocessor"></span>    debug(<span class="stringliteral">&quot;Begin obtaining problem records for  set $setName&quot;</span>);
<span class="preprocessor">    # DBFIXME use an iterator</span>
<span class="preprocessor"></span>    my @userRecords  = $db-&gt;getUsers(@studentList);
    debug(<span class="stringliteral">&quot;End obtaining user records for set $setName&quot;</span>);
    debug(<span class="stringliteral">&quot;begin main loop&quot;</span>);
    my @augmentedUserRecords    = ();
    my $number_of_active_students;
    
<span class="preprocessor">    ########################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # Notes for factoring this calculation</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    # Inputs include:</span>
<span class="preprocessor"></span><span class="preprocessor">    # $user</span>
<span class="preprocessor"></span><span class="preprocessor">    # $setName</span>
<span class="preprocessor"></span><span class="preprocessor">    # @userRecords</span>
<span class="preprocessor"></span><span class="preprocessor">    #               @problemRecords  these are fetched for each student in @userRecords</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    ###################################</span>
<span class="preprocessor"></span>   
    <span class="keywordflow">foreach</span> my $studentRecord (@userRecords)   {
        next unless ref($studentRecord);
        my $student = $studentRecord-&gt;user_id;
        next <span class="keywordflow">if</span> $studentRecord-&gt;last_name =~/^practice/i;  # don<span class="stringliteral">&#39;t show practice users</span>
<span class="stringliteral">        next unless $ce-&gt;status_abbrev_has_behavior($studentRecord-&gt;status, &quot;include_in_stats&quot;);</span>
<span class="stringliteral">        $number_of_active_students++;</span>
<span class="stringliteral">        my $string          = &#39;</span><span class="stringliteral">&#39;;</span>
<span class="stringliteral">        my $twoString       = &#39;</span><span class="stringliteral">&#39;;</span>
<span class="stringliteral">        my $totalRight      = 0;</span>
<span class="stringliteral">        my $total           = 0;</span>
<span class="stringliteral">        my $total_num_of_attempts_for_set = 0;</span>
<span class="stringliteral">        my %h_problemData   = ();</span>
<span class="stringliteral">        my $probNum         = 0;</span>
<span class="stringliteral">        </span>
<span class="stringliteral">        debug(&quot;Begin obtaining problem records for user $student set $setName&quot;);</span>
<span class="stringliteral">        </span>
<span class="stringliteral">        # DBFIXME use an iterator</span>
<span class="stringliteral">        my @problemRecords;</span>
<span class="stringliteral">        if ( $setRecord-&gt;assignment_type =~ /gateway/ ) {</span>
<span class="stringliteral">            my @setVersions = $db-&gt;listSetVersions($student, $setName);</span>
<span class="stringliteral">            foreach my $ver ( @setVersions ) {</span>
<span class="stringliteral">                push( @problemRecords,</span>
<span class="stringliteral">                      $db-&gt;getAllProblemVersions($student,</span>
<span class="stringliteral">                                 $setName, $ver) );</span>
<span class="stringliteral">            }</span>
<span class="stringliteral">        } else {</span>
<span class="stringliteral">            @problemRecords = sort {$a-&gt;problem_id &lt;=&gt; $b-&gt;problem_id } $db-&gt;getAllUserProblems( $student, $setName );</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">        debug(&quot;End obtaining problem records for user $student set $setName&quot;);</span>
<span class="stringliteral"></span>
<span class="stringliteral">        my $num_of_problems = @problemRecords;</span>
<span class="stringliteral">        $max_num_problems = ($max_num_problems&gt;= $num_of_problems) ? $max_num_problems : $num_of_problems;</span>
<span class="stringliteral">       ########################################</span>
<span class="stringliteral">        # Notes for factoring the calculation in this loop.</span>
<span class="stringliteral">        #</span>
<span class="stringliteral">        # Inputs include:</span>
<span class="stringliteral">        # </span>
<span class="stringliteral">        #</span>
<span class="stringliteral">        # @problemRecords  </span>
<span class="stringliteral">        # returns</span>
<span class="stringliteral">        #       $num_of_attempts</span>
<span class="stringliteral">        #       $status</span>
<span class="stringliteral">        # updates</span>
<span class="stringliteral">        #       $number_of_students_attempting_problem{$probID}++;</span>
<span class="stringliteral">        #       @{ $attempts_list_for_problem{$probID} }   </span>
<span class="stringliteral">        #       $number_of_attempts_for_problem{$probID}          </span>
<span class="stringliteral">        #       $total_num_of_attempts_for_set                    </span>
<span class="stringliteral">        #       $correct_answers_for_problem{$probID}   </span>
<span class="stringliteral">        #    </span>
<span class="stringliteral">        #       $string (formatting output)</span>
<span class="stringliteral">        #       $twoString (more formatted output)</span>
<span class="stringliteral">        #       $total</span>
<span class="stringliteral">        #       $totalRight</span>
<span class="stringliteral">        ###################################</span>
<span class="stringliteral">   </span>
<span class="stringliteral">        foreach my $problemRecord (@problemRecords) {</span>
<span class="stringliteral">            next unless ref($problemRecord);</span>
<span class="stringliteral"></span>
<span class="stringliteral">                # warn &quot;Can&#39;</span>t find record <span class="keywordflow">for</span> problem $prob in <span class="keyword">set</span> $setName <span class="keywordflow">for</span> $student<span class="stringliteral">&quot;;</span>
<span class="stringliteral">                # FIXME check the legitimate reasons why a student record might not be defined</span>
<span class="stringliteral">            ####################################################################</span>
<span class="stringliteral">            # Grab data from the database</span>
<span class="stringliteral">            ####################################################################</span>
<span class="stringliteral">            # It&#39;s possible that $problemRecord-&gt;num_correct or $problemRecord-&gt;num_correct</span>
<span class="stringliteral">            # or $problemRecord-&gt;status is an empty </span>
<span class="stringliteral">            # or blank string instead of 0.  The || clause fixes this and prevents </span>
<span class="stringliteral">            # warning messages in the comparisons below.</span>
<span class="stringliteral">            </span>
<span class="stringliteral">            my $probID             = $problemRecord-&gt;problem_id;</span>
<span class="stringliteral">            my $attempted          = $problemRecord-&gt;attempted;</span>
<span class="stringliteral">            my $num_correct        = $problemRecord-&gt;num_correct     || 0;</span>
<span class="stringliteral">            my $num_incorrect      = $problemRecord-&gt;num_incorrect   || 0;</span>
<span class="stringliteral">            my $num_of_attempts    = $num_correct + $num_incorrect;</span>
<span class="stringliteral">            </span>
<span class="stringliteral">            # initialize the number of correct answers for this problem </span>
<span class="stringliteral">            # if the value has not been defined.</span>
<span class="stringliteral">            $correct_answers_for_problem{$probID}  = 0 unless defined($correct_answers_for_problem{$probID});</span>
<span class="stringliteral">        </span>
<span class="stringliteral">            </span>
<span class="stringliteral">            my $probValue          = $problemRecord-&gt;value;</span>
<span class="stringliteral">            # set default problem value here</span>
<span class="stringliteral">            $probValue             = 1 unless defined($probValue) and $probValue ne &quot;</span><span class="stringliteral">&quot;;  # FIXME?? set defaults here?</span>
<span class="stringliteral">            </span>
<span class="stringliteral">            my $status             = $problemRecord-&gt;status          || 0;</span>
<span class="stringliteral">            # sanity check that the status (score) is between 0 and 1</span>
<span class="stringliteral">            my $valid_status       = ($status &gt;= 0 and $status &lt;=1 ) ? 1 : 0;</span>
<span class="stringliteral">            </span>
<span class="stringliteral">            ###################################################################</span>
<span class="stringliteral">            # Determine the string $longStatus which will display the student&#39;s current score</span>
<span class="stringliteral">            ###################################################################</span>
<span class="stringliteral">            my $longStatus = &#39;&#39;;</span>
<span class="stringliteral">            if (!$attempted){</span>
<span class="stringliteral">                $longStatus     = &#39;.&#39;;</span>
<span class="stringliteral">            } elsif   ($valid_status) {</span>
<span class="stringliteral">                $longStatus     = int(100*$status+.5);</span>
<span class="stringliteral">                $longStatus     = ($longStatus == 100) ? &#39;C&#39; : $longStatus;</span>
<span class="stringliteral">            } else  {</span>
<span class="stringliteral">                $longStatus     = &#39;X&#39;;</span>
<span class="stringliteral">            }</span>
<span class="stringliteral">            </span>
<span class="stringliteral">            $string          .=  threeSpaceFill($longStatus);</span>
<span class="stringliteral">            $twoString       .= threeSpaceFill($num_incorrect);</span>
<span class="stringliteral"></span>
<span class="stringliteral">            $total           += $probValue;</span>
<span class="stringliteral">            $totalRight      += round_score($status*$probValue) if $valid_status;</span>
<span class="stringliteral"></span>
<span class="stringliteral">            </span>
<span class="stringliteral">            </span>
<span class="stringliteral">            </span>
<span class="stringliteral">            </span>
<span class="stringliteral">            </span>
<span class="stringliteral">             # add on the scores for this problem</span>
<span class="stringliteral">            if (defined($attempted) and $attempted) {</span>
<span class="stringliteral">                $number_of_students_attempting_problem{$probID}++;</span>
<span class="stringliteral">                push( @{ $attempts_list_for_problem{$probID} } ,     $num_of_attempts);</span>
<span class="stringliteral">                $number_of_attempts_for_problem{$probID}             += $num_of_attempts;</span>
<span class="stringliteral">                $h_problemData{$probID}                               = $num_incorrect;</span>
<span class="stringliteral">                $total_num_of_attempts_for_set                       += $num_of_attempts;</span>
<span class="stringliteral">                $correct_answers_for_problem{$probID}                += $status;</span>
<span class="stringliteral">            }</span>
<span class="stringliteral">            </span>
<span class="stringliteral">        }</span>
<span class="stringliteral">        </span>
<span class="stringliteral">        </span>
<span class="stringliteral">        my $act_as_student_url = $self-&gt;systemLink($urlpath-&gt;new(type=&gt;&#39;set_list&#39;,args=&gt;{courseID=&gt;$courseName}),</span>
<span class="stringliteral">                                                   params=&gt;{effectiveUser =&gt; $studentRecord-&gt;user_id}</span>
<span class="stringliteral">        );</span>
<span class="stringliteral">        my $email              = $studentRecord-&gt;email_address;</span>
<span class="stringliteral">        # FIXME  this needs formatting</span>
<span class="stringliteral">        </span>
<span class="stringliteral">        my $avg_num_attempts = ($num_of_problems) ? $total_num_of_attempts_for_set/$num_of_problems : 0;</span>
<span class="stringliteral">        my $successIndicator = ($avg_num_attempts) ? ($totalRight/$total)**2/$avg_num_attempts : 0 ;</span>
<span class="stringliteral">        </span>
<span class="stringliteral">        my $temp_hash         = {         user_id        =&gt; $studentRecord-&gt;user_id,</span>
<span class="stringliteral">                                          last_name      =&gt; $studentRecord-&gt;last_name,</span>
<span class="stringliteral">                                          first_name     =&gt; $studentRecord-&gt;first_name,</span>
<span class="stringliteral">                                          score          =&gt; $totalRight,</span>
<span class="stringliteral">                                          total          =&gt; $total,</span>
<span class="stringliteral">                                          index          =&gt; $successIndicator,</span>
<span class="stringliteral">                                          section        =&gt; $studentRecord-&gt;section,</span>
<span class="stringliteral">                                          recitation     =&gt; $studentRecord-&gt;recitation,</span>
<span class="stringliteral">                                          problemString  =&gt; &quot;</span>&lt;pre&gt;$string\n$twoString&lt;/pre&gt;<span class="stringliteral">&quot;,</span>
<span class="stringliteral">                                          act_as_student =&gt; $act_as_student_url,</span>
<span class="stringliteral">                                          email_address  =&gt; $studentRecord-&gt;email_address,</span>
<span class="stringliteral">                                          problemData    =&gt; {%h_problemData},</span>
<span class="stringliteral">        }; </span>
<span class="stringliteral">        # add this data to the list of total scores (out of 100)</span>
<span class="stringliteral">        # add this data to the list of success indices.</span>
<span class="stringliteral">        push( @index_list, $temp_hash-&gt;{index});</span>
<span class="stringliteral">        push( @score_list, ($temp_hash-&gt;{total}) ?$temp_hash-&gt;{score}/$temp_hash-&gt;{total} : 0 ) ;</span>
<span class="stringliteral">        push( @augmentedUserRecords, $temp_hash );</span>
<span class="stringliteral">                                        </span>
<span class="stringliteral">    }   </span>
<span class="stringliteral">    debug(&quot;</span>end mainloop<span class="stringliteral">&quot;);</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    @augmentedUserRecords = sort {           &amp;$sort_method($a,$b)</span>
<span class="stringliteral">                                                ||</span>
<span class="stringliteral">                            lc($a-&gt;{last_name}) cmp lc($b-&gt;{last_name} ) } @augmentedUserRecords;</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    # sort the problem IDs</span>
<span class="stringliteral">    my @problemIDs         = sort {$a&lt;=&gt;$b} keys %correct_answers_for_problem;</span>
<span class="stringliteral">    # determine index quartiles</span>
<span class="stringliteral">    my @brackets1          = (90,80,70,60,50,40,30,20,10);  #% students having scores or indices above this cutoff value</span>
<span class="stringliteral">    my @brackets2          = (95, 75,50,25,5,1);       # % students having this many incorrect attempts or more  </span>
<span class="stringliteral">    my %index_percentiles = determine_percentiles(\@brackets1, @index_list);</span>
<span class="stringliteral">    my %score_percentiles = determine_percentiles(\@brackets1, @score_list);</span>
<span class="stringliteral">    my %attempts_percentiles_for_problem = ();</span>
<span class="stringliteral">    my %problemPage                      = (); # link to the problem page</span>
<span class="stringliteral">    foreach my $probID (@problemIDs) {</span>
<span class="stringliteral">        $attempts_percentiles_for_problem{$probID} =   {</span>
<span class="stringliteral">            determine_percentiles([@brackets2], @{$attempts_list_for_problem{$probID}})</span>
<span class="stringliteral"></span>
<span class="stringliteral">        }; </span>
<span class="stringliteral">        $problemPage{$probID} = $urlpath-&gt;newFromModule(&quot;</span><a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Problem.html">WeBWorK::ContentGenerator::Problem</a><span class="stringliteral">&quot;, $r, </span>
<span class="stringliteral">            courseID =&gt; $courseName, setID =&gt; $setName, problemID =&gt; $probID);</span>
<span class="stringliteral"></span>
<span class="stringliteral">    }</span>
<span class="stringliteral"> </span>
<span class="stringliteral">#####################################################################################</span>
<span class="stringliteral"># Table showing the percentage of students with correct answers for each problems</span>
<span class="stringliteral">#####################################################################################</span>
<span class="stringliteral"></span>
<span class="stringliteral">print  </span>
<span class="stringliteral"></span>
<span class="stringliteral">       CGI::p($r-&gt;maketext(&#39;The percentage of active students with correct answers for each problem&#39;)),</span>
<span class="stringliteral">        CGI::start_table({-border=&gt;1}),</span>
<span class="stringliteral">        CGI::Tr(CGI::td(</span>
<span class="stringliteral">            [$r-&gt;maketext(&#39;Problem&#39;).&#39; #&#39;, </span>
<span class="stringliteral">               map {CGI::a({ href=&gt;$self-&gt;systemLink($problemPage{$_}) },$_)} @problemIDs</span>
<span class="stringliteral">            ]</span>
<span class="stringliteral">        )),</span>
<span class="stringliteral">        CGI::Tr(CGI::td(</span>
<span class="stringliteral">            [ &#39;% &#39;.$r-&gt;maketext(&#39;correct&#39;),map {($number_of_students_attempting_problem{$_})</span>
<span class="stringliteral">                                  ? sprintf(&quot;</span>%0.0f<span class="stringliteral">&quot;,100*$correct_answers_for_problem{$_}/$number_of_students_attempting_problem{$_})</span>
<span class="stringliteral">                                  : &#39;-&#39;}                               </span>
<span class="stringliteral">                                   @problemIDs </span>
<span class="stringliteral">            ]</span>
<span class="stringliteral">        )),</span>
<span class="stringliteral">        CGI::Tr(CGI::td(</span>
<span class="stringliteral">            [ $r-&gt;maketext(&#39;avg attempts&#39;),map {($number_of_students_attempting_problem{$_})</span>
<span class="stringliteral">                                  ? sprintf(&quot;</span>%0.1f<span class="stringliteral">&quot;,$number_of_attempts_for_problem{$_}/$number_of_students_attempting_problem{$_})</span>
<span class="stringliteral">                                  : &#39;-&#39;}                               </span>
<span class="stringliteral">                                   @problemIDs </span>
<span class="stringliteral">            ]</span>
<span class="stringliteral">        )),</span>
<span class="stringliteral">        CGI::end_table();</span>
<span class="stringliteral"></span>
<span class="stringliteral">#####################################################################################</span>
<span class="stringliteral"># table showing percentile statistics for scores and success indices</span>
<span class="stringliteral">#####################################################################################</span>
<span class="stringliteral">    print  </span>
<span class="stringliteral"></span>
<span class="stringliteral">            CGI::p(CGI::i($r-&gt;maketext(&#39;The percentage of students receiving at least these scores. The median score is in the 50% column. &#39;))),</span>
<span class="stringliteral">            CGI::start_table({-border=&gt;1}),</span>
<span class="stringliteral">                CGI::Tr(</span>
<span class="stringliteral">                    CGI::td( [&#39;% &#39;.$r-&gt;maketext(&#39;students&#39;),</span>
<span class="stringliteral">                              (map {  &quot;</span>&amp;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#a0b04a9c84777c525b5d1a7683331f7ee">nbsp</a>;<span class="stringliteral">&quot;.$_   } @brackets1) ,</span>
<span class="stringliteral">                              $r-&gt;maketext(&#39;top score&#39;).&#39; &#39;, </span>
<span class="stringliteral">                             </span>
<span class="stringliteral">                             ]</span>
<span class="stringliteral">                    )</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral">                CGI::Tr(</span>
<span class="stringliteral">                    CGI::td( [</span>
<span class="stringliteral">                        $r-&gt;maketext(&#39;Score&#39;),</span>
<span class="stringliteral">                        (prevent_repeats map { sprintf(&quot;</span>%0.0f<span class="stringliteral">&quot;,100*$score_percentiles{$_})   } @brackets1),</span>
<span class="stringliteral">                        sprintf(&quot;</span>%0.0f<span class="stringliteral">&quot;,100),</span>
<span class="stringliteral">                        ]</span>
<span class="stringliteral">                    )</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral">                CGI::Tr(</span>
<span class="stringliteral">                    CGI::td( [</span>
<span class="stringliteral">                        $r-&gt;maketext(&#39;Success Index&#39;),</span>
<span class="stringliteral">                        (prevent_repeats  map { sprintf(&quot;</span>%0.0f<span class="stringliteral">&quot;,100*$index_percentiles{$_})   } @brackets1),</span>
<span class="stringliteral">                        sprintf(&quot;</span>%0.0f<span class="stringliteral">&quot;,100),</span>
<span class="stringliteral">                        ]</span>
<span class="stringliteral">                    )</span>
<span class="stringliteral">                )</span>
<span class="stringliteral">            ;</span>
<span class="stringliteral"></span>
<span class="stringliteral">    print     CGI::end_table(), </span>
<span class="stringliteral"></span>
<span class="stringliteral">        ;</span>
<span class="stringliteral"></span>
<span class="stringliteral">#####################################################################################</span>
<span class="stringliteral"># table showing percentile statistics for scores and success indices</span>
<span class="stringliteral">#####################################################################################</span>
<span class="stringliteral">    print  </span>
<span class="stringliteral"></span>
<span class="stringliteral">            CGI::p(CGI::i($r-&gt;maketext(&#39;Percentile cutoffs for number of attempts. &lt;br/&gt; The 50% column shows the median number of attempts&#39;))),</span>
<span class="stringliteral">            CGI::start_table({-border=&gt;1}),</span>
<span class="stringliteral">                CGI::Tr(</span>
<span class="stringliteral">                    CGI::td( [&#39;% &#39;.$r-&gt;maketext(&#39;students&#39;),</span>
<span class="stringliteral">                              (map {  &quot;</span>&amp;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#a0b04a9c84777c525b5d1a7683331f7ee">nbsp</a>;<span class="stringliteral">&quot;.($_)  } @brackets2) ,</span>
<span class="stringliteral">                            </span>
<span class="stringliteral">                             ]</span>
<span class="stringliteral">                    )</span>
<span class="stringliteral">                );</span>
<span class="stringliteral"></span>
<span class="stringliteral"></span>
<span class="stringliteral">    foreach my $probID (@problemIDs) {</span>
<span class="stringliteral">        print   CGI::Tr(</span>
<span class="stringliteral">                    CGI::td( [</span>
<span class="stringliteral">                        CGI::a({ href=&gt;$self-&gt;systemLink($problemPage{$probID}) },&quot;</span>Prob $probID<span class="stringliteral">&quot;),</span>
<span class="stringliteral">                        ( prevent_repeats reverse map { sprintf(&quot;</span>%0.0f<span class="stringliteral">&quot;,$attempts_percentiles_for_problem{$probID}-&gt;{$_})   } @brackets2),</span>
<span class="stringliteral"></span>
<span class="stringliteral">                        ]</span>
<span class="stringliteral">                    )</span>
<span class="stringliteral">                );</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    print CGI::end_table();</span>
<span class="stringliteral">            </span>
<span class="stringliteral">    return &quot;</span><span class="stringliteral">&quot;;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae1b3bdce87e9463c05548ef24b5596e7"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::index" ref="ae1b3bdce87e9463c05548ef24b5596e7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::index </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-index' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-index-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-index-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-index-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in index: 50</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#ae1b3bdce87e9463c05548ef24b5596e7">index</a> {
    my $self          = shift;
    my $r             = $self-&gt;r;
    my $urlpath       = $r-&gt;urlpath;
    my $ce            = $r-&gt;ce;
    my $db            = $r-&gt;db;
    my $courseName    = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    
<span class="preprocessor">    # DBFIXME sort in database</span>
<span class="preprocessor"></span>    my @studentList   = sort $db-&gt;listUsers;
    my @setList       = sort  $db-&gt;listGlobalSets;
    
    
    my @setLinks      = ();
    my @studentLinks  = (); 
    <span class="keywordflow">foreach</span> my $set (@setList) {
        my $setStatisticsPage   = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, 
                                                          courseID =&gt; $courseName,
                                                          statType =&gt; <span class="stringliteral">&#39;set&#39;</span>,
                                                          setID    =&gt; $set
        );
        push @setLinks, CGI::a({-href=&gt;$self-&gt;systemLink($setStatisticsPage) }, <a class="code" href="classWeBWorK_1_1ContentGenerator.html#a773245b898171c74901ad1833b09b78d">WeBWorK::ContentGenerator::underscore2nbsp</a>($set));
    }
    
    <span class="keywordflow">foreach</span> my $student (@studentList) {
        my $userStatisticsPage  = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, 
                                                          courseID =&gt; $courseName,
                                                          statType =&gt; <span class="stringliteral">&#39;student&#39;</span>,
                                                          userID   =&gt; $student
        );
        push @studentLinks, CGI::a({-href=&gt;$self-&gt;systemLink($userStatisticsPage,
                                                             prams=&gt;{effectiveUser =&gt; $student}
                                                             )},<span class="stringliteral">&quot;  $student&quot;</span> ),;    
    }
    print join(<span class="stringliteral">&quot;&quot;</span>,
        CGI::start_table({-border=&gt;2, -cellpadding=&gt;20}),
        CGI::Tr({},
            CGI::td({-valign=&gt;<span class="stringliteral">&#39;top&#39;</span>}, 
                CGI::h3({-align=&gt;<span class="stringliteral">&#39;center&#39;</span>},$r-&gt;maketext(<span class="stringliteral">&#39;View statistics by set&#39;</span>)),
                CGI::ul(  CGI::li( [@setLinks] ) ), 
            ),
            CGI::td({-valign=&gt;<span class="stringliteral">&#39;top&#39;</span>}, 
                CGI::h3({-align=&gt;<span class="stringliteral">&#39;center&#39;</span>},$r-&gt;maketext(<span class="stringliteral">&#39;View statistics by student&#39;</span>)),
                CGI::ul(CGI::li( [ @studentLinks ] ) ),
            ),
        ),
        CGI::end_table(),
    );
    
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2802b5d58fef67a14e82bf042bcf7b72"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::initialize" ref="a2802b5d58fef67a14e82bf042bcf7b72" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in initialize: 32</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a2802b5d58fef67a14e82bf042bcf7b72">initialize</a> {
    my $self     = shift; 
<span class="preprocessor">    # FIXME  are there args here?</span>
<span class="preprocessor"></span>    my @components = @_;
    my $r          = $self-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator.html#afc1106db125a42082cafaf10746a947b">r</a>};
    my $urlpath    = $r-&gt;urlpath;
    my $type       = $urlpath-&gt;arg(<span class="stringliteral">&quot;statType&quot;</span>) || <span class="stringliteral">&#39;&#39;</span>;
    my $db         = $self-&gt;{db};
    my $ce         = $self-&gt;{ce};
    my $authz      = $self-&gt;{authz};
    my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&#39;courseID&#39;</span>);
    my $user       = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
<span class="preprocessor">    # Check permissions</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
    
    $self-&gt;{type}  = $type;
    <span class="keywordflow">if</span> ($type eq <span class="stringliteral">&#39;student&#39;</span>) {
        my $studentName = $r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;userID&quot;</span>) || $user;
        $self-&gt;{studentName } = $studentName;
        
    } elsif ($type eq <span class="stringliteral">&#39;set&#39;</span>) {
        my $setName = $r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;setID&quot;</span>) || 0;
        $self-&gt;{setName}     = $setName;
        my $setRecord  = $db-&gt;getGlobalSet($setName); # checked
        die $r-&gt;maketext(<span class="stringliteral">&quot;global set [_1]  not found.&quot;</span>, $setName) unless $setRecord;
        $self-&gt;{set_due_date} = $setRecord-&gt;due_date;
        $self-&gt;{setRecord}   = $setRecord;
    }
    
    
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7037799a4cfa6d1752f160bfd2d328db"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::prevent_repeats" ref="a7037799a4cfa6d1752f160bfd2d328db" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::prevent_repeats </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-prevent_repeats' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-prevent_repeats-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-prevent_repeats-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-prevent_repeats-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in prevent_repeats: 16</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a7037799a4cfa6d1752f160bfd2d328db">prevent_repeats</a> {    # replace a <span class="keywordtype">string</span> such as 0 0 0 86 86 100 100 100 by    0 - - 86 - 100 - -
    my @inarray   = @_;
    my @outarray = ();
    my $saved_item = shift @inarray;
    push @outarray, $saved_item;
    <span class="keywordflow">while</span> (@inarray )   {
        my $current_item = shift @inarray;
        <span class="keywordflow">if</span> ( $current_item == $saved_item ) {
            push @outarray, <span class="stringliteral">&#39;&amp;nbsp;-&#39;</span>;
        } <span class="keywordflow">else</span> {
            push @outarray, $current_item;
            $saved_item = $current_item;
        }
    }
    @outarray;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3953fcaddca72a27a5e8c6c2c176c5db"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::round_score" ref="a3953fcaddca72a27a5e8c6c2c176c5db" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::round_score </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-round_score' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-round_score-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-round_score-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-round_score-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in round_score: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a3953fcaddca72a27a5e8c6c2c176c5db">round_score</a>{
    <span class="keywordflow">return</span> shift;
}

1;
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae9d4fffc5b50f85a64a825143cacc198"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::siblings" ref="ae9d4fffc5b50f85a64a825143cacc198" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::siblings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-siblings' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-siblings-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-siblings-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-siblings-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in siblings: 38</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#ae9d4fffc5b50f85a64a825143cacc198">siblings</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $urlpath = $r-&gt;urlpath;
    
<span class="preprocessor">    # Check permissions</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span> unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
    
    my $courseID = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $eUserID  = $r-&gt;param(<span class="stringliteral">&quot;effectiveUser&quot;</span>);
    my @setIDs   = sort  $db-&gt;listGlobalSets;
    
    my $stats     = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::Stats&quot;</span>, $r,  
                                            courseID =&gt; $courseID);
    
    print CGI::start_div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;info-box&quot;</span>, <span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;fisheye&quot;</span>});
    print CGI::h2(<span class="stringliteral">&quot;Statistics&quot;</span>);
<span class="preprocessor">    #print CGI::start_ul({class=&gt;&quot;LinksMenu&quot;});</span>
<span class="preprocessor"></span><span class="preprocessor">    #print CGI::start_li();</span>
<span class="preprocessor"></span><span class="preprocessor">    #print CGI::span({style=&gt;&quot;font-size:larger&quot;}, CGI::a({href=&gt;$self-&gt;systemLink($stats)}, &#39;Statistics&#39;));</span>
<span class="preprocessor"></span>    print CGI::start_ul();
    
    <span class="keywordflow">foreach</span> my $setID (@setIDs) {
        my $problemPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::Stats&quot;</span>, $r, 
            courseID =&gt; $courseID, setID =&gt; $setID,statType =&gt; <span class="stringliteral">&#39;set&#39;</span>,);
        print CGI::li(CGI::a({href=&gt;$self-&gt;systemLink($problemPage)}, <a class="code" href="classWeBWorK_1_1ContentGenerator.html#a773245b898171c74901ad1833b09b78d">WeBWorK::ContentGenerator::underscore2nbsp</a>($setID)));
    }
    
    print CGI::end_ul();
<span class="preprocessor">    #print CGI::end_li();</span>
<span class="preprocessor"></span><span class="preprocessor">    #print CGI::end_ul();</span>
<span class="preprocessor"></span>    print CGI::end_div();
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a186a5b734f7cb8854c94b6f209f813f9"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::threeSpaceFill" ref="a186a5b734f7cb8854c94b6f209f813f9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::threeSpaceFill </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-threeSpaceFill' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-threeSpaceFill-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-threeSpaceFill-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-threeSpaceFill-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in threeSpaceFill: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a186a5b734f7cb8854c94b6f209f813f9">threeSpaceFill</a> {
    my $num = shift @_ || 0;

    <span class="keywordflow">if</span> (length($num)&lt;=1) {<span class="keywordflow">return</span> <span class="stringliteral">&quot;$num&quot;</span>.<span class="stringliteral">&#39;&amp;nbsp;&amp;nbsp;&#39;</span>;}
    elsif (length($num)==2) {<span class="keywordflow">return</span> <span class="stringliteral">&quot;$num&quot;</span>.<span class="stringliteral">&#39;&amp;nbsp;&#39;</span>;}
    <span class="keywordflow">else</span> {<span class="keywordflow">return</span> <span class="stringliteral">&quot;## &quot;</span>;}
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3ffc9b8b69c6f6a6f9aa155ae88342e4"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::Stats::title" ref="a3ffc9b8b69c6f6a6f9aa155ae88342e4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::Stats::title </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-title' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-title-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-title-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-title-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in title: 19</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1Stats.html#a3ffc9b8b69c6f6a6f9aa155ae88342e4">title</a> { 
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $authz = $r-&gt;authz;
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);

    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span> unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
    
    my $type                = $self-&gt;{type};
    my $string              = $r-&gt;maketext(<span class="stringliteral">&quot;Statistics for&quot;</span>).$self-&gt;{ce}-&gt;{courseName}.<span class="stringliteral">&quot; &quot;</span>;
    
    <span class="keywordflow">if</span> ($type eq <span class="stringliteral">&#39;student&#39;</span>) {
        $string             .= $r-&gt;maketext(<span class="stringliteral">&quot;student&quot;</span>).<span class="stringliteral">&quot; &quot;</span>.$self-&gt;{studentName};
    } elsif ($type eq <span class="stringliteral">&#39;set&#39;</span> ) {
        $string             .= $r-&gt;maketext(<span class="stringliteral">&quot;set&quot;</span>).<span class="stringliteral">&quot;   &quot;</span>.$self-&gt;{setName};
        $string             .= <span class="stringliteral">&quot;.&amp;nbsp;&amp;nbsp;&amp;nbsp; &quot;</span>.$r-&gt;maketext(<span class="stringliteral">&quot;Due&quot;</span>).<span class="stringliteral">&quot; &quot;</span>.$self-&gt;formatDateTime($self-&gt;{set_due_date});
    }
    <span class="keywordflow">return</span> $string;
}
</pre></div>  
</div>
 
<p>Reimplemented from <a class="el" href="classWeBWorK_1_1ContentGenerator.html#ad83c346d1b3f70cf42ba4debe6239c9f">WeBWorK::ContentGenerator</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="Stats_8pm_source.html">Stats.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:58:20 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
