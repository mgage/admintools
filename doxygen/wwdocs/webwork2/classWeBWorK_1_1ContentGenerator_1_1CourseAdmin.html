<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::ContentGenerator::CourseAdmin Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator.html">ContentGenerator</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html">CourseAdmin</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::ContentGenerator::CourseAdmin Class Reference</h1><!-- doxytag: class="WeBWorK::ContentGenerator::CourseAdmin" --><!-- doxytag: inherits="WeBWorK::ContentGenerator" --><div class="dynheader">
Inheritance diagram for WeBWorK::ContentGenerator::CourseAdmin:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin__inherit__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1CourseAdmin_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1CourseAdmin_inherit__map" id="WeBWorK_1_1ContentGenerator_1_1CourseAdmin_inherit__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="49,80,241,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="104,5,187,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::ContentGenerator::CourseAdmin:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin__coll__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1CourseAdmin_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1CourseAdmin_coll__map" id="WeBWorK_1_1ContentGenerator_1_1CourseAdmin_coll__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="49,80,241,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="104,5,187,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ab35081328ee2095124f0d1869a2d7566">archive_course_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a633c08ddbc624299b33f29e9b5866ab3">add_course_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a6ba556ac21ca64d0c0cf41a36e0836e3">delete_course_confirm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ad49746ae733cb9c2a9798e9868b19fcd">content</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a84611176934ca15e19c4762f585b47e0">do_unarchive_course</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a4a3249d81fb5c990f8ddf29afb0c7e19">add_location_handler</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a1a8cceeca01e6fb7699eddc69569d86f">do_registration</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a95f8ce0e60d2e90526f67f36aa0b4926">do_add_course</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a6b45db977b580be98a0cfc522c0e5121">do_hide_inactive_course</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a182011f0a9ddd2eadb596813bf0aed37">unarchive_course_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a44933dfc3a9018a7ec48953d17afbb38">display_registration_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a4e1ac0afdf29cb5b5679abbb6070a73c">archive_course_validate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#aeac87e48910f5a254469d95d4295afc0">do_upgrade_course</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#adf2bc1906528ee2cf5e7a9bcbcb6ff9e">do_archive_course</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ae51d55c485fd696633245b24aa991721">add_course_validate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ae3df3a1e1435f9032ffb837743f621cd">delete_course_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ade381a86d4f41837bde7ea5b1ea748c1">upgrade_course_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a3470cc813f60b7eaa9ffbf641bc65be6">byLoginActivity</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a1c6860496524c45b0f800d67a5d6670b">delete_course_validate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a48e0df95ed36c88b20d0de8eff8b19d9">hide_course_validate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a488ded445e7083debeecc87b03cb092f">archive_course_confirm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a8dfc248d5695539e5ee2fb479ad07c7c">do_unhide_inactive_course</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a52738445fdb55c2b9de823f87625b3f9">upgrade_course_confirm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a2dfdd169f68e81d506c255bf19ac2f33">unarchive_course_validate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a382dd1ad022168d38abf5090d375c0b7">rename_course_validate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ab483552395995130885c84b88ec95492">formatReportOnDatabaseTables</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a907945ed5c2461fda065220362cab78e">delete_location_handler</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ac39c965823016b2e58f9d1f2878b4d32">unhide_course_validate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#aa7dee07c2e6a185f1271411704f5d598">pre_header_initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#afbaeae646325f8529dc0eca4fd1439a1">rename_course_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a628e8e259bb173b85e001efc69230ea5">body</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#aacc8887147bb0f3e122d78bbc8187a70">unarchive_course_confirm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a5c300da40782982284ab7698c97ae4ed">rename_course_confirm</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a64f469d57b38e2e526907d584bf6099b">registration_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a77dd4cee8c0adf3701ae36bd7115a6fb">upgrade_course_validate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a164a48c5034b49f309e5126e8be47ac9">manage_location_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ad6693db4fe413ffaba1418eea59e1f65">existsLocations_helper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a590c98500c57bb3582c17c07efe1c9f4">hide_inactive_course_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#abca09cdbfe996360789fa8f52f44ead5">edit_location_handler</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a1368dc17271e260f6af74434ae919f04">do_rename_course</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a89e13ea9f889a1f25cea28fcb0b7e5c8">do_delete_course</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ad5f02132fec2983f26283e273b2ceb14">header</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a272c4b05a62b0ea31b64395909dba868">edit_location_form</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html">WeBWorK::ContentGenerator::CourseAdmin</a> - Add, rename, and delete courses. </p>

<p>Definition at line <a class="el" href="CourseAdmin_8pm_source.html#l00030">30</a> of file <a class="el" href="CourseAdmin_8pm_source.html">CourseAdmin.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a633c08ddbc624299b33f29e9b5866ab3"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::add_course_form" ref="a633c08ddbc624299b33f29e9b5866ab3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::add_course_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-add_course_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-add_course_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-add_course_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-add_course_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in add_course_form: 163</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a633c08ddbc624299b33f29e9b5866ab3">add_course_form</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    my $add_courseID                     = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_courseID&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_courseTitle                  = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_courseTitle&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_courseInstitution            = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_courseInstitution&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_admin_users                  = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_admin_users&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_initial_userID               = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_userID&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_password             = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_password&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_confirmPassword      = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_confirmPassword&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_firstName            = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_firstName&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_lastName             = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_lastName&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_email                = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_email&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_templates_course             = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_templates_course&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_dbLayout                     = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_dbLayout&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    



    my @dbLayouts = <span class="keywordflow">do</span> {
        my @ordered_layouts;
        <span class="keywordflow">foreach</span> my $layout (@{$ce-&gt;{dbLayout_order}}) {
            <span class="keywordflow">if</span> (exists $ce-&gt;{dbLayouts}-&gt;{$layout}) {
                push @ordered_layouts, $layout;
            }
        }
        
        my %ordered_layouts; @ordered_layouts{@ordered_layouts} = ();
        my @other_layouts;
        <span class="keywordflow">foreach</span> my $layout (keys %{ $ce-&gt;{dbLayouts} }) {
            unless (exists $ordered_layouts{$layout}) {
                push @other_layouts, $layout;
            }
        }
        
        (@ordered_layouts, @other_layouts);
    };
    
<span class="preprocessor">    # unused...</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $ce2 = new WeBWorK::CourseEnvironment({</span>
<span class="preprocessor"></span><span class="preprocessor">    #   %WeBWorK::SeedCE,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   courseName =&gt; &quot;COURSENAME&quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">    #});</span>
<span class="preprocessor"></span>    
    my @existingCourses = listCourses($ce);
    @existingCourses = sort { lc($a) cmp lc ($b) } @existingCourses; <span class="preprocessor">#make sort case insensitive </span>
<span class="preprocessor"></span>    
    print CGI::h2(<span class="stringliteral">&quot;Add Course&quot;</span>);
    
    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    
    print CGI::p(<span class="stringliteral">&quot;Specify an ID, title, and institution for the new course. The course ID may contain only letters, numbers, hyphens, and underscores.&quot;</span>);
    
    print CGI::table({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;FormLayout&quot;</span>},
        CGI::Tr({},
            CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, <span class="stringliteral">&quot;Course ID:&quot;</span>),
            CGI::td(CGI::textfield(-name=&gt;<span class="stringliteral">&quot;add_courseID&quot;</span>, -value=&gt;$add_courseID, -size=&gt;25)),
        ),
        CGI::Tr({},
            CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, <span class="stringliteral">&quot;Course Title:&quot;</span>),
            CGI::td(CGI::textfield(-name=&gt;<span class="stringliteral">&quot;add_courseTitle&quot;</span>, -value=&gt;$add_courseTitle, -size=&gt;25)),
        ),
        CGI::Tr({},
            CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, <span class="stringliteral">&quot;Institution:&quot;</span>),
            CGI::td(CGI::textfield(-name=&gt;<span class="stringliteral">&quot;add_courseInstitution&quot;</span>, -value=&gt;$add_courseInstitution, -size=&gt;25)),
        ),
    );
    
    print CGI::p(<span class="stringliteral">&quot;To add the WeBWorK administrators to the new course (as instructors) check the box below.&quot;</span>);
    my @checked = ($add_admin_users) ?(checked=&gt;1): ();  # workaround because CGI::checkbox seems to have a bug -- it won<span class="stringliteral">&#39;t default to checked.</span>
<span class="stringliteral">    print CGI::p({},CGI::input({-type=&gt;&#39;</span>checkbox<span class="stringliteral">&#39;, -name=&gt;&quot;add_admin_users&quot;, @checked }, &quot;Add WeBWorK administrators to new course&quot;));</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print CGI::p(&quot;To add an additional instructor to the new course, specify user information below. The user ID may contain only </span>
<span class="stringliteral">    numbers, letters, hyphens, periods (dots), commas,and underscores.\n&quot;);</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print CGI::table({class=&gt;&quot;FormLayout&quot;}, CGI::Tr({},</span>
<span class="stringliteral">        CGI::td({},</span>
<span class="stringliteral">            CGI::table({class=&gt;&quot;FormLayout&quot;},</span>
<span class="stringliteral">                CGI::Tr({},</span>
<span class="stringliteral">                    CGI::th({class=&gt;&quot;LeftHeader&quot;}, &quot;User ID:&quot;),</span>
<span class="stringliteral">                    CGI::td(CGI::textfield(-name=&gt;&quot;add_initial_userID&quot;, -value=&gt;$add_initial_userID, -size=&gt;25)),</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral">                CGI::Tr({},</span>
<span class="stringliteral">                    CGI::th({class=&gt;&quot;LeftHeader&quot;}, &quot;Password:&quot;),</span>
<span class="stringliteral">                    CGI::td(CGI::password_field(-name=&gt;&quot;add_initial_password&quot;, -value=&gt;$add_initial_password, -size=&gt;25)),</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral">                CGI::Tr({},</span>
<span class="stringliteral">                    CGI::th({class=&gt;&quot;LeftHeader&quot;}, &quot;Confirm Password:&quot;),</span>
<span class="stringliteral">                    CGI::td(CGI::password_field(-name=&gt;&quot;add_initial_confirmPassword&quot;, -value=&gt;$add_initial_confirmPassword, -size=&gt;25)),</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral">            ),</span>
<span class="stringliteral">        ),</span>
<span class="stringliteral">        CGI::td({},</span>
<span class="stringliteral">            CGI::table({class=&gt;&quot;FormLayout&quot;},</span>
<span class="stringliteral">                CGI::Tr({},</span>
<span class="stringliteral">                    CGI::th({class=&gt;&quot;LeftHeader&quot;}, &quot;First Name:&quot;),</span>
<span class="stringliteral">                    CGI::td(CGI::textfield(-name=&gt;&quot;add_initial_firstName&quot;, -value=&gt;$add_initial_firstName, -size=&gt;25)),</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral">                CGI::Tr({},</span>
<span class="stringliteral">                    CGI::th({class=&gt;&quot;LeftHeader&quot;}, &quot;Last Name:&quot;),</span>
<span class="stringliteral">                    CGI::td(CGI::textfield(-name=&gt;&quot;add_initial_lastName&quot;, -value=&gt;$add_initial_lastName, -size=&gt;25)),</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral">                CGI::Tr({},</span>
<span class="stringliteral">                    CGI::th({class=&gt;&quot;LeftHeader&quot;}, &quot;Email Address:&quot;),</span>
<span class="stringliteral">                    CGI::td(CGI::textfield(-name=&gt;&quot;add_initial_email&quot;, -value=&gt;$add_initial_email, -size=&gt;25)),</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral">            ),</span>
<span class="stringliteral">            </span>
<span class="stringliteral">        ),</span>
<span class="stringliteral">    ));</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print CGI::p(&quot;To copy problem templates from an existing course, select the course below.&quot;);</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print CGI::table({class=&gt;&quot;FormLayout&quot;},</span>
<span class="stringliteral">        CGI::Tr({},</span>
<span class="stringliteral">            CGI::th({class=&gt;&quot;LeftHeader&quot;}, &quot;Copy templates from:&quot;),</span>
<span class="stringliteral">            CGI::td(</span>
<span class="stringliteral">                CGI::popup_menu(</span>
<span class="stringliteral">                    -name =&gt; &quot;add_templates_course&quot;,</span>
<span class="stringliteral">                    -values =&gt; [ &quot;&quot;, @existingCourses ],</span>
<span class="stringliteral">                    -default =&gt; $add_templates_course,</span>
<span class="stringliteral">                    #-size =&gt; 10,</span>
<span class="stringliteral">                    #-multiple =&gt; 0,</span>
<span class="stringliteral">                    #-labels =&gt; \%courseLabels,</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral"></span>
<span class="stringliteral">            ),</span>
<span class="stringliteral">        ),</span>
<span class="stringliteral">    );</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    </span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print CGI::p(&quot;Select a database layout below.&quot;);</span>
<span class="stringliteral">    print CGI::start_table({class=&gt;&quot;FormLayout&quot;});</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    my %dbLayout_buttons;</span>
<span class="stringliteral">    my $selected_dbLayout = defined $add_dbLayout ? $add_dbLayout : $ce-&gt;{dbLayout_order}[0];</span>
<span class="stringliteral">    @dbLayout_buttons{@dbLayouts} = CGI::radio_group(-name=&gt;&quot;add_dbLayout&quot;,-values=&gt;\@dbLayouts,-default=&gt;$selected_dbLayout);</span>
<span class="stringliteral">    foreach my $dbLayout (@dbLayouts) {</span>
<span class="stringliteral">        my $dbLayoutLabel = (defined $ce-&gt;{dbLayout_descr}{$dbLayout})</span>
<span class="stringliteral">            ? &quot;$dbLayout - &quot; . $ce-&gt;{dbLayout_descr}{$dbLayout}</span>
<span class="stringliteral">            : &quot;$dbLayout - no description provided in global.conf&quot;;</span>
<span class="stringliteral">        print CGI::Tr({},</span>
<span class="stringliteral">            CGI::td({width=&gt;&#39;</span>20%<span class="stringliteral">&#39;}, $dbLayout_buttons{$dbLayout}),</span>
<span class="stringliteral">            CGI::td($dbLayoutLabel),</span>
<span class="stringliteral">        );</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    print CGI::end_table();</span>
<span class="stringliteral">    print CGI::p({style=&gt;&quot;text-align: left&quot;}, CGI::submit(-name=&gt;&quot;add_course&quot;, -label=&gt;&quot;Add Course&quot;));</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print CGI::end_form();</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae51d55c485fd696633245b24aa991721"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::add_course_validate" ref="ae51d55c485fd696633245b24aa991721" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::add_course_validate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-add_course_validate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-add_course_validate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-add_course_validate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-add_course_validate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in add_course_validate: 81</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ae51d55c485fd696633245b24aa991721">add_course_validate</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    

    my $add_courseID                     = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_courseID&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_courseTitle                  = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_courseTitle&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_courseInstitution            = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_courseInstitution&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_admin_users                  = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_admin_users&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_initial_userID               = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_userID&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_password             = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_password&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_confirmPassword      = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_confirmPassword&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_firstName            = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_firstName&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_lastName             = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_lastName&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_email                = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_email&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_templates_course             = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_templates_course&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_dbLayout                     = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_dbLayout&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    

    
<span class="preprocessor">    ######################</span>
<span class="preprocessor"></span>    
    my @errors;
    
    <span class="keywordflow">if</span> ($add_courseID eq <span class="stringliteral">&quot;&quot;</span>) {
        push @errors, <span class="stringliteral">&quot;You must specify a course ID.&quot;</span>;
    }
    unless ($add_courseID =~ /^[\w-]*$/) { # regex copied from CourseAdministration.pm
        push @errors, <span class="stringliteral">&quot;Course ID may only contain letters, numbers, hyphens, and underscores.&quot;</span>;
    }
    <span class="keywordflow">if</span> (grep { $add_courseID eq $_ } listCourses($ce)) {
        push @errors, <span class="stringliteral">&quot;A course with ID $add_courseID already exists.&quot;</span>;
    }
<span class="preprocessor">    #if ($add_courseTitle eq &quot;&quot;) {</span>
<span class="preprocessor"></span><span class="preprocessor">    #   push @errors, &quot;You must specify a course title.&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #}</span>
<span class="preprocessor"></span><span class="preprocessor">    #if ($add_courseInstitution eq &quot;&quot;) {</span>
<span class="preprocessor"></span><span class="preprocessor">    #   push @errors, &quot;You must specify an institution for this course.&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #}</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> ($add_initial_userID ne <span class="stringliteral">&quot;&quot;</span>) {
        <span class="keywordflow">if</span> ($add_initial_password eq <span class="stringliteral">&quot;&quot;</span>) {
            push @errors, <span class="stringliteral">&quot;You must specify a password for the initial instructor.&quot;</span>;
        }
        <span class="keywordflow">if</span> ($add_initial_confirmPassword eq <span class="stringliteral">&quot;&quot;</span>) {
            push @errors, <span class="stringliteral">&quot;You must confirm the password for the initial instructor.&quot;</span>;
        }
        <span class="keywordflow">if</span> ($add_initial_password ne $add_initial_confirmPassword) {
            push @errors, <span class="stringliteral">&quot;The password and password confirmation for the instructor must match.&quot;</span>;
        }
        <span class="keywordflow">if</span> ($add_initial_firstName eq <span class="stringliteral">&quot;&quot;</span>) {
            push @errors, <span class="stringliteral">&quot;You must specify a first name for the initial instructor.&quot;</span>;
        }
        <span class="keywordflow">if</span> ($add_initial_lastName eq <span class="stringliteral">&quot;&quot;</span>) {
            push @errors, <span class="stringliteral">&quot;You must specify a last name for the initial instructor.&quot;</span>;
        }
        <span class="keywordflow">if</span> ($add_initial_email eq <span class="stringliteral">&quot;&quot;</span>) {
            push @errors, <span class="stringliteral">&quot;You must specify an email address for the initial instructor.&quot;</span>;
        }
    }
    
    <span class="keywordflow">if</span> ($add_dbLayout eq <span class="stringliteral">&quot;&quot;</span>) {
        push @errors, <span class="stringliteral">&quot;You must select a database layout.&quot;</span>;
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">if</span> (exists $ce-&gt;{dbLayouts}-&gt;{$add_dbLayout}) {
<span class="preprocessor">            # we used to check for layout-specific fields here, but there aren&#39;t any layouts that require them</span>
<span class="preprocessor"></span><span class="preprocessor">            # anymore. (in the future, we&#39;ll probably deal with this in layout-specific modules.)</span>
<span class="preprocessor"></span>        } <span class="keywordflow">else</span> {
            push @errors, <span class="stringliteral">&quot;The database layout $add_dbLayout doesn&#39;t exist.&quot;</span>;
        }
    }
    
    <span class="keywordflow">return</span> @errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4a3249d81fb5c990f8ddf29afb0c7e19"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::add_location_handler" ref="a4a3249d81fb5c990f8ddf29afb0c7e19" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::add_location_handler </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-add_location_handler' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-add_location_handler-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-add_location_handler-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-add_location_handler-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in add_location_handler: 92</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a4a3249d81fb5c990f8ddf29afb0c7e19">add_location_handler</a> {
    my $self = shift();
    my $r = $self-&gt;r;
    my $db = $r-&gt;db;

<span class="preprocessor">    # the location data we&#39;re to add</span>
<span class="preprocessor"></span>    my $locationID = $r-&gt;param(<span class="stringliteral">&quot;new_location_name&quot;</span>);
    my $locationDescr = $r-&gt;param(<span class="stringliteral">&quot;new_location_description&quot;</span>);
    my $locationAddr = $r-&gt;param(<span class="stringliteral">&quot;new_location_addresses&quot;</span>);
<span class="preprocessor">    # break the addresses up</span>
<span class="preprocessor"></span>    $locationAddr =~ s/\s*-\s*/-/g;
    $locationAddr =~ s/\s*\/\s*/\<span class="comment">//g;</span>
    my @addresses = split(/\s+/, $locationAddr);

<span class="preprocessor">    # sanity checks</span>
<span class="preprocessor"></span>    my $badAddr = <span class="stringliteral">&#39;&#39;</span>;
    <span class="keywordflow">foreach</span> my $addr ( @addresses ) {
        unless ( <span class="keyword">new</span> Net::IP($addr) ) {
            $badAddr .= <span class="stringliteral">&quot;$addr, &quot;</span>;
            $locationAddr =~ s/$addr\n<span class="comment">//s;</span>
        }
    }
    $badAddr =~ s/, $<span class="comment">//;</span>

<span class="preprocessor">    # a check to be sure that the location addresses don&#39;t already</span>
<span class="preprocessor"></span><span class="preprocessor">    #    exist</span>
<span class="preprocessor"></span>    my $badLocAddr;
    <span class="keywordflow">if</span> ( ! $badAddr &amp;&amp; $locationID ) {
        <span class="keywordflow">if</span> ( $db-&gt;countLocationAddresses( $locationID ) ) {
            my @allLocAddr = $db-&gt;listLocationAddresses($locationID);
            <span class="keywordflow">foreach</span> my $addr ( @addresses ) {
                $badLocAddr .= <span class="stringliteral">&quot;$addr, &quot;</span> 
                    <span class="keywordflow">if</span> ( grep {/^$addr$/} @allLocAddr );
            }
            $badLocAddr =~ s/, $<span class="comment">//;</span>
        }
    }

    <span class="keywordflow">if</span> ( ! @addresses || ! $locationID || ! $locationDescr ) {
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, 
                   <span class="stringliteral">&quot;Missing required input data. Please check &quot;</span> .
                   <span class="stringliteral">&quot;that you have filled in all of the create &quot;</span> .
                   <span class="stringliteral">&quot;location fields and resubmit.&quot;</span>);
    } elsif ( $badAddr ) {
        $r-&gt;param(<span class="stringliteral">&quot;new_location_addresses&quot;</span>, $locationAddr);
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, 
                   <span class="stringliteral">&quot;Address(es) $badAddr is(are) not in a &quot;</span> .
                   <span class="stringliteral">&quot;recognized form.  Please check your &quot;</span> .
                   <span class="stringliteral">&quot;data entry and resubmit.&quot;</span>);
    } elsif ( $db-&gt;existsLocation( $locationID ) ) {
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, 
                   <span class="stringliteral">&quot;A location with the name $locationID &quot;</span> .
                   <span class="stringliteral">&quot;already exists in the database.  Did &quot;</span> .
                   <span class="stringliteral">&quot;you mean to edit that location instead?&quot;</span>);
    } elsif ( $badLocAddr ) {
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, 
                   <span class="stringliteral">&quot;Address(es) $badLocAddr already exist &quot;</span> .
                   <span class="stringliteral">&quot;in the database.  THIS SHOULD NOT HAPPEN!  &quot;</span> .
                   <span class="stringliteral">&quot;Please double check the integrity of &quot;</span> .
                   <span class="stringliteral">&quot;the WeBWorK database before continuing.&quot;</span>);
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # add the location</span>
<span class="preprocessor"></span>        my $locationObj = $db-&gt;newLocation;
        $locationObj-&gt;location_id( $locationID );
        $locationObj-&gt;description( $locationDescr );
        $db-&gt;addLocation( $locationObj );

<span class="preprocessor">        # and add the addresses</span>
<span class="preprocessor"></span>        <span class="keywordflow">foreach</span> my $addr ( @addresses ) {
            my $locationAddress = $db-&gt;newLocationAddress;
            $locationAddress-&gt;location_id($locationID);
            $locationAddress-&gt;ip_mask($addr);

            $db-&gt;addLocationAddress( $locationAddress );
        }
        
<span class="preprocessor">        # we&#39;ve added the location, so clear those param </span>
<span class="preprocessor"></span><span class="preprocessor">        #    entries</span>
<span class="preprocessor"></span>        $r-&gt;param(<span class="stringliteral">&#39;manage_location_action&#39;</span>,<span class="stringliteral">&#39;none&#39;</span>);
        $r-&gt;param(<span class="stringliteral">&#39;new_location_name&#39;</span>,<span class="stringliteral">&#39;&#39;</span>);
        $r-&gt;param(<span class="stringliteral">&#39;new_location_description&#39;</span>,<span class="stringliteral">&#39;&#39;</span>);
        $r-&gt;param(<span class="stringliteral">&#39;new_location_addresses&#39;</span>,<span class="stringliteral">&#39;&#39;</span>);

        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>}, 
                   <span class="stringliteral">&quot;Location $locationID has been created, &quot;</span> .
                   <span class="stringliteral">&quot;with addresses &quot;</span> . join(<span class="stringliteral">&#39;, &#39;</span>, @addresses) .
                   <span class="stringliteral">&quot;.&quot;</span>);
    }

    $self-&gt;manage_location_form;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a488ded445e7083debeecc87b03cb092f"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::archive_course_confirm" ref="a488ded445e7083debeecc87b03cb092f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::archive_course_confirm </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-archive_course_confirm' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-archive_course_confirm-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-archive_course_confirm-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-archive_course_confirm-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in archive_course_confirm: 115</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a488ded445e7083debeecc87b03cb092f">archive_course_confirm</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    print CGI::h2(<span class="stringliteral">&quot;archive Course&quot;</span>);
    
    my $delete_course_flag   = $r-&gt;param(<span class="stringliteral">&quot;delete_course&quot;</span>)        || <span class="stringliteral">&quot;&quot;</span>;
    
    my @archive_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;archive_courseIDs&quot;</span>);
    @archive_courseIDs        = () unless @archive_courseIDs;
    my $archive_courseID  = $r-&gt;param(<span class="stringliteral">&quot;archive_courseID&quot;</span>); 
    $archive_courseID  = $archive_courseIDs[0] unless $archive_courseID;
    
    
    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        %WeBWorK::SeedCE,
        courseName =&gt; $archive_courseID,
    });

    
    my ($tables_ok,$dbStatus);
<span class="preprocessor">#############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Check database</span>
<span class="preprocessor"></span><span class="preprocessor">#############################################################################</span>
<span class="preprocessor"></span>    my %missing_fields;
    <span class="keywordflow">if</span> ($ce2-&gt;{dbLayoutName} ) {
        my $CIchecker = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1Utils_1_1CourseIntegrityCheck.html">WeBWorK::Utils::CourseIntegrityCheck</a>(ce=&gt;$ce2);
        ($tables_ok,$dbStatus) = $CIchecker-&gt;checkCourseTables($archive_courseID);
        <span class="keywordflow">if</span> ($r-&gt;param(<span class="stringliteral">&quot;upgrade_course_tables&quot;</span>)) {
            my @schema_table_names = keys %$dbStatus;  # update tables missing from database;
            my @tables_to_create = grep {$dbStatus-&gt;{$_}-&gt;[0] == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A} @schema_table_names;
            my @tables_to_alter  = grep {$dbStatus-&gt;{$_}-&gt;[0] == WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B} @schema_table_names;
            my $msg = $CIchecker-&gt;updateCourseTables($archive_courseID, [@tables_to_create]);
            <span class="keywordflow">foreach</span> my $table_name (@tables_to_alter) {
                $msg .= $CIchecker-&gt;updateTableFields($archive_courseID, $table_name);
            }
            print CGI::p({-style=&gt;<span class="stringliteral">&#39;color:green; font-weight:bold&#39;</span>}, $msg);
        }
        <span class="keywordflow">if</span> ($r-&gt;param(<span class="stringliteral">&quot;upgrade_course_tables&quot;</span>) ) {
            
            $CIchecker -&gt; updateCourseDirectories();   # needs more error messages
        
        
        
        }
        ($tables_ok,$dbStatus) = $CIchecker-&gt;checkCourseTables($archive_courseID);
 

<span class="preprocessor">        # print db status</span>
<span class="preprocessor"></span>
        my %msg =(    WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A         =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Table defined in schema but missing in database&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B         =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Table defined in database but missing in schema&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::SAME_IN_A_AND_B   =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:green&quot;</span>},<span class="stringliteral">&quot; Table is ok &quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Schema and database table definitions do not agree &quot;</span>),
        );
        my %msg2 =(    WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A        =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; missing in database&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B         =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; missing in schema&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::SAME_IN_A_AND_B   =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:green&quot;</span>},<span class="stringliteral">&quot; is ok &quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Schema and database field definitions do not agree &quot;</span>),
        );
        my $all_tables_ok=1;
        my $extra_database_tables=0;
        my $extra_database_fields=0;
        my $str=CGI::h4(<span class="stringliteral">&quot;Report on database structure for course $archive_courseID:&quot;</span>).CGI::br();
        <span class="keywordflow">foreach</span> my $table (sort keys %$dbStatus) {
            my $table_status = $dbStatus-&gt;{$table}-&gt;[0];
            $str .= CGI::b($table) .  $msg{ $table_status } . CGI::br();
            
            CASE: {
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::SAME_IN_A_AND_B 
                    &amp;&amp; <span class="keywordflow">do</span>{ last CASE;
                    };
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A
                    &amp;&amp; <span class="keywordflow">do</span>{
                           $all_tables_ok = 0; last CASE;
                    };
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B
                    &amp;&amp; <span class="keywordflow">do</span>{
                           $extra_database_tables = 1; last CASE;
                    };
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B
                    &amp;&amp; <span class="keywordflow">do</span>{ 
                        my %fieldInfo = %{ $dbStatus-&gt;{$table}-&gt;[1] };
                        <span class="keywordflow">foreach</span> my $key (keys %fieldInfo) {
                            my $field_status = $fieldInfo{$key}-&gt;[0];
                            CASE2: {
                                $field_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B 
                                    &amp;&amp; <span class="keywordflow">do</span>{ 
                                       $extra_database_fields = 1; last CASE2;
                                    };
                                $field_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A 
                                    &amp;&amp; <span class="keywordflow">do</span>{ 
                                       $all_tables_ok=0; last CASE2;
                                    };                          
                            }
                            $str .= CGI::br().<span class="stringliteral">&quot;\n&amp;nbsp;&amp;nbsp;Field $key =&gt; &quot;</span>. $msg2{$field_status };
                        }                           
                    };
            }
            $str.=CGI::br();
            
        }
<span class="preprocessor">#############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Report on databases</span>
<span class="preprocessor"></span><span class="preprocessor">#############################################################################</span>
<span class="preprocessor"></span>
        print CGI::p($str);
        <span class="keywordflow">if</span> ($extra_database_tables) {
                print CGI::p({-style=&gt;<span class="stringliteral">&#39;color:red; font-weight:bold&#39;</span>},<span class="stringliteral">&quot;There are extra database tables which are not defined in the schema.  </span>
<span class="stringliteral">                                                                     They can only be removed manually from the database.&quot;</span>);
        } 
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab35081328ee2095124f0d1869a2d7566"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::archive_course_form" ref="ab35081328ee2095124f0d1869a2d7566" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::archive_course_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-archive_course_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-archive_course_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-archive_course_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-archive_course_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in archive_course_form: 126</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ab35081328ee2095124f0d1869a2d7566">archive_course_form</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    my $archive_courseID     = $r-&gt;param(<span class="stringliteral">&quot;archive_courseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
    my $coursesDir = $ce-&gt;{webworkDirs}-&gt;{courses};
    my @courseIDs = listCourses($ce);
<span class="preprocessor">#   @courseIDs    = sort {lc($a) cmp lc ($b) } @courseIDs; #make sort case insensitive</span>
<span class="preprocessor"></span>    my $archive_listing_format   = $r-&gt;param(<span class="stringliteral">&quot;archive_listing_format&quot;</span>); 
    unless (defined $archive_listing_format) {$archive_listing_format = <span class="stringliteral">&#39;alphabetically&#39;</span>;}  #use the <span class="keywordflow">default</span>
    
<span class="preprocessor">#   my %courseLabels; # records... heh.</span>
<span class="preprocessor"></span><span class="preprocessor">#   foreach my $courseID (@courseIDs) {</span>
<span class="preprocessor"></span><span class="preprocessor">#       my $tempCE = new WeBWorK::CourseEnvironment({</span>
<span class="preprocessor"></span><span class="preprocessor">#           %WeBWorK::SeedCE,</span>
<span class="preprocessor"></span><span class="preprocessor">#           courseName =&gt; $courseID,</span>
<span class="preprocessor"></span><span class="preprocessor">#       });</span>
<span class="preprocessor"></span><span class="preprocessor">#       $courseLabels{$courseID} = &quot;$courseID (&quot; . $tempCE-&gt;{dbLayoutName} . &quot;)&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">#   }</span>
<span class="preprocessor"></span><span class="preprocessor">    # Get and store last modify time for login.log for all courses. Also get visibility status.</span>
<span class="preprocessor"></span>    my %courseLabels;
    my @noLoginLogIDs = ();
    my @loginLogIDs = ();

    my ($loginLogFile, $epoch_modify_time, $courseDir);
    <span class="keywordflow">foreach</span> my $courseID (@courseIDs) {
        $loginLogFile = <span class="stringliteral">&quot;$coursesDir/$courseID/logs/login.log&quot;</span>;
        <span class="keywordflow">if</span> (-e $loginLogFile) {                 #<span class="keyword">this</span> should always exist except <span class="keywordflow">for</span> the model course
            $epoch_modify_time = stat($loginLogFile)-&gt;mtime;
            $coursesData{$courseID}{<span class="stringliteral">&#39;epoch_modify_time&#39;</span>} = $epoch_modify_time;
            $coursesData{$courseID}{<span class="stringliteral">&#39;local_modify_time&#39;</span>} = ctime($epoch_modify_time);
            push(@loginLogIDs,$courseID);
        } <span class="keywordflow">else</span> {
            $coursesData{$courseID}{<span class="stringliteral">&#39;local_modify_time&#39;</span>} = <span class="stringliteral">&#39;no login.log&#39;</span>;  #<span class="keyword">this</span> should never be the <span class="keywordflow">case</span> except <span class="keywordflow">for</span> the model course
            push(@noLoginLogIDs,$courseID);
        }
        <span class="keywordflow">if</span> (-f <span class="stringliteral">&quot;$coursesDir/$courseID/hide_directory&quot;</span>) {
            $coursesData{$courseID}{<span class="stringliteral">&#39;status&#39;</span>} = <span class="stringliteral">&#39;hidden&#39;</span>;
        } <span class="keywordflow">else</span> {    
            $coursesData{$courseID}{<span class="stringliteral">&#39;status&#39;</span>} = <span class="stringliteral">&#39;visible&#39;</span>;  
        }
        $courseLabels{$courseID} = <span class="stringliteral">&quot;$courseID  ($coursesData{$courseID}{&#39;status&#39;} :: $coursesData{$courseID}{&#39;local_modify_time&#39;}) &quot;</span>;
    }
    <span class="keywordflow">if</span> ($archive_listing_format eq <span class="stringliteral">&#39;last_login&#39;</span>) {
        @noLoginLogIDs = sort {lc($a) cmp lc ($b) } @noLoginLogIDs; <span class="preprocessor">#this should be an empty arrey except for the model course</span>
<span class="preprocessor"></span>        @loginLogIDs = sort <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a3470cc813f60b7eaa9ffbf641bc65be6">byLoginActivity</a> @loginLogIDs;  # oldest first
        @courseIDs = (@noLoginLogIDs,@loginLogIDs);
    } <span class="keywordflow">else</span> { # in <span class="keyword">this</span> <span class="keywordflow">case</span> we sort alphabetically
        @courseIDs = sort {lc($a) cmp lc ($b) } @courseIDs;
    }
    
    print CGI::h2(&quot;archive Course&quot;);
    
    print CGI::p(
        &#39;Creates a gzipped tar archive (.tar.gz) of a course in the <a class="code" href="classWeBWorK.html">WeBWorK</a>
        courses directory. Before archiving, the course database is dumped into
        a subdirectory of the course\&#39;s DATA directory. Currently the archive
        facility is only available for mysql databases. It depends on the
        mysqldump application.&#39;
    );
        print CGI::p(
        &#39;Courses are listed either alphabetically or in order by the time of most recent login activity, oldest first.
        To change the listing order check the mode you want and click &quot;Refresh Listing&quot;.  The listing format is: Course_Name 
        (status :: date/time of most recent login) where status is &quot;hidden&quot; or &quot;visible&quot;.&#39;);

    print CGI::start_form(-method=&gt;&quot;POST&quot;, -action=&gt;$r-&gt;uri);
    my %list_labels = (
                                alphabetically =&gt; &#39;alphabetically&#39;, 
                                last_login =&gt; &#39;by last login date&#39;, 
                                );
                                            
    print CGI::table(
            CGI::Tr({},
            CGI::p(<span class="stringliteral">&quot;Select a listing format:&quot;</span>),
            CGI::radio_group(-name=&gt;<span class="stringliteral">&#39;archive_listing_format&#39;</span>,
                                            -values=&gt;[<span class="stringliteral">&#39;alphabetically&#39;</span>, <span class="stringliteral">&#39;last_login&#39;</span>],
                                            -<span class="keywordflow">default</span>=&gt;<span class="stringliteral">&#39;alphabetically&#39;</span>,
                                            -labels=&gt;\%list_labels,
                                            ),
            ),
        );  
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;archive_course_refresh&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Refresh Listing&quot;</span>), 
      CGI::submit(-name=&gt;<span class="stringliteral">&quot;archive_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Archive Courses&quot;</span>)); 
    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    
    print CGI::p(<span class="stringliteral">&quot;Select course(s) to archive.&quot;</span>);
    
    print CGI::table({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;FormLayout&quot;</span>},
        CGI::Tr({},
            CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, <span class="stringliteral">&quot;Course Name:&quot;</span>),
            CGI::td(
                CGI::scrolling_list(
                    -name =&gt; <span class="stringliteral">&quot;archive_courseIDs&quot;</span>,
                    -values =&gt; \@courseIDs,
                    -<span class="keywordflow">default</span> =&gt; $archive_courseID,
                    -size =&gt; 15,
                    -multiple =&gt; 1,
                    -labels =&gt; \%courseLabels,
                ),
            ),
            
        ),
        CGI::Tr({},
            CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, <span class="stringliteral">&quot;Delete course:&quot;</span>),
            CGI::td({-style=&gt;<span class="stringliteral">&#39;color:red&#39;</span>}, CGI::checkbox({ 
                                -name=&gt;<span class="stringliteral">&#39;delete_course&#39;</span>, 
                                -checked=&gt;0,
                                -value =&gt; 1,
                                -label =&gt;<span class="stringliteral">&#39;Delete course after archiving. Caution there is no undo!&#39;</span>,
                               },
                   ),
            ),
        )
    );
    
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;archive_course_refresh&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Refresh Listing&quot;</span>), 
    CGI::submit(-name=&gt;<span class="stringliteral">&quot;archive_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Archive Courses&quot;</span>));
    
    print CGI::end_form();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4e1ac0afdf29cb5b5679abbb6070a73c"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::archive_course_validate" ref="a4e1ac0afdf29cb5b5679abbb6070a73c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::archive_course_validate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-archive_course_validate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-archive_course_validate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-archive_course_validate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-archive_course_validate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in archive_course_validate: 26</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a4e1ac0afdf29cb5b5679abbb6070a73c">archive_course_validate</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span>    my $urlpath = $r-&gt;urlpath;
    
    my @archive_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;archive_courseIDs&quot;</span>);
    @archive_courseIDs        = () unless @archive_courseIDs;
    my @errors;
    <span class="keywordflow">foreach</span> my $archive_courseID (@archive_courseIDs) {
        <span class="keywordflow">if</span> ($archive_courseID eq <span class="stringliteral">&quot;&quot;</span>) {
            push @errors, <span class="stringliteral">&quot;You must specify a course name.&quot;</span>;
        } elsif ($archive_courseID eq $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>)) {
            push @errors, <span class="stringliteral">&quot;You cannot archive the course you are currently using.&quot;</span>;
        }
    }
    
<span class="preprocessor">    #my $ce2 = new WeBWorK::CourseEnvironment({</span>
<span class="preprocessor"></span><span class="preprocessor">    #   %WeBWorK::SeedCE,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   courseName =&gt; $archive_courseID,</span>
<span class="preprocessor"></span><span class="preprocessor">    #});</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">return</span> @errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a628e8e259bb173b85e001efc69230ea5"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::body" ref="a628e8e259bb173b85e001efc69230ea5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::body </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-body' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-body-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-body-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-body-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in body: 109</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a628e8e259bb173b85e001efc69230ea5">body</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    my $urlpath = $r-&gt;urlpath;
    
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
<span class="preprocessor">    # check permissions</span>
<span class="preprocessor"></span>    unless ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;create_and_delete_courses&quot;</span>)) {
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
    }
    my $method_to_call = $self-&gt;{method_to_call};
    my $methodMessage =<span class="stringliteral">&quot;&quot;</span>;
    
    (defined($method_to_call) and $method_to_call eq &quot;do_export_database&quot;) &amp;&amp; do {
        my @export_courseID = $r-&gt;param(<span class="stringliteral">&quot;export_courseID&quot;</span>);
        my $course_ids = join(<span class="stringliteral">&quot;, &quot;</span>, @export_courseID);
        $methodMessage  = CGI::p(<span class="stringliteral">&quot;Exporting database for course(s) $course_ids&quot;</span>).
        CGI::p(<span class="stringliteral">&quot;.... please wait.... </span>
<span class="stringliteral">        If your browser times out you will</span>
<span class="stringliteral">        still be able to download the exported database using the </span>
<span class="stringliteral">        file manager.&quot;</span>).CGI::hr();
    };
    
    
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>},
        CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;add_course&quot;</span>,add_admin_users=&gt;1,
                   add_dbLayout=&gt;<span class="stringliteral">&#39;sql_single&#39;</span>, 
                   add_templates_course =&gt; $ce-&gt;{siteDefaults}-&gt;{default_templates_course} ||<span class="stringliteral">&quot;&quot;</span>}
                   )}, 
                   <span class="stringliteral">&quot;Add Course&quot;</span>
        ),
        <span class="stringliteral">&quot; | &quot;</span>,
        CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;rename_course&quot;</span>})}, <span class="stringliteral">&quot;Rename Course&quot;</span>),
        <span class="stringliteral">&quot; | &quot;</span>,
        CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;delete_course&quot;</span>})}, <span class="stringliteral">&quot;Delete Course&quot;</span>),
        <span class="stringliteral">&quot; | &quot;</span>,
<span class="preprocessor">        # CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;&quot;export_database&quot;})}, &quot;Export Database&quot;),</span>
<span class="preprocessor"></span><span class="preprocessor">        # &quot; | &quot;,</span>
<span class="preprocessor"></span><span class="preprocessor">        # CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;&quot;import_database&quot;})}, &quot;Import Database&quot;),</span>
<span class="preprocessor"></span><span class="preprocessor">        # &quot; | &quot;,</span>
<span class="preprocessor"></span>        CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;archive_course&quot;</span>})}, <span class="stringliteral">&quot;Archive Course&quot;</span>),
         <span class="stringliteral">&quot;|&quot;</span>,
        CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;unarchive_course&quot;</span>})}, <span class="stringliteral">&quot;Unarchive Course&quot;</span>),
         <span class="stringliteral">&quot;|&quot;</span>,
        CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;upgrade_course&quot;</span>})}, <span class="stringliteral">&quot;Upgrade courses&quot;</span>),
         <span class="stringliteral">&quot;|&quot;</span>,
        CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;manage_locations&quot;</span>})}, <span class="stringliteral">&quot;Manage Locations&quot;</span>),
         <span class="stringliteral">&quot;|&quot;</span>,
        CGI::a({href=&gt;$self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;hide_inactive_course&quot;</span>})}, <span class="stringliteral">&quot;Hide Inactive courses&quot;</span>),
        CGI::hr(),
        $methodMessage,
        
    );
    
    print( CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, $self-&gt;display_registration_form() ) ) if $self-&gt;<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a44933dfc3a9018a7ec48953d17afbb38">display_registration_form</a>();
    
    
    my @errors = @{$self-&gt;{errors}};
    
    
    <span class="keywordflow">if</span> (@errors) {
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;Please correct the following errors and try again:&quot;</span>),
            CGI::ul(CGI::li(\@errors)),
        );
    }
    
    <span class="keywordflow">if</span> (defined $method_to_call and $method_to_call ne <span class="stringliteral">&quot;&quot;</span>) {
        $self-&gt;$method_to_call;
    } <span class="keywordflow">else</span> {
            my $msg = <span class="stringliteral">&quot;&quot;</span>;
            $msg .= CGI::li(<span class="stringliteral">&quot;unable to write to directory $ce-&gt;{webworkDirs}{logs}&quot;</span>)  unless -w $ce-&gt;{webworkDirs}{logs}; 
            $msg .=  CGI::li(<span class="stringliteral">&quot;unable to write to directory $ce-&gt;{webworkDirs}{tmp}&quot;</span> )  unless -w $ce-&gt;{webworkDirs}{tmp}; 
            $msg .=  CGI::li(<span class="stringliteral">&quot;unable to write to directory $ce-&gt;{webworkDirs}{DATA}&quot;</span>)  unless -w $ce-&gt;{webworkDirs}{DATA}; 
            <span class="keywordflow">if</span> ($msg) {
                print CGI::h2(<span class="stringliteral">&quot;Directory permission errors &quot;</span>).CGI::ul($msg).
                CGI::p(<span class="stringliteral">&quot; The webwork server must be able to write to these directories. Please correct the permssion errors.&quot;</span>) ;
            }
    
        print CGI::h2(<span class="stringliteral">&quot;Courses&quot;</span>);
    
        print CGI::start_ol();
        
        my @courseIDs = listCourses($ce);
        <span class="keywordflow">foreach</span> my $courseID (sort {lc($a) cmp lc($b) } @courseIDs) {
            next <span class="keywordflow">if</span> $courseID eq <span class="stringliteral">&quot;admin&quot;</span>; # done already above
            next <span class="keywordflow">if</span> $courseID eq <span class="stringliteral">&quot;modelCourse&quot;</span>; # modelCourse isn<span class="stringliteral">&#39;t a real course so don&#39;</span>t create missing directories, etc
            my $urlpath = $r-&gt;urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::ProblemSets&quot;</span>, $r, courseID =&gt; $courseID);
            print CGI::li(CGI::a({href=&gt;$self-&gt;systemLink($urlpath, authen =&gt; 0)}, $courseID));
        }
        
        print CGI::end_ol();
        
        print CGI::h2(<span class="stringliteral">&quot;Archived Courses&quot;</span>);
        print CGI::start_ol();
        
        @courseIDs = listArchivedCourses($ce);
        <span class="keywordflow">foreach</span> my $courseID (sort {lc($a) cmp lc($b) } @courseIDs) {
            print CGI::li($courseID),    
        }
        
        print CGI::end_ol();
    }
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3470cc813f60b7eaa9ffbf641bc65be6"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::byLoginActivity" ref="a3470cc813f60b7eaa9ffbf641bc65be6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::byLoginActivity </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-byLoginActivity' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-byLoginActivity-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-byLoginActivity-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-byLoginActivity-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in byLoginActivity: 1</span>
<span class="preprocessor">sub byLoginActivity {$coursesData{$a}{&#39;epoch_modify_time&#39;} &lt;=&gt; $coursesData{$b}{&#39;epoch_modify_time&#39;}}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad49746ae733cb9c2a9798e9868b19fcd"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::content" ref="ad49746ae733cb9c2a9798e9868b19fcd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::content </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-content' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-content-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-content-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-content-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in content: 10</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ad49746ae733cb9c2a9798e9868b19fcd">content</a> {
    my ($self) = @_;
    my $method_to_call = $self-&gt;{method_to_call};
    <span class="keywordflow">if</span> (defined $method_to_call and $method_to_call eq <span class="stringliteral">&quot;do_export_database&quot;</span>) {
<span class="preprocessor">        #$self-&gt;do_export_database;</span>
<span class="preprocessor"></span>        $self-&gt;SUPER::content;
    } <span class="keywordflow">else</span> {
        $self-&gt;SUPER::content;
    }
}
</pre></div>  
</div>
 
<p>Reimplemented from <a class="el" href="classWeBWorK_1_1ContentGenerator.html#ae8c8b9b7ac345339bce657444d32ee2e">WeBWorK::ContentGenerator</a>.</p>

</div>
</div>
<a class="anchor" id="a6ba556ac21ca64d0c0cf41a36e0836e3"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::delete_course_confirm" ref="a6ba556ac21ca64d0c0cf41a36e0836e3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::delete_course_confirm </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-delete_course_confirm' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-delete_course_confirm-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-delete_course_confirm-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-delete_course_confirm-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in delete_course_confirm: 33</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a6ba556ac21ca64d0c0cf41a36e0836e3">delete_course_confirm</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    print CGI::h2(<span class="stringliteral">&quot;Delete Course&quot;</span>);
    
    my $delete_courseID     = $r-&gt;param(<span class="stringliteral">&quot;delete_courseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        %WeBWorK::SeedCE,
        courseName =&gt; $delete_courseID,
    });
    
    print CGI::p(<span class="stringliteral">&quot;Are you sure you want to delete the course &quot;</span> . CGI::b($delete_courseID)
        . <span class="stringliteral">&quot;? All course files and data will be destroyed. There is no undo available.&quot;</span>);
    
    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    print $self-&gt;hidden_fields(qw/delete_courseID/);
    
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>},
        CGI::submit(-name=&gt;<span class="stringliteral">&quot;decline_delete_course&quot;</span>, -label=&gt;<span class="stringliteral">&quot;Don&#39;t delete&quot;</span>),
        <span class="stringliteral">&quot;&amp;nbsp;&quot;</span>,
        CGI::submit(-name=&gt;<span class="stringliteral">&quot;confirm_delete_course&quot;</span>, -label=&gt;<span class="stringliteral">&quot;Delete&quot;</span>),
    );
    
    print CGI::end_form();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae3df3a1e1435f9032ffb837743f621cd"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::delete_course_form" ref="ae3df3a1e1435f9032ffb837743f621cd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::delete_course_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-delete_course_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-delete_course_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-delete_course_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-delete_course_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in delete_course_form: 106</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ae3df3a1e1435f9032ffb837743f621cd">delete_course_form</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    my $delete_courseID     = $r-&gt;param(<span class="stringliteral">&quot;delete_courseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
    my $coursesDir = $ce-&gt;{webworkDirs}-&gt;{courses};
    my @courseIDs = listCourses($ce);
<span class="preprocessor">#   @courseIDs    = sort {lc($a) cmp lc ($b) } @courseIDs; #make sort case insensitive </span>
<span class="preprocessor"></span>    my $delete_listing_format   = $r-&gt;param(<span class="stringliteral">&quot;delete_listing_format&quot;</span>); 
    unless (defined $delete_listing_format) {$delete_listing_format = <span class="stringliteral">&#39;alphabetically&#39;</span>;}  #use the <span class="keywordflow">default</span>
    
<span class="preprocessor">#   my %courseLabels; # records... heh.</span>
<span class="preprocessor"></span><span class="preprocessor">#   foreach my $courseID (@courseIDs) {</span>
<span class="preprocessor"></span><span class="preprocessor">#       my $tempCE = new WeBWorK::CourseEnvironment({</span>
<span class="preprocessor"></span><span class="preprocessor">#           %WeBWorK::SeedCE,</span>
<span class="preprocessor"></span><span class="preprocessor">#           courseName =&gt; $courseID,</span>
<span class="preprocessor"></span><span class="preprocessor">#       });</span>
<span class="preprocessor"></span><span class="preprocessor">#       $courseLabels{$courseID} = &quot;$courseID (&quot; . $tempCE-&gt;{dbLayoutName} . &quot;)&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">#   }</span>
<span class="preprocessor"></span><span class="preprocessor">    # Get and store last modify time for login.log for all courses. Also get visibility status.</span>
<span class="preprocessor"></span>    my %courseLabels;
    my @noLoginLogIDs = ();
    my @loginLogIDs = ();

    my ($loginLogFile, $epoch_modify_time, $courseDir);
    <span class="keywordflow">foreach</span> my $courseID (@courseIDs) {
        $loginLogFile = <span class="stringliteral">&quot;$coursesDir/$courseID/logs/login.log&quot;</span>;
        <span class="keywordflow">if</span> (-e $loginLogFile) {                 #<span class="keyword">this</span> should always exist except <span class="keywordflow">for</span> the model course
            $epoch_modify_time = stat($loginLogFile)-&gt;mtime;
            $coursesData{$courseID}{<span class="stringliteral">&#39;epoch_modify_time&#39;</span>} = $epoch_modify_time;
            $coursesData{$courseID}{<span class="stringliteral">&#39;local_modify_time&#39;</span>} = ctime($epoch_modify_time);
            push(@loginLogIDs,$courseID);
        } <span class="keywordflow">else</span> {
            $coursesData{$courseID}{<span class="stringliteral">&#39;local_modify_time&#39;</span>} = <span class="stringliteral">&#39;no login.log&#39;</span>;  #<span class="keyword">this</span> should never be the <span class="keywordflow">case</span> except <span class="keywordflow">for</span> the model course
            push(@noLoginLogIDs,$courseID);
        }
        <span class="keywordflow">if</span> (-f <span class="stringliteral">&quot;$coursesDir/$courseID/hide_directory&quot;</span>) {
            $coursesData{$courseID}{<span class="stringliteral">&#39;status&#39;</span>} = <span class="stringliteral">&#39;hidden&#39;</span>;
        } <span class="keywordflow">else</span> {    
            $coursesData{$courseID}{<span class="stringliteral">&#39;status&#39;</span>} = <span class="stringliteral">&#39;visible&#39;</span>;  
        }
        $courseLabels{$courseID} = <span class="stringliteral">&quot;$courseID  ($coursesData{$courseID}{&#39;status&#39;} :: $coursesData{$courseID}{&#39;local_modify_time&#39;}) &quot;</span>;
    }
    <span class="keywordflow">if</span> ($delete_listing_format eq <span class="stringliteral">&#39;last_login&#39;</span>) {
        @noLoginLogIDs = sort {lc($a) cmp lc ($b) } @noLoginLogIDs; <span class="preprocessor">#this should be an empty arrey except for the model course</span>
<span class="preprocessor"></span>        @loginLogIDs = sort <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a3470cc813f60b7eaa9ffbf641bc65be6">byLoginActivity</a> @loginLogIDs;  # oldest first
        @courseIDs = (@noLoginLogIDs,@loginLogIDs);
    } <span class="keywordflow">else</span> { # in <span class="keyword">this</span> <span class="keywordflow">case</span> we sort alphabetically
        @courseIDs = sort {lc($a) cmp lc ($b) } @courseIDs;
    }
        
    print CGI::h2(&quot;Delete Course&quot;);
    
    print CGI::start_form(-method=&gt;&quot;POST&quot;, -action=&gt;$r-&gt;uri);
    my %list_labels = (
                                alphabetically =&gt; &#39;alphabetically&#39;, 
                                last_login =&gt; &#39;by last login date&#39;,
                                );
    print CGI::p(
        &#39;Courses are listed either alphabetically or in order by the time of most recent login activity, oldest first.
        To change the listing order check the mode you want and click &quot;Refresh Listing&quot;.  The listing format is: Course_Name 
        (status :: date/time of most recent login) where status is &quot;hidden&quot; or &quot;visible&quot;.&#39;);

    print CGI::table(
            CGI::Tr({},
            CGI::p(<span class="stringliteral">&quot;Select a listing format:&quot;</span>),
            CGI::radio_group(-name=&gt;<span class="stringliteral">&#39;delete_listing_format&#39;</span>,
                                            -values=&gt;[<span class="stringliteral">&#39;alphabetically&#39;</span>, <span class="stringliteral">&#39;last_login&#39;</span>],
                                            -<span class="keywordflow">default</span>=&gt;<span class="stringliteral">&#39;alphabetically&#39;</span>,
                                            -labels=&gt;\%list_labels,
                                            ),
            ),
        );  
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;delete_course_refresh&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Refresh Listing&quot;</span>), 
      CGI::submit(-name=&gt;<span class="stringliteral">&quot;delete_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Delete Course&quot;</span>));    
    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    

    print CGI::p(<span class="stringliteral">&quot;Select a course to delete.&quot;</span>);
    print CGI::table({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;FormLayout&quot;</span>},
        CGI::Tr({},
            CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, <span class="stringliteral">&quot;Course Name:&quot;</span>),
            CGI::td(
                CGI::scrolling_list(
                    -name =&gt; <span class="stringliteral">&quot;delete_courseID&quot;</span>,
                    -values =&gt; \@courseIDs,
                    -<span class="keywordflow">default</span> =&gt; $delete_courseID,
                    -size =&gt; 15,
                    -multiple =&gt; 0,
                    -labels =&gt; \%courseLabels,
                ),
            ),
        ),
    );
    
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;delete_course_refresh&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Refresh Listing&quot;</span>), 
      CGI::submit(-name=&gt;<span class="stringliteral">&quot;delete_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Delete Course&quot;</span>));    
    
    print CGI::end_form();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1c6860496524c45b0f800d67a5d6670b"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::delete_course_validate" ref="a1c6860496524c45b0f800d67a5d6670b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::delete_course_validate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-delete_course_validate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-delete_course_validate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-delete_course_validate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-delete_course_validate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in delete_course_validate: 25</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a1c6860496524c45b0f800d67a5d6670b">delete_course_validate</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span>    my $urlpath = $r-&gt;urlpath;
    
    my $delete_courseID     = $r-&gt;param(<span class="stringliteral">&quot;delete_courseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
    my @errors;
    
    <span class="keywordflow">if</span> ($delete_courseID eq <span class="stringliteral">&quot;&quot;</span>) {
        push @errors, <span class="stringliteral">&quot;You must specify a course name.&quot;</span>;
    } elsif ($delete_courseID eq $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>)) {
        push @errors, <span class="stringliteral">&quot;You cannot delete the course you are currently using.&quot;</span>;
    }
    
    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        %WeBWorK::SeedCE,
        courseName =&gt; $delete_courseID,
    });
    
    <span class="keywordflow">return</span> @errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a907945ed5c2461fda065220362cab78e"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::delete_location_handler" ref="a907945ed5c2461fda065220362cab78e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::delete_location_handler </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-delete_location_handler' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-delete_location_handler-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-delete_location_handler-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-delete_location_handler-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in delete_location_handler: 44</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a907945ed5c2461fda065220362cab78e">delete_location_handler</a> {
    my $self = shift;
    my $r = $self-&gt;r;
    my $db = $r-&gt;db;

<span class="preprocessor">    # what location are we deleting?</span>
<span class="preprocessor"></span>    my $locationID = $r-&gt;param(<span class="stringliteral">&quot;delete_location&quot;</span>);
<span class="preprocessor">    # check for selected deletions if appropriate</span>
<span class="preprocessor"></span>    my @delLocations = ( $locationID );
    <span class="keywordflow">if</span> ( $locationID eq <span class="stringliteral">&#39;selected_locations&#39;</span> ) {
        @delLocations = $r-&gt;param(<span class="stringliteral">&quot;delete_selected&quot;</span>);
        $locationID = @delLocations;
    }
<span class="preprocessor">    # are we sure?</span>
<span class="preprocessor"></span>    my $confirm = $r-&gt;param(<span class="stringliteral">&quot;delete_confirm&quot;</span>);

    my $badID;
    <span class="keywordflow">if</span> ( ! $locationID ) {
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, 
                   <span class="stringliteral">&quot;Please provide a location name &quot;</span> . 
                   <span class="stringliteral">&quot;to delete.&quot;</span>);

    } elsif ( $badID = $self-&gt;existsLocations_helper( @delLocations ) ) {
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, 
                   <span class="stringliteral">&quot;No location with name $badID &quot;</span> . 
                   <span class="stringliteral">&quot;exists in the database.&quot;</span>);

    } elsif ( ! $confirm || $confirm ne <span class="stringliteral">&#39;true&#39;</span> ) {
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, 
                   <span class="stringliteral">&quot;Location deletion requires confirmation.&quot;</span>);
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">foreach</span> ( @delLocations ) {
            $db-&gt;deleteLocation( $_ );
        }
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
                   <span class="stringliteral">&quot;Location&quot;</span> . (@delLocations &gt; 1 ? <span class="stringliteral">&#39;s &#39;</span> : <span class="charliteral">&#39; &#39;</span>) .
                   join(<span class="stringliteral">&#39;, &#39;</span>, @delLocations) . 
                   (@delLocations &gt; 1 ? <span class="stringliteral">&#39; have &#39;</span> : <span class="stringliteral">&#39; has &#39;</span> ) . 
                   <span class="stringliteral">&#39;been deleted.&#39;</span>);
        $r-&gt;param(<span class="stringliteral">&#39;manage_location_action&#39;</span>,<span class="stringliteral">&#39;none&#39;</span>);
        $r-&gt;param(<span class="stringliteral">&#39;delete_location&#39;</span>,<span class="stringliteral">&#39;&#39;</span>);
    }
    $self-&gt;manage_location_form;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a44933dfc3a9018a7ec48953d17afbb38"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::display_registration_form" ref="a44933dfc3a9018a7ec48953d17afbb38" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::display_registration_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-display_registration_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-display_registration_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-display_registration_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-display_registration_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in display_registration_form: 32</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a44933dfc3a9018a7ec48953d17afbb38">display_registration_form</a> {
    my $self = shift;
    my $ce   = $self-&gt;r-&gt;ce;
    my $registeredQ = (-e ($ce-&gt;{courseDirs}-&gt;{root}).<span class="stringliteral">&quot;/$registered_file_name&quot;</span>)?1:0;
<span class="preprocessor">    #my $registration_subDisplay = ( $self-&gt;{method_to_call} eq &quot;registration_form&quot;) ?  1: 0;</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> 0  <span class="keywordflow">if</span> $registeredQ or $self-&gt;r-&gt;param(<span class="stringliteral">&quot;register_site&quot;</span>);     #otherwise <span class="keywordflow">return</span> registration form
    <span class="keywordflow">return</span>  q! 
    &lt;center&gt;
    &lt;table <span class="keyword">class</span>=<span class="stringliteral">&quot;messagebox&quot;</span> style=<span class="stringliteral">&quot;background-color:#FFFFCC;width:60%&quot;</span>&gt;
    &lt;tr&gt;&lt;td&gt;
    !,
    CGI::p(<span class="stringliteral">&quot;If you are using your WeBWorK server for courses please help us out by registering your server.&quot;</span>),
    CGI::p(<span class="stringliteral">&quot;We are often asked how many institutions are using WeBWorK and how many students are using</span>
<span class="stringliteral">    WeBWorK  Since WeBWorK is open source and can be freely downloaded from &quot;</span>.
    CGI::a({href=&gt;<span class="stringliteral">&#39;http://webwork.maa.org&#39;</span>},<span class="stringliteral">&#39;http://webwork.maa.org&#39;</span> ). <span class="stringliteral">&quot; and &quot;</span>.
    CGI::a({href=&gt; <span class="stringliteral">&#39;http://www.openwebwork.org&#39;</span>},<span class="stringliteral">&#39;http://www.openwebwork.org&#39;</span>). <span class="stringliteral">&quot;, it is frequently difficult for us to give a reasonable answer to this </span>
<span class="stringliteral">    question.&quot;</span>),
    CGI::p(<span class="stringliteral">&quot;You can help by registering your current version of WeBWorK -- click the button, answer a few</span>
<span class="stringliteral">    questions (the ones you can answer easily) and send the email.  It takes less than two minutes.  Thank you!. -- The WeBWorK Team&quot;</span>),
    q!
    &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;&lt;td align=<span class="stringliteral">&quot;center&quot;</span>&gt;
    !,
    CGI::a({href=&gt;$self-&gt;systemLink($self-&gt;r-&gt;urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;registration&quot;</span>})}, <span class="stringliteral">&quot;Register&quot;</span>),
    q!
    &lt;/td&gt;&lt;/tr&gt;
    &lt;/table&gt;
    &lt;/center&gt;
    !;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a95f8ce0e60d2e90526f67f36aa0b4926"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::do_add_course" ref="a95f8ce0e60d2e90526f67f36aa0b4926" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::do_add_course </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-do_add_course' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-do_add_course-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-do_add_course-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-do_add_course-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in do_add_course: 172</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a95f8ce0e60d2e90526f67f36aa0b4926">do_add_course</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    my $urlpath = $r-&gt;urlpath;
    
    my $add_courseID                     = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_courseID&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_courseTitle                  = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_courseTitle&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_courseInstitution            = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_courseInstitution&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_admin_users                  = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_admin_users&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_initial_userID               = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_userID&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_password             = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_password&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_confirmPassword      = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_confirmPassword&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_firstName            = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_firstName&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_lastName             = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_lastName&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    my $add_initial_email                = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_initial_email&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_templates_course             = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_templates_course&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $add_dbLayout                     = trim_spaces( $r-&gt;param(<span class="stringliteral">&quot;add_dbLayout&quot;</span>) ) || <span class="stringliteral">&quot;&quot;</span>;
    
    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        %WeBWorK::SeedCE,
        courseName =&gt; $add_courseID,
    });
    
    my %courseOptions = ( dbLayoutName =&gt; $add_dbLayout );
    
    <span class="keywordflow">if</span> ($add_initial_email ne <span class="stringliteral">&quot;&quot;</span>) {
        $courseOptions{allowedRecipients} = [ $add_initial_email ];
<span class="preprocessor">        # don&#39;t set feedbackRecipients -- this just gets in the way of the more</span>
<span class="preprocessor"></span><span class="preprocessor">        # intelligent &quot;receive_recipients&quot; method.</span>
<span class="preprocessor"></span><span class="preprocessor">        #$courseOptions{feedbackRecipients} = [ $add_initial_email ];</span>
<span class="preprocessor"></span>    }
    
<span class="preprocessor">    # this is kinda left over from when we had &#39;gdbm&#39; and &#39;sql&#39; database layouts</span>
<span class="preprocessor"></span><span class="preprocessor">    # below this line, we would grab values from getopt and put them in this hash</span>
<span class="preprocessor"></span><span class="preprocessor">    # but for now the hash can remain empty</span>
<span class="preprocessor"></span>    my %dbOptions;
    
    my @users;
    
<span class="preprocessor">    # copy users from current (admin) course if desired</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($add_admin_users ne <span class="stringliteral">&quot;&quot;</span>) {
        <span class="keywordflow">foreach</span> my $userID ($db-&gt;listUsers) {
            <span class="keywordflow">if</span> ($userID eq $add_initial_userID) {
                $self-&gt;addbadmessage( <span class="stringliteral">&quot;User &#39;$userID&#39; will not be copied from admin course as it is the initial instructor.&quot;</span>);
                next;
            }
            my $User            = $db-&gt;getUser($userID);
            my $Password        = $db-&gt;getPassword($userID);
            my $PermissionLevel = $db-&gt;getPermissionLevel($userID);
            push @users, [ $User, $Password, $PermissionLevel ] 
                   <span class="keywordflow">if</span> $authz-&gt;hasPermissions($userID,<span class="stringliteral">&quot;create_and_delete_courses&quot;</span>);  
<span class="preprocessor">                   #only transfer the &quot;instructors&quot; in the admin course classlist.</span>
<span class="preprocessor"></span>        }
    }
    
<span class="preprocessor">    # add initial instructor if desired</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($add_initial_userID ne <span class="stringliteral">&quot;&quot;</span>) {
        my $User = $db-&gt;newUser(
            user_id       =&gt; $add_initial_userID,
            first_name    =&gt; $add_initial_firstName,
            last_name     =&gt; $add_initial_lastName,
            student_id    =&gt; $add_initial_userID,
            email_address =&gt; $add_initial_email,
            status        =&gt; <span class="stringliteral">&quot;C&quot;</span>,
        );
        my $Password = $db-&gt;newPassword(
            user_id  =&gt; $add_initial_userID,
            password =&gt; cryptPassword($add_initial_password),
        );
        my $PermissionLevel = $db-&gt;newPermissionLevel(
            user_id    =&gt; $add_initial_userID,
            permission =&gt; <span class="stringliteral">&quot;10&quot;</span>,
        );
        push @users, [ $User, $Password, $PermissionLevel ];
    }
    
    push @{$courseOptions{PRINT_FILE_NAMES_FOR}}, map { $_-&gt;[0]-&gt;user_id } @users;
    
    my %optional_arguments;
    <span class="keywordflow">if</span> ($add_templates_course ne <span class="stringliteral">&quot;&quot;</span>) {
        $optional_arguments{templatesFrom} = $add_templates_course;
    }
    
    eval {
        addCourse(
            courseID      =&gt; $add_courseID,
            ce            =&gt; $ce2,
            courseOptions =&gt; \%courseOptions,
            dbOptions     =&gt; \%dbOptions,
            users         =&gt; \@users,
            %optional_arguments,
        );
    };
    <span class="keywordflow">if</span> ($@) {
        my $error = $@;
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;An error occured while creating the course $add_courseID:&quot;</span>),
            CGI::tt(CGI::escapeHTML($error)),
        );
<span class="preprocessor">        # get rid of any partially built courses</span>
<span class="preprocessor"></span><span class="preprocessor">        # FIXME  -- this is too fragile</span>
<span class="preprocessor"></span>        unless ($error =~ /course exists/) {
            eval {
                deleteCourse(
                    courseID   =&gt; $add_courseID,
                    ce         =&gt; $ce2,
                    dbOptions  =&gt; \%dbOptions,
                );
            }
        }
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        #log the action</span>
<span class="preprocessor"></span>        writeLog($ce, <span class="stringliteral">&quot;hosted_courses&quot;</span>, join(<span class="stringliteral">&quot;\t&quot;</span>,
            <span class="stringliteral">&quot;\tAdded&quot;</span>,
            ( defined $add_courseInstitution ? $add_courseInstitution : <span class="stringliteral">&quot;(no institution specified)&quot;</span> ),
            ( defined $add_courseTitle ? $add_courseTitle : <span class="stringliteral">&quot;(no title specified)&quot;</span> ),
            $add_courseID,
            $add_initial_firstName,
            $add_initial_lastName,
            $add_initial_email,
        ));
<span class="preprocessor">        # add contact to admin course as student?</span>
<span class="preprocessor"></span><span class="preprocessor">        # FIXME -- should we do this?</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ($add_initial_userID ne <span class="stringliteral">&quot;&quot;</span>) {
            my $composite_id = <span class="stringliteral">&quot;${add_initial_userID}_${add_courseID}&quot;</span>; # student <span class="keywordtype">id</span> includes school name and contact
            my $User = $db-&gt;newUser(
            user_id       =&gt; $composite_id,          # student <span class="keywordtype">id</span> includes school name and contact
            first_name    =&gt; $add_initial_firstName,
            last_name     =&gt; $add_initial_lastName,
            student_id    =&gt; $add_initial_userID,
            email_address =&gt; $add_initial_email,
            status        =&gt; <span class="stringliteral">&quot;C&quot;</span>,
            );
            my $Password = $db-&gt;newPassword(
                user_id  =&gt; $composite_id,
                password =&gt; cryptPassword($add_initial_password),
            );
            my $PermissionLevel = $db-&gt;newPermissionLevel(
                user_id    =&gt; $composite_id,
                permission =&gt; <span class="stringliteral">&quot;0&quot;</span>,
            );
<span class="preprocessor">            # add contact to admin course as student</span>
<span class="preprocessor"></span><span class="preprocessor">            # or if this contact and course already exist in a dropped status</span>
<span class="preprocessor"></span><span class="preprocessor">            # change the student&#39;s status to enrolled</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> (my $oldUser = $db-&gt;getUser($composite_id) ) {
                warn <span class="stringliteral">&quot;Replacing old data for $composite_id  status: &quot;</span>. $oldUser-&gt;status;
                $db-&gt;deleteUser($composite_id);
            }
            eval { $db-&gt;addUser($User)                       }; warn $@ <span class="keywordflow">if</span> $@;
            eval { $db-&gt;addPassword($Password)               }; warn $@ <span class="keywordflow">if</span> $@;
            eval { $db-&gt;addPermissionLevel($PermissionLevel) }; warn $@ <span class="keywordflow">if</span> $@;
        }
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;Successfully created the course $add_courseID&quot;</span>),
        );
        my $newCoursePath = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::ProblemSets&quot;</span>, $r,
            courseID =&gt; $add_courseID);
        my $newCourseURL = $self-&gt;systemLink($newCoursePath, authen =&gt; 0);
        print CGI::div({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>},
            CGI::a({href=&gt;$newCourseURL}, <span class="stringliteral">&quot;Log into $add_courseID&quot;</span>),
        );
    }

    
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="adf2bc1906528ee2cf5e7a9bcbcb6ff9e"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::do_archive_course" ref="adf2bc1906528ee2cf5e7a9bcbcb6ff9e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::do_archive_course </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-do_archive_course' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-do_archive_course-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-do_archive_course-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-do_archive_course-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in do_archive_course: 120</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#adf2bc1906528ee2cf5e7a9bcbcb6ff9e">do_archive_course</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
<span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    
    my $archive_courseID     = $r-&gt;param(<span class="stringliteral">&quot;archive_courseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    my $delete_course_flag   = $r-&gt;param(<span class="stringliteral">&quot;delete_course&quot;</span>)        || <span class="stringliteral">&quot;&quot;</span>;
    my @archive_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;archive_courseIDs&quot;</span>);
    @archive_courseIDs        = () unless @archive_courseIDs;

    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        %WeBWorK::SeedCE,
        courseName =&gt; $archive_courseID,
    });
    
<span class="preprocessor">    # Remove course specific temp files before archiving</span>
<span class="preprocessor"></span>    my $courseTempDir = $ce2-&gt;{courseDirs}{html_temp};
    remove_tree(<span class="stringliteral">&quot;$courseTempDir&quot;</span>);
<span class="preprocessor">    # Remove the original default tmp directory if it exists </span>
<span class="preprocessor"></span>    my $orgDefaultCourseTempDir = <span class="stringliteral">&quot;$ce2-&gt;{courseDirs}{html}/tmp&quot;</span>;   
    <span class="keywordflow">if</span> (-d <span class="stringliteral">&quot;$orgDefaultCourseTempDir&quot;</span>) {
        remove_tree(<span class="stringliteral">&quot;$orgDefaultCourseTempDir&quot;</span>);
    }

<span class="preprocessor">    # this is kinda left over from when we had &#39;gdbm&#39; and &#39;sql&#39; database layouts</span>
<span class="preprocessor"></span><span class="preprocessor">    # below this line, we would grab values from getopt and put them in this hash</span>
<span class="preprocessor"></span><span class="preprocessor">    # but for now the hash can remain empty</span>
<span class="preprocessor"></span>    my %dbOptions;
    
    eval {
        archiveCourse(
            courseID =&gt; $archive_courseID,
            ce =&gt; $ce2,
            dbOptions =&gt; \%dbOptions,
        );
    };
    
    <span class="keywordflow">if</span> ($@) {
        my $error = $@;
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;An error occured while archiving the course $archive_courseID:&quot;</span>),
            CGI::tt(CGI::escapeHTML($error)),
        );
    } <span class="keywordflow">else</span> {
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;Successfully archived the course $archive_courseID&quot;</span>),
        );
         writeLog($ce, <span class="stringliteral">&quot;hosted_courses&quot;</span>, join(<span class="stringliteral">&quot;\t&quot;</span>,
            <span class="stringliteral">&quot;\tarchived&quot;</span>,
            <span class="stringliteral">&quot;&quot;</span>,
            <span class="stringliteral">&quot;&quot;</span>,
            $archive_courseID,
        ));
        
        <span class="keywordflow">if</span> ($delete_course_flag) {
            eval {
                deleteCourse(
                    courseID =&gt; $archive_courseID,
                    ce =&gt; $ce2,
                    dbOptions =&gt; \%dbOptions,
                );
            };
            
            <span class="keywordflow">if</span> ($@) {
                my $error = $@;
                print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
                    CGI::p(<span class="stringliteral">&quot;An error occured while deleting the course $archive_courseID:&quot;</span>),
                    CGI::tt(CGI::escapeHTML($error)),
                );
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # mark the contact person in the admin course as dropped.</span>
<span class="preprocessor"></span><span class="preprocessor">                # find the contact person for the course by searching the admin classlist.</span>
<span class="preprocessor"></span>                my @contacts = grep /_$archive_courseID$/,  $db-&gt;listUsers;
                <span class="keywordflow">if</span> (@contacts) {
                    die <span class="stringliteral">&quot;Incorrect number of contacts for the course $archive_courseID&quot;</span>. join(<span class="stringliteral">&quot; &quot;</span>, @contacts) if @contacts !=1;
                    <span class="preprocessor">#warn &quot;contacts&quot;, join(&quot; &quot;, @contacts);</span>
<span class="preprocessor"></span><span class="preprocessor">                    #my $composite_id = &quot;${add_initial_userID}_${add_courseID}&quot;;</span>
<span class="preprocessor"></span>                    my $composite_id  = $contacts[0];
                    
<span class="preprocessor">                    # mark the contact person as dropped.</span>
<span class="preprocessor"></span>                    my $User = $db-&gt;getUser($composite_id);
                    my $status_name = <span class="stringliteral">&#39;Drop&#39;</span>;
                    my $status_value = ($ce-&gt;status_name_to_abbrevs($status_name))[0];
                    $User-&gt;status($status_value);
                    $db-&gt;putUser($User);
                }
                
                print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
                    CGI::p(<span class="stringliteral">&quot;Successfully deleted the course $archive_courseID.&quot;</span>),
                );
            }
        
        
        }
        shift @archive_courseIDs;  # <span class="keyword">remove</span> the course which has just been archived.
        <span class="keywordflow">if</span> (@archive_courseIDs) {       
            print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
            print $self-&gt;hidden_authen_fields;
            print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
            print $self-&gt;hidden_fields(qw/delete_course/);

            print CGI::hidden(<span class="stringliteral">&#39;archive_courseIDs&#39;</span>,@archive_courseIDs);      
            print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(<span class="stringliteral">&quot;decline_archive_course&quot;</span>, <span class="stringliteral">&quot;Stop archiving courses&quot;</span>),
                CGI::submit(<span class="stringliteral">&quot;archive_course&quot;</span>, <span class="stringliteral">&quot;archive next course&quot;</span>)
            );
            print CGI::end_form();
        } <span class="keywordflow">else</span> {
            print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
            print $self-&gt;hidden_authen_fields;
            print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
            print CGI::hidden(<span class="stringliteral">&quot;archive_courseID&quot;</span>,$archive_courseID);
            print CGI::p( CGI::submit(<span class="stringliteral">&quot;decline_archive_course&quot;</span>, <span class="stringliteral">&quot;OK&quot;</span>)  );
            print CGI::end_form();
        }
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a89e13ea9f889a1f25cea28fcb0b7e5c8"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::do_delete_course" ref="a89e13ea9f889a1f25cea28fcb0b7e5c8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::do_delete_course </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-do_delete_course' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-do_delete_course-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-do_delete_course-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-do_delete_course-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in do_delete_course: 70</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a89e13ea9f889a1f25cea28fcb0b7e5c8">do_delete_course</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
<span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    my $delete_courseID     = $r-&gt;param(<span class="stringliteral">&quot;delete_courseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        %WeBWorK::SeedCE,
        courseName =&gt; $delete_courseID,
    });
    
<span class="preprocessor">    # this is kinda left over from when we had &#39;gdbm&#39; and &#39;sql&#39; database layouts</span>
<span class="preprocessor"></span><span class="preprocessor">    # below this line, we would grab values from getopt and put them in this hash</span>
<span class="preprocessor"></span><span class="preprocessor">    # but for now the hash can remain empty</span>
<span class="preprocessor"></span>    my %dbOptions;
    
    eval {
        deleteCourse(
            courseID =&gt; $delete_courseID,
            ce =&gt; $ce2,
            dbOptions =&gt; \%dbOptions,
        );
    };
    
    <span class="keywordflow">if</span> ($@) {
        my $error = $@;
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;An error occured while deleting the course $delete_courseID:&quot;</span>),
            CGI::tt(CGI::escapeHTML($error)),
        );
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # mark the contact person in the admin course as dropped.</span>
<span class="preprocessor"></span><span class="preprocessor">        # find the contact person for the course by searching the admin classlist.</span>
<span class="preprocessor"></span>        my @contacts = grep /_$delete_courseID$/,  $db-&gt;listUsers;
        <span class="keywordflow">if</span> (@contacts) {
            die <span class="stringliteral">&quot;Incorrect number of contacts for the course $delete_courseID&quot;</span>. join(<span class="stringliteral">&quot; &quot;</span>, @contacts) if @contacts !=1;
            <span class="preprocessor">#warn &quot;contacts&quot;, join(&quot; &quot;, @contacts);</span>
<span class="preprocessor"></span><span class="preprocessor">            #my $composite_id = &quot;${add_initial_userID}_${add_courseID}&quot;;</span>
<span class="preprocessor"></span>            my $composite_id  = $contacts[0];
            
<span class="preprocessor">            # mark the contact person as dropped.</span>
<span class="preprocessor"></span>            my $User = $db-&gt;getUser($composite_id);
            my $status_name = <span class="stringliteral">&#39;Drop&#39;</span>;
            my $status_value = ($ce-&gt;status_name_to_abbrevs($status_name))[0];
            $User-&gt;status($status_value);
            $db-&gt;putUser($User);
        }
        
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;Successfully deleted the course $delete_courseID.&quot;</span>),
        );
         writeLog($ce, <span class="stringliteral">&quot;hosted_courses&quot;</span>, join(<span class="stringliteral">&quot;\t&quot;</span>,
            <span class="stringliteral">&quot;\tDeleted&quot;</span>,
            <span class="stringliteral">&quot;&quot;</span>,
            <span class="stringliteral">&quot;&quot;</span>,
            $delete_courseID,
        ));
        print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
        print $self-&gt;hidden_authen_fields;
        print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
        
        print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;decline_delete_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;OK&quot;</span>),);
        
        print CGI::end_form();
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a6b45db977b580be98a0cfc522c0e5121"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::do_hide_inactive_course" ref="a6b45db977b580be98a0cfc522c0e5121" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::do_hide_inactive_course </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-do_hide_inactive_course' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-do_hide_inactive_course-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-do_hide_inactive_course-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-do_hide_inactive_course-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in do_hide_inactive_course: 64</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a6b45db977b580be98a0cfc522c0e5121">do_hide_inactive_course</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    
  my $coursesDir = $ce-&gt;{webworkDirs}-&gt;{courses};
  
    my $hide_courseID;
    my @hide_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;hide_courseIDs&quot;</span>);
    @hide_courseIDs        = () unless @hide_courseIDs;

  my $hideDirFileContent = <span class="stringliteral">&#39;Place a file named &quot;hide_directory&quot; in a course or other directory</span>
<span class="stringliteral">and it will not show up in the courses list on the WeBWorK home page.</span>
<span class="stringliteral">It will still appear in the Course Administration listing.&#39;</span>;
    my @succeeded_courses = ();
    my $succeeded_count = 0;
    my @failed_courses = ();
    my $already_hidden_count = 0;
    
  <span class="keywordflow">foreach</span> $hide_courseID (@hide_courseIDs) {
    my $hideDirFile = <span class="stringliteral">&quot;$coursesDir/$hide_courseID/hide_directory&quot;</span>;
    <span class="keywordflow">if</span> (-f $hideDirFile) {
        $already_hidden_count++;
        next;
    } <span class="keywordflow">else</span> {
        local *HIDEFILE;
        <span class="keywordflow">if</span> (open (HIDEFILE, <span class="stringliteral">&quot;&gt;&quot;</span>, $hideDirFile)) {  
            print HIDEFILE <span class="stringliteral">&quot;$hideDirFileContent&quot;</span>;
            close HIDEFILE;
            push @succeeded_courses,$hide_courseID;
            $succeeded_count++;
        } <span class="keywordflow">else</span> {    
            push @failed_courses,$hide_courseID;
        }   
    }
  }

    <span class="keywordflow">if</span> (@failed_courses) {
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;Errors occured while hiding the courses listed below when attempting to create the file hide_directory in the course&#39;s directory. </span>
<span class="stringliteral">Check the ownership and permissions of the course&#39;s directory, e.g $coursesDir/$failed_courses[0]/&quot;</span>),
            CGI::p(<span class="stringliteral">&quot;@failed_courses&quot;</span>),
        );
    } 
    my $succeeded_message = <span class="stringliteral">&#39;&#39;</span>;
    
    <span class="keywordflow">if</span> ($succeeded_count &lt; 1 and $already_hidden_count &gt; 0) {
        $succeeded_message = <span class="stringliteral">&quot;Except for possible errors listed above, all selected courses are already hidden.&quot;</span>;
    }   
    
    <span class="keywordflow">if</span> ($succeeded_count) {
        <span class="keywordflow">if</span> ($succeeded_count &lt; 6) {
            $succeeded_message = <span class="stringliteral">&quot;The following courses were successfully hidden: @succeeded_courses&quot;</span>;
        } <span class="keywordflow">else</span> {
            $succeeded_message = <span class="stringliteral">&quot;$succeeded_count courses were successfully hidden.&quot;</span>;
        }
    }
    <span class="keywordflow">if</span> ($succeeded_count or $already_hidden_count) {
            print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;$succeeded_message&quot;</span>),
        );
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1a8cceeca01e6fb7699eddc69569d86f"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::do_registration" ref="a1a8cceeca01e6fb7699eddc69569d86f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::do_registration </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-do_registration' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-do_registration-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-do_registration-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-do_registration-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in do_registration: 16</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a1a8cceeca01e6fb7699eddc69569d86f">do_registration</a> {
    my $self = shift;
    my $ce   = $self-&gt;r-&gt;ce;
    my $registered_file_path = $ce-&gt;{courseDirs}-&gt;{root}.<span class="stringliteral">&quot;/$registered_file_name&quot;</span>;
<span class="preprocessor">    # warn qq!`echo &quot;info&quot; &gt;$registered_file_path`!;</span>
<span class="preprocessor"></span>    `echo <span class="stringliteral">&quot;info&quot;</span> &gt;$registered_file_path`;
    
    print  <span class="stringliteral">&quot;\n&lt;center&gt;&quot;</span>,CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: left; width:60%&quot;</span>},q{Registration action completed.  Thank you very much <span class="keywordflow">for</span> registering <a class="code" href="classWeBWorK.html">WeBWorK</a>!<span class="stringliteral">&quot;});</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print CGI::start_form(-method=&gt;&quot;</span>POST<span class="stringliteral">&quot;, -action=&gt;$self-&gt;r-&gt;uri);</span>
<span class="stringliteral">    print $self-&gt;hidden_authen_fields;</span>
<span class="stringliteral">    print CGI::p({style=&gt;&quot;</span>text-align: center<span class="stringliteral">&quot;}, CGI::submit(-name=&gt;&quot;</span>registration_completed<span class="stringliteral">&quot;, -label=&gt;&quot;</span>Continue<span class="stringliteral">&quot;));</span>
<span class="stringliteral">    print CGI::end_form();</span>
<span class="stringliteral">    print &quot;</span>&lt;/center&gt;<span class="stringliteral">&quot;;</span>
<span class="stringliteral"></span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1368dc17271e260f6af74434ae919f04"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::do_rename_course" ref="a1368dc17271e260f6af74434ae919f04" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::do_rename_course </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-do_rename_course' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-do_rename_course-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-do_rename_course-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-do_rename_course-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in do_rename_course: 55</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a1368dc17271e260f6af74434ae919f04">do_rename_course</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
<span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span>    my $urlpath = $r-&gt;urlpath;
    
    my $rename_oldCourseID     = $r-&gt;param(<span class="stringliteral">&quot;rename_oldCourseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    my $rename_newCourseID     = $r-&gt;param(<span class="stringliteral">&quot;rename_newCourseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        %WeBWorK::SeedCE,
        courseName =&gt; $rename_oldCourseID,
    });
    
    my $dbLayoutName = $ce-&gt;{dbLayoutName};
    
<span class="preprocessor">    # this is kinda left over from when we had &#39;gdbm&#39; and &#39;sql&#39; database layouts</span>
<span class="preprocessor"></span><span class="preprocessor">    # below this line, we would grab values from getopt and put them in this hash</span>
<span class="preprocessor"></span><span class="preprocessor">    # but for now the hash can remain empty</span>
<span class="preprocessor"></span>    my %dbOptions;
    
    eval {
        renameCourse(
            courseID      =&gt; $rename_oldCourseID,
            ce            =&gt; $ce2,
            dbOptions     =&gt; \%dbOptions,
            newCourseID   =&gt; $rename_newCourseID,
        );
    };
    <span class="keywordflow">if</span> ($@) {
        my $error = $@;
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;An error occured while renaming the course $rename_oldCourseID to $rename_newCourseID:&quot;</span>),
            CGI::tt(CGI::escapeHTML($error)),
        );
    } <span class="keywordflow">else</span> {
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;Successfully renamed the course $rename_oldCourseID to $rename_newCourseID&quot;</span>),
        );
         writeLog($ce, <span class="stringliteral">&quot;hosted_courses&quot;</span>, join(<span class="stringliteral">&quot;\t&quot;</span>,
            <span class="stringliteral">&quot;\tRenamed&quot;</span>,
            <span class="stringliteral">&quot;&quot;</span>,
            <span class="stringliteral">&quot;&quot;</span>,
            <span class="stringliteral">&quot;$rename_oldCourseID to $rename_newCourseID&quot;</span>,
        ));     
        my $newCoursePath = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::ProblemSets&quot;</span>, $r,
            courseID =&gt; $rename_newCourseID);
        my $newCourseURL = $self-&gt;systemLink($newCoursePath, authen =&gt; 0);
        print CGI::div({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>},
            CGI::a({href=&gt;$newCourseURL}, <span class="stringliteral">&quot;Log into $rename_newCourseID&quot;</span>),
        );
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a84611176934ca15e19c4762f585b47e0"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::do_unarchive_course" ref="a84611176934ca15e19c4762f585b47e0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::do_unarchive_course </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-do_unarchive_course' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-do_unarchive_course-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-do_unarchive_course-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-do_unarchive_course-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in do_unarchive_course: 55</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a84611176934ca15e19c4762f585b47e0">do_unarchive_course</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span>    my $urlpath = $r-&gt;urlpath;
    my $new_courseID           = $r-&gt;param(<span class="stringliteral">&quot;new_courseID&quot;</span>)           || <span class="stringliteral">&quot;&quot;</span>;
    my $unarchive_courseID     = $r-&gt;param(<span class="stringliteral">&quot;unarchive_courseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
    my $old_courseID   = $unarchive_courseID; 
    $old_courseID =~ s/.tar.gz<span class="comment">//;</span>

<span class="preprocessor">    #eval {</span>
<span class="preprocessor"></span>        unarchiveCourse(
            newCourseID =&gt; $new_courseID,
            oldCourseID =&gt; $old_courseID,
            archivePath =&gt;$ce-&gt;{webworkDirs}-&gt;{courses}.<span class="stringliteral">&quot;/$unarchive_courseID&quot;</span>,
            ce =&gt; $ce,
        );
<span class="preprocessor">    #};</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> ($@) {
        my $error = $@;
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;An error occured while archiving the course $unarchive_courseID:&quot;</span>),
            CGI::tt(CGI::escapeHTML($error)),
        );
    } <span class="keywordflow">else</span> {
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;Successfully unarchived  $unarchive_courseID to the course $new_courseID&quot;</span>),
        );
         writeLog($ce, <span class="stringliteral">&quot;hosted_courses&quot;</span>, join(<span class="stringliteral">&quot;\t&quot;</span>,
            <span class="stringliteral">&quot;\tunarchived&quot;</span>,
            <span class="stringliteral">&quot;&quot;</span>,
            <span class="stringliteral">&quot;&quot;</span>,
            <span class="stringliteral">&quot;$unarchive_courseID to $new_courseID&quot;</span>,
        ));

        my $newCoursePath = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::ProblemSets&quot;</span>, $r,
            courseID =&gt; $new_courseID);
        my $newCourseURL = $self-&gt;systemLink($newCoursePath, authen =&gt; 0);
        print CGI::div({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>},
            CGI::a({href=&gt;$newCourseURL}, <span class="stringliteral">&quot;Log into $new_courseID&quot;</span>),
        );
        
        print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
        print $self-&gt;hidden_authen_fields;
        print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
        print CGI::hidden(<span class="stringliteral">&quot;unarchive_courseID&quot;</span>,$unarchive_courseID);
        print CGI::p( CGI::submit(<span class="stringliteral">&quot;decline_unarchive_course&quot;</span>, <span class="stringliteral">&quot;unarchive next course&quot;</span>)  );
        print CGI::end_form();
 
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a8dfc248d5695539e5ee2fb479ad07c7c"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::do_unhide_inactive_course" ref="a8dfc248d5695539e5ee2fb479ad07c7c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::do_unhide_inactive_course </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-do_unhide_inactive_course' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-do_unhide_inactive_course-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-do_unhide_inactive_course-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-do_unhide_inactive_course-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in do_unhide_inactive_course: 65</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a8dfc248d5695539e5ee2fb479ad07c7c">do_unhide_inactive_course</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    
  my $coursesDir = $ce-&gt;{webworkDirs}-&gt;{courses};
  
    my $unhide_courseID;
    my @unhide_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;hide_courseIDs&quot;</span>);
    @unhide_courseIDs        = () unless @unhide_courseIDs;
    
    my @succeeded_courses = ();
    my $succeeded_count = 0;
    my @failed_courses = ();
    my $already_visible_count = 0;

  <span class="keywordflow">foreach</span> $unhide_courseID (@unhide_courseIDs) {
    my $hideDirFile = <span class="stringliteral">&quot;$coursesDir/$unhide_courseID/hide_directory&quot;</span>;
    unless (-f $hideDirFile) {
        $already_visible_count++;
        next;
    } 
    remove_tree(<span class="stringliteral">&quot;$hideDirFile&quot;</span>, {error =&gt; \my $err});
    <span class="keywordflow">if</span> (@$err) {
        push @failed_courses,$unhide_courseID;
    } <span class="keywordflow">else</span> {
    push @succeeded_courses,$unhide_courseID;
        $succeeded_count++;
    }
  }
  my $succeeded_message = <span class="stringliteral">&#39;&#39;</span>;
  
  <span class="keywordflow">if</span> ($succeeded_count &lt; 1 and $already_visible_count &gt; 0) {
        $succeeded_message = <span class="stringliteral">&quot;Except for possible errors listed above, all selected courses are already unhidden.&quot;</span>;
    }   
    
    <span class="keywordflow">if</span> ($succeeded_count) {
        <span class="keywordflow">if</span> ($succeeded_count &lt; 6) {
            $succeeded_message = <span class="stringliteral">&quot;The following courses were successfully unhidden: @succeeded_courses&quot;</span>;
        } <span class="keywordflow">else</span> {
            $succeeded_message = <span class="stringliteral">&quot;$succeeded_count courses were successfully unhidden.&quot;</span>;
        }
    }
    <span class="keywordflow">if</span> ($succeeded_count or $already_visible_count) {
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
        CGI::p(<span class="stringliteral">&quot;$succeeded_message&quot;</span>),
        );
    }   
    <span class="keywordflow">if</span> (@failed_courses) {
        print CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
            CGI::p(<span class="stringliteral">&quot;Errors occured while unhiding the courses listed below when attempting delete the file hide_directory in the course&#39;s directory. </span>
<span class="stringliteral">Check the ownership and permissions of the course&#39;s directory, e.g $coursesDir/$failed_courses[0]/&quot;</span>),
            CGI::p(<span class="stringliteral">&quot;@failed_courses&quot;</span>),
        );
    }   
}



<span class="preprocessor">################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#   registration forms added by Mike Gage 5-5-2008</span>
<span class="preprocessor"></span><span class="preprocessor">################################################################################</span>
<span class="preprocessor"></span>
our $registered_file_name = <span class="stringliteral">&quot;registered_$main::VERSION&quot;</span>;
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aeac87e48910f5a254469d95d4295afc0"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::do_upgrade_course" ref="aeac87e48910f5a254469d95d4295afc0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::do_upgrade_course </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-do_upgrade_course' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-do_upgrade_course-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-do_upgrade_course-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-do_upgrade_course-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in do_upgrade_course: 95</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#aeac87e48910f5a254469d95d4295afc0">do_upgrade_course</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    
    
    my @upgrade_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;upgrade_courseIDs&quot;</span>);
    @upgrade_courseIDs        = () unless @upgrade_courseIDs;
    my %update_error_msg                  = ();
<span class="preprocessor">    #warn &quot;do_upgrade_course:  upgrade_courseIDs = &quot;, join(&quot; &quot;, @upgrade_courseIDs);</span>
<span class="preprocessor"></span>    <span class="keywordflow">foreach</span> my $upgrade_courseID (@upgrade_courseIDs) {
        next unless $upgrade_courseID =~ /\S/; # omit blank course IDs
 
<span class="preprocessor">        ##########################</span>
<span class="preprocessor"></span><span class="preprocessor">        # update one course</span>
<span class="preprocessor"></span><span class="preprocessor">        ##########################</span>
<span class="preprocessor"></span>        my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
            %WeBWorK::SeedCE,
            courseName =&gt; $upgrade_courseID,
        });
<span class="preprocessor">        #warn &quot;do_upgrade_course: updating |$upgrade_courseID| from&quot; , join(&quot;|&quot;,@upgrade_courseIDs); </span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Create integrity checker</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>    
        my $CIchecker = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1Utils_1_1CourseIntegrityCheck.html">WeBWorK::Utils::CourseIntegrityCheck</a>(ce=&gt;$ce2);
        
<span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Add missing tables and missing fields to existing tables</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>    
        my ($tables_ok,$dbStatus) = $CIchecker-&gt;checkCourseTables($upgrade_courseID);
        my @schema_table_names = keys %$dbStatus;  # update tables missing from database;
        my @tables_to_create = grep {$dbStatus-&gt;{$_}-&gt;[0] == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A} @schema_table_names;  
        my @tables_to_alter  = grep {$dbStatus-&gt;{$_}-&gt;[0] == WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B} @schema_table_names;
        $update_error_msg{$upgrade_courseID} = $CIchecker-&gt;updateCourseTables($upgrade_courseID, [@tables_to_create]);
        <span class="keywordflow">foreach</span> my $table_name (@tables_to_alter) { #warn <span class="stringliteral">&quot;do_upgrade_course: adding new fields to table $table_name in course $upgrade_courseID&quot;</span>;
            $update_error_msg{$upgrade_courseID} .= $CIchecker-&gt;updateTableFields($upgrade_courseID, $table_name);
        }
<span class="preprocessor">        ### $update_error_msg{$upgrade_courseID} is printed below</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Add missing directories when it can be done safely</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################   #warn &quot;do_upgrade_course: updating course directories for $upgrade_courseID&quot;;</span>
<span class="preprocessor"></span>        $CIchecker -&gt; updateCourseDirectories();   # needs more error messages
    
        
<span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Analyze database status and prepare status report</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>    
        ($tables_ok,$dbStatus) = $CIchecker-&gt;checkCourseTables($upgrade_courseID);
          
        my ($all_tables_ok, $extra_database_tables, $extra_database_fields, $str) 
              = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ab483552395995130885c84b88ec95492">formatReportOnDatabaseTables</a>($tables_ok, $dbStatus);
<span class="preprocessor">        # prepend course name</span>
<span class="preprocessor"></span>        $str = CGI::br().<span class="stringliteral">&quot;Database:&quot;</span>.CGI::br(). $str;

<span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Report on databases and report summary</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>    
            
            <span class="keywordflow">if</span> ($extra_database_tables) {
                    $str .= CGI::p({-style=&gt;<span class="stringliteral">&#39;color:red; font-weight:bold&#39;</span>},<span class="stringliteral">&quot;There are extra database tables which are not defined in the schema.  </span>
<span class="stringliteral">                                                                         They can only be removed manually from the database.&quot;</span>);
            } 
            <span class="keywordflow">if</span> ($extra_database_fields) {
                    $str .= CGI::p({-style=&gt;<span class="stringliteral">&#39;color:red; font-weight:bold&#39;</span>},<span class="stringliteral">&quot;There are extra database fields  which are not defined in the schema for at least one table.  </span>
<span class="stringliteral">                                                                         They can only be removed manually from the database.&quot;</span>);
            } 
       
<span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Prepare report on directory status</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>          my ($directories_ok, $str2) = $CIchecker-&gt;checkCourseDirectories();
          my $style = ($directories_ok)?<span class="stringliteral">&quot;color:green&quot;</span> : <span class="stringliteral">&quot;color:red&quot;</span>;
          my $dir_msg  = join (<span class="stringliteral">&#39;&#39;</span>, 
            <span class="stringliteral">&quot;Directory structure&quot;</span>,CGI::br(), 
            CGI::p($str2),
            ($directories_ok)? CGI::p({style=&gt;$style},<span class="stringliteral">&quot;Directory structure is ok&quot;</span>) :
                  CGI::p({style=&gt;$style},<span class="stringliteral">&quot;Directory structure is missing directories </span>
<span class="stringliteral">                              or the webserver lacks sufficient privileges.&quot;</span>)
          );
    
<span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Print status</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>        print <span class="stringliteral">&quot; Report for course $upgrade_courseID:&quot;</span>.CGI::br();
        print CGI::p({-style=&gt;<span class="stringliteral">&#39;color:green; font-weight:bold&#39;</span>}, $update_error_msg{$upgrade_courseID});

        print CGI::p($str);     # print <a class="code" href="classWeBWorK_1_1ContentGenerator.html#a265ffdacc7577cf63e2ad7519dbdb0a2">message</a> about tables
        print CGI::p($dir_msg); # <a class="code" href="classWeBWorK_1_1ContentGenerator.html#a265ffdacc7577cf63e2ad7519dbdb0a2">message</a> about directories

    }
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a272c4b05a62b0ea31b64395909dba868"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::edit_location_form" ref="a272c4b05a62b0ea31b64395909dba868" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::edit_location_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-edit_location_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-edit_location_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-edit_location_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-edit_location_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in edit_location_form: 84</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a272c4b05a62b0ea31b64395909dba868">edit_location_form</a> {
    my $self = shift;
    my $r = $self-&gt;r;
    my $db = $r-&gt;db;

    my $locationID = $r-&gt;param(<span class="stringliteral">&quot;edit_location&quot;</span>);
    <span class="keywordflow">if</span> ( $db-&gt;existsLocation( $locationID ) ) {
        my $location = $db-&gt;getLocation($locationID);
<span class="preprocessor">        # this doesn&#39;t give that nice a sort for IP addresses,</span>
<span class="preprocessor"></span><span class="preprocessor">        #    b/c there&#39;s the problem with 192.168.1.168 sorting </span>
<span class="preprocessor"></span><span class="preprocessor">        #    ahead of 192.168.1.2.  we could do better if we </span>
<span class="preprocessor"></span><span class="preprocessor">        #    either invoked Net::IP in the sort routine, or if</span>
<span class="preprocessor"></span><span class="preprocessor">        #    we insisted on dealing only with IPv4.  rather than</span>
<span class="preprocessor"></span><span class="preprocessor">        #    deal with either of those, we&#39;ll leave this for now</span>
<span class="preprocessor"></span>        my @locAddresses = sort { $a cmp $b }
            $db-&gt;listLocationAddresses($locationID);

        print CGI::h2(<span class="stringliteral">&quot;Editing location &quot;</span>, $locationID);

        print CGI::p({},<span class="stringliteral">&quot;Edit the current value of the location &quot;</span>,
                 <span class="stringliteral">&quot;description, if desired, then add and select &quot;</span>,
                 <span class="stringliteral">&quot;addresses to delete, and then click the &quot;</span>, 
                 <span class="stringliteral">&quot;\&quot;Take Action\&quot; button to make all of your &quot;</span>,
                 <span class="stringliteral">&quot;changes.  Or, click \&quot;Manage Locations\&quot; &quot;</span>,
                 <span class="stringliteral">&quot;above to make no changes and return to the &quot;</span>,
                 <span class="stringliteral">&quot;Manage Locations page.&quot;</span>);

        print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>,
                      -action=&gt;$r-&gt;uri);
        print $self-&gt;hidden_authen_fields;
        print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
        print CGI::hidden(-name=&gt;<span class="stringliteral">&#39;edit_location&#39;</span>,
                  -<span class="keywordflow">default</span>=&gt;$locationID);
        print CGI::hidden(-name=&gt;<span class="stringliteral">&#39;manage_location_action&#39;</span>,
                  -<span class="keywordflow">default</span>=&gt;<span class="stringliteral">&#39;edit_location_handler&#39;</span>);

        print CGI::start_table();
        print CGI::Tr({-valign=&gt;<span class="stringliteral">&#39;top&#39;</span>},
            CGI::td({-colspan=&gt;3},
                <span class="stringliteral">&quot;Location description: &quot;</span>, CGI::br(),
                CGI::textfield(-name=&gt;<span class="stringliteral">&quot;location_description&quot;</span>,
                           -size=&gt;<span class="stringliteral">&quot;50&quot;</span>,
                           -<span class="keywordflow">default</span>=&gt;$location-&gt;description)));
        print CGI::Tr({-valign=&gt;<span class="stringliteral">&#39;top&#39;</span>},
            CGI::td({-width=&gt;<span class="stringliteral">&quot;50%&quot;</span>},
                <span class="stringliteral">&quot;Addresses to add to the location &quot;</span> .
                <span class="stringliteral">&quot;(enter one per line, as single IP addresses &quot;</span> .
                <span class="stringliteral">&quot;(e.g., 192.168.1.101), address masks &quot;</span> .
                <span class="stringliteral">&quot;(e.g., 192.168.1.0/24), or IP ranges &quot;</span> .
                <span class="stringliteral">&quot;(e.g., 192.168.1.101-192.168.1.150)):&quot;</span> . 
                CGI::br() .
                CGI::textarea({-name=&gt;<span class="stringliteral">&quot;new_location_addresses&quot;</span>,
                           -rows=&gt;5, -columns=&gt;28})),
            CGI::td({}, <span class="stringliteral">&quot;&amp;nbsp;&quot;</span>),
            CGI::td({-width=&gt;<span class="stringliteral">&quot;50%&quot;</span>},
                <span class="stringliteral">&quot;Existing addresses for the location are &quot;</span> .
                <span class="stringliteral">&quot;given in the scrolling list below.  Select &quot;</span> .
                <span class="stringliteral">&quot;addresses from the list to delete them:&quot;</span> . 
                CGI::br() .
                CGI::scrolling_list(-name=&gt;<span class="stringliteral">&#39;delete_location_addresses&#39;</span>,
                            -values=&gt;[@locAddresses],
                            -size=&gt;8,
                            -multiple=&gt;<span class="stringliteral">&#39;multiple&#39;</span>) .
                CGI::br() . <span class="stringliteral">&quot;or: &quot;</span> .
                CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;delete_all_addresses&#39;</span>,
                          -value=&gt;<span class="stringliteral">&#39;true&#39;</span>,
                          -label=&gt;<span class="stringliteral">&#39;Delete all existing addresses&#39;</span>)
                 ));

        print CGI::end_table();

        print CGI::p({},CGI::submit(-value=&gt;<span class="stringliteral">&#39;Take Action!&#39;</span>));

    } <span class="keywordflow">else</span> {
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
                   <span class="stringliteral">&quot;Location $locationID does not exist &quot;</span> .
                   <span class="stringliteral">&quot;in the WeBWorK database.  Please check &quot;</span> .
                   <span class="stringliteral">&quot;your input (perhaps you need to reload &quot;</span> .
                   <span class="stringliteral">&quot;the location management page?).&quot;</span>);

        $self-&gt;manage_location_form;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="abca09cdbfe996360789fa8f52f44ead5"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::edit_location_handler" ref="abca09cdbfe996360789fa8f52f44ead5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::edit_location_handler </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-edit_location_handler' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-edit_location_handler-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-edit_location_handler-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-edit_location_handler-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in edit_location_handler: 126</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#abca09cdbfe996360789fa8f52f44ead5">edit_location_handler</a> { 
    my $self = shift;
    my $r = $self-&gt;r;
    my $db = $r-&gt;db;

    my $locationID = $r-&gt;param(<span class="stringliteral">&quot;edit_location&quot;</span>);
    my $locationDesc = $r-&gt;param(<span class="stringliteral">&quot;location_description&quot;</span>);
    my $addAddresses = $r-&gt;param(<span class="stringliteral">&quot;new_location_addresses&quot;</span>);
    my @delAddresses = $r-&gt;param(<span class="stringliteral">&quot;delete_location_addresses&quot;</span>);
    my $deleteAll = $r-&gt;param(<span class="stringliteral">&quot;delete_all_addresses&quot;</span>);

<span class="preprocessor">    # gut check</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ! $locationID ) {
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
                   <span class="stringliteral">&quot;No location specified to edit?! &quot;</span> .
                   <span class="stringliteral">&quot;Please check your input data.&quot;</span>);
        $self-&gt;manage_location_form;

    } elsif ( ! $db-&gt;existsLocation( $locationID ) ) {
        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
                   <span class="stringliteral">&quot;Location $locationID does not exist &quot;</span> .
                   <span class="stringliteral">&quot;in the WeBWorK database.  Please check &quot;</span> .
                   <span class="stringliteral">&quot;your input (perhaps you need to reload &quot;</span> .
                   <span class="stringliteral">&quot;the location management page?).&quot;</span>);
        $self-&gt;manage_location_form;
    } <span class="keywordflow">else</span> {
        my $location = $db-&gt;getLocation($locationID);

<span class="preprocessor">        # get the current location addresses.  if we&#39;re deleting</span>
<span class="preprocessor"></span><span class="preprocessor">        #   all of the existing addresses, we don&#39;t use this list </span>
<span class="preprocessor"></span><span class="preprocessor">        #   to determine which addresses to add, however.</span>
<span class="preprocessor"></span>        my @currentAddr = $db-&gt;listLocationAddresses($locationID);
        my @compareAddr = ( ! $deleteAll || $deleteAll ne <span class="stringliteral">&#39;true&#39;</span> )
            ? @currentAddr : ();

        my $doneMsg = <span class="stringliteral">&#39;&#39;</span>;

        <span class="keywordflow">if</span> ($locationDesc &amp;&amp; $location-&gt;description ne $locationDesc) {
            $location-&gt;description($locationDesc);
            $db-&gt;putLocation($location);
            $doneMsg .= CGI::p({},<span class="stringliteral">&quot;Updated location description.&quot;</span>);
        }
<span class="preprocessor">        # get the actual addresses to add out of the text field</span>
<span class="preprocessor"></span>        $addAddresses =~ s/\s*-\s*/-/g;
        $addAddresses =~ s/\s*\/\s*/\<span class="comment">//g;</span>
        my @addAddresses = split(/\s+/, $addAddresses);

<span class="preprocessor">        # make sure that we&#39;re adding and deleting only those </span>
<span class="preprocessor"></span><span class="preprocessor">        #    addresses that are not yet/currently in the location</span>
<span class="preprocessor"></span><span class="preprocessor">        #    addresses</span>
<span class="preprocessor"></span>        my @toAdd = ();  my @noAdd = ();
        my @toDel = ();  my @noDel = ();
        <span class="keywordflow">foreach</span> my $addr ( @addAddresses ) {
            <span class="keywordflow">if</span> (grep {/^$addr$/} @compareAddr) {push(@noAdd,$addr);}
            <span class="keywordflow">else</span> { push(@toAdd, $addr); }
        }
        <span class="keywordflow">if</span> ( $deleteAll &amp;&amp; $deleteAll eq <span class="stringliteral">&#39;true&#39;</span> ) {
            @toDel = @currentAddr;
        } <span class="keywordflow">else</span> {
            <span class="keywordflow">foreach</span> my $addr ( @delAddresses ) { 
                <span class="keywordflow">if</span> (grep {/^$addr$/} @currentAddr) {
                    push(@toDel,$addr);
                } <span class="keywordflow">else</span> { push(@noDel, $addr); }
            }
        }

<span class="preprocessor">        # and make sure that all of the addresses we&#39;re adding are </span>
<span class="preprocessor"></span><span class="preprocessor">        #    a sensible form</span>
<span class="preprocessor"></span>        my $badAddr = <span class="stringliteral">&#39;&#39;</span>;
        <span class="keywordflow">foreach</span> my $addr ( @toAdd ) {
            unless ( <span class="keyword">new</span> Net::IP($addr) ) {
                $badAddr .= <span class="stringliteral">&quot;$addr, &quot;</span>;
            }
        }
        $badAddr =~ s/, $<span class="comment">//;</span>

<span class="preprocessor">        # delete addresses first, because we allow deletion of </span>
<span class="preprocessor"></span><span class="preprocessor">        #    all existing addresses, then addition of addresses.</span>
<span class="preprocessor"></span><span class="preprocessor">        #    note that we don&#39;t allow deletion and then addition </span>
<span class="preprocessor"></span><span class="preprocessor">        #    of the same address normally, however; in that case</span>
<span class="preprocessor"></span><span class="preprocessor">        #    we&#39;ll end up just deleting the address.</span>
<span class="preprocessor"></span>        <span class="keywordflow">foreach</span> ( @toDel ) {
            $db-&gt;deleteLocationAddress($locationID, $_);
        }
        <span class="keywordflow">foreach</span> ( @toAdd ) {
            my $locAddr = $db-&gt;newLocationAddress;
            $locAddr-&gt;location_id($locationID);
            $locAddr-&gt;ip_mask($_);

            $db-&gt;addLocationAddress($locAddr);
        }

        my $addrMsg = <span class="stringliteral">&#39;&#39;</span>;
        $addrMsg .= <span class="stringliteral">&quot;Deleted addresses &quot;</span> . join(<span class="stringliteral">&#39;, &#39;</span>, @toDel) .
            <span class="stringliteral">&quot; from location.&quot;</span> . CGI::br() if ( @toDel );
        $addrMsg .= &quot;Added addresses &quot; . join(&#39;, &#39;, @toAdd) . 
            &quot; to location $locationID.  &quot; if ( @toAdd );

        my $badMsg = &#39;&#39;;
        $badMsg .= &#39;Address(es) &#39; . join(&#39;, &#39;, @noAdd) .
            &quot; in the add list is(are) already in the &quot; .
            &quot;location $locationID, and so were &quot; .
            &quot;skipped.&quot; . CGI::br() if ( @noAdd );
        $badMsg .= &quot;Address(es) $badAddr is(are) not in a &quot; .
            &quot;recognized form.  Please check your data &quot; .
            &quot;entry and try again.&quot; . CGI::br() if ( $badAddr );
        $badMsg .= &#39;Address(es) &#39; . join(&#39;, &#39;, @noDel) . 
            &quot; in the delete list is(are) not in the &quot; .
            &quot;location $locationID, and so were &quot; .
            &quot;skipped.&quot; if ( @noDel );

        print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}, $badMsg)
            <span class="keywordflow">if</span> ( $badMsg );
        <span class="keywordflow">if</span> ( $doneMsg || $addrMsg ) {
            print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithoutError&quot;</span>},
                       CGI::p({}, $doneMsg, $addrMsg));
        } <span class="keywordflow">else</span> {
            print CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
                       <span class="stringliteral">&quot;No valid changes submitted for &quot;</span>,
                       <span class="stringliteral">&quot;location $locationID.&quot;</span>);
        }

        $self-&gt;edit_location_form;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad6693db4fe413ffaba1418eea59e1f65"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::existsLocations_helper" ref="ad6693db4fe413ffaba1418eea59e1f65" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::existsLocations_helper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-existsLocations_helper' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-existsLocations_helper-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-existsLocations_helper-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-existsLocations_helper-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in existsLocations_helper: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ad6693db4fe413ffaba1418eea59e1f65">existsLocations_helper</a> {
    my ($self, @locations) = @_;
    my $db = $self-&gt;r-&gt;db;
    <span class="keywordflow">foreach</span> ( @locations ) {
        <span class="keywordflow">return</span> $_ <span class="keywordflow">if</span> ( ! $db-&gt;existsLocation($_) );
    }
    <span class="keywordflow">return</span> 0;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab483552395995130885c84b88ec95492"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::formatReportOnDatabaseTables" ref="ab483552395995130885c84b88ec95492" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::formatReportOnDatabaseTables </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-formatReportOnDatabaseTables' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-formatReportOnDatabaseTables-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-formatReportOnDatabaseTables-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-formatReportOnDatabaseTables-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in formatReportOnDatabaseTables: 64</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ab483552395995130885c84b88ec95492">formatReportOnDatabaseTables</a> {
    my ($tables_ok,$dbStatus) =  @_;
    
<span class="preprocessor">    # print db status</span>
<span class="preprocessor"></span>    
        my %msg =(    WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A         =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Table defined in schema but missing in database&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B         =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Table defined in database but missing in schema&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::SAME_IN_A_AND_B   =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:green&quot;</span>},<span class="stringliteral">&quot; Table is ok &quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Schema and database table definitions do not agree &quot;</span>),
        );
        my %msg2 =(    WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A        =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; missing in database&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B         =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; missing in schema&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::SAME_IN_A_AND_B   =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:green&quot;</span>},<span class="stringliteral">&quot; is ok &quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Schema and database field definitions do not agree &quot;</span>),
        );
        my $all_tables_ok=1;
        my $extra_database_tables=0;
        my $extra_database_fields=0;
        my $str =<span class="stringliteral">&#39;&#39;</span>;
        $str .= CGI::start_ul();
        <span class="keywordflow">foreach</span> my $table (sort keys %$dbStatus) {
            my $table_status = $dbStatus-&gt;{$table}-&gt;[0];
            $str .= CGI::li( CGI::b($table) .  $msg{ $table_status } );
            
            CASE: {
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::SAME_IN_A_AND_B 
                    &amp;&amp; <span class="keywordflow">do</span>{ last CASE;
                    };
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A
                    &amp;&amp; <span class="keywordflow">do</span>{
                           $all_tables_ok = 0; last CASE;
                    };
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B
                    &amp;&amp; <span class="keywordflow">do</span>{
                           $extra_database_tables = 1; last CASE;
                    };
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B
                    &amp;&amp; <span class="keywordflow">do</span>{ 
                        my %fieldInfo = %{ $dbStatus-&gt;{$table}-&gt;[1] };
                        $str .=CGI::start_ul();
                        <span class="keywordflow">foreach</span> my $key (keys %fieldInfo) {
                            my $field_status = $fieldInfo{$key}-&gt;[0];
                            CASE2: {
                                $field_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B 
                                    &amp;&amp; <span class="keywordflow">do</span>{ 
                                       $extra_database_fields = 1; last CASE2;
                                    };
                                $field_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A 
                                    &amp;&amp; <span class="keywordflow">do</span>{ 
                                       $all_tables_ok=0; last CASE2;
                                    };                          
                            }
                            $str .= CGI::li(<span class="stringliteral">&quot;Field $key =&gt; &quot;</span>. $msg2{$field_status });
                        }
                        $str .= CGI::end_ul();
                    };
            }
            
            
        }
        $str.=CGI::end_ul();
        $str .= ($all_tables_ok)?CGI::p(<span class="stringliteral">&quot;Database tables are ok&quot;</span>) : <span class="stringliteral">&quot;&quot;</span>;
        <span class="keywordflow">return</span> ($all_tables_ok, $extra_database_tables, $extra_database_fields, $str);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad5f02132fec2983f26283e273b2ceb14"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::header" ref="ad5f02132fec2983f26283e273b2ceb14" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::header </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-header' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-header-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-header-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-header-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in header: 13</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ad5f02132fec2983f26283e273b2ceb14">header</a> {
    my ($self) = @_;
    my $method_to_call = $self-&gt;{method_to_call};
<span class="preprocessor">#   if (defined $method_to_call and $method_to_call eq &quot;do_export_database&quot;) {</span>
<span class="preprocessor"></span><span class="preprocessor">#       my $r = $self-&gt;r;</span>
<span class="preprocessor"></span><span class="preprocessor">#       my $courseID = $r-&gt;param(&quot;export_courseID&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">#       $r-&gt;content_type(&quot;application/octet-stream&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">#       $r-&gt;header_out(&quot;Content-Disposition&quot; =&gt; &quot;attachment; filename=\&quot;${courseID}_database.xml\&quot;&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">#       $r-&gt;send_http_header;</span>
<span class="preprocessor"></span><span class="preprocessor">#   } else {</span>
<span class="preprocessor"></span>        $self-&gt;SUPER::header;
<span class="preprocessor">#   }</span>
<span class="preprocessor">}</span>
</pre></div>  
</div>
 
<p>Reimplemented from <a class="el" href="classWeBWorK_1_1ContentGenerator.html#ad1905f1621af61ea10def7aae24b7b8b">WeBWorK::ContentGenerator</a>.</p>

</div>
</div>
<a class="anchor" id="a48e0df95ed36c88b20d0de8eff8b19d9"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::hide_course_validate" ref="a48e0df95ed36c88b20d0de8eff8b19d9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::hide_course_validate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-hide_course_validate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-hide_course_validate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-hide_course_validate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-hide_course_validate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in hide_course_validate: 20</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a48e0df95ed36c88b20d0de8eff8b19d9">hide_course_validate</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span>    my $urlpath = $r-&gt;urlpath;
    
    my @hide_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;hide_courseIDs&quot;</span>);
    @hide_courseIDs        = () unless @hide_courseIDs;
    
    my @errors;
    
    unless (@hide_courseIDs) {
        push @errors, <span class="stringliteral">&quot;You must specify a course name.&quot;</span>;
    } 
    <span class="keywordflow">return</span> @errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a590c98500c57bb3582c17c07efe1c9f4"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::hide_inactive_course_form" ref="a590c98500c57bb3582c17c07efe1c9f4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::hide_inactive_course_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-hide_inactive_course_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-hide_inactive_course_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-hide_inactive_course_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-hide_inactive_course_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in hide_inactive_course_form: 104</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a590c98500c57bb3582c17c07efe1c9f4">hide_inactive_course_form</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;

    my $coursesDir = $ce-&gt;{webworkDirs}-&gt;{courses};
    my @courseIDs = listCourses($ce);
    my $hide_listing_format   = $r-&gt;param(<span class="stringliteral">&quot;hide_listing_format&quot;</span>);
    unless (defined $hide_listing_format) {$hide_listing_format = <span class="stringliteral">&#39;last_login&#39;</span>;}  #use the <span class="keywordflow">default</span>
<span class="preprocessor">#   warn &quot;hide_listing_format is $hide_listing_format&quot;;</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    # Get and store last modify time for login.log for all courses. Also get visibility status.</span>
<span class="preprocessor"></span>    my %courseLabels;
    my @noLoginLogIDs = ();
    my @loginLogIDs = ();
    my @hideCourseIDs = ();
    my ($loginLogFile, $epoch_modify_time, $courseDir);
    <span class="keywordflow">foreach</span> my $courseID (@courseIDs) {
        $loginLogFile = <span class="stringliteral">&quot;$coursesDir/$courseID/logs/login.log&quot;</span>;
        <span class="keywordflow">if</span> (-e $loginLogFile) {                 #<span class="keyword">this</span> should always exist except <span class="keywordflow">for</span> the model course
            $epoch_modify_time = stat($loginLogFile)-&gt;mtime;
            $coursesData{$courseID}{<span class="stringliteral">&#39;epoch_modify_time&#39;</span>} = $epoch_modify_time;
            $coursesData{$courseID}{<span class="stringliteral">&#39;local_modify_time&#39;</span>} = ctime($epoch_modify_time);
            push(@loginLogIDs,$courseID);
        } <span class="keywordflow">else</span> {
            $coursesData{$courseID}{<span class="stringliteral">&#39;local_modify_time&#39;</span>} = <span class="stringliteral">&#39;no login.log&#39;</span>;  #<span class="keyword">this</span> should never be the <span class="keywordflow">case</span> except <span class="keywordflow">for</span> the model course
            push(@noLoginLogIDs,$courseID);
        }
        <span class="keywordflow">if</span> (-f <span class="stringliteral">&quot;$coursesDir/$courseID/hide_directory&quot;</span>) {
            $coursesData{$courseID}{<span class="stringliteral">&#39;status&#39;</span>} = <span class="stringliteral">&#39;hidden&#39;</span>;
        } <span class="keywordflow">else</span> {    
            $coursesData{$courseID}{<span class="stringliteral">&#39;status&#39;</span>} = <span class="stringliteral">&#39;visible&#39;</span>;  
        }
        $courseLabels{$courseID} = <span class="stringliteral">&quot;$courseID  ($coursesData{$courseID}{&#39;status&#39;} :: $coursesData{$courseID}{&#39;local_modify_time&#39;}) &quot;</span>;
    }
    <span class="keywordflow">if</span> ($hide_listing_format eq <span class="stringliteral">&#39;last_login&#39;</span>) {
        @noLoginLogIDs = sort {lc($a) cmp lc ($b) } @noLoginLogIDs; <span class="preprocessor">#this should be an empty arrey except for the model course</span>
<span class="preprocessor"></span>        @loginLogIDs = sort <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a3470cc813f60b7eaa9ffbf641bc65be6">byLoginActivity</a> @loginLogIDs;  # oldest first
        @hideCourseIDs = (@noLoginLogIDs,@loginLogIDs);
    } <span class="keywordflow">else</span> { # in <span class="keyword">this</span> <span class="keywordflow">case</span> we sort alphabetically
        @hideCourseIDs = sort {lc($a) cmp lc ($b) } @courseIDs;
    }
    
    print CGI::h2(&quot;Hide Inactive courses&quot;);
    
        print CGI::p(  
         &#39;Select the course(s) you want to hide (or unhide) and then click &quot;Hide Courses&quot; (or &quot;Unhide Courses&quot;). Hiding 
         a course that is already hidden does no harm (the action is skipped). Likewise unhiding a course that is 
         already visible does no harm (the action is skipped).  Hidden courses are still active but are not listed in 
         the list of <a class="code" href="classWeBWorK.html">WeBWorK</a> courses on the opening page.  To access the course, an instructor or student must know the 
         full URL address for the course.&#39;
    );
    
    print CGI::p(
        &#39;Courses are listed either alphabetically or in order by the time of most recent login activity, oldest first.
        To change the listing order check the mode you want and click &quot;Refresh Listing&quot;.  The listing format is: 
        Course_Name (status :: date/time of most recent login) where status is &quot;hidden&quot; or &quot;visible&quot;.&#39;);
        
    
    print CGI::start_form(-method=&gt;&quot;POST&quot;, -action=&gt;$r-&gt;uri);

    my %list_labels = (
                                alphabetically =&gt; &#39;alphabetically&#39;, 
                                last_login =&gt; &#39;by last login date&#39;, 
                                );
                                            
    print CGI::table(
            CGI::Tr({},
            CGI::p(<span class="stringliteral">&quot;Select a listing format:&quot;</span>),
            CGI::radio_group(-name=&gt;<span class="stringliteral">&#39;hide_listing_format&#39;</span>,
                                            -values=&gt;[<span class="stringliteral">&#39;alphabetically&#39;</span>, <span class="stringliteral">&#39;last_login&#39;</span>],
                                            -<span class="keywordflow">default</span>=&gt;<span class="stringliteral">&#39;last_login&#39;</span>,
                                            -labels=&gt;\%list_labels,
                                            ),
            ),
        );                          
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;hide_course_refresh&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Refresh Listing&quot;</span>), CGI::submit(-name=&gt;<span class="stringliteral">&quot;hide_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Hide Courses&quot;</span>),
    CGI::submit(-name=&gt;<span class="stringliteral">&quot;unhide_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Unhide Courses&quot;</span>));
    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    
    print CGI::p(<span class="stringliteral">&quot;Select course(s) to hide or unhide.&quot;</span>);
    
    print CGI::table({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;FormLayout&quot;</span>},
        CGI::Tr({},
            CGI::td(
                CGI::scrolling_list(
                    -name =&gt; <span class="stringliteral">&quot;hide_courseIDs&quot;</span>,
                    -values =&gt; \@hideCourseIDs,
                    -size =&gt; 15,
                    -multiple =&gt; 1,
                    -labels =&gt; \%courseLabels,
                ),
            ),
            
        ),
    );
    
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;hide_course_refresh&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Refresh Listing&quot;</span>), CGI::submit(-name=&gt;<span class="stringliteral">&quot;hide_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Hide Courses&quot;</span>),
    CGI::submit(-name=&gt;<span class="stringliteral">&quot;unhide_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Unhide Courses&quot;</span>));
    
    print CGI::end_form();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a164a48c5034b49f309e5126e8be47ac9"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::manage_location_form" ref="a164a48c5034b49f309e5126e8be47ac9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::manage_location_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-manage_location_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-manage_location_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-manage_location_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-manage_location_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in manage_location_form: 125</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a164a48c5034b49f309e5126e8be47ac9">manage_location_form</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
<span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span>    my $urlpath = $r-&gt;urlpath;

<span class="preprocessor">    # get a list of all existing locations</span>
<span class="preprocessor"></span>    my @locations = sort {lc($a-&gt;location_id) cmp lc($b-&gt;location_id)}
        $db-&gt;getAllLocations();
    my %locAddr = map {$_-&gt;location_id =&gt; [ $db-&gt;listLocationAddresses($_-&gt;location_id) ]} @locations;

    my @locationIDs = map { $_-&gt;location_id } @locations;
    
    print CGI::h2(<span class="stringliteral">&quot;Manage Locations&quot;</span>);

    print CGI::p({},CGI::strong(<span class="stringliteral">&quot;Currently defined locations are listed below.&quot;</span>));

    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);

<span class="preprocessor">    # get a list of radio buttons to select an action</span>
<span class="preprocessor"></span>    my @actionRadios = 
        CGI::radio_group(-name =&gt; <span class="stringliteral">&quot;manage_location_action&quot;</span>,
                 -values =&gt; [<span class="stringliteral">&quot;edit_location_form&quot;</span>,
                         <span class="stringliteral">&quot;add_location_handler&quot;</span>,
                         <span class="stringliteral">&quot;delete_location_handler&quot;</span>],
                 -labels =&gt; { <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a272c4b05a62b0ea31b64395909dba868">edit_location_form</a> =&gt; <span class="stringliteral">&quot;&quot;</span>,
                          <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a4a3249d81fb5c990f8ddf29afb0c7e19">add_location_handler</a> =&gt; <span class="stringliteral">&quot;&quot;</span>,
                          <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a907945ed5c2461fda065220362cab78e">delete_location_handler</a> =&gt; <span class="stringliteral">&quot;&quot;</span>, },
                 -<span class="keywordflow">default</span> =&gt; $r-&gt;param(<span class="stringliteral">&quot;manage_location_action&quot;</span>) ? $r-&gt;param(<span class="stringliteral">&quot;manage_location_action&quot;</span>) : <span class="stringliteral">&#39;none&#39;</span>);

    print CGI::start_table({});
    print CGI::Tr({}, CGI::th({-colspan=&gt;4,-align=&gt;<span class="stringliteral">&quot;left&quot;</span>}, 
                  <span class="stringliteral">&quot;Select an action to perform:&quot;</span>));

<span class="preprocessor">    # edit action</span>
<span class="preprocessor"></span>    print CGI::Tr({}, 
        CGI::td({},[ $actionRadios[0], <span class="stringliteral">&quot;Edit Location:&quot;</span> ]),
        CGI::td({-colspan=&gt;2, -align=&gt;<span class="stringliteral">&quot;left&quot;</span>}, 
            CGI::div({-style=&gt;<span class="stringliteral">&quot;width:25%;&quot;</span>},
                  CGI::popup_menu(-name=&gt;<span class="stringliteral">&quot;edit_location&quot;</span>,
                    -values=&gt;[@locationIDs]))) );
<span class="preprocessor">    # create action</span>
<span class="preprocessor"></span>    print CGI::Tr({},
        CGI::td({-align=&gt;<span class="stringliteral">&quot;left&quot;</span>},[ $actionRadios[1], 
            <span class="stringliteral">&quot;Create Location:&quot;</span> ]),
        CGI::td({-colspan=&gt;2},
            <span class="stringliteral">&quot;Location name: &quot;</span> .
            CGI::textfield(-name=&gt;<span class="stringliteral">&quot;new_location_name&quot;</span>,
                       -size=&gt;<span class="stringliteral">&quot;10&quot;</span>,
                       -<span class="keywordflow">default</span>=&gt;$r-&gt;param(<span class="stringliteral">&quot;new_location_name&quot;</span>)?$r-&gt;param(<span class="stringliteral">&quot;new_location_name&quot;</span>):<span class="stringliteral">&#39;&#39;</span>)));
    print CGI::Tr({valign=&gt;<span class="stringliteral">&#39;top&#39;</span>},
        CGI::td({}, [<span class="stringliteral">&quot;&amp;nbsp;&quot;</span>, <span class="stringliteral">&quot;Location description:&quot;</span>]),
        CGI::td({-colspan=&gt;2}, 
            CGI::textfield(-name=&gt;<span class="stringliteral">&quot;new_location_description&quot;</span>,
                       -size=&gt;<span class="stringliteral">&quot;50&quot;</span>,
                       -<span class="keywordflow">default</span>=&gt;$r-&gt;param(<span class="stringliteral">&quot;new_location_description&quot;</span>)?$r-&gt;param(<span class="stringliteral">&quot;new_location_description&quot;</span>):<span class="stringliteral">&#39;&#39;</span>)) );
    print CGI::Tr({}, CGI::td({},<span class="stringliteral">&quot;&amp;nbsp;&quot;</span>),
        CGI::td({-colspan=&gt;3}, <span class="stringliteral">&quot;Addresses for new location &quot;</span> .
            <span class="stringliteral">&quot;(enter one per line, as single IP addresses &quot;</span> .
            <span class="stringliteral">&quot;(e.g., 192.168.1.101), address masks (e.g., &quot;</span> .
            <span class="stringliteral">&quot;192.168.1.0/24), or IP ranges (e.g., &quot;</span> .
            <span class="stringliteral">&quot;192.168.1.101-192.168.1.150)):&quot;</span>));
    print CGI::Tr({}, CGI::td({}, <span class="stringliteral">&quot;&amp;nbsp;&quot;</span>),
        CGI::td({-colspan=&gt;3},
            CGI::textarea({-name=&gt;<span class="stringliteral">&quot;new_location_addresses&quot;</span>,
                       -rows=&gt;5, -columns=&gt;28,
                       -<span class="keywordflow">default</span>=&gt;$r-&gt;param(<span class="stringliteral">&quot;new_location_addresses&quot;</span>)?$r-&gt;param(<span class="stringliteral">&quot;new_location_addresses&quot;</span>):<span class="stringliteral">&#39;&#39;</span>})));

<span class="preprocessor">    # delete action</span>
<span class="preprocessor"></span>    print CGI::Tr({}, 
        CGI::td({-colspan=&gt;4}, 
            CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
                 CGI::em({}, <span class="stringliteral">&quot;Deletion deletes all location &quot;</span> .
                     <span class="stringliteral">&quot;data and related addresses, and is&quot;</span> .

                     <span class="stringliteral">&quot; not undoable!&quot;</span>))));
    print CGI::Tr({}, 
        CGI::td({}, 
            [ $actionRadios[2],
              CGI::div({-<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>},
                   <span class="stringliteral">&quot;Delete location:&quot;</span>) ]),
        CGI::td({-colspan=&gt;2}, 
            CGI::popup_menu(-name=&gt;<span class="stringliteral">&quot;delete_location&quot;</span>,
                    -values=&gt;[<span class="stringliteral">&quot;&quot;</span>,
                          <span class="stringliteral">&quot;selected_locations&quot;</span>,
                          @locationIDs],
                    -labels=&gt;{selected_locations =&gt; <span class="stringliteral">&quot;locations selected below&quot;</span>,
                          <span class="stringliteral">&quot;&quot;</span> =&gt; <span class="stringliteral">&quot;no location&quot;</span>}) .
            CGI::span({-style=&gt;<span class="stringliteral">&quot;color:#C33;&quot;</span>}, <span class="stringliteral">&quot;  Confirm: &quot;</span>) . 
            CGI::checkbox({-name=&gt;<span class="stringliteral">&quot;delete_confirm&quot;</span>,
                       -value=&gt;<span class="stringliteral">&quot;true&quot;</span>,
                       -label=&gt;<span class="stringliteral">&quot;&quot;</span>}) ) );
    print CGI::end_table();

    print CGI::p({}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;manage_locations&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Take Action!&quot;</span>));

<span class="preprocessor">    # existing location table</span>
<span class="preprocessor"></span><span class="preprocessor">    # FIXME: the styles for this table should be off in a stylesheet </span>
<span class="preprocessor"></span><span class="preprocessor">    #    somewhere</span>
<span class="preprocessor"></span>    print CGI::start_div({align=&gt;<span class="stringliteral">&quot;center&quot;</span>}),
        CGI::start_table({border=&gt;1, cellpadding=&gt;2});
    print CGI::Tr({style=&gt;<span class="stringliteral">&quot;background-color:#e0e0e0;font-size:92%&quot;</span>, align=&gt;<span class="stringliteral">&quot;left&quot;</span>}, 
              CGI::th({}, [<span class="stringliteral">&quot;Select&quot;</span>, <span class="stringliteral">&quot;Location&quot;</span>, <span class="stringliteral">&quot;Description&quot;</span>, 
                   <span class="stringliteral">&quot;Addresses&quot;</span>]));
    <span class="keywordflow">foreach</span> my $loc ( @locations ) {
        my $editAddr = $self-&gt;systemLink($urlpath, params=&gt;{subDisplay=&gt;<span class="stringliteral">&quot;manage_locations&quot;</span>, manage_location_action=&gt;<span class="stringliteral">&quot;edit_location_form&quot;</span>, edit_location=&gt;$loc-&gt;location_id});
        print CGI::Tr({valign=&gt;<span class="stringliteral">&#39;top&#39;</span>,style=&gt;<span class="stringliteral">&quot;background-color:#eeeeee;&quot;</span>}, 
                  CGI::td({style=&gt;<span class="stringliteral">&#39;font-size:85%;&#39;</span>},
                      [ CGI::checkbox(-name=&gt;<span class="stringliteral">&quot;delete_selected&quot;</span>,
                              -value=&gt;$loc-&gt;location_id,
                              -label=&gt;<span class="stringliteral">&#39;&#39;</span>),
                    CGI::a({href=&gt;$editAddr}, $loc-&gt;location_id),
                    $loc-&gt;description,
                    join(<span class="stringliteral">&#39;, &#39;</span>, @{$locAddr{$loc-&gt;location_id}}) ]));
    }
    print CGI::end_table(), CGI::end_div();
    print CGI::end_form();


}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa7dee07c2e6a185f1271411704f5d598"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::pre_header_initialize" ref="aa7dee07c2e6a185f1271411704f5d598" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::pre_header_initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-pre_header_initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-pre_header_initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-pre_header_initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-pre_header_initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in pre_header_initialize: 292</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#aa7dee07c2e6a185f1271411704f5d598">pre_header_initialize</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    my $urlpath = $r-&gt;urlpath;
    my $user        = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
<span class="preprocessor">    # check permissions</span>
<span class="preprocessor"></span>    unless ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;create_and_delete_courses&quot;</span>)) {
        $self-&gt;addmessage( CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&#39;ResultsWithError&#39;</span>},<span class="stringliteral">&quot;$user is not authorized to create or delete courses&quot;</span>) );
        <span class="keywordflow">return</span>;
    }
    
<span class="preprocessor">    # get result and send to message</span>
<span class="preprocessor"></span>    my $status_message = $r-&gt;param(<span class="stringliteral">&quot;status_message&quot;</span>);
    $self-&gt;addmessage(CGI::p(<span class="stringliteral">&quot;$status_message&quot;</span>)) <span class="keywordflow">if</span> $status_message;
    
    
<span class="preprocessor">    # Check that the non-native tables are present in the database</span>
<span class="preprocessor"></span><span class="preprocessor">    # These are the tables which are not course specific</span>
<span class="preprocessor"></span>    
    my $table_update_result = initNonNativeTables($ce, $ce-&gt;{dbLayoutName});
    
    $self-&gt;addgoodmessage(CGI::p(<span class="stringliteral">&quot;$table_update_result&quot;</span>)) <span class="keywordflow">if</span> $table_update_result;
    
    
<span class="preprocessor">    ## if the user is asking for the downloaded database...</span>
<span class="preprocessor"></span><span class="preprocessor">    #if (defined $r-&gt;param(&quot;download_exported_database&quot;)) {</span>
<span class="preprocessor"></span><span class="preprocessor">    #   my $courseID = $r-&gt;param(&quot;export_courseID&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">    #   my $random_chars = $r-&gt;param(&quot;download_exported_database&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">    #   </span>
<span class="preprocessor"></span><span class="preprocessor">    #   die &quot;courseID not specified&quot; unless defined $courseID;</span>
<span class="preprocessor"></span><span class="preprocessor">    #   die &quot;invalid file specification&quot; unless $random_chars =~ m/^\w+$/;</span>
<span class="preprocessor"></span><span class="preprocessor">    #   </span>
<span class="preprocessor"></span><span class="preprocessor">    #   my $tempdir = $ce-&gt;{webworkDirs}-&gt;{tmp};</span>
<span class="preprocessor"></span><span class="preprocessor">    #   my $export_file = &quot;$tempdir/db_export_$random_chars&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #   </span>
<span class="preprocessor"></span><span class="preprocessor">    #   $self-&gt;reply_with_file(&quot;application/xml&quot;, $export_file, &quot;${courseID}_database.xml&quot;, 0);</span>
<span class="preprocessor"></span><span class="preprocessor">    #   </span>
<span class="preprocessor"></span><span class="preprocessor">    #   return &quot;&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #}</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    ## otherwise...</span>
<span class="preprocessor"></span>    
    my @errors;
    my $method_to_call;
    
    my $subDisplay = $r-&gt;param(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    <span class="keywordflow">if</span> (defined $subDisplay) {
    
        <span class="keywordflow">if</span> ($subDisplay eq <span class="stringliteral">&quot;add_course&quot;</span>) {
            <span class="keywordflow">if</span> (defined $r-&gt;param(<span class="stringliteral">&quot;add_course&quot;</span>)) {
                @errors = $self-&gt;add_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;add_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;do_add_course&quot;</span>;
                }
            } <span class="keywordflow">else</span> {
                $method_to_call = <span class="stringliteral">&quot;add_course_form&quot;</span>;
            }
        }
        
        elsif ($subDisplay eq <span class="stringliteral">&quot;rename_course&quot;</span>) {
            <span class="keywordflow">if</span> (defined $r-&gt;param(<span class="stringliteral">&quot;rename_course&quot;</span>)) {
                @errors = $self-&gt;rename_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;rename_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;rename_course_confirm&quot;</span>;
                }
            } elsif (defined $r-&gt;param(<span class="stringliteral">&quot;confirm_rename_course&quot;</span>)) {
<span class="preprocessor">                # validate and delete</span>
<span class="preprocessor"></span>                @errors = $self-&gt;rename_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;rename_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;do_rename_course&quot;</span>;
                }
            } elsif (defined $r-&gt;param(<span class="stringliteral">&quot;upgrade_course_tables&quot;</span>) ){
<span class="preprocessor">                # upgrade and revalidate</span>
<span class="preprocessor"></span>                @errors = $self-&gt;rename_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;rename_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;rename_course_confirm&quot;</span>;
                }

            } <span class="keywordflow">else</span> {
                $method_to_call = <span class="stringliteral">&quot;rename_course_form&quot;</span>;
            }
        }
        
        elsif ($subDisplay eq <span class="stringliteral">&quot;delete_course&quot;</span>) {
            <span class="keywordflow">if</span> (defined $r-&gt;param(<span class="stringliteral">&quot;delete_course&quot;</span>)) {
<span class="preprocessor">                # validate or confirm</span>
<span class="preprocessor"></span>                @errors = $self-&gt;delete_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;delete_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;delete_course_confirm&quot;</span>;
                }
            } elsif (defined $r-&gt;param(<span class="stringliteral">&quot;confirm_delete_course&quot;</span>)) {
<span class="preprocessor">                # validate and delete</span>
<span class="preprocessor"></span>                @errors = $self-&gt;delete_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;delete_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;do_delete_course&quot;</span>;
                }
            }   
            elsif (defined ($r-&gt;param(<span class="stringliteral">&quot;delete_course_refresh&quot;</span>))) {
                $method_to_call = <span class="stringliteral">&quot;delete_course_form&quot;</span>;
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # form only</span>
<span class="preprocessor"></span>                $method_to_call = <span class="stringliteral">&quot;delete_course_form&quot;</span>;
            }
        }
        
        elsif ($subDisplay eq <span class="stringliteral">&quot;export_database&quot;</span>) {
            <span class="keywordflow">if</span> (defined $r-&gt;param(<span class="stringliteral">&quot;export_database&quot;</span>)) {
                @errors = $self-&gt;export_database_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;export_database_form&quot;</span>;
                } <span class="keywordflow">else</span> {
<span class="preprocessor">                    # we have to do something special here, since we&#39;re sending</span>
<span class="preprocessor"></span><span class="preprocessor">                    # the database as we export it. $method_to_call still gets</span>
<span class="preprocessor"></span><span class="preprocessor">                    # set here, but it gets caught by header() and content()</span>
<span class="preprocessor"></span><span class="preprocessor">                    # below instead of by body().</span>
<span class="preprocessor"></span>                    $method_to_call = <span class="stringliteral">&quot;do_export_database&quot;</span>;
                }
            } <span class="keywordflow">else</span> {
                $method_to_call = <span class="stringliteral">&quot;export_database_form&quot;</span>;
            }
        }
        
        elsif ($subDisplay eq <span class="stringliteral">&quot;import_database&quot;</span>) {
            <span class="keywordflow">if</span> (defined $r-&gt;param(<span class="stringliteral">&quot;import_database&quot;</span>)) {
                @errors = $self-&gt;import_database_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;import_database_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;do_import_database&quot;</span>;
                }
            } <span class="keywordflow">else</span> {
                $method_to_call = <span class="stringliteral">&quot;import_database_form&quot;</span>;
            }
        }
        
        elsif ($subDisplay eq <span class="stringliteral">&quot;archive_course&quot;</span>) {
            <span class="keywordflow">if</span> (defined $r-&gt;param(<span class="stringliteral">&quot;archive_course&quot;</span>)) {
<span class="preprocessor">                # validate -- if invalid, start over.</span>
<span class="preprocessor"></span><span class="preprocessor">                # if form is valid a page indicating the status of </span>
<span class="preprocessor"></span><span class="preprocessor">                # database tables and directories is presented.</span>
<span class="preprocessor"></span><span class="preprocessor">                # If they are ok, then you can push archive button, otherwise</span>
<span class="preprocessor"></span><span class="preprocessor">                # you can quit or choose to upgrade the tables</span>
<span class="preprocessor"></span>                @errors = $self-&gt;archive_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;archive_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;archive_course_confirm&quot;</span>; #check tables &amp; directories
                }
            } elsif (defined $r-&gt;param(<span class="stringliteral">&quot;confirm_archive_course&quot;</span>)) {
<span class="preprocessor">                # validate and archive</span>
<span class="preprocessor"></span><span class="preprocessor">                # the &quot;archive it&quot; button has been pushed and the </span>
<span class="preprocessor"></span><span class="preprocessor">                # course will be archived</span>
<span class="preprocessor"></span><span class="preprocessor">                # a report on success or failure will be generated</span>
<span class="preprocessor"></span>                @errors = $self-&gt;archive_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;archive_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;do_archive_course&quot;</span>;
                }
            } elsif (defined $r-&gt;param(<span class="stringliteral">&quot;upgrade_course_tables&quot;</span>) ){
<span class="preprocessor">                # upgrade and revalidate</span>
<span class="preprocessor"></span><span class="preprocessor">                # the &quot;upgrade course&quot; button has been pushed</span>
<span class="preprocessor"></span><span class="preprocessor">                # after the course has been upgraded you are returned</span>
<span class="preprocessor"></span><span class="preprocessor">                # to the confirm page.</span>
<span class="preprocessor"></span>                @errors = $self-&gt;archive_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;archive_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;archive_course_confirm&quot;</span>; # upgrade and recheck tables &amp; directories.
                }
            }   
            elsif (defined ($r-&gt;param(<span class="stringliteral">&quot;archive_course_refresh&quot;</span>))) {
                $method_to_call = <span class="stringliteral">&quot;archive_course_form&quot;</span>;
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # form only</span>
<span class="preprocessor"></span>                $method_to_call = <span class="stringliteral">&quot;archive_course_form&quot;</span>;
            }
        }
        elsif ($subDisplay eq <span class="stringliteral">&quot;unarchive_course&quot;</span>) {
            <span class="keywordflow">if</span> (defined $r-&gt;param(<span class="stringliteral">&quot;unarchive_course&quot;</span>)) {
<span class="preprocessor">                # validate or confirm</span>
<span class="preprocessor"></span>                @errors = $self-&gt;unarchive_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;unarchive_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;unarchive_course_confirm&quot;</span>;
                }
            } elsif (defined $r-&gt;param(<span class="stringliteral">&quot;confirm_unarchive_course&quot;</span>)) {
<span class="preprocessor">                # validate and archive</span>
<span class="preprocessor"></span>                @errors = $self-&gt;unarchive_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;unarchive_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;do_unarchive_course&quot;</span>;
                }
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # form only</span>
<span class="preprocessor"></span><span class="preprocessor">                # start at the beginning -- get drop down list of courses to unarchive</span>
<span class="preprocessor"></span>                $method_to_call = <span class="stringliteral">&quot;unarchive_course_form&quot;</span>;
            }
        }
        elsif ($subDisplay eq <span class="stringliteral">&quot;upgrade_course&quot;</span>) {
            <span class="keywordflow">if</span> (defined $r-&gt;param(<span class="stringliteral">&quot;upgrade_course&quot;</span>)) {
<span class="preprocessor">                # validate or confirm</span>
<span class="preprocessor"></span><span class="preprocessor">                # if form is valid present details of analysis of the course structure</span>
<span class="preprocessor"></span>                @errors = $self-&gt;upgrade_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;upgrade_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;upgrade_course_confirm&quot;</span>;
                }
            } elsif (defined $r-&gt;param(<span class="stringliteral">&quot;confirm_upgrade_course&quot;</span>)) {
<span class="preprocessor">                # validate and upgrade</span>
<span class="preprocessor"></span><span class="preprocessor">                # if form is valid upgrade the courses and present results</span>
<span class="preprocessor"></span>                @errors = $self-&gt;upgrade_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;upgrade_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $method_to_call = <span class="stringliteral">&quot;do_upgrade_course&quot;</span>;
                }
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # form only</span>
<span class="preprocessor"></span><span class="preprocessor">                # start at the beginning -- get list of courses and their status</span>
<span class="preprocessor"></span>                $method_to_call = <span class="stringliteral">&quot;upgrade_course_form&quot;</span>;
            }
        }
        elsif ($subDisplay eq <span class="stringliteral">&quot;manage_locations&quot;</span>) {
            <span class="keywordflow">if</span> (defined ($r-&gt;param(<span class="stringliteral">&quot;manage_location_action&quot;</span>))) {
                $method_to_call = 
                    $r-&gt;param(<span class="stringliteral">&quot;manage_location_action&quot;</span>);
            }
            <span class="keywordflow">else</span>{
                $method_to_call = <span class="stringliteral">&quot;manage_location_form&quot;</span>;
            }
        }
        elsif ($subDisplay eq <span class="stringliteral">&quot;hide_inactive_course&quot;</span>) {
<span class="preprocessor">#           warn &quot;subDisplay is $subDisplay&quot;;</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> (defined ($r-&gt;param(<span class="stringliteral">&quot;hide_course&quot;</span>))) {
                @errors = $self-&gt;hide_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;hide_inactive_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                $method_to_call = <span class="stringliteral">&quot;do_hide_inactive_course&quot;</span>;
              }
            }  
            elsif (defined ($r-&gt;param(<span class="stringliteral">&quot;unhide_course&quot;</span>))) {
                @errors = $self-&gt;unhide_course_validate;
                <span class="keywordflow">if</span> (@errors) {
                    $method_to_call = <span class="stringliteral">&quot;hide_inactive_course_form&quot;</span>;
                } <span class="keywordflow">else</span> {
                $method_to_call = <span class="stringliteral">&quot;do_unhide_inactive_course&quot;</span>;
              }
            } 
            elsif (defined ($r-&gt;param(<span class="stringliteral">&quot;hide_course_refresh&quot;</span>))) {
                $method_to_call = <span class="stringliteral">&quot;hide_inactive_course_form&quot;</span>;
            }
            <span class="keywordflow">else</span>{
                $method_to_call = <span class="stringliteral">&quot;hide_inactive_course_form&quot;</span>;
            }
        }       
        elsif ($subDisplay eq <span class="stringliteral">&quot;registration&quot;</span>) {
            <span class="keywordflow">if</span> (defined ($r-&gt;param(<span class="stringliteral">&quot;register_site&quot;</span>))) {
                $method_to_call =  <span class="stringliteral">&quot;do_registration&quot;</span>;
            }
            <span class="keywordflow">else</span>{
                $method_to_call = <span class="stringliteral">&quot;registration_form&quot;</span>;
            }
        }
        <span class="keywordflow">else</span> {
            @errors = <span class="stringliteral">&quot;Unrecognized sub-display @{[ CGI::b($subDisplay) ]}.&quot;</span>;
        }
    }
    
    $self-&gt;{errors} = \@errors;
    $self-&gt;{method_to_call} = $method_to_call;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a64f469d57b38e2e526907d584bf6099b"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::registration_form" ref="a64f469d57b38e2e526907d584bf6099b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::registration_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-registration_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-registration_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-registration_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-registration_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in registration_form: 51</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a64f469d57b38e2e526907d584bf6099b">registration_form</a> {
    my $self = shift;
    my $ce = $self-&gt;r-&gt;ce;
    
    print <span class="stringliteral">&quot;&lt;center&gt;&quot;</span>;
    print  <span class="stringliteral">&quot;\n&quot;</span>,CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: left; width:60%&quot;</span>},
    <span class="stringliteral">&quot;\nPlease &quot;</span>,
    CGI::a({href=&gt;<span class="stringliteral">&#39;mailto:gage@math.rochester.edu?&#39;</span>
    .<span class="stringliteral">&#39;subject=WeBWorK%20Server%20Registration&#39;</span>
    .<span class="stringliteral">&#39;&amp;body=&#39;</span>
    .uri_escape(<span class="stringliteral">&quot;Thanks for registering your WeBWorK server.  We&#39;d appreciate if you would answer</span>
<span class="stringliteral">    as many of these questions as you can conveniently.  We need this data so we can better </span>
<span class="stringliteral">    answer questions such as &#39;How many institutions have webwork servers?&#39; and &#39;How many students</span>
<span class="stringliteral">    use WeBWorK?&#39;.  Your email and contact information  will be kept private.  We will </span>
<span class="stringliteral">    list your institution as one that uses WeBWorK unless you tell us to keep that private as well.</span>
<span class="stringliteral">    \n\nThank you. \n\n--Mike Gage \n\n</span>
<span class="stringliteral">    &quot;</span>)
    .uri_escape(<span class="stringliteral">&quot;Server URL: &quot;</span>.$ce-&gt;{apache_root_url}.<span class="stringliteral">&quot; \n\n&quot;</span>)
    .uri_escape(<span class="stringliteral">&quot;WeBWorK version: $main::VERSION \n\n&quot;</span>)
    .uri_escape(<span class="stringliteral">&quot;Institution name (e.g. University of Rochester): \n\n&quot;</span>)
    .uri_escape(<span class="stringliteral">&quot;Contact person name: \n\n&quot;</span>)
    .uri_escape(<span class="stringliteral">&quot;Contact email: \n\n&quot;</span>)
    .uri_escape(<span class="stringliteral">&quot;Approximate number of courses run each term: \n\n&quot;</span>)
    .uri_escape(<span class="stringliteral">&quot;Approximate number of students using this server each term: \n\n&quot;</span>)
    .uri_escape(<span class="stringliteral">&quot;Other institutions who use WeBWorK courses hosted on this server: \n\n&quot;</span>)
    .uri_escape(<span class="stringliteral">&quot;Other comments: \n\n&quot;</span>)
    },
    <span class="stringliteral">&#39;click here&#39;</span>),
    q! to open your email application.  There are a few questions, some of which have already
    been filled in <span class="keywordflow">for</span> your installation.  Fill in the other questions which you can answer easily and send
    the email to gage@math.rochester.edu
    !
    );
    
    
    
    print  <span class="stringliteral">&quot;\n&quot;</span>,CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: left; width:60%&quot;</span>},q!Once you have emailed your registration information you can hide the <span class="stringliteral">&quot;registration&quot;</span> banner 
    <span class="keywordflow">for</span> successive visits by clicking
    the button below. It writes an empty file (!.CGI::code(<span class="stringliteral">&#39;registered_versionNumber&#39;</span>).q!) to the directory !.CGI::code(&#39;..../courses/admin&#39;)
    );
    
    print &quot;&lt;/center&gt;&quot;;
    print CGI::start_form(-method=&gt;&quot;POST&quot;, -action=&gt;$self-&gt;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#afc1106db125a42082cafaf10746a947b">r</a>-&gt;uri);
    print $self-&gt;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#aa62b98ea810566650c83e05d9aff3fc0">hidden_authen_fields</a>;
    print $self-&gt;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#ad923bd08f625bcd753a68a70395f2337">hidden_fields</a>(&quot;subDisplay&quot;);
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;register_site&quot;</span>, -label=&gt;<span class="stringliteral">&quot;Site has been registered&quot;</span>));
    print CGI::end_form();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a5c300da40782982284ab7698c97ae4ed"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::rename_course_confirm" ref="a5c300da40782982284ab7698c97ae4ed" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::rename_course_confirm </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rename_course_confirm' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rename_course_confirm-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rename_course_confirm-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rename_course_confirm-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rename_course_confirm: 101</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a5c300da40782982284ab7698c97ae4ed">rename_course_confirm</a> {

    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>
    my $rename_oldCourseID     = $r-&gt;param(<span class="stringliteral">&quot;rename_oldCourseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    my $rename_newCourseID     = $r-&gt;param(<span class="stringliteral">&quot;rename_newCourseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;

    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        %WeBWorK::SeedCE,
        courseName =&gt; $rename_oldCourseID,
    });
<span class="preprocessor">#############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Check database</span>
<span class="preprocessor"></span><span class="preprocessor">#############################################################################</span>
<span class="preprocessor"></span>    
    my ($tables_ok,$dbStatus);
    <span class="keywordflow">if</span> ($ce2-&gt;{dbLayoutName} ) {
         my $CIchecker = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1Utils_1_1CourseIntegrityCheck.html">WeBWorK::Utils::CourseIntegrityCheck</a>(ce=&gt;$ce2);
        ($tables_ok,$dbStatus) = $CIchecker-&gt;checkCourseTables($rename_oldCourseID);
        <span class="keywordflow">if</span> ($r-&gt;param(<span class="stringliteral">&quot;upgrade_course_tables&quot;</span>)) {
            my @schema_table_names = keys %$dbStatus;  # update tables missing from database;
            my @tables_to_create = grep {$dbStatus-&gt;{$_}-&gt;[0] == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A} @schema_table_names;
            my @tables_to_alter  = grep {$dbStatus-&gt;{$_}-&gt;[0] == WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B} @schema_table_names;
            my $msg = $CIchecker-&gt;updateCourseTables($rename_oldCourseID, [@tables_to_create]);
            <span class="keywordflow">foreach</span> my $table_name (@tables_to_alter) {
                $msg .= $CIchecker-&gt;updateTableFields($rename_oldCourseID, $table_name);
            }
            print CGI::p({-style=&gt;<span class="stringliteral">&#39;color:green; font-weight:bold&#39;</span>}, $msg);
            
        }
        ($tables_ok,$dbStatus) = $CIchecker-&gt;checkCourseTables($rename_oldCourseID);
 

<span class="preprocessor">        # print db status</span>
<span class="preprocessor"></span>
        my %msg =(    WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A         =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Table defined in schema but missing in database&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B         =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Table defined in database but missing in schema&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::SAME_IN_A_AND_B   =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:green&quot;</span>},<span class="stringliteral">&quot; Table is ok &quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Schema and database table definitions do not agree &quot;</span>),
        );
        my %msg2 =(    WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A        =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; missing in database&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B         =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; missing in schema&quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::SAME_IN_A_AND_B   =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:green&quot;</span>},<span class="stringliteral">&quot; is ok &quot;</span>),
                      WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B =&gt; CGI::span({style=&gt;<span class="stringliteral">&quot;color:red&quot;</span>},<span class="stringliteral">&quot; Schema and database field definitions do not agree &quot;</span>),
        );
        my $all_tables_ok=1;
        my $extra_database_tables=0;
        my $extra_database_fields=0;
        my $str=CGI::h4(<span class="stringliteral">&quot;Report on database structure for course $rename_oldCourseID:&quot;</span>).CGI::br();
        <span class="keywordflow">foreach</span> my $table (sort keys %$dbStatus) {
            my $table_status = $dbStatus-&gt;{$table}-&gt;[0];
            $str .= CGI::b($table) .  $msg{ $table_status } . CGI::br();
            
            CASE: {
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::SAME_IN_A_AND_B 
                    &amp;&amp; <span class="keywordflow">do</span>{ last CASE;
                    };
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A
                    &amp;&amp; <span class="keywordflow">do</span>{
                           $all_tables_ok = 0; last CASE;
                    };
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B
                    &amp;&amp; <span class="keywordflow">do</span>{
                           $extra_database_tables = 1; last CASE;
                    };
                $table_status == WeBWorK::Utils::CourseIntegrityCheck::DIFFER_IN_A_AND_B
                    &amp;&amp; <span class="keywordflow">do</span>{ 
                        my %fieldInfo = %{ $dbStatus-&gt;{$table}-&gt;[1] };
                        <span class="keywordflow">foreach</span> my $key (keys %fieldInfo) {
                            my $field_status = $fieldInfo{$key}-&gt;[0];
                            CASE2: {
                                $field_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_B 
                                    &amp;&amp; <span class="keywordflow">do</span>{ 
                                       $extra_database_fields = 1; last CASE2;
                                    };
                                $field_status == WeBWorK::Utils::CourseIntegrityCheck::ONLY_IN_A 
                                    &amp;&amp; <span class="keywordflow">do</span>{ 
                                       $all_tables_ok=0; last CASE2;
                                    };                          
                            }
                            $str .= CGI::br().<span class="stringliteral">&quot;\n&amp;nbsp;&amp;nbsp;Field $key =&gt; &quot;</span>. $msg2{$field_status };
                        }                           
                    };
            }
            $str.=CGI::br();
            
        }
<span class="preprocessor">#############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Report on databases</span>
<span class="preprocessor"></span><span class="preprocessor">#############################################################################</span>
<span class="preprocessor"></span>
        print CGI::p($str);
        <span class="keywordflow">if</span> ($extra_database_tables) {
                print CGI::p({-style=&gt;<span class="stringliteral">&#39;color:red; font-weight:bold&#39;</span>},<span class="stringliteral">&quot;There are extra database tables which are not defined in the schema.  </span>
<span class="stringliteral">                                                                     They can only be removed manually from the database. They will not be renamed.&quot;</span>);
        } 
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="afbaeae646325f8529dc0eca4fd1439a1"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::rename_course_form" ref="afbaeae646325f8529dc0eca4fd1439a1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::rename_course_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rename_course_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rename_course_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rename_course_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rename_course_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rename_course_form: 58</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#afbaeae646325f8529dc0eca4fd1439a1">rename_course_form</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    my $rename_oldCourseID     = $r-&gt;param(<span class="stringliteral">&quot;rename_oldCourseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    my $rename_newCourseID     = $r-&gt;param(<span class="stringliteral">&quot;rename_newCourseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
    my @courseIDs = listCourses($ce);
    @courseIDs    = sort {lc($a) cmp lc ($b) } @courseIDs;
    
    my %courseLabels; <span class="preprocessor"># records... heh.</span>
<span class="preprocessor"></span>    <span class="keywordflow">foreach</span> my $courseID (@courseIDs) {
<span class="preprocessor">#       my $tempCE = new WeBWorK::CourseEnvironment({</span>
<span class="preprocessor"></span><span class="preprocessor">#           %WeBWorK::SeedCE,</span>
<span class="preprocessor"></span><span class="preprocessor">#           courseName =&gt; $courseID,</span>
<span class="preprocessor"></span><span class="preprocessor">#       });</span>
<span class="preprocessor"></span><span class="preprocessor">#       $courseLabels{$courseID} = &quot;$courseID (&quot; . $tempCE-&gt;{dbLayoutName} . &quot;)&quot;;</span>
<span class="preprocessor"></span>        $courseLabels{$courseID} = <span class="stringliteral">&quot;$courseID&quot;</span>;
    }
    
    print CGI::h2(<span class="stringliteral">&quot;Rename Course&quot;</span>);
    
    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    
    print CGI::p(<span class="stringliteral">&quot;Select a course to rename.&quot;</span>);
    
    print CGI::table({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;FormLayout&quot;</span>},
        CGI::Tr({},
            CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, <span class="stringliteral">&quot;Course Name:&quot;</span>),
            CGI::td(
                CGI::scrolling_list(
                    -name =&gt; <span class="stringliteral">&quot;rename_oldCourseID&quot;</span>,
                    -values =&gt; \@courseIDs,
                    -<span class="keywordflow">default</span> =&gt; $rename_oldCourseID,
                    -size =&gt; 10,
                    -multiple =&gt; 0,
                    -labels =&gt; \%courseLabels,
                ),
            ),
        ),
        CGI::Tr({},
            CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, <span class="stringliteral">&quot;New Name:&quot;</span>),
            CGI::td(CGI::textfield(-name=&gt;<span class="stringliteral">&quot;rename_newCourseID&quot;</span>, -value=&gt;$rename_newCourseID, -size=&gt;25)),
        ),
    );
    
    print CGI::end_table();
    
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;rename_course&quot;</span>, -label=&gt;<span class="stringliteral">&quot;Rename Course&quot;</span>));
    
    print CGI::end_form();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a382dd1ad022168d38abf5090d375c0b7"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::rename_course_validate" ref="a382dd1ad022168d38abf5090d375c0b7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::rename_course_validate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rename_course_validate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rename_course_validate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rename_course_validate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rename_course_validate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rename_course_validate: 36</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a382dd1ad022168d38abf5090d375c0b7">rename_course_validate</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    my $rename_oldCourseID     = $r-&gt;param(<span class="stringliteral">&quot;rename_oldCourseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    my $rename_newCourseID     = $r-&gt;param(<span class="stringliteral">&quot;rename_newCourseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
    my @errors;
    
    <span class="keywordflow">if</span> ($rename_oldCourseID eq <span class="stringliteral">&quot;&quot;</span>) {
        push @errors, <span class="stringliteral">&quot;You must select a course to rename.&quot;</span>;
    }
    <span class="keywordflow">if</span> ($rename_newCourseID eq <span class="stringliteral">&quot;&quot;</span>) {
        push @errors, <span class="stringliteral">&quot;You must specify a new name for the course.&quot;</span>;
    }
    <span class="keywordflow">if</span> ($rename_oldCourseID eq $rename_newCourseID) {
        push @errors, <span class="stringliteral">&quot;Can&#39;t rename to the same name.&quot;</span>;
    }
    unless ($rename_newCourseID =~ /^[\w-]*$/) { # regex copied from CourseAdministration.pm
        push @errors, <span class="stringliteral">&quot;Course ID may only contain letters, numbers, hyphens, and underscores.&quot;</span>;
    }
    <span class="keywordflow">if</span> (grep { $rename_newCourseID eq $_ } listCourses($ce)) {
        push @errors, <span class="stringliteral">&quot;A course with ID $rename_newCourseID already exists.&quot;</span>;
    }
    
    my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
        %WeBWorK::SeedCE,
        courseName =&gt; $rename_oldCourseID,
    });
    
    <span class="keywordflow">return</span> @errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aacc8887147bb0f3e122d78bbc8187a70"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::unarchive_course_confirm" ref="aacc8887147bb0f3e122d78bbc8187a70" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::unarchive_course_confirm </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-unarchive_course_confirm' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-unarchive_course_confirm-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-unarchive_course_confirm-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-unarchive_course_confirm-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in unarchive_course_confirm: 39</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#aacc8887147bb0f3e122d78bbc8187a70">unarchive_course_confirm</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    print CGI::h2(<span class="stringliteral">&quot;Unarchive Course&quot;</span>);
    
    my $unarchive_courseID                    = $r-&gt;param(<span class="stringliteral">&quot;unarchive_courseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    my $create_newCourseID                    = $r-&gt;param(<span class="stringliteral">&quot;create_newCourseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    my $new_courseID                          = $r-&gt;param(<span class="stringliteral">&quot;new_courseID&quot;</span>)           || <span class="stringliteral">&quot;&quot;</span>;

    my $courseID = $unarchive_courseID; $courseID =~ s/\.tar\.gz$<span class="comment">//;</span>
    
    <span class="keywordflow">if</span> ( $create_newCourseID) {
        $courseID = $new_courseID;
    }   

    debug(<span class="stringliteral">&quot; unarchive_courseID $unarchive_courseID new_courseID $new_courseID &quot;</span>);

    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
        print CGI::p($unarchive_courseID,<span class="stringliteral">&quot; to course &quot;</span>, 
                 CGI::input({-name=&gt;<span class="stringliteral">&#39;new_courseID&#39;</span>, -value=&gt;$courseID})
    );

    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    print $self-&gt;hidden_fields(qw/unarchive_courseID create_newCourseID/);
    
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>},
        CGI::submit(-name=&gt;<span class="stringliteral">&quot;decline_unarchive_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Don&#39;t unarchive&quot;</span>),
        <span class="stringliteral">&quot;&amp;nbsp;&quot;</span>,
        CGI::submit(-name=&gt;<span class="stringliteral">&quot;confirm_unarchive_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;unarchive&quot;</span>),
    );
    
    print CGI::end_form();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a182011f0a9ddd2eadb596813bf0aed37"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::unarchive_course_form" ref="a182011f0a9ddd2eadb596813bf0aed37" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::unarchive_course_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-unarchive_course_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-unarchive_course_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-unarchive_course_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-unarchive_course_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in unarchive_course_form: 59</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a182011f0a9ddd2eadb596813bf0aed37">unarchive_course_form</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    my $unarchive_courseID     = $r-&gt;param(<span class="stringliteral">&quot;unarchive_courseID&quot;</span>)     || <span class="stringliteral">&quot;&quot;</span>;
    
<span class="preprocessor">    # First find courses which have been archived.</span>
<span class="preprocessor"></span>    my @courseIDs = listArchivedCourses($ce);
    @courseIDs    = sort {lc($a) cmp lc ($b) } @courseIDs; <span class="preprocessor">#make sort case insensitive </span>
<span class="preprocessor"></span>    
    my %courseLabels; # records... heh.
    <span class="keywordflow">foreach</span> my $courseID (@courseIDs) {
        $courseLabels{$courseID} = $courseID;
    }
    
    print CGI::h2(<span class="stringliteral">&quot;Unarchive Course&quot;</span>);
    
    print CGI::p(
        <span class="stringliteral">&quot;Restores a course from a gzipped tar archive (.tar.gz). After</span>
<span class="stringliteral">        unarchiving, the course database is restored from a subdirectory of the</span>
<span class="stringliteral">        course&#39;s DATA directory. Currently the archive facility is only</span>
<span class="stringliteral">        available for mysql databases. It depends on the mysqldump application.&quot;</span>
    );
    
    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    
    print CGI::p(<span class="stringliteral">&quot;Select a course to unarchive.&quot;</span>);
    
    print CGI::table({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;FormLayout&quot;</span>},
        CGI::Tr({},
            CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, <span class="stringliteral">&quot;Course Name:&quot;</span>),
            CGI::td(
                CGI::scrolling_list(
                    -name =&gt; <span class="stringliteral">&quot;unarchive_courseID&quot;</span>,
                    -values =&gt; \@courseIDs,
                    -<span class="keywordflow">default</span> =&gt; $unarchive_courseID,
                    -size =&gt; 10,
                    -multiple =&gt; 0,
                    -labels =&gt; \%courseLabels,
                ),
            ),
        ),
    
        CGI::Tr({},
                CGI::th({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;LeftHeader&quot;</span>}, CGI::checkbox(-name =&gt; <span class="stringliteral">&quot;create_newCourseID&quot;</span>,-<span class="keywordflow">default</span>=&gt;<span class="stringliteral">&#39;&#39;</span>,-value=&gt;1, -label=&gt;<span class="stringliteral">&#39;New Name:&#39;</span>)),
                CGI::td(CGI::textfield(-name=&gt;<span class="stringliteral">&quot;new_courseID&quot;</span>, -value=&gt;<span class="stringliteral">&#39;&#39;</span>, -size=&gt;25)),
            ),
    );
    
    print CGI::p({style=&gt;<span class="stringliteral">&quot;text-align: center&quot;</span>}, CGI::submit(-name=&gt;<span class="stringliteral">&quot;unarchive_course&quot;</span>, -value=&gt;<span class="stringliteral">&quot;Unarchive Course&quot;</span>));
    
    print CGI::end_form();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2dfdd169f68e81d506c255bf19ac2f33"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::unarchive_course_validate" ref="a2dfdd169f68e81d506c255bf19ac2f33" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::unarchive_course_validate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-unarchive_course_validate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-unarchive_course_validate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-unarchive_course_validate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-unarchive_course_validate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in unarchive_course_validate: 32</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a2dfdd169f68e81d506c255bf19ac2f33">unarchive_course_validate</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span>    my $urlpath = $r-&gt;urlpath;
    
    my $unarchive_courseID                   = $r-&gt;param(<span class="stringliteral">&quot;unarchive_courseID&quot;</span>)             || <span class="stringliteral">&quot;&quot;</span>;
    my $create_newCourseID                   = $r-&gt;param(<span class="stringliteral">&quot;create_newCourseID&quot;</span>)      || <span class="stringliteral">&quot;&quot;</span>;
    my $new_courseID                         = $r-&gt;param(<span class="stringliteral">&quot;new_courseID&quot;</span>)    || <span class="stringliteral">&quot;&quot;</span>;
    my @errors;
<span class="preprocessor">    #by default we use the archive name for the course</span>
<span class="preprocessor"></span>    my $courseID = $unarchive_courseID; 
    $courseID =~ s/\.tar\.gz$<span class="comment">//;</span>
    
    <span class="keywordflow">if</span> ( $create_newCourseID) {
        $courseID = $new_courseID;
    }
    debug(<span class="stringliteral">&quot; unarchive_courseID $unarchive_courseID new_courseID $new_courseID &quot;</span>);

    <span class="keywordflow">if</span> ($courseID eq <span class="stringliteral">&quot;&quot;</span>) {
        push @errors, <span class="stringliteral">&quot;You must specify a course name.&quot;</span>;
    } elsif ( -d $ce-&gt;{webworkDirs}-&gt;{courses}.<span class="stringliteral">&quot;/$courseID&quot;</span> ) {
<span class="preprocessor">        #Check that a directory for this course doesn&#39;t already exist</span>
<span class="preprocessor"></span>        push @errors, <span class="stringliteral">&quot;A directory already exists with the name $courseID. </span>
<span class="stringliteral">         You must first delete this existing course before you can unarchive.&quot;</span>;
    }

    
    <span class="keywordflow">return</span> @errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac39c965823016b2e58f9d1f2878b4d32"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::unhide_course_validate" ref="ac39c965823016b2e58f9d1f2878b4d32" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::unhide_course_validate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-unhide_course_validate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-unhide_course_validate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-unhide_course_validate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-unhide_course_validate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in unhide_course_validate: 20</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ac39c965823016b2e58f9d1f2878b4d32">unhide_course_validate</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span>    my $urlpath = $r-&gt;urlpath;
    
    my @unhide_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;hide_courseIDs&quot;</span>);
    @unhide_courseIDs        = () unless @unhide_courseIDs;
    
    my @errors;
    
    unless (@unhide_courseIDs) {
        push @errors, <span class="stringliteral">&quot;You must specify a course name.&quot;</span>;
    } 
    <span class="keywordflow">return</span> @errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a52738445fdb55c2b9de823f87625b3f9"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::upgrade_course_confirm" ref="a52738445fdb55c2b9de823f87625b3f9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::upgrade_course_confirm </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-upgrade_course_confirm' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-upgrade_course_confirm-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-upgrade_course_confirm-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-upgrade_course_confirm-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in upgrade_course_confirm: 52</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a52738445fdb55c2b9de823f87625b3f9">upgrade_course_confirm</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    
    
    my @upgrade_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;upgrade_courseIDs&quot;</span>);
    @upgrade_courseIDs        = () unless @upgrade_courseIDs;
<span class="preprocessor">    #my $upgrade_courseID      = $upgrade_courseIDs[0];</span>
<span class="preprocessor"></span>    my %update_error_msg      = ();
    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri);
    <span class="keywordflow">foreach</span> my $upgrade_courseID (@upgrade_courseIDs) {
        next unless $upgrade_courseID =~/\S/;   # skip empty values
<span class="preprocessor">        ##########################</span>
<span class="preprocessor"></span><span class="preprocessor">        # analyze one course</span>
<span class="preprocessor"></span><span class="preprocessor">        ##########################</span>
<span class="preprocessor"></span>        my $ce2 = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1CourseEnvironment.html">WeBWorK::CourseEnvironment</a>({
            %WeBWorK::SeedCE,
            courseName =&gt; $upgrade_courseID,
        });
<span class="preprocessor">        #warn &quot;upgrade_course_confirm: updating |$upgrade_courseID| from course list: &quot; , join(&quot;|&quot;,@upgrade_courseIDs); </span>
<span class="preprocessor"></span>    
<span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Create integrity checker</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>    
        my $CIchecker = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1Utils_1_1CourseIntegrityCheck.html">WeBWorK::Utils::CourseIntegrityCheck</a>(ce=&gt;$ce2);
    
<span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Report on database status</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>    
        my ($tables_ok,$dbStatus) = $CIchecker-&gt;checkCourseTables($upgrade_courseID);
        my ($all_tables_ok, $extra_database_tables, $extra_database_fields, $str) = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ab483552395995130885c84b88ec95492">formatReportOnDatabaseTables</a>($tables_ok, $dbStatus);
<span class="preprocessor">        # prepend course name</span>
<span class="preprocessor"></span>        $str = CGI::checkbox({name=&gt;<span class="stringliteral">&quot;upgrade_courseIDs&quot;</span>, label=&gt;<span class="stringliteral">&#39;upgrade&#39;</span>, selected=&gt;1,value=&gt;$upgrade_courseID}).
                 <span class="stringliteral">&quot;Report for course $upgrade_courseID:&quot;</span>.CGI::br().<span class="stringliteral">&quot;Database:&quot;</span>.CGI::br(). $str;
         
<span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # Report on databases</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>    
        print CGI::p($str);
        <span class="keywordflow">if</span> ($extra_database_tables) {
                print CGI::p({-style=&gt;<span class="stringliteral">&#39;color:red; font-weight:bold&#39;</span>},<span class="stringliteral">&quot;There are extra database tables which are not defined in the schema.  </span>
<span class="stringliteral">                                                                     They can only be removed manually from the database.&quot;</span>);
        } 
        <span class="keywordflow">if</span> ($extra_database_fields) {
                print CGI::p({-style=&gt;<span class="stringliteral">&#39;color:red; font-weight:bold&#39;</span>},<span class="stringliteral">&quot;There are extra database fields  which are not defined in the schema for at least one table.  </span>
<span class="stringliteral">                                                                     They can only be removed manually from the database.&quot;</span>);
        } 
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ade381a86d4f41837bde7ea5b1ea748c1"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::upgrade_course_form" ref="ade381a86d4f41837bde7ea5b1ea748c1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::upgrade_course_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-upgrade_course_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-upgrade_course_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-upgrade_course_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-upgrade_course_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in upgrade_course_form: 75</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#ade381a86d4f41837bde7ea5b1ea748c1">upgrade_course_form</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $urlpath = $r-&gt;urlpath;</span>
<span class="preprocessor"></span>    
    
    my $selectAll =CGI::input({-type=&gt;<span class="stringliteral">&#39;button&#39;</span>, -name=&gt;<span class="stringliteral">&#39;check_all&#39;</span>, -value=&gt;<span class="stringliteral">&#39;Select all eligible courses&#39;</span>,
           onClick =&gt; <span class="stringliteral">&quot;for (i in document.courselist.elements)  { </span>
<span class="stringliteral">                           if (document.courselist.elements[i].name ==&#39;upgrade_courseIDs&#39;) { </span>
<span class="stringliteral">                               document.courselist.elements[i].checked = true</span>
<span class="stringliteral">                           }</span>
<span class="stringliteral">                        }&quot;</span> });
    my $selectNone =CGI::input({-type=&gt;<span class="stringliteral">&#39;button&#39;</span>, -name=&gt;<span class="stringliteral">&#39;check_none&#39;</span>, -value=&gt;<span class="stringliteral">&#39;Unselect all courses&#39;</span>,
           onClick =&gt; <span class="stringliteral">&quot;for (i in document.courselist.elements)  { </span>
<span class="stringliteral">                           if (document.courselist.elements[i].name ==&#39;upgrade_courseIDs&#39;) { </span>
<span class="stringliteral">                              document.courselist.elements[i].checked = false</span>
<span class="stringliteral">                           }</span>
<span class="stringliteral">                        }&quot;</span> });

    my @courseIDs = listCourses($ce);
    @courseIDs    = sort {lc($a) cmp lc ($b) } @courseIDs; <span class="preprocessor">#make sort case insensitive </span>
<span class="preprocessor"></span>    
    print CGI::h2(<span class="stringliteral">&quot;Upgrade Courses&quot;</span>);
    
    print CGI::p(
        <span class="stringliteral">&quot;Update the checked directories?&quot;</span>
    );
    
    print CGI::start_form(-method=&gt;<span class="stringliteral">&quot;POST&quot;</span>, -action=&gt;$r-&gt;uri, -<span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;courselist&quot;</span>, -name=&gt;<span class="stringliteral">&quot;courselist&quot;</span>),
          CGI::p($selectAll, $selectNone);
    print $self-&gt;hidden_authen_fields;
    print $self-&gt;hidden_fields(<span class="stringliteral">&quot;subDisplay&quot;</span>);
    
        <span class="keywordflow">foreach</span> my $courseID ( @courseIDs) {
            next <span class="keywordflow">if</span> $courseID eq <span class="stringliteral">&quot;admin&quot;</span>; # done already above
            next <span class="keywordflow">if</span> $courseID eq <span class="stringliteral">&quot;modelCourse&quot;</span>; # modelCourse isn<span class="stringliteral">&#39;t a real course so don&#39;</span>t create missing directories, etc
            next unless $courseID =~/\S/;  # skip empty courseIDs (there shouldn<span class="stringliteral">&#39;t be any</span>
<span class="stringliteral">            my $urlpath = $r-&gt;urlpath-&gt;newFromModule(&quot;WeBWorK::ContentGenerator::ProblemSets&quot;, $r, courseID =&gt; $courseID);</span>
<span class="stringliteral">            my $tempCE;</span>
<span class="stringliteral">            eval{ $tempCE = new WeBWorK::CourseEnvironment({</span>
<span class="stringliteral">                %WeBWorK::SeedCE,</span>
<span class="stringliteral">                courseName =&gt; $courseID,</span>
<span class="stringliteral">            })};</span>
<span class="stringliteral">            print &quot;Can&#39;</span>t create course environment <span class="keywordflow">for</span> $courseID because $<span class="stringliteral">@&quot; if $@;</span>
<span class="stringliteral">            my $CIchecker = new WeBWorK::Utils::CourseIntegrityCheck(ce=&gt;$tempCE);</span>
<span class="stringliteral">            $CIchecker-&gt;updateCourseDirectories();  #creates missing html_temp, mailmerge tmpEditFileDir directories;</span>
<span class="stringliteral">            my ($tables_ok,$dbStatus)   = $CIchecker-&gt;checkCourseTables($courseID);</span>
<span class="stringliteral">            my ($directories_ok, $str2) = $CIchecker-&gt;checkCourseDirectories();</span>
<span class="stringliteral">            my $checked = ($tables_ok &amp;&amp; $directories_ok)?0:1;   # don&#39;t check if everything is ok</span>
<span class="stringliteral">            my $checkbox_spot = &quot;&quot;;</span>
<span class="stringliteral">            if ($checked) {  # only show checkbox if the course is not up-to-date</span>
<span class="stringliteral">                $checkbox_spot = CGI::checkbox({name=&gt;&quot;</span>upgrade_courseIDs<span class="stringliteral">&quot;, label=&gt;&#39;upgrade&#39;, selected=&gt;$checked,value=&gt;$courseID});</span>
<span class="stringliteral">            }</span>
<span class="stringliteral">            print CGI::li(</span>
<span class="stringliteral">                $checkbox_spot,&quot;</span>&amp;<a class="code" href="classWeBWorK_1_1ContentGenerator.html#a0b04a9c84777c525b5d1a7683331f7ee">nbsp</a>;<span class="stringliteral">&quot;,</span>
<span class="stringliteral">                CGI::a({href=&gt;$self-&gt;systemLink($urlpath, authen =&gt; 0)}, $courseID),</span>
<span class="stringliteral">                CGI::code(</span>
<span class="stringliteral">                    $tempCE-&gt;{dbLayoutName},</span>
<span class="stringliteral">                ),</span>
<span class="stringliteral">                $directories_ok ? &quot;</span><span class="stringliteral">&quot; : CGI::span({style=&gt;&quot;</span>color:red<span class="stringliteral">&quot;},&quot;</span>Directory structure or permissions need to be repaired. <span class="stringliteral">&quot;),</span>
<span class="stringliteral">                $tables_ok ? CGI::span({style=&gt;&quot;</span>color:green<span class="stringliteral">&quot;},&quot;</span>Database tables ok<span class="stringliteral">&quot;) : CGI::span({style=&gt;&quot;</span>color:red<span class="stringliteral">&quot;},&quot;</span>Database tables need updating.<span class="stringliteral">&quot;),</span>
<span class="stringliteral">            </span>
<span class="stringliteral">            );</span>
<span class="stringliteral">             </span>
<span class="stringliteral">        }</span>
<span class="stringliteral">        </span>
<span class="stringliteral"></span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print CGI::p({style=&gt;&quot;</span>text-align: center<span class="stringliteral">&quot;}, CGI::submit(-name=&gt;&quot;</span>upgrade_course<span class="stringliteral">&quot;, -value=&gt;&quot;</span>Upgrade Courses<span class="stringliteral">&quot;));</span>
<span class="stringliteral">    </span>
<span class="stringliteral">    print CGI::end_form();</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a77dd4cee8c0adf3701ae36bd7115a6fb"></a><!-- doxytag: member="WeBWorK::ContentGenerator::CourseAdmin::upgrade_course_validate" ref="a77dd4cee8c0adf3701ae36bd7115a6fb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::CourseAdmin::upgrade_course_validate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-upgrade_course_validate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-upgrade_course_validate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-upgrade_course_validate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-upgrade_course_validate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in upgrade_course_validate: 21</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1CourseAdmin.html#a77dd4cee8c0adf3701ae36bd7115a6fb">upgrade_course_validate</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
<span class="preprocessor">    #my $db = $r-&gt;db;</span>
<span class="preprocessor"></span><span class="preprocessor">    #my $authz = $r-&gt;authz;</span>
<span class="preprocessor"></span>    my $urlpath = $r-&gt;urlpath;
    
    my @upgrade_courseIDs     = $r-&gt;param(<span class="stringliteral">&quot;upgrade_courseIDs&quot;</span>) ; 
    @upgrade_courseIDs        = () unless  @upgrade_courseIDs;
<span class="preprocessor">    #warn &quot;validate: upgrade ids &quot;, join(&quot;|&quot;,@upgrade_courseIDs);</span>
<span class="preprocessor"></span>    my @errors;
    <span class="keywordflow">foreach</span> my $upgrade_courseID (@upgrade_courseIDs) {
        <span class="keywordflow">if</span> ($upgrade_courseID eq <span class="stringliteral">&quot;&quot;</span>) {
            push @errors, <span class="stringliteral">&quot;You must specify a course name.&quot;</span>;
        } 
    }
    
    
    <span class="keywordflow">return</span> @errors;
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="CourseAdmin_8pm_source.html">CourseAdmin.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:57:15 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
