<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::ContentGenerator::Instructor::StudentProgress Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator.html">ContentGenerator</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html">Instructor</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html">StudentProgress</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::ContentGenerator::Instructor::StudentProgress Class Reference</h1><!-- doxytag: class="WeBWorK::ContentGenerator::Instructor::StudentProgress" --><!-- doxytag: inherits="WeBWorK::ContentGenerator::Instructor" --><div class="dynheader">
Inheritance diagram for WeBWorK::ContentGenerator::Instructor::StudentProgress:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress__inherit__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress_inherit__map" id="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress_inherit__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html" title="WeBWorK::ContentGenerator::Instructor" alt="" coords="57,155,313,181"/><area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="89,80,281,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="144,5,227,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::ContentGenerator::Instructor::StudentProgress:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress__coll__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress_coll__map" id="WeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress_coll__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator_1_1Instructor.html" title="WeBWorK::ContentGenerator::Instructor" alt="" coords="57,155,313,181"/><area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="89,80,281,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="144,5,227,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#ace828f252bb2b6d4862159b52324b501">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a7d744206e973755acaeeafa83e093282">siblings</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#ae00c2179c8fd93fb6202355e5c773e89">body</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a29949112e170351c359a6cb025c3db4f">displaySets</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a6b7f922cb427161e198fce5d4157d153">grade_set</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#ad10018c7b9def54c0c3791748c67cef6">threeSpaceFill</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a64c65369f514910bb9125a2bdc841cce">round_score</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#aa181e99303ad7e91ad205e1b42c682df">title</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html">WeBWorK::ContentGenerator::Instructor::StudentProgress</a> - Display Student Progress. </p>

<p>Definition at line <a class="el" href="StudentProgress_8pm_source.html#l00021">21</a> of file <a class="el" href="StudentProgress_8pm_source.html">StudentProgress.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ae00c2179c8fd93fb6202355e5c773e89"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::StudentProgress::body" ref="ae00c2179c8fd93fb6202355e5c773e89" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::StudentProgress::body </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-body' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-body-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-body-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-body-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in body: 50</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#ae00c2179c8fd93fb6202355e5c773e89">body</a> {
    my $self       = shift;
    my $r          = $self-&gt;r;
    my $urlpath    = $r-&gt;urlpath;
    my $db         = $r-&gt;db;
    my $ce         = $r-&gt;ce;
    my $authz      = $r-&gt;authz;
    my $user       = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $type       = $self-&gt;{type};

<span class="preprocessor">    # Check permissions </span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> CGI::div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;ResultsWithError&quot;</span>}. CGI::p(<span class="stringliteral">&quot;You are not authorized to access instructor tools&quot;</span>))
        unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
        
    <span class="keywordflow">if</span> ($type eq <span class="stringliteral">&#39;student&#39;</span>) {
        my $studentName = $self-&gt;{studentName};
        my $studentRecord = $db-&gt;getUser($studentName) # checked
            or die <span class="stringliteral">&quot;record for user $studentName not found&quot;</span>;
        my $fullName = $studentRecord-&gt;full_name;
        my $courseHomePage = $urlpath-&gt;new(type  =&gt; <span class="stringliteral">&#39;set_list&#39;</span>,
            args =&gt; {courseID=&gt;$courseName});
        my $email = $studentRecord-&gt;email_address;
        
        print CGI::a({-href=&gt;<span class="stringliteral">&quot;mailto:$email&quot;</span>}, $email), CGI::br(),
            <span class="stringliteral">&quot;Section: &quot;</span>, $studentRecord-&gt;section, CGI::br(),
            <span class="stringliteral">&quot;Recitation: &quot;</span>, $studentRecord-&gt;recitation, CGI::br();
        
        <span class="keywordflow">if</span> ($authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;become_student&quot;</span>)) {
            my $act_as_student_url = $self-&gt;systemLink($courseHomePage,
                params =&gt; {effectiveUser=&gt;$studentName});
            
            print <span class="stringliteral">&#39;Act as: &#39;</span>, CGI::a({-href=&gt;$act_as_student_url},$studentRecord-&gt;user_id);
        }
        
        print <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Grades.html#ae4abb37ae251c756b26b293643982811">WeBWorK::ContentGenerator::Grades::displayStudentStats</a>($self,$studentName);
    } elsif( $type eq <span class="stringliteral">&#39;set&#39;</span>) {
        $self-&gt;displaySets($self-&gt;{setName});
    } elsif ($type eq <span class="stringliteral">&#39;&#39;</span>) {
        
        $self-&gt;index;
    } <span class="keywordflow">else</span> {
        warn <span class="stringliteral">&quot;Don&#39;t recognize statistics display type: |$type|&quot;</span>;

    }
    

    <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;

}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a29949112e170351c359a6cb025c3db4f"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::StudentProgress::displaySets" ref="a29949112e170351c359a6cb025c3db4f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::StudentProgress::displaySets </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-displaySets' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-displaySets-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-displaySets-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-displaySets-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in displaySets: 744</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a29949112e170351c359a6cb025c3db4f">displaySets</a> {
    my $self             = shift;   
    my $r                = $self-&gt;r;
    my $urlpath          = $r-&gt;urlpath;
    my $db               = $r-&gt;db;
    my $ce               = $r-&gt;ce;
    my $authz            = $r-&gt;authz;
    my $courseName       = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $setName          = $urlpath-&gt;arg(<span class="stringliteral">&quot;setID&quot;</span>);
    my $user             = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $GlobalSet        = $self-&gt;{setRecord};
    my $root             = $ce-&gt;{webworkURLs}-&gt;{root};
    
    my $setStatsPage     = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, courseID=&gt;$courseName,statType=&gt;<span class="stringliteral">&#39;sets&#39;</span>,setID=&gt;$setName);
    my $primary_sort_method_name = $r-&gt;param(<span class="stringliteral">&#39;primary_sort&#39;</span>);
    my $secondary_sort_method_name = $r-&gt;param(<span class="stringliteral">&#39;secondary_sort&#39;</span>); 
    my $ternary_sort_method_name = $r-&gt;param(<span class="stringliteral">&#39;ternary_sort&#39;</span>);  

<span class="preprocessor">    # DBFIXME duplicate call!</span>
<span class="preprocessor"></span>    my @studentList      = $db-&gt;listUsers;
    
<span class="preprocessor"># another versioning/gateway change.  in many cases we don&#39;t want or need</span>
<span class="preprocessor"></span><span class="preprocessor"># all of the columns that are put in here by default, so we add a set of</span>
<span class="preprocessor"></span><span class="preprocessor"># flags for which columns to show.  for versioned sets we may also want to</span>
<span class="preprocessor"></span><span class="preprocessor"># only see the best score, so we include that as an option also.</span>
<span class="preprocessor"></span><span class="preprocessor"># these are ignored for non-versioned sets</span>
<span class="preprocessor"></span>    my %showColumns = ( <span class="stringliteral">&#39;name&#39;</span> =&gt; 1, <span class="stringliteral">&#39;score&#39;</span> =&gt; 1, <span class="stringliteral">&#39;outof&#39;</span> =&gt; 1, 
                <span class="stringliteral">&#39;date&#39;</span> =&gt; 0, <span class="stringliteral">&#39;testtime&#39;</span> =&gt; 0, <span class="stringliteral">&#39;index&#39;</span> =&gt; 1, 
                <span class="stringliteral">&#39;problems&#39;</span> =&gt; 1, <span class="stringliteral">&#39;section&#39;</span> =&gt; 1, <span class="stringliteral">&#39;recit&#39;</span> =&gt; 1, 
                <span class="stringliteral">&#39;login&#39;</span> =&gt; 1 );
    my $showBestOnly = 0;

    my @index_list                           = ();  # list of all student <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a> 
    my @score_list                           = ();  # list of all student total percentage scores 
    my %attempts_list_for_problem            = ();  # a list of the number of attempts <span class="keywordflow">for each</span> problem
    my %number_of_attempts_for_problem       = ();  # the total number of attempst <span class="keywordflow">for</span> <span class="keyword">this</span> problem (sum of above list)
    my %number_of_students_attempting_problem = ();  # the number of students attempting <span class="keyword">this</span> problem.
    my %correct_answers_for_problem          = ();  # the number of students correctly answering <span class="keyword">this</span> problem (partial correctness allowed)
    my $sort_method = sub {
        my ($a,$b,$sort_method_name) = @_;
        <span class="keywordflow">return</span> 0 unless defined($sort_method_name);
        <span class="keywordflow">return</span> lc($a-&gt;{last_name}) cmp lc($b-&gt;{last_name}) <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;last_name&#39;</span>;
        <span class="keywordflow">return</span> lc($a-&gt;{first_name}) cmp lc($b-&gt;{first_name}) <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;first_name&#39;</span>;
        <span class="keywordflow">return</span>  lc($a-&gt;{email_address}) cmp lc($b-&gt;{email_address}) <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;email_address&#39;</span>;
        <span class="keywordflow">return</span> $b-&gt;{score} &lt;=&gt; $a-&gt;{score} <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;score&#39;</span>;
        <span class="keywordflow">return</span> $b-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a>} &lt;=&gt; $a-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a>} <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;index&#39;</span>;
        <span class="keywordflow">return</span> lc($a-&gt;{section}) cmp lc($b-&gt;{section}) <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;section&#39;</span>;
        <span class="keywordflow">return</span> lc($a-&gt;{recitation}) cmp lc($b-&gt;{recitation}) <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;recitation&#39;</span>;
        <span class="keywordflow">return</span> lc($a-&gt;{user_id}) cmp lc($b-&gt;{user_id}) <span class="keywordflow">if</span> $sort_method_name eq <span class="stringliteral">&#39;user_id&#39;</span>;
        <span class="keywordflow">if</span> ($sort_method_name =~/p(\d+)/) {
            my $left  =  $b-&gt;{problemData}-&gt;{$1} ||0;
            my $right =  $a-&gt;{problemData}-&gt;{$1} ||0;
            <span class="keywordflow">return</span> $left &lt;=&gt; $right;  # sort by number of attempts.
        }

    };
    my %display_sort_method_name = (
        last_name =&gt; <span class="stringliteral">&#39;last name&#39;</span>,
        first_name =&gt; <span class="stringliteral">&#39;first name&#39;</span>,
        email_address =&gt; <span class="stringliteral">&#39;email address&#39;</span>,
        score =&gt; <span class="stringliteral">&#39;score&#39;</span>,
        <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a> =&gt; <span class="stringliteral">&#39;success indicator&#39;</span>,
        section =&gt; <span class="stringliteral">&#39;section&#39;</span>,
        recitation =&gt; <span class="stringliteral">&#39;recitation&#39;</span>,
        user_id =&gt; <span class="stringliteral">&#39;login name&#39;</span>,
    );              

<span class="preprocessor"># get versioning information</span>
<span class="preprocessor"></span>    my $setIsVersioned = 
        ( defined($GlobalSet-&gt;assignment_type()) &amp;&amp; 
          $GlobalSet-&gt;assignment_type() =~ /gateway/ ) ? 1 : 0;

<span class="preprocessor"># reset column view options based on whether the set is versioned and, if so,</span>
<span class="preprocessor"></span><span class="preprocessor"># the input parameters</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( $setIsVersioned ) {
<span class="preprocessor">  # the returning parameter lets us set defaults for versioned sets</span>
<span class="preprocessor"></span>        my $ret = defined($r-&gt;param(<span class="stringliteral">&#39;returning&#39;</span>)) ? 
            $r-&gt;param(<span class="stringliteral">&#39;returning&#39;</span>) : 0;
        $showColumns{<span class="stringliteral">&#39;date&#39;</span>} = ($ret &amp;&amp; defined($r-&gt;param(<span class="stringliteral">&#39;show_date&#39;</span>))) ? $r-&gt;param(<span class="stringliteral">&#39;show_date&#39;</span>) : 1;
        $showColumns{<span class="stringliteral">&#39;testtime&#39;</span>} = ($ret &amp;&amp; defined($r-&gt;param(<span class="stringliteral">&#39;show_testtime&#39;</span>))) ? $r-&gt;param(<span class="stringliteral">&#39;show_testtime&#39;</span>):1;
        $showColumns{<span class="stringliteral">&#39;index&#39;</span>} = ($ret &amp;&amp; defined($r-&gt;param(<span class="stringliteral">&#39;show_index&#39;</span>))) ? $r-&gt;param(<span class="stringliteral">&#39;show_index&#39;</span>) : 0;
        $showColumns{<span class="stringliteral">&#39;problems&#39;</span>} = ($ret &amp;&amp; defined($r-&gt;param(<span class="stringliteral">&#39;show_problems&#39;</span>))) ? $r-&gt;param(<span class="stringliteral">&#39;show_problems&#39;</span>):0;
        $showColumns{<span class="stringliteral">&#39;section&#39;</span>} = ($ret &amp;&amp; defined($r-&gt;param(<span class="stringliteral">&#39;show_section&#39;</span>))) ? $r-&gt;param(<span class="stringliteral">&#39;show_section&#39;</span>) : 0;
        $showColumns{<span class="stringliteral">&#39;recit&#39;</span>} = ($ret &amp;&amp; defined($r-&gt;param(<span class="stringliteral">&#39;show_recitation&#39;</span>))) ? $r-&gt;param(<span class="stringliteral">&#39;show_recitation&#39;</span>) : 0;
        $showColumns{<span class="stringliteral">&#39;login&#39;</span>} = ($ret &amp;&amp; defined($r-&gt;param(<span class="stringliteral">&#39;show_login&#39;</span>))) ? $r-&gt;param(<span class="stringliteral">&#39;show_login&#39;</span>) : 0;
        $showBestOnly = ($ret &amp;&amp; defined($r-&gt;param(<span class="stringliteral">&#39;show_best_only&#39;</span>))) ? $r-&gt;param(<span class="stringliteral">&#39;show_best_only&#39;</span>) : 0;
    }

<span class="preprocessor">###############################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#  Print tables</span>
<span class="preprocessor"></span><span class="preprocessor">###############################################################</span>
<span class="preprocessor"></span>    
    my $max_num_problems  = 0;
<span class="preprocessor">    # get user records</span>
<span class="preprocessor"></span>    debug(<span class="stringliteral">&quot;Begin obtaining user records for set $setName&quot;</span>);
    my @userRecords  = $db-&gt;getUsers(@studentList);
    debug(<span class="stringliteral">&quot;End obtaining user records for set $setName&quot;</span>);
    debug(<span class="stringliteral">&quot;begin main loop&quot;</span>);
    my @augmentedUserRecords    = ();
    my $number_of_active_students;

<span class="preprocessor">## Edit to filter out students</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span>    my @myUsers;
    my $ActiveUser = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    my (@viewable_sections, @viewable_recitations);
    <span class="keywordflow">if</span> (defined @{$ce-&gt;{viewable_sections}-&gt;{$user}})
        {@viewable_sections = @{$ce-&gt;{viewable_sections}-&gt;{$user}};}
    <span class="keywordflow">if</span> (defined @{$ce-&gt;{viewable_recitations}-&gt;{$user}})
        {@viewable_recitations = @{$ce-&gt;{viewable_recitations}-&gt;{$user}};}
    <span class="keywordflow">if</span> (@viewable_sections or @viewable_recitations){
        <span class="keywordflow">foreach</span> my $student (@userRecords){
            my $keep = 0;
            <span class="keywordflow">foreach</span> my $sec (@viewable_sections){
                <span class="keywordflow">if</span> ($student-&gt;section() eq $sec){$keep = 1; last;}
            }
            <span class="keywordflow">foreach</span> my $rec (@viewable_recitations){
                <span class="keywordflow">if</span> ($student-&gt;recitation() eq $rec){$keep = 1; last;}
            }
            <span class="keywordflow">if</span> ($keep) {push @myUsers, $student;}       
        }
    }
    <span class="keywordflow">else</span> {@myUsers = @userRecords;}
    <span class="keywordflow">foreach</span> my $studentRecord (@myUsers)   {
        next unless ref($studentRecord);
        my $studentName = $studentRecord-&gt;user_id;
        next <span class="keywordflow">if</span> $studentRecord-&gt;last_name =~/^practice/i;  # don<span class="stringliteral">&#39;t show practice users</span>
<span class="stringliteral">        next unless $ce-&gt;status_abbrev_has_behavior($studentRecord-&gt;status, &quot;include_in_stats&quot;);</span>
<span class="stringliteral">        $number_of_active_students++;</span>
<span class="stringliteral"></span>
<span class="stringliteral"># build list of versioned sets for this student user</span>
<span class="stringliteral">#       my @allSetNames = ();</span>
<span class="stringliteral">#       my $notAssignedSet = 0;</span>
<span class="stringliteral">#       if ( $setIsVersioned ) {</span>
<span class="stringliteral">#           my @setVersions = $db-&gt;listSetVersions($studentName, $setName);</span>
<span class="stringliteral">#           @allSetNames = map { &quot;$setName,v$_&quot; } @setVersions;</span>
<span class="stringliteral">#           # if there aren&#39;</span>t any <span class="keyword">set</span> versions, is it because
<span class="preprocessor">#           #    the user isn&#39;t assigned the set (e.g., is a </span>
<span class="preprocessor"></span><span class="preprocessor">#           #    proctor), or because the user hasn&#39;t completed</span>
<span class="preprocessor"></span><span class="preprocessor">#           #    any versions?</span>
<span class="preprocessor"></span><span class="preprocessor">#           if ( ! @setVersions ) {</span>
<span class="preprocessor"></span><span class="preprocessor">#               $notAssignedSet = 1 if (! $db-&gt;existsUserSet($studentName,$setName));</span>
<span class="preprocessor"></span><span class="preprocessor">#           }</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor">#       } else {</span>
<span class="preprocessor"></span><span class="preprocessor">#           @allSetNames = ( &quot;$setName&quot; );</span>
<span class="preprocessor"></span><span class="preprocessor">#       }</span>
<span class="preprocessor"></span>        my( $ra_allSetVersionNames, $notAssignedSet) = list_set_versions($db, $studentName, $setName, $setIsVersioned);
        my @allSetVersionNames = @{$ra_allSetVersionNames};
        
<span class="preprocessor">        # for versioned sets, we might be keeping only the high score</span>
<span class="preprocessor"></span>        my $maxScore = -1;
        my $max_hash = {};

        <span class="keywordflow">foreach</span> my $setName ( @allSetVersionNames ) {

            my $status          = 0;
            my $longStatus      = <span class="stringliteral">&#39;&#39;</span>;
            my $string          = <span class="stringliteral">&#39;&#39;</span>;
            my $twoString       = <span class="stringliteral">&#39;&#39;</span>;
            my $totalRight      = 0;
            my $total           = 0;
            my $total_num_of_attempts_for_set = 0;
            my %h_problemData   = ();
            my $num_of_attempts;
            my $num_of_problems;
            
            my $set;
            my $userSet;
            <span class="keywordflow">if</span> ( $setIsVersioned ) {
                my ($setN,$vNum) = ($setName =~ /(.+),v(\d+)$/);
<span class="preprocessor">                # we&#39;ll also need information from the set</span>
<span class="preprocessor"></span><span class="preprocessor">                #    as we set up the display below, so get</span>
<span class="preprocessor"></span><span class="preprocessor">                #    the merged userset as well</span>
<span class="preprocessor"></span>                $set = $db-&gt;getMergedSetVersion($studentRecord-&gt;user_id, $setN, $vNum);
                $userSet = $set;
                $setName = $setN;
            } <span class="keywordflow">else</span> {
                $set = $db-&gt;getMergedSet( $studentName, $setName );
            
            }
<span class="preprocessor">             #FIXME -- this seems like over kill -- perhaps we only need to pass in the set_id.</span>
<span class="preprocessor"></span><span class="preprocessor">             # that is the only aspect of $set that is used in grade set.</span>
<span class="preprocessor"></span><span class="preprocessor">             # the problem_random order sequence is used in the corresponding routine in Grades.pm</span>
<span class="preprocessor"></span>             
            unless ( ref($set) ) {
                $set = <span class="keyword">new</span> <a class="code" href="classWeBWorK_1_1DB_1_1Record_1_1UserSet.html">WeBWorK::DB::Record::UserSet</a>;
                $set-&gt;set_id($setName);
            }
            
           ( $status, 
             $longStatus, 
             $string,
             $twoString, 
             $totalRight,
             $total, 
             $num_of_attempts, 
             $num_of_problems) = <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a6b7f922cb427161e198fce5d4157d153">grade_set</a>( $db, $set, $setName, $studentName, $setIsVersioned,
                                        \%number_of_students_attempting_problem,
                                        \%attempts_list_for_problem,
                                        \%number_of_attempts_for_problem,
                                        \%h_problemData,
                                        \$total_num_of_attempts_for_set,
                                        \%correct_answers_for_problem,
                               );
            my $probNum         = 0;
            my $act_as_student_url = <span class="stringliteral">&#39;&#39;</span>;


<span class="preprocessor">#       </span>
<span class="preprocessor"></span><span class="preprocessor">#           # add on the scores for this problem</span>
<span class="preprocessor"></span><span class="preprocessor">#           if (defined($attempted) and $attempted) {</span>
<span class="preprocessor"></span><span class="preprocessor">#               $number_of_students_attempting_problem{$probID}++;</span>
<span class="preprocessor"></span><span class="preprocessor">#               push( @{ $attempts_list_for_problem{$probID} } ,     $num_of_attempts);</span>
<span class="preprocessor"></span><span class="preprocessor">#               $number_of_attempts_for_problem{$probID}             += $num_of_attempts;</span>
<span class="preprocessor"></span><span class="preprocessor">#               $h_problemData{$probID}                               = $num_incorrect;</span>
<span class="preprocessor"></span><span class="preprocessor">#               $total_num_of_attempts_for_set                       += $num_of_attempts;</span>
<span class="preprocessor"></span><span class="preprocessor">#               $correct_answers_for_problem{$probID}                += $status;</span>
<span class="preprocessor"></span><span class="preprocessor">#           }</span>
<span class="preprocessor"></span>
<span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor">#           # DBFIXME: to collect the problem records, we have </span>
<span class="preprocessor"></span><span class="preprocessor">#           #    to know which merge routines to call.  Should </span>
<span class="preprocessor"></span><span class="preprocessor">#           #    this really be an issue here?  That is, </span>
<span class="preprocessor"></span><span class="preprocessor">#           #    shouldn&#39;t the database deal with it invisibly </span>
<span class="preprocessor"></span><span class="preprocessor">#           #    by detecting what the problem types are?</span>
<span class="preprocessor"></span><span class="preprocessor">#           # DBFIXME sort in database</span>
<span class="preprocessor"></span><span class="preprocessor">#           my $userSet;</span>
<span class="preprocessor"></span><span class="preprocessor">#           my @problemRecords = ();</span>
<span class="preprocessor"></span><span class="preprocessor">#           if ( $setIsVersioned ) {</span>
<span class="preprocessor"></span><span class="preprocessor">#               my ($setN,$vNum) = ($sN =~ /(.+),v(\d+)$/);</span>
<span class="preprocessor"></span><span class="preprocessor">#               @problemRecords = sort {$a-&gt;problem_id &lt;=&gt; $b-&gt;problem_id } $db-&gt;getAllMergedProblemVersions( $student, $setN, $vNum );</span>
<span class="preprocessor"></span><span class="preprocessor">#               # we&#39;ll also need information from the set</span>
<span class="preprocessor"></span><span class="preprocessor">#               #    as we set up the display below, so get</span>
<span class="preprocessor"></span><span class="preprocessor">#               #    the merged userset as well</span>
<span class="preprocessor"></span><span class="preprocessor">#               $userSet = $db-&gt;getMergedSetVersion($studentRecord-&gt;user_id, $setN, $vNum);</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor">#           } else {</span>
<span class="preprocessor"></span><span class="preprocessor">#               @problemRecords = sort {$a-&gt;problem_id &lt;=&gt; $b-&gt;problem_id} $db-&gt;getAllMergedUserProblems( $student, $sN );</span>
<span class="preprocessor"></span><span class="preprocessor">#           }</span>
<span class="preprocessor"></span><span class="preprocessor">#           debug(&quot;End obtaining problem records for user $student set $sN&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">#           my $num_of_problems = @problemRecords;</span>
<span class="preprocessor"></span><span class="preprocessor">#           $max_num_problems = ($max_num_problems&gt;= $num_of_problems) ? $max_num_problems : $num_of_problems;</span>
<span class="preprocessor"></span><span class="preprocessor">#           ########################################</span>
<span class="preprocessor"></span><span class="preprocessor">#           # Notes for factoring the calculation in this loop.</span>
<span class="preprocessor"></span><span class="preprocessor">#           #</span>
<span class="preprocessor"></span><span class="preprocessor">#           # Inputs include:</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   @problemRecords  </span>
<span class="preprocessor"></span><span class="preprocessor">#           # returns</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $num_of_attempts</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $status</span>
<span class="preprocessor"></span><span class="preprocessor">#           # updates</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $number_of_students_attempting_problem{$probID}++;</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   @{ $attempts_list_for_problem{$probID} }   </span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $number_of_attempts_for_problem{$probID}</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $total_num_of_attempts_for_set</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $correct_answers_for_problem{$probID}   </span>
<span class="preprocessor"></span><span class="preprocessor">#           #    </span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $string (formatting output)</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $twoString (more formatted output)</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $longtwo (a combination of $string and $twostring)</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $total</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $totalRight</span>
<span class="preprocessor"></span><span class="preprocessor">#           ###################################</span>
<span class="preprocessor"></span><span class="preprocessor">#    </span>
<span class="preprocessor"></span><span class="preprocessor">#           foreach my $problemRecord (@problemRecords) {</span>
<span class="preprocessor"></span><span class="preprocessor">#               next unless ref($problemRecord);</span>
<span class="preprocessor"></span><span class="preprocessor">#               # warn &quot;Can&#39;t find record for problem $prob in set $setName for $student&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">#               # FIXME check the legitimate reasons why a student record might not be defined</span>
<span class="preprocessor"></span><span class="preprocessor">#               ###########################################</span>
<span class="preprocessor"></span><span class="preprocessor">#               # Grab data from the database</span>
<span class="preprocessor"></span><span class="preprocessor">#               ###########################################</span>
<span class="preprocessor"></span><span class="preprocessor">#               # It&#39;s possible that </span>
<span class="preprocessor"></span><span class="preprocessor">#               # $problemRecord-&gt;num_correct or </span>
<span class="preprocessor"></span><span class="preprocessor">#               # $problemRecord-&gt;num_correct</span>
<span class="preprocessor"></span><span class="preprocessor">#               # or $problemRecord-&gt;status is an empty </span>
<span class="preprocessor"></span><span class="preprocessor">#               # or blank string instead of 0.  </span>
<span class="preprocessor"></span><span class="preprocessor">#               # The || clause fixes this and prevents </span>
<span class="preprocessor"></span><span class="preprocessor">#               # warning messages in the comparisons below.</span>
<span class="preprocessor"></span><span class="preprocessor">#           </span>
<span class="preprocessor"></span><span class="preprocessor">#               my $probID          = $problemRecord-&gt;problem_id;</span>
<span class="preprocessor"></span><span class="preprocessor">#               my $attempted       = $problemRecord-&gt;attempted;</span>
<span class="preprocessor"></span><span class="preprocessor">#               my $num_correct     = $problemRecord-&gt;num_correct     || 0;</span>
<span class="preprocessor"></span><span class="preprocessor">#               my $num_incorrect   = $problemRecord-&gt;num_incorrect   || 0;</span>
<span class="preprocessor"></span><span class="preprocessor">#               my $num_of_attempts = $num_correct + $num_incorrect;</span>
<span class="preprocessor"></span><span class="preprocessor">#               # initialize the number of correct answers </span>
<span class="preprocessor"></span><span class="preprocessor">#               # for this problem if the value has not been </span>
<span class="preprocessor"></span><span class="preprocessor">#               # defined.</span>
<span class="preprocessor"></span><span class="preprocessor">#               $correct_answers_for_problem{$probID} = 0 </span>
<span class="preprocessor"></span><span class="preprocessor">#                   unless defined($correct_answers_for_problem{$probID});</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor">#               ## This doesn&#39;t work - Fix it</span>
<span class="preprocessor"></span><span class="preprocessor">#               my $probValue = $problemRecord-&gt;value;</span>
<span class="preprocessor"></span><span class="preprocessor">#               # set default problem value here</span>
<span class="preprocessor"></span><span class="preprocessor">#               # FIXME?? set defaults here?</span>
<span class="preprocessor"></span><span class="preprocessor">#               $probValue = 1 unless defined($probValue) and </span>
<span class="preprocessor"></span><span class="preprocessor">#                   $probValue ne &quot;&quot;;  </span>
<span class="preprocessor"></span><span class="preprocessor">#           </span>
<span class="preprocessor"></span><span class="preprocessor">#               my $status  = $problemRecord-&gt;status || 0;</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor">#               # sanity check that the status (score) is </span>
<span class="preprocessor"></span><span class="preprocessor">#               # between 0 and 1</span>
<span class="preprocessor"></span><span class="preprocessor">#               my $valid_status = ($status&gt;=0 &amp;&amp; $status&lt;=1)?1:0;</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor">#               ###########################################</span>
<span class="preprocessor"></span><span class="preprocessor">#               # Determine the string $longStatus which </span>
<span class="preprocessor"></span><span class="preprocessor">#               # will display the student&#39;s current score</span>
<span class="preprocessor"></span><span class="preprocessor">#               ###########################################</span>
<span class="preprocessor"></span><span class="preprocessor">#               my $longStatus = &#39;&#39;;</span>
<span class="preprocessor"></span><span class="preprocessor">#               if (!$attempted){</span>
<span class="preprocessor"></span><span class="preprocessor">#                   $longStatus     = &#39;.&#39;;</span>
<span class="preprocessor"></span><span class="preprocessor">#               } elsif   ($valid_status) {</span>
<span class="preprocessor"></span><span class="preprocessor">#                   $longStatus     = int(100*$status+.5);</span>
<span class="preprocessor"></span><span class="preprocessor">#                   $longStatus=&#39;C&#39; if ($longStatus==100);</span>
<span class="preprocessor"></span><span class="preprocessor">#               } else  {</span>
<span class="preprocessor"></span><span class="preprocessor">#                   $longStatus     = &#39;X&#39;;</span>
<span class="preprocessor"></span><span class="preprocessor">#               }</span>
<span class="preprocessor"></span><span class="preprocessor">#           </span>
<span class="preprocessor"></span><span class="preprocessor">#               $string     .= threeSpaceFill($longStatus);</span>
<span class="preprocessor"></span><span class="preprocessor">#               $twoString  .= threeSpaceFill($num_incorrect);</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor">#               $total      += $probValue;</span>
<span class="preprocessor"></span><span class="preprocessor">#               $totalRight += round_score($status*$probValue) </span>
<span class="preprocessor"></span><span class="preprocessor">#                   if $valid_status;</span>
<span class="preprocessor"></span><span class="preprocessor">#           </span>
<span class="preprocessor"></span><span class="preprocessor">#               # add on the scores for this problem</span>
<span class="preprocessor"></span><span class="preprocessor">#               if (defined($attempted) and $attempted) {</span>
<span class="preprocessor"></span><span class="preprocessor">#                   $number_of_students_attempting_problem{$probID}++;</span>
<span class="preprocessor"></span><span class="preprocessor">#                   push( @{ $attempts_list_for_problem{$probID} } ,     $num_of_attempts);</span>
<span class="preprocessor"></span><span class="preprocessor">#                   $number_of_attempts_for_problem{$probID}             += $num_of_attempts;</span>
<span class="preprocessor"></span><span class="preprocessor">#                   $h_problemData{$probID}                               = $num_incorrect;</span>
<span class="preprocessor"></span><span class="preprocessor">#                   $total_num_of_attempts_for_set                       += $num_of_attempts;</span>
<span class="preprocessor"></span><span class="preprocessor">#                   $correct_answers_for_problem{$probID}                += $status;</span>
<span class="preprocessor"></span><span class="preprocessor">#               }</span>
<span class="preprocessor"></span><span class="preprocessor">#           </span>
<span class="preprocessor"></span><span class="preprocessor">#           }  # end of problem record loop</span>
<span class="preprocessor"></span>            
            
<span class="preprocessor">            # for versioned tests we might be displaying the </span>
<span class="preprocessor"></span><span class="preprocessor">            # test date and test time</span>
<span class="preprocessor"></span>            my $dateOfTest = <span class="stringliteral">&#39;&#39;</span>;
            my $testTime = <span class="stringliteral">&#39;&#39;</span>;
            <span class="keywordflow">if</span> ( $setIsVersioned ) {
<span class="preprocessor">                # if this isn&#39;t defined, something&#39;s wrong</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> ( defined($userSet) ) {  
                    $dateOfTest = localtime($userSet-&gt;version_creation_time());
                    <span class="keywordflow">if</span> ( defined($userSet-&gt;version_last_attempt_time()) &amp;&amp; $userSet-&gt;version_last_attempt_time() ) {
                        $testTime = ($userSet-&gt;version_last_attempt_time() - $userSet-&gt;open_date() ) / 60; 
                        my $timeLimit = $userSet-&gt;version_time_limit()/60;
                        $testTime = $timeLimit <span class="keywordflow">if</span> ( $testTime &gt; $timeLimit );
                        $testTime = sprintf(<span class="stringliteral">&quot;%3.1f min&quot;</span>, $testTime);
                    } elsif ( time() - $userSet-&gt;open_date() &lt; $userSet-&gt;version_time_limit() ) {
                        $testTime = <span class="stringliteral">&#39;still open&#39;</span>;
                    } <span class="keywordflow">else</span> {
                        $testTime = <span class="stringliteral">&#39;time limit &#39;</span> .
                            <span class="stringliteral">&#39;exceeded&#39;</span>;
                    }
                } <span class="keywordflow">else</span> {
                    $dateOfTest = <span class="stringliteral">&#39;???&#39;</span>;
                    $testTime = <span class="stringliteral">&#39;???&#39;</span>;
                }
            }
        
        
            $act_as_student_url = $self-&gt;systemLink($urlpath-&gt;new(type=&gt;<span class="stringliteral">&#39;set_list&#39;</span>,args=&gt;{courseID=&gt;$courseName}), params=&gt;{effectiveUser =&gt; $studentRecord-&gt;user_id});
            my $email              = $studentRecord-&gt;email_address;
<span class="preprocessor">            # FIXME  this needs formatting</span>
<span class="preprocessor"></span>
<span class="preprocessor">            # change to give better output for gateways with; </span>
<span class="preprocessor"></span><span class="preprocessor">            # only one attempt per version: just reports the </span>
<span class="preprocessor"></span><span class="preprocessor">            # result for each problem, not the number of attempts.</span>
<span class="preprocessor"></span>            my $longtwo = ($setIsVersioned &amp;&amp; 
                       $userSet-&gt;attempts_per_version == 1) ? 
                       $string : <span class="stringliteral">&quot;$string\n$twoString&quot;</span>;
        
            my $avg_num_attempts = ($num_of_problems) ? $total_num_of_attempts_for_set/$num_of_problems : 0;
            my $successIndicator = ($avg_num_attempts &amp;&amp; $total) ? ($totalRight/$total)**2/$avg_num_attempts : 0 ;
        
            my $temp_hash         = { user_id        =&gt; $studentRecord-&gt;user_id,
                                          last_name      =&gt; $studentRecord-&gt;last_name,
                                          first_name     =&gt; $studentRecord-&gt;first_name,
                                          score          =&gt; $totalRight,
                                          total          =&gt; $total,
                                          <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a>          =&gt; $successIndicator,
                                          section        =&gt; $studentRecord-&gt;section,
                                          recitation     =&gt; $studentRecord-&gt;recitation,
                                          problemString  =&gt; <span class="stringliteral">&quot;&lt;pre&gt;$longtwo&lt;/pre&gt;&quot;</span>,
                                          act_as_student =&gt; $act_as_student_url,
                                          email_address  =&gt; $studentRecord-&gt;email_address,
                                          problemData    =&gt; {%h_problemData},
                          date           =&gt; $dateOfTest,
                          testtime       =&gt; $testTime,
                          }; 
            
<span class="preprocessor">            # keep track of best score</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> ( $totalRight &gt; $maxScore ) {
                $maxScore = $totalRight;
                $max_hash = { %$temp_hash };
            }

<span class="preprocessor">            # if we&#39;re showing all records, add it in to the list</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> ( ! $showBestOnly ) {
<span class="preprocessor">                # add this data to the list of total scores (out of 100)</span>
<span class="preprocessor"></span><span class="preprocessor">                # add this data to the list of success indices.</span>
<span class="preprocessor"></span>                push( @index_list, $temp_hash-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a>});
                push( @score_list, ($temp_hash-&gt;{total}) ?$temp_hash-&gt;{score}/$temp_hash-&gt;{total} : 0 ) ;
                push( @augmentedUserRecords, $temp_hash );
            }

        } # <span class="keyword">this</span> closes the loop through all <span class="keyword">set</span> versions

<span class="preprocessor">        # if we&#39;re showing only the best score, add the best score now</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( $showBestOnly ) {
<span class="preprocessor">            # if there&#39;s no %$max_hash, then we had no results</span>
<span class="preprocessor"></span><span class="preprocessor">            #    this occurs for proctors, for example</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> ( $notAssignedSet ) {
                next;
            } elsif ( ! %$max_hash ) {
                $max_hash = { 
                    user_id =&gt; $studentRecord-&gt;user_id(),
                    last_name=&gt;$studentRecord-&gt;last_name(),
                    first_name=&gt;$studentRecord-&gt;first_name(),
                    score =&gt; 0,
                    total =&gt; <span class="stringliteral">&#39;n/a&#39;</span>,
                    <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a> =&gt; 0,
                    section =&gt; $studentRecord-&gt;section(),
                    recitation=&gt;$studentRecord-&gt;recitation(),
                    problemString =&gt; <span class="stringliteral">&#39;no attempt recorded&#39;</span>,
                    act_as_student =&gt; $self-&gt;systemLink($urlpath-&gt;new(type=&gt;<span class="stringliteral">&#39;set_list&#39;</span>,args=&gt;{courseID=&gt;$courseName}), params=&gt;{effectiveUser =&gt; $studentRecord-&gt;user_id}),
                    email_address =&gt; $studentRecord-&gt;email_address(),
                    problemData =&gt; {},
                    date =&gt; <span class="stringliteral">&#39;none&#39;</span>,
                    testtime =&gt; <span class="stringliteral">&#39;none&#39;</span>,
                };
            }

            push( @index_list, $max_hash-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a>} );
            push( @score_list, 
                  ($max_hash-&gt;{total} &amp;&amp; $max_hash-&gt;{total} ne <span class="stringliteral">&#39;n/a&#39;</span>) ? 
                  $max_hash-&gt;{score}/$max_hash-&gt;{total} : 0 );
            push( @augmentedUserRecords, $max_hash );
<span class="preprocessor">        # if there were no set versions and the set was assigned</span>
<span class="preprocessor"></span><span class="preprocessor">        #    to the user, also keep the data</span>
<span class="preprocessor"></span>        } elsif ( ! @allSetVersionNames &amp;&amp; ! $notAssignedSet ) {
            my $dataH = { user_id =&gt; $studentRecord-&gt;user_id(),
                      last_name=&gt;$studentRecord-&gt;last_name(),
                      first_name=&gt;$studentRecord-&gt;first_name(),
                      score =&gt; 0,
                      total =&gt; <span class="stringliteral">&#39;n/a&#39;</span>,
                      <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a> =&gt; 0,
                      section =&gt; $studentRecord-&gt;section(),
                      recitation=&gt;$studentRecord-&gt;recitation(),
                      problemString =&gt; <span class="stringliteral">&#39;no attempt recorded&#39;</span>,
                      act_as_student =&gt; $self-&gt;systemLink($urlpath-&gt;new(type=&gt;<span class="stringliteral">&#39;set_list&#39;</span>,args=&gt;{courseID=&gt;$courseName}), params=&gt;{effectiveUser =&gt; $studentRecord-&gt;user_id}),
                      email_address =&gt; $studentRecord-&gt;email_address(),
                      problemData =&gt; {},
                      date =&gt; <span class="stringliteral">&#39;none&#39;</span>,
                      testtime =&gt; <span class="stringliteral">&#39;none&#39;</span>,
                  };
            push( @index_list, 0 );
            push( @score_list, 0 );
            push( @augmentedUserRecords, $dataH );

        }

        } # <span class="keyword">this</span> closes the loop through all student records
    
    debug(<span class="stringliteral">&quot;end mainloop&quot;</span>);
    
    @augmentedUserRecords = sort {
        &amp;$sort_method($a,$b,$primary_sort_method_name)
            ||
        &amp;$sort_method($a,$b,$secondary_sort_method_name)
            ||
        &amp;$sort_method($a,$b,$ternary_sort_method_name)
            ||          
        lc($a-&gt;{last_name}) cmp lc($b-&gt;{last_name})
            ||
        lc($a-&gt;{first_name}) cmp lc($b-&gt;{first_name})
            ||
        lc($a-&gt;{user_id}) cmp lc($b-&gt;{user_id}) 
        } 
        @augmentedUserRecords;
    

<span class="preprocessor">    # construct header</span>
<span class="preprocessor"></span>    my $problem_header = <span class="stringliteral">&#39;&#39;</span>;
<span class="preprocessor">    # DBFIXME sort in database</span>
<span class="preprocessor"></span>    my @list_problems = sort {$a&lt;=&gt; $b } $db-&gt;listGlobalProblems($setName );
    $problem_header = <span class="stringliteral">&#39;&lt;pre&gt;&#39;</span>.join(<span class="stringliteral">&quot;&quot;</span>, map {&amp;<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#ad10018c7b9def54c0c3791748c67cef6">threeSpaceFill</a>($_)}  @list_problems  ).<span class="stringliteral">&#39;&lt;/pre&gt;&#39;</span>;

<span class="preprocessor"># changes for gateways/versioned sets here.  in this case we allow instructors</span>
<span class="preprocessor"></span><span class="preprocessor"># to modify the appearance of output, which we do with a form.  so paste in the</span>
<span class="preprocessor"></span><span class="preprocessor"># form header here, and make appropriate modifications</span>
<span class="preprocessor"></span>        my $verSelectors = <span class="stringliteral">&#39;&#39;</span>;
    <span class="keywordflow">if</span> ( $setIsVersioned ) {
        print CGI::start_form({<span class="stringliteral">&#39;method&#39;</span> =&gt; <span class="stringliteral">&#39;post&#39;</span>, 
                       <span class="stringliteral">&#39;action&#39;</span> =&gt; $self-&gt;systemLink($urlpath,authen=&gt;0),<span class="stringliteral">&#39;name&#39;</span> =&gt; <span class="stringliteral">&#39;StudentProgress&#39;</span>});
        print $self-&gt;hidden_authen_fields();

<span class="preprocessor">#       $verSelectors = CGI::p({&#39;style&#39;=&gt;&#39;background-color:#eeeeee;color:black;&#39;},</span>
<span class="preprocessor"></span>        print CGI::p({<span class="stringliteral">&#39;style&#39;</span>=&gt;<span class="stringliteral">&#39;background-color:#eeeeee;color:black;&#39;</span>},
                 <span class="stringliteral">&quot;Display options: Show &quot;</span>,
                 CGI::hidden(-name=&gt;<span class="stringliteral">&#39;returning&#39;</span>, -value=&gt;<span class="charliteral">&#39;1&#39;</span>),
                 CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;show_best_only&#39;</span>, -value=&gt;<span class="charliteral">&#39;1&#39;</span>, 
                       -checked=&gt;$showBestOnly, 
                       -label=&gt;<span class="stringliteral">&#39; only best scores; &#39;</span>),
<span class="preprocessor">#                CGI::checkbox(-name=&gt;&#39;show_index&#39;, -value=&gt;&#39;1&#39;, </span>
<span class="preprocessor"></span><span class="preprocessor">#                      -checked=&gt;$showColumns{&#39;index&#39;},</span>
<span class="preprocessor"></span><span class="preprocessor">#                      -label=&gt;&#39; success indicator; &#39;),</span>
<span class="preprocessor"></span>                 CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;show_date&#39;</span>, -value=&gt;<span class="charliteral">&#39;1&#39;</span>, 
                       -checked=&gt;$showColumns{<span class="stringliteral">&#39;date&#39;</span>},
                       -label=&gt;<span class="stringliteral">&#39; test date; &#39;</span>),
                 CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;show_testtime&#39;</span>, -value=&gt;<span class="charliteral">&#39;1&#39;</span>, 
                       -checked=&gt;$showColumns{<span class="stringliteral">&#39;testtime&#39;</span>},
                       -label=&gt;<span class="stringliteral">&#39; test time; &#39;</span>),
                 CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;show_problems&#39;</span>, -value=&gt;<span class="charliteral">&#39;1&#39;</span>, 
                       -checked=&gt;$showColumns{<span class="stringliteral">&#39;problems&#39;</span>},
                       -label=&gt;<span class="stringliteral">&#39;problems;&#39;</span>), <span class="stringliteral">&quot;\n&quot;</span>, CGI::br(), <span class="stringliteral">&quot;\n&quot;</span>,
                 CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;show_section&#39;</span>, -value=&gt;<span class="charliteral">&#39;1&#39;</span>, 
                       -checked=&gt;$showColumns{<span class="stringliteral">&#39;section&#39;</span>}, 
                       -label=&gt;<span class="stringliteral">&#39; section #; &#39;</span>),
                 CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;show_recitation&#39;</span>, -value=&gt;<span class="charliteral">&#39;1&#39;</span>, 
                       -checked=&gt;$showColumns{<span class="stringliteral">&#39;recit&#39;</span>},
                       -label=&gt;<span class="stringliteral">&#39; recitation #; &#39;</span>),
                 CGI::checkbox(-name=&gt;<span class="stringliteral">&#39;show_login&#39;</span>, -value=&gt;<span class="charliteral">&#39;1&#39;</span>, 
                       -checked=&gt;$showColumns{<span class="stringliteral">&#39;login&#39;</span>}, 
                       -label=&gt;<span class="stringliteral">&#39;login&#39;</span>), <span class="stringliteral">&quot;\n&quot;</span>, CGI::br(), <span class="stringliteral">&quot;\n&quot;</span>,
                 CGI::submit(-value=&gt;<span class="stringliteral">&#39;Update Display&#39;</span>),
                 );
        print CGI::end_form();
    }

<span class="preprocessor">#####################################################################################</span>
<span class="preprocessor"></span>    print
<span class="preprocessor">#       CGI::br(),</span>
<span class="preprocessor"></span>        CGI::br(),
        CGI::p({},<span class="stringliteral">&#39;A period (.) indicates a problem has not been attempted, a &amp;quot;C&amp;quot; indicates </span>
<span class="stringliteral">        a problem has been answered 100% correctly, and a number from 0 to 99 </span>
<span class="stringliteral">        indicates the percentage of partial credit earned. The number on the </span>
<span class="stringliteral">        second line gives the number of incorrect attempts.  &#39;</span>,
<span class="preprocessor">#       &#39;The success indicator,&#39; ,CGI::i(&#39;Ind&#39;),&#39;, for each student is calculated as&#39;,</span>
<span class="preprocessor"></span><span class="preprocessor">#       CGI::br(),</span>
<span class="preprocessor"></span><span class="preprocessor">#       &#39;100*(totalNumberOfCorrectProblems / totalNumberOfProblems)^2 / (AvgNumberOfAttemptsPerProblem)&#39;,CGI::br(),</span>
<span class="preprocessor"></span><span class="preprocessor">#       &#39;or 0 if there are no attempts.&#39;</span>
<span class="preprocessor"></span>        ),
        CGI::br(),
        <span class="stringliteral">&quot;Click on student&#39;s name to see the student&#39;s version of the homework set. &amp;nbsp; &amp;nbsp;&amp;nbsp;</span>
<span class="stringliteral">        Click heading to sort table. &quot;</span>,
        CGI::br(),
        CGI::br(),
        defined($primary_sort_method_name) ?<span class="stringliteral">&quot; Entries are sorted by $display_sort_method_name{$primary_sort_method_name}&quot;</span>:<span class="stringliteral">&#39;&#39;</span>,
        defined($secondary_sort_method_name) ?<span class="stringliteral">&quot;, then by $display_sort_method_name{$secondary_sort_method_name}&quot;</span>:<span class="stringliteral">&#39;&#39;</span>,
        defined($ternary_sort_method_name) ?<span class="stringliteral">&quot;, then by $display_sort_method_name{$ternary_sort_method_name}&quot;</span>:<span class="stringliteral">&#39;&#39;</span>,
        defined($primary_sort_method_name) ?<span class="charliteral">&#39;.&#39;</span>:<span class="stringliteral">&#39;&#39;</span>,
    ;
<span class="preprocessor">    # calculate secondary and ternary sort methods parameters if appropriate</span>
<span class="preprocessor"></span>    my %past_sort_methods = ();     
    %past_sort_methods = (secondary_sort =&gt; <span class="stringliteral">&quot;$primary_sort_method_name&quot;</span>,) <span class="keywordflow">if</span> defined($primary_sort_method_name);
    %past_sort_methods = (%past_sort_methods, ternary_sort =&gt; <span class="stringliteral">&quot;$secondary_sort_method_name&quot;</span>,) <span class="keywordflow">if</span> defined($secondary_sort_method_name);

<span class="preprocessor">    # continue with table output</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ! $setIsVersioned ) {
        print
        CGI::start_table({-border=&gt;5,style=&gt;<span class="stringliteral">&#39;font-size:smaller&#39;</span>}),
        CGI::Tr(CGI::td(  {-align=&gt;<span class="stringliteral">&#39;left&#39;</span>},
            [<span class="stringliteral">&#39;Name&#39;</span>.CGI::br().CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;first_name&#39;</span>, %past_sort_methods})},<span class="stringliteral">&#39;First&#39;</span>).
               <span class="stringliteral">&#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;</span>.CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;last_name&#39;</span>, %past_sort_methods })},<span class="stringliteral">&#39;Last&#39;</span>).CGI::br().
               CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;email_address&#39;</span>, %past_sort_methods })},<span class="stringliteral">&#39;Email&#39;</span>),
            CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;score&#39;</span>, %past_sort_methods})},<span class="stringliteral">&#39;Score&#39;</span>),
            <span class="stringliteral">&#39;Out&#39;</span>.CGI::br().<span class="stringliteral">&#39;Of&#39;</span>,
<span class="preprocessor">#           CGI::a({&quot;href&quot;=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;&#39;index&#39;, %past_sort_methods})},&#39;Ind&#39;),</span>
<span class="preprocessor"></span>            <span class="stringliteral">&#39;Problems&#39;</span>.CGI::br().$problem_header,
            CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;section&#39;</span>, %past_sort_methods})},<span class="stringliteral">&#39;Section&#39;</span>),
            CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;recitation&#39;</span>, %past_sort_methods})},<span class="stringliteral">&#39;Recitation&#39;</span>),
            CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;user_id&#39;</span>, %past_sort_methods})},<span class="stringliteral">&#39;Login Name&#39;</span>),
            ])

        ),
        ;
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # we need to preserve display options when the sort headers are clicked</span>
<span class="preprocessor"></span>        my %display_options = (
            returning       =&gt; 1,
            show_best_only  =&gt; $showBestOnly,
<span class="preprocessor">#           show_index      =&gt; $showColumns{index},</span>
<span class="preprocessor"></span>            show_date       =&gt; $showColumns{date},
            show_testtime   =&gt; $showColumns{testtime},
            show_problems   =&gt; $showColumns{problems},
            show_section    =&gt; $showColumns{section},
            show_recitation =&gt; $showColumns{recit},
            show_login      =&gt; $showColumns{login},
        );
        my %params = (%past_sort_methods, %display_options);
        my @columnHdrs = ();
        push( @columnHdrs, <span class="stringliteral">&#39;Name&#39;</span>.CGI::br().CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;first_name&#39;</span>, %params})},<span class="stringliteral">&#39;First&#39;</span>).
          <span class="stringliteral">&#39;&amp;nbsp;&amp;nbsp;&amp;nbsp;&#39;</span>.CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;last_name&#39;</span>, %params })},<span class="stringliteral">&#39;Last&#39;</span>) );
        push( @columnHdrs, CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;score&#39;</span>, %params})},<span class="stringliteral">&#39;Score&#39;</span>) );
        push( @columnHdrs, <span class="stringliteral">&#39;Out&#39;</span>.CGI::br().<span class="stringliteral">&#39;Of&#39;</span> );
        push( @columnHdrs, <span class="stringliteral">&#39;Date&#39;</span> ) if ( $showColumns{ <span class="stringliteral">&#39;date&#39;</span> } );
        push( @columnHdrs, <span class="stringliteral">&#39;TestTime&#39;</span> ) if ( $showColumns{ <span class="stringliteral">&#39;testtime&#39;</span> } );
<span class="preprocessor">#       push( @columnHdrs, CGI::a({&quot;href&quot;=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;&#39;index&#39;, %params})},&#39;Ind&#39;) )</span>
<span class="preprocessor"></span><span class="preprocessor">#       if ( $showColumns{ &#39;index&#39; } );</span>
<span class="preprocessor"></span>        push( @columnHdrs, <span class="stringliteral">&#39;Problems&#39;</span>.CGI::br().$problem_header )
        if ( $showColumns{ <span class="stringliteral">&#39;problems&#39;</span> } );
        push( @columnHdrs, CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;section&#39;</span>, %params})},<span class="stringliteral">&#39;Section&#39;</span>) )
        <span class="keywordflow">if</span> ( $showColumns{ <span class="stringliteral">&#39;section&#39;</span> } );
        push( @columnHdrs, CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;recitation&#39;</span>, %params})},<span class="stringliteral">&#39;Recitation&#39;</span>) )
        <span class="keywordflow">if</span> ( $showColumns{ <span class="stringliteral">&#39;recit&#39;</span> } );
        push( @columnHdrs, CGI::a({<span class="stringliteral">&quot;href&quot;</span>=&gt;$self-&gt;systemLink($setStatsPage,params=&gt;{primary_sort=&gt;<span class="stringliteral">&#39;user_id&#39;</span>, %params})},<span class="stringliteral">&#39;Login Name&#39;</span>) )
        <span class="keywordflow">if</span> ( $showColumns{ <span class="stringliteral">&#39;login&#39;</span> } );

        print CGI::start_table({-border=&gt;5,style=&gt;<span class="stringliteral">&#39;font-size:smaller&#39;</span>}),
            CGI::Tr(CGI::td(  {-align=&gt;<span class="stringliteral">&#39;left&#39;</span>},
            [ @columnHdrs ] ) ),
        ;
    }

<span class="preprocessor">    # variables to keep track of versioned sets</span>
<span class="preprocessor"></span>    my $prevFullName = <span class="stringliteral">&#39;&#39;</span>;
    my $vNum = 1;
<span class="preprocessor">    # and to make formatting nice for students who haven&#39;t taken any tests</span>
<span class="preprocessor"></span><span class="preprocessor">    #    (the total number of columns is two more than this; we want the </span>
<span class="preprocessor"></span><span class="preprocessor">    #    number that missing record information should span)</span>
<span class="preprocessor"></span>    my $numCol = 1 + $showColumns{<span class="stringliteral">&#39;date&#39;</span>} + $showColumns{<span class="stringliteral">&#39;testtime&#39;</span>} + 
<span class="preprocessor">#       $showColumns{&#39;index&#39;} +</span>
<span class="preprocessor"></span>        $showColumns{<span class="stringliteral">&#39;problems&#39;</span>};

    <span class="keywordflow">foreach</span> my $rec (@augmentedUserRecords) {
        my $fullName = join(<span class="stringliteral">&quot;&quot;</span>, $rec-&gt;{first_name},<span class="stringliteral">&quot; &quot;</span>, $rec-&gt;{last_name});
        my $email    = $rec-&gt;{email_address}; 
        my $twoString  = $rec-&gt;{twoString};
        <span class="keywordflow">if</span> ( ! $setIsVersioned ) {
            print CGI::Tr({},
            CGI::td({},CGI::a({-href=&gt;$rec-&gt;{act_as_student}},$fullName), CGI::br(), CGI::a({-href=&gt;<span class="stringliteral">&quot;mailto:$email&quot;</span>},$email)),
            CGI::td( sprintf(<span class="stringliteral">&quot;%0.2f&quot;</span>,$rec-&gt;{score}) ), # score
            CGI::td($rec-&gt;{total}), # out of 
#           CGI::td(sprintf(<span class="stringliteral">&quot;%0.0f&quot;</span>,100*($rec-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a>}) )),   # indicator
            CGI::td($rec-&gt;{problemString}), # problems
            CGI::td($self-&gt;nbsp($rec-&gt;{section})),
            CGI::td($self-&gt;nbsp($rec-&gt;{recitation})),
            CGI::td($rec-&gt;{user_id}),           
            );
        } <span class="keywordflow">else</span> {
<span class="preprocessor">            # we separate versioned sets so that we can restrict what columns</span>
<span class="preprocessor"></span><span class="preprocessor">            # we show</span>
<span class="preprocessor"></span><span class="preprocessor">            # if total is &#39;n/a&#39;, then it&#39;s a user who hasn&#39;t taken</span>
<span class="preprocessor"></span><span class="preprocessor">            #    any tests, which we treat separately</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> ( $rec-&gt;{total} ne <span class="stringliteral">&#39;n/a&#39;</span> ) {
                my @cols = ();
<span class="preprocessor">                # make make versioned sets&#39; name format nicer</span>
<span class="preprocessor"></span>                my $nameEntry = <span class="stringliteral">&#39;&#39;</span>;
                <span class="keywordflow">if</span> ( $fullName eq $prevFullName ) {
                    $vNum++;
                    $nameEntry = <span class="stringliteral">&quot;(v$vNum)&quot;</span>;
                } <span class="keywordflow">else</span> {
                    $nameEntry = CGI::a({-href=&gt;$rec-&gt;{act_as_student}},$fullName) . 
                        ($setIsVersioned &amp;&amp; ! $showBestOnly ? <span class="stringliteral">&#39; (v1)&#39;</span>:<span class="charliteral">&#39; &#39;</span>) .
                        CGI::br() . CGI::a({-href=&gt;<span class="stringliteral">&quot;mailto:$email&quot;</span>},$email);
                    $vNum = 1;
                    $prevFullName = $fullName;
                }
            
<span class="preprocessor">                # build columns to show</span>
<span class="preprocessor"></span>                push(@cols, $nameEntry, 
                     sprintf(<span class="stringliteral">&quot;%0.2f&quot;</span>,$rec-&gt;{score}),
                     $rec-&gt;{total});
                push(@cols, $self-&gt;nbsp($rec-&gt;{date})) 
                    if ($showColumns{<span class="stringliteral">&#39;date&#39;</span>});
                push(@cols, $self-&gt;nbsp($rec-&gt;{testtime})) 
                    if ($showColumns{<span class="stringliteral">&#39;testtime&#39;</span>});
<span class="preprocessor">#               push(@cols, sprintf(&quot;%0.0f&quot;,$rec-&gt;{index})) </span>
<span class="preprocessor"></span><span class="preprocessor">#                   if ($showColumns{&#39;index&#39;});</span>
<span class="preprocessor"></span>                push(@cols, $self-&gt;nbsp($rec-&gt;{problemString}))
                    if ($showColumns{<span class="stringliteral">&#39;problems&#39;</span>});
                push(@cols, $self-&gt;nbsp($rec-&gt;{section})) 
                    if ($showColumns{<span class="stringliteral">&#39;section&#39;</span>});
                push(@cols, $self-&gt;nbsp($rec-&gt;{recitation})) 
                    if ($showColumns{<span class="stringliteral">&#39;recit&#39;</span>});
                push(@cols, $rec-&gt;{user_id}) <span class="keywordflow">if</span> ($showColumns{<span class="stringliteral">&#39;login&#39;</span>});
                print CGI::Tr( CGI::td( [ @cols ] ) );
            } <span class="keywordflow">else</span> {
                my @cols = ( CGI::td( $fullName ),
                         CGI::td( $rec-&gt;{score} ),
                         CGI::td({colspan=&gt;$numCol},
                             CGI::em($self-&gt;nbsp(<span class="stringliteral">&quot;No tests taken.&quot;</span>))) );
                push(@cols, 
                     CGI::td($self-&gt;nbsp($rec-&gt;{section})))
                    <span class="keywordflow">if</span> ( $showColumns{<span class="stringliteral">&#39;section&#39;</span>} );
                push(@cols, 
                     CGI::td($self-&gt;nbsp($rec-&gt;{recitation})))
                    <span class="keywordflow">if</span> ( $showColumns{<span class="stringliteral">&#39;recit&#39;</span>} );
                push(@cols, 
                     CGI::td($self-&gt;nbsp($rec-&gt;{user_id})))
                    <span class="keywordflow">if</span> ( $showColumns{<span class="stringliteral">&#39;login&#39;</span>} );
                print CGI::Tr(@cols);
            }
        }
    }

    print CGI::end_table();

    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}

<span class="preprocessor">#############################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Grading utilities</span>
<span class="preprocessor"></span><span class="preprocessor">#############################################################</span>
<span class="preprocessor"></span>

<span class="preprocessor">#           ########################################</span>
<span class="preprocessor"></span><span class="preprocessor">#           # Notes for factoring the calculation in this loop.</span>
<span class="preprocessor"></span><span class="preprocessor">#           #</span>
<span class="preprocessor"></span><span class="preprocessor">#           # Inputs include:</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   @problemRecords  </span>
<span class="preprocessor"></span><span class="preprocessor">#           # returns</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $num_of_attempts</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $status</span>
<span class="preprocessor"></span><span class="preprocessor">#           # updates</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $number__studofents_attempting_problem{$probID}++;</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   @{ $attempts_list_for_problem{$probID} }   </span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $number_of_attempts_for_problem{$probID}</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $total_num_of_attempts_for_set</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $correct_answers_for_problem{$probID}   </span>
<span class="preprocessor"></span><span class="preprocessor">#           #    </span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $string (formatting output)</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $twoString (more formatted output)</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $longtwo (a combination of $string and $twostring)</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $total</span>
<span class="preprocessor"></span><span class="preprocessor">#           #   $totalRight</span>
<span class="preprocessor"></span><span class="preprocessor">#           ###################################</span>
<span class="preprocessor"></span>
<span class="preprocessor">###############################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># requires = grade_set( $db, $set, $setName, $studentName, $setIsVersioned);</span>
<span class="preprocessor"></span><span class="preprocessor"># returns   my ($status, </span>
<span class="preprocessor"></span><span class="preprocessor">#            $longStatus, </span>
<span class="preprocessor"></span><span class="preprocessor">#            $string,</span>
<span class="preprocessor"></span><span class="preprocessor">#            $twoString, </span>
<span class="preprocessor"></span><span class="preprocessor">#            $totalRight,</span>
<span class="preprocessor"></span><span class="preprocessor">#            $total, </span>
<span class="preprocessor"></span><span class="preprocessor">#            $num_of_attempts, </span>
<span class="preprocessor"></span><span class="preprocessor">#            $num_of_problems) = grade_set(...);</span>
<span class="preprocessor">#########################</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a6b7f922cb427161e198fce5d4157d153"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::StudentProgress::grade_set" ref="a6b7f922cb427161e198fce5d4157d153" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::StudentProgress::grade_set </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-grade_set' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-grade_set-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-grade_set-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-grade_set-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in grade_set: 170</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a6b7f922cb427161e198fce5d4157d153">grade_set</a> {

        my ($db, $set, $setName, $studentName, $setIsVersioned,
        $rh_number_of_students_attempting_problem,
        $rh_attempts_list_for_problem,
        $rh_number_of_attempts_for_problem,
        $rh_problemData,
        $rh_total_num_of_attempts_for_set,
        $rh_correct_answers_for_problem
        ) = @_;

        my $setID = $set-&gt;set_id();  #FIXME   setName and setID should be the same

        my $status = 0;
        my $longStatus = <span class="stringliteral">&#39;&#39;</span>;
        my $string     = <span class="stringliteral">&#39;&#39;</span>;
        my $twoString  = <span class="stringliteral">&#39;&#39;</span>;
        my $totalRight = 0;
        my $total      = 0;
        my $num_of_attempts = 0;
    
        debug(<span class="stringliteral">&quot;Begin collecting problems for set $setName&quot;</span>);
<span class="preprocessor">        # DBFIXME: to collect the problem records, we have to know </span>
<span class="preprocessor"></span><span class="preprocessor">        #    which merge routines to call.  Should this really be an </span>
<span class="preprocessor"></span><span class="preprocessor">        #    issue here?  That is, shouldn&#39;t the database deal with </span>
<span class="preprocessor"></span><span class="preprocessor">        #    it invisibly by detecting what the problem types are?  </span>
<span class="preprocessor"></span><span class="preprocessor">        #    oh well.</span>
<span class="preprocessor"></span>        
        my @problemRecords = $db-&gt;getAllMergedUserProblems( $studentName, $setID );
        my $num_of_problems  = @problemRecords || 0;
        <span class="keywordflow">if</span> ( $setIsVersioned ) {
            @problemRecords =  $db-&gt;getAllMergedProblemVersions( $studentName, $setID, $set-&gt;version_id );
        }
        
        
        
        
        
        
        debug(<span class="stringliteral">&quot;End collecting problems for set $setName&quot;</span>);

<span class="preprocessor">    ####################</span>
<span class="preprocessor"></span><span class="preprocessor">    # Resort records</span>
<span class="preprocessor"></span><span class="preprocessor">    #####################</span>
<span class="preprocessor"></span>        @problemRecords = sort {$a-&gt;problem_id &lt;=&gt; $b-&gt;problem_id } @problemRecords;

<span class="preprocessor">#           </span>
<span class="preprocessor"></span><span class="preprocessor">#       # for gateway/quiz assignments we have to be careful about </span>
<span class="preprocessor"></span><span class="preprocessor">#       #    the order in which the problems are displayed, because</span>
<span class="preprocessor"></span><span class="preprocessor">#       #    they may be in a random order</span>
<span class="preprocessor"></span><span class="preprocessor">#       if ( $set-&gt;problem_randorder ) {</span>
<span class="preprocessor"></span><span class="preprocessor">#           my @newOrder = ();</span>
<span class="preprocessor"></span><span class="preprocessor">#           my @probOrder = (0..$#problemRecords);</span>
<span class="preprocessor"></span><span class="preprocessor">#           # we reorder using a pgrand based on the set psvn</span>
<span class="preprocessor"></span><span class="preprocessor">#           my $pgrand = PGrandom-&gt;new();</span>
<span class="preprocessor"></span><span class="preprocessor">#           $pgrand-&gt;srand( $set-&gt;psvn );</span>
<span class="preprocessor"></span><span class="preprocessor">#           while ( @probOrder ) { </span>
<span class="preprocessor"></span><span class="preprocessor">#               my $i = int($pgrand-&gt;rand(scalar(@probOrder)));</span>
<span class="preprocessor"></span><span class="preprocessor">#               push( @newOrder, $probOrder[$i] );</span>
<span class="preprocessor"></span><span class="preprocessor">#               splice(@probOrder, $i, 1);</span>
<span class="preprocessor"></span><span class="preprocessor">#           }</span>
<span class="preprocessor"></span><span class="preprocessor">#           # now $newOrder[i] = pNum-1, where pNum is the problem</span>
<span class="preprocessor"></span><span class="preprocessor">#           #    number to display in the ith position on the test</span>
<span class="preprocessor"></span><span class="preprocessor">#           #    for sorting, invert this mapping:</span>
<span class="preprocessor"></span><span class="preprocessor">#           my %pSort = map {($newOrder[$_]+1)=&gt;$_} (0..$#newOrder);</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor">#           @problemRecords = sort {$pSort{$a-&gt;problem_id} &lt;=&gt; $pSort{$b-&gt;problem_id}} @problemRecords;</span>
<span class="preprocessor"></span><span class="preprocessor">#       }</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    #######################################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # construct header</span>
<span class="preprocessor"></span>    
        <span class="keywordflow">foreach</span> my $problemRecord (@problemRecords) {
            my $prob = $problemRecord-&gt;problem_id;
            
            unless (defined($problemRecord) ){
<span class="preprocessor">                # warn &quot;Can&#39;t find record for problem $prob in set $setName for $student&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">            # FIXME check the legitimate reasons why a student record might not be defined</span>
<span class="preprocessor"></span>                next;
            }
            
            $status           = $problemRecord-&gt;status || 0;
            my $attempted     = $problemRecord-&gt;attempted;
            my $num_correct   = $problemRecord-&gt;num_correct || 0;
            my $num_incorrect = $problemRecord-&gt;num_incorrect   || 0;
            $num_of_attempts  = $num_correct + $num_incorrect;
            
<span class="preprocessor">#######################################################</span>
<span class="preprocessor"></span><span class="preprocessor">            # This is a fail safe mechanism that makes sure that</span>
<span class="preprocessor"></span><span class="preprocessor">            # the problem is marked as attempted if the status has</span>
<span class="preprocessor"></span><span class="preprocessor">            # been set or if the problem has been attempted</span>
<span class="preprocessor"></span><span class="preprocessor">            # DBFIXME this should happen in the database layer, not here!</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> (!$attempted &amp;&amp; ($status || $num_of_attempts)) {
                $attempted = 1;
                $problemRecord-&gt;attempted(<span class="charliteral">&#39;1&#39;</span>);
<span class="preprocessor">                # DBFIXME: this is another case where it </span>
<span class="preprocessor"></span><span class="preprocessor">                #    seems we shouldn&#39;t have to check for </span>
<span class="preprocessor"></span><span class="preprocessor">                #    which routine to use here...</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> ( $setIsVersioned ) {
                    $db-&gt;putProblemVersion($problemRecord);
                } <span class="keywordflow">else</span> {
                    $db-&gt;putUserProblem($problemRecord );
                }
            }
<span class="preprocessor">######################################################          </span>
<span class="preprocessor"></span>
<span class="preprocessor">            # sanity check that the status (score) is </span>
<span class="preprocessor"></span><span class="preprocessor">            # between 0 and 1</span>
<span class="preprocessor"></span>            my $valid_status = ($status&gt;=0 &amp;&amp; $status&lt;=1)?1:0;

<span class="preprocessor">            ###########################################</span>
<span class="preprocessor"></span><span class="preprocessor">            # Determine the string $longStatus which </span>
<span class="preprocessor"></span><span class="preprocessor">            # will display the student&#39;s current score</span>
<span class="preprocessor"></span><span class="preprocessor">            ###########################################</span>
<span class="preprocessor"></span>
            <span class="keywordflow">if</span> (!$attempted){
                $longStatus     = <span class="charliteral">&#39;.&#39;</span>;
            } elsif   ($valid_status) {
                $longStatus     =  int(100*$status+.5) ;
                $longStatus=<span class="charliteral">&#39;C&#39;</span> <span class="keywordflow">if</span> ($longStatus==100);
            } <span class="keywordflow">else</span>  {
                $longStatus     = <span class="charliteral">&#39;X&#39;</span>;
            }
        
            $string         .= <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#ad10018c7b9def54c0c3791748c67cef6">threeSpaceFill</a>($longStatus);
            $twoString      .= <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#ad10018c7b9def54c0c3791748c67cef6">threeSpaceFill</a>($num_incorrect);
            my $probValue   =  $problemRecord-&gt;value;
            $probValue      =  1 unless defined($probValue) and $probValue ne &quot;&quot;;  <span class="preprocessor"># FIXME?? set defaults here?</span>
<span class="preprocessor"></span>            $total          += $probValue;
            $totalRight     += <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a64c65369f514910bb9125a2bdc841cce">round_score</a>($status*$probValue) <span class="keywordflow">if</span> $valid_status;
                
<span class="preprocessor">#               </span>
<span class="preprocessor"></span><span class="preprocessor">#           # initialize the number of correct answers </span>
<span class="preprocessor"></span><span class="preprocessor">#           # for this problem if the value has not been </span>
<span class="preprocessor"></span><span class="preprocessor">#           # defined.</span>
<span class="preprocessor"></span><span class="preprocessor">#           $correct_answers_for_problem{$probID} = 0 </span>
<span class="preprocessor"></span><span class="preprocessor">#               unless defined($correct_answers_for_problem{$probID});</span>
<span class="preprocessor"></span>            
                
<span class="preprocessor">        # add on the scores for this problem</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> (defined($rh_correct_answers_for_problem ) ) {  #skip <span class="keyword">this</span> <span class="keywordflow">if</span> we are not updating records
                my $probID          = $problemRecord-&gt;problem_id;
                $rh_correct_answers_for_problem-&gt;{$probID} = 0      unless defined($rh_correct_answers_for_problem-&gt;{$probID});
                <span class="keywordflow">if</span> (defined($attempted) and $attempted) {
                    $rh_number_of_students_attempting_problem-&gt;{$probID}++;
                    push( @{ $rh_attempts_list_for_problem-&gt;{$probID} } ,     $num_of_attempts);
                    $rh_number_of_attempts_for_problem-&gt;{$probID}          += $num_of_attempts;
                    $rh_problemData-&gt;{$probID}                              = $num_incorrect;
                    $$rh_total_num_of_attempts_for_set                     += $num_of_attempts;
                    $rh_correct_answers_for_problem-&gt;{$probID}             += $status;
                }
            }
        
        }  # end of problem record loop



        <span class="keywordflow">return</span>($status,  
               $longStatus, 
               $string,
               $twoString, 
               $totalRight,
               $total, 
               $num_of_attempts, 
               $num_of_problems         
        );
}
<span class="preprocessor">#################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Utility function NOT a method</span>
<span class="preprocessor">#################################</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="af5528326540df88cbdcfb5170309aedf"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::StudentProgress::index" ref="af5528326540df88cbdcfb5170309aedf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::StudentProgress::index </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-index' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-index-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-index-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-index-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in index: 85</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#af5528326540df88cbdcfb5170309aedf">index</a> {
    my $self          = shift;
    my $r             = $self-&gt;r;
    my $urlpath       = $r-&gt;urlpath;
    my $ce            = $r-&gt;ce;
    my $db            = $r-&gt;db;
    my $courseName    = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my @studentList   = sort $db-&gt;listUsers;
    my @setList       = sort  $db-&gt;listGlobalSets;

<span class="preprocessor">## Edit to filter out students you aren&#39;t allowed to see</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">    # DBFIXME do filtering in database</span>
<span class="preprocessor"></span>    my @myUsers;
<span class="preprocessor">#   my @studentRecords = $db-&gt;getUsers;  #this is never used</span>
<span class="preprocessor"></span>    my $user = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    
    my (@viewable_sections, @viewable_recitations);
    <span class="keywordflow">if</span> (defined @{$ce-&gt;{viewable_sections}-&gt;{$user}})
        {@viewable_sections = @{$ce-&gt;{viewable_sections}-&gt;{$user}};}
    <span class="keywordflow">if</span> (defined @{$ce-&gt;{viewable_recitations}-&gt;{$user}})
        {@viewable_recitations = @{$ce-&gt;{viewable_recitations}-&gt;{$user}};}
    <span class="keywordflow">if</span> (@viewable_sections or @viewable_recitations){
        <span class="keywordflow">foreach</span> my $studentL (@studentList){
            my $keep = 0;
            my $student = $db-&gt;getUser($studentL);
            <span class="keywordflow">foreach</span> my $sec (@viewable_sections){
                <span class="keywordflow">if</span> ($student-&gt;section() eq $sec){$keep = 1; last;}
            }
            <span class="keywordflow">foreach</span> my $rec (@viewable_recitations){
                <span class="keywordflow">if</span> ($student-&gt;recitation() eq $rec){$keep = 1; last;}
            }
            <span class="keywordflow">if</span> ($keep) {push @myUsers, $studentL;}      
        }
<span class="preprocessor">#   @studentList = @myUsers;</span>
<span class="preprocessor"></span>    }
    <span class="keywordflow">else</span> {@myUsers = @studentList;}
    
<span class="preprocessor">    # DBFIXME sort in database</span>
<span class="preprocessor"></span>    my @studentRecords = $db-&gt;getUsers(@myUsers);
    my @sortedStudentRecords = sortRecords({fields=&gt;[qw/last_name first_name user_id/]}, @studentRecords);
        
    my @setLinks      = ();
    my @studentLinks  = (); 
    <span class="keywordflow">foreach</span> my $set (@setList) {
        my $setStatisticsPage   = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, 
                                                          courseID =&gt; $courseName,
                                                          statType =&gt; <span class="stringliteral">&#39;set&#39;</span>,
                                                          setID    =&gt; $set
        );
        my $prettySetID = $set;
        $prettySetID =~ s/_/ /g;
        push @setLinks, CGI::a({-href=&gt;$self-&gt;systemLink($setStatisticsPage) }, $prettySetID);
    }
    
    <span class="keywordflow">foreach</span> my $studentRecord (@sortedStudentRecords) {
        my $first_name = $studentRecord-&gt;first_name;
        my $last_name = $studentRecord-&gt;last_name;
        my $user_id = $studentRecord-&gt;user_id;
        my $userStatisticsPage  = $urlpath-&gt;newFromModule($urlpath-&gt;module, $r, 
                                                          courseID =&gt; $courseName,
                                                          statType =&gt; <span class="stringliteral">&#39;student&#39;</span>,
                                                          userID   =&gt; $user_id
        );

        push @studentLinks, CGI::a({-href=&gt;$self-&gt;systemLink($userStatisticsPage,
                                                             prams=&gt;{effectiveUser =&gt; $studentRecord-&gt;user_id}
                                                             )},<span class="stringliteral">&quot;  $last_name, $first_name  ($user_id)&quot;</span> ),; 
    }
    print join(<span class="stringliteral">&quot;&quot;</span>,
        CGI::start_table({-border=&gt;2, -cellpadding=&gt;20}),
        CGI::Tr({},
            CGI::td({-valign=&gt;<span class="stringliteral">&#39;top&#39;</span>}, 
                CGI::h3({-align=&gt;<span class="stringliteral">&#39;center&#39;</span>},<span class="stringliteral">&#39;View student progress by set&#39;</span>),
                CGI::ul(  CGI::li( [@setLinks] ) ), 
            ),
            CGI::td({-valign=&gt;<span class="stringliteral">&#39;top&#39;</span>}, 
                CGI::h3({-align=&gt;<span class="stringliteral">&#39;center&#39;</span>},<span class="stringliteral">&#39;View student progress by student&#39;</span>),
                CGI::ul(CGI::li( [ @studentLinks ] ) ),
            ),
        ),
        CGI::end_table(),
    );
    
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ace828f252bb2b6d4862159b52324b501"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::StudentProgress::initialize" ref="ace828f252bb2b6d4862159b52324b501" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::StudentProgress::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in initialize: 30</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#ace828f252bb2b6d4862159b52324b501">initialize</a> {
    my $self     = shift; 
<span class="preprocessor">    # FIXME  are there args here?</span>
<span class="preprocessor"></span>    my @components = @_;
    my $r          = $self-&gt;{<a class="code" href="classWeBWorK_1_1ContentGenerator.html#afc1106db125a42082cafaf10746a947b">r</a>};
    my $urlpath    = $r-&gt;urlpath;
    my $type       = $urlpath-&gt;arg(<span class="stringliteral">&quot;statType&quot;</span>) || <span class="stringliteral">&#39;&#39;</span>;
    my $db         = $self-&gt;{db};
    my $ce         = $self-&gt;{ce};
    my $authz      = $self-&gt;{authz};
    my $courseName = $urlpath-&gt;arg(<span class="stringliteral">&#39;courseID&#39;</span>);
    my $user       = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
<span class="preprocessor">    # Check permissions</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
    
    $self-&gt;{type}  = $type;
    <span class="keywordflow">if</span> ($type eq <span class="stringliteral">&#39;student&#39;</span>) {
        my $studentName = $r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;userID&quot;</span>) || $user;
        $self-&gt;{studentName } = $studentName;
        
    } elsif ($type eq <span class="stringliteral">&#39;set&#39;</span>) {
        my $setName = $r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;setID&quot;</span>) || 0;
        $self-&gt;{setName}     = $setName;
        my $setRecord  = $db-&gt;getGlobalSet($setName); # checked
        die <span class="stringliteral">&quot;global set $setName  not found.&quot;</span> unless $setRecord;
        $self-&gt;{set_due_date} = $setRecord-&gt;due_date;
        $self-&gt;{setRecord}   = $setRecord;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a64c65369f514910bb9125a2bdc841cce"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::StudentProgress::round_score" ref="a64c65369f514910bb9125a2bdc841cce" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::StudentProgress::round_score </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-round_score' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-round_score-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-round_score-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-round_score-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in round_score: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a64c65369f514910bb9125a2bdc841cce">round_score</a>{
    <span class="keywordflow">return</span> shift;
}

1;
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7d744206e973755acaeeafa83e093282"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::StudentProgress::siblings" ref="a7d744206e973755acaeeafa83e093282" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::StudentProgress::siblings </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-siblings' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-siblings-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-siblings-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-siblings-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in siblings: 39</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#a7d744206e973755acaeeafa83e093282">siblings</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    my $urlpath = $r-&gt;urlpath;
    
<span class="preprocessor">    # Check permissions</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span> unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
    
    my $courseID = $urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $eUserID  = $r-&gt;param(<span class="stringliteral">&quot;effectiveUser&quot;</span>);
    my @setIDs   = sort  $db-&gt;listGlobalSets;
    
    my $progress     = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::StudentProgress&quot;</span>,  $r, 
                                            courseID =&gt; $courseID);
    
    print CGI::start_div({<span class="keyword">class</span>=&gt;<span class="stringliteral">&quot;info-box&quot;</span>, <span class="keywordtype">id</span>=&gt;<span class="stringliteral">&quot;fisheye&quot;</span>});
    print CGI::h2(<span class="stringliteral">&quot;Student Progress&quot;</span>);
<span class="preprocessor">    #print CGI::start_ul({class=&gt;&quot;LinksMenu&quot;});</span>
<span class="preprocessor"></span><span class="preprocessor">    #print CGI::start_li();</span>
<span class="preprocessor"></span><span class="preprocessor">    #print CGI::span({style=&gt;&quot;font-size:larger&quot;}, CGI::a({href=&gt;$self-&gt;systemLink($stats)}, &#39;Statistics&#39;));</span>
<span class="preprocessor"></span>    print CGI::start_ul();
    <span class="keywordflow">foreach</span> my $setID (@setIDs) {
        my $problemPage = $urlpath-&gt;newFromModule(<span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::StudentProgress&quot;</span>, $r, 
            courseID =&gt; $courseID, setID =&gt; $setID,statType =&gt; <span class="stringliteral">&#39;set&#39;</span>,);
        my $prettySetID = $setID;
        $prettySetID =~ s/_/ /g;
        print CGI::li({},CGI::a({href=&gt;$self-&gt;systemLink($problemPage)}, $prettySetID));
    }
    
    print CGI::end_ul();
<span class="preprocessor">    #print CGI::end_li();</span>
<span class="preprocessor"></span><span class="preprocessor">    #print CGI::end_ul();</span>
<span class="preprocessor"></span>    print CGI::end_div();
    
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad10018c7b9def54c0c3791748c67cef6"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::StudentProgress::threeSpaceFill" ref="ad10018c7b9def54c0c3791748c67cef6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::StudentProgress::threeSpaceFill </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-threeSpaceFill' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-threeSpaceFill-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-threeSpaceFill-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-threeSpaceFill-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in threeSpaceFill: 8</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#ad10018c7b9def54c0c3791748c67cef6">threeSpaceFill</a> {
    my $num = shift @_ || 0;

    <span class="keywordflow">if</span> (length($num)&lt;=1) {<span class="keywordflow">return</span> <span class="stringliteral">&quot;$num&quot;</span>.<span class="stringliteral">&#39;&amp;nbsp;&amp;nbsp;&#39;</span>;}
    elsif (length($num)==2) {<span class="keywordflow">return</span> <span class="stringliteral">&quot;$num&quot;</span>.<span class="stringliteral">&#39;&amp;nbsp;&#39;</span>;}
    <span class="keywordflow">else</span> {<span class="keywordflow">return</span> <span class="stringliteral">&quot;## &quot;</span>;}
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa181e99303ad7e91ad205e1b42c682df"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Instructor::StudentProgress::title" ref="aa181e99303ad7e91ad205e1b42c682df" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Instructor::StudentProgress::title </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-title' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-title-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-title-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-title-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in title: 19</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Instructor_1_1StudentProgress.html#aa181e99303ad7e91ad205e1b42c682df">title</a> { 
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $authz = $r-&gt;authz;
    my $user = $r-&gt;param(<span class="stringliteral">&#39;user&#39;</span>);
    
<span class="preprocessor">    # Check permissions</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span> unless $authz-&gt;hasPermissions($user, <span class="stringliteral">&quot;access_instructor_tools&quot;</span>);
    
    my $type                = $self-&gt;{type};
    my $string              = <span class="stringliteral">&quot;Student Progress for &quot;</span>.$self-&gt;{ce}-&gt;{courseName}.<span class="stringliteral">&quot; &quot;</span>;
    <span class="keywordflow">if</span> ($type eq <span class="stringliteral">&#39;student&#39;</span>) {
        $string             .= <span class="stringliteral">&quot;student &quot;</span>.$self-&gt;{studentName};
    } elsif ($type eq <span class="stringliteral">&#39;set&#39;</span> ) {
        $string             .= <span class="stringliteral">&quot;set   &quot;</span>.$self-&gt;{setName};
        $string             .= <span class="stringliteral">&quot;.&amp;nbsp;&amp;nbsp;&amp;nbsp; Due &quot;</span>. $self-&gt;formatDateTime($self-&gt;{set_due_date});
    }
    <span class="keywordflow">return</span> $string;
}
</pre></div>  
</div>
 
<p>Reimplemented from <a class="el" href="classWeBWorK_1_1ContentGenerator.html#ad83c346d1b3f70cf42ba4debe6239c9f">WeBWorK::ContentGenerator</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="StudentProgress_8pm_source.html">StudentProgress.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:58:24 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
