<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>WeBWorK2: WeBWorK::ContentGenerator::Hardcopy Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="classWeBWorK.html">WeBWorK</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator.html">ContentGenerator</a>::<a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html">Hardcopy</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::ContentGenerator::Hardcopy Class Reference</h1><!-- doxytag: class="WeBWorK::ContentGenerator::Hardcopy" --><!-- doxytag: inherits="WeBWorK::ContentGenerator" --><div class="dynheader">
Inheritance diagram for WeBWorK::ContentGenerator::Hardcopy:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Hardcopy__inherit__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Hardcopy_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Hardcopy_inherit__map" id="WeBWorK_1_1ContentGenerator_1_1Hardcopy_inherit__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="37,80,229,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="92,5,175,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::ContentGenerator::Hardcopy:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1ContentGenerator_1_1Hardcopy__coll__graph.png" border="0" usemap="#WeBWorK_1_1ContentGenerator_1_1Hardcopy_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1ContentGenerator_1_1Hardcopy_coll__map" id="WeBWorK_1_1ContentGenerator_1_1Hardcopy_coll__map">
<area shape="rect" href="classWeBWorK_1_1ContentGenerator.html" title="WeBWorK::ContentGenerator" alt="" coords="37,80,229,107"/><area shape="rect" href="classWeBWorK.html" title="WeBWorK" alt="" coords="92,5,175,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a812af2db57c15d9d3b7df8cd277abc21">get_errors_ref</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#adc7b6118131b83982c6b5d424eac894d">add_errors</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a7bf717128f46dbbfd385976b6b21a2d3">delete_temp_dir</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a7f18738b9bb688ca30328bb5d2023a51">write_multiuser_tex</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#af8df2b5a1acd0a305eddb773796d76d0">get_errors</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a2beb2d1c510efaf02acd1860353a85ba">write_problem_tex</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a12d8bd31d18edb63dfc6f77f0f415df3">generate_hardcopy_pdf</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#ae8b3b13e9ba93ec88761c5147696c4b2">write_tex_file</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a5b7bbbf5cc89753ae71b10f49962316d">pre_header_initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a5a022797bb3eef3a3f331acfcf24a663">body</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#adfe61230e5dc3ba2285fb64e41df4d2b">write_multiset_tex</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a82e566d1b6db59bf3cd153526f9c39de">display_form</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a71cd787eeea8b8462bfd29572684d391">write_set_tex</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#afe3c1f87634948e2242776556c90ebbb">generate_hardcopy_tex</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a9aca79fff2a4cb651d5a4aad8de20d5d">generate_hardcopy</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html">WeBWorK::ContentGenerator::Hardcopy</a> - generate printable versions of one or more problem sets.</p>
<h2><a class="anchor" id="CONFIGURATION_VARIABLES">
CONFIGURATION VARIABLES</a></h2>
<ul>
<li>
<p class="startli"><a class="anchor" id="item__PreserveTempFiles"></a><b>$PreserveTempFiles</b> </p>
<p class="endli">If true, don't delete temporary files.  </p>
</li>
</ul>

<p>Definition at line <a class="el" href="Hardcopy_8pm_source.html#l00034">34</a> of file <a class="el" href="Hardcopy_8pm_source.html">Hardcopy.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="adc7b6118131b83982c6b5d424eac894d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::add_errors" ref="adc7b6118131b83982c6b5d424eac894d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::add_errors </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-add_errors' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-add_errors-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-add_errors-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-add_errors-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in add_errors: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#adc7b6118131b83982c6b5d424eac894d">add_errors</a> {
    my ($self, @errors) = @_;
    push @{$self-&gt;{hardcopy_errors}}, @errors;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a5a022797bb3eef3a3f331acfcf24a663"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::body" ref="a5a022797bb3eef3a3f331acfcf24a663" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::body </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-body' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-body-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-body-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-body-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in body: 54</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a5a022797bb3eef3a3f331acfcf24a663">body</a> {
    my ($self) = @_;
    my $userID = $self-&gt;r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    my $perm_view_errors = $self-&gt;r-&gt;authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;download_hardcopy_view_errors&quot;</span>);
    $perm_view_errors = (defined($perm_view_errors) ) ? $perm_view_errors : 0;
    <span class="keywordflow">if</span> (my $num = $self-&gt;get_errors) {
        my $final_file_url = $self-&gt;{final_file_url};
        my %temp_file_map = %{$self-&gt;{temp_file_map}};
        <span class="keywordflow">if</span>($perm_view_errors) {
            my $errors_str = $num &gt; 1 ? <span class="stringliteral">&quot;errors&quot;</span> : <span class="stringliteral">&quot;error&quot;</span>;
            print CGI::p(<span class="stringliteral">&quot;$num $errors_str occured while generating hardcopy:&quot;</span>);
            
            print CGI::ul(CGI::li($self-&gt;get_errors_ref));
        }
        
        <span class="keywordflow">if</span> ($final_file_url) {
            print CGI::p(
                <span class="stringliteral">&quot;A hardcopy file was generated, but it may not be complete or correct.&quot;</span>, 
                <span class="stringliteral">&quot;Please check that no problems are missing and that they are all legible.&quot;</span> , 
                <span class="stringliteral">&quot;If not, please inform your instructor.&lt;br /&gt;&quot;</span>,
                CGI::a({href=&gt;$final_file_url}, <span class="stringliteral">&quot;Download Hardcopy&quot;</span>),
            );
        } <span class="keywordflow">else</span> {
            print CGI::p(
                <span class="stringliteral">&quot;WeBWorK was unable to generate a paper copy of this homework set.  Please inform your instructor. &quot;</span>
            ); 
        
        }
        <span class="keywordflow">if</span>($perm_view_errors) {
            <span class="keywordflow">if</span> (%temp_file_map) {
                print CGI::start_p();
                print <span class="stringliteral">&quot;You can also examine the following temporary files: &quot;</span>;
                my $first = 1;
                <span class="keywordflow">while</span> (my ($temp_file_name, $temp_file_url) = each %temp_file_map) {
                    <span class="keywordflow">if</span> ($first) {
                        $first = 0;
                    } <span class="keywordflow">else</span> {
                        print <span class="stringliteral">&quot;, &quot;</span>;
                    }
                    print CGI::a({href=&gt;$temp_file_url}, <span class="stringliteral">&quot; $temp_file_name&quot;</span>);
                }
                print CGI::end_p();
            }
        }
        
        print CGI::hr();
    }

<span class="preprocessor">    # don&#39;t display the retry form if there are errors and the user doesn&#39;t have permission to view the errors.</span>
<span class="preprocessor"></span>    unless ($self-&gt;get_errors and not $perm_view_errors) {
        $self-&gt;display_form();
    }
    <span class="stringliteral">&#39;&#39;</span>; # <span class="keywordflow">return</span> a blank
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7bf717128f46dbbfd385976b6b21a2d3"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::delete_temp_dir" ref="a7bf717128f46dbbfd385976b6b21a2d3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::delete_temp_dir </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-delete_temp_dir' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-delete_temp_dir-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-delete_temp_dir-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-delete_temp_dir-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in delete_temp_dir: 13</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a7bf717128f46dbbfd385976b6b21a2d3">delete_temp_dir</a> {
    my ($self, $temp_dir_path) = @_;
    
    my $rm_cmd = <span class="stringliteral">&quot;2&gt;&amp;1 &quot;</span> . $self-&gt;r-&gt;ce-&gt;{externalPrograms}{rm} . <span class="stringliteral">&quot; -rf &quot;</span> . shell_quote($temp_dir_path);
    my $rm_out = readpipe $rm_cmd;
    <span class="keywordflow">if</span> ($?) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Failed to remove temporary directory &#39;&quot;</span>.CGI::code(CGI::escapeHTML($temp_dir_path)).<span class="stringliteral">&quot;&#39;:&quot;</span>
            .CGI::br().CGI::pre($rm_out));
        <span class="keywordflow">return</span> 0;
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">return</span> 1;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a82e566d1b6db59bf3cd153526f9c39de"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::display_form" ref="a82e566d1b6db59bf3cd153526f9c39de" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::display_form </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-display_form' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-display_form-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-display_form-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-display_form-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in display_form: 103</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a82e566d1b6db59bf3cd153526f9c39de">display_form</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    my $userID = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    my $eUserID = $r-&gt;param(<span class="stringliteral">&quot;effectiveUser&quot;</span>);
    
<span class="preprocessor">    # first time we show up here, fill in some values</span>
<span class="preprocessor"></span>    unless ($r-&gt;param(<span class="stringliteral">&quot;in_hc_form&quot;</span>)) {
<span class="preprocessor">        # if a set was passed in via the path_info, add that to the list of sets.</span>
<span class="preprocessor"></span>        my $singleSet = $r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;setID&quot;</span>);
        <span class="keywordflow">if</span> (defined $singleSet and $singleSet ne <span class="stringliteral">&quot;&quot;</span>) {
            my @selected_sets = $r-&gt;param(<span class="stringliteral">&quot;selected_sets&quot;</span>);
            $r-&gt;param(<span class="stringliteral">&quot;selected_sets&quot;</span> =&gt; [ @selected_sets, $singleSet]) unless grep { $_ eq $singleSet } @selected_sets;
        }
        
<span class="preprocessor">        # if no users are selected, select the effective user</span>
<span class="preprocessor"></span>        my @selected_users = $r-&gt;param(<span class="stringliteral">&quot;selected_users&quot;</span>);
        unless (@selected_users) {
            $r-&gt;param(<span class="stringliteral">&quot;selected_users&quot;</span> =&gt; $eUserID);
        }
    }
    
    my $perm_multiset = $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;download_hardcopy_multiset&quot;</span>);
    my $perm_multiuser = $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;download_hardcopy_multiuser&quot;</span>);
    my $perm_texformat = $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;download_hardcopy_format_tex&quot;</span>);
    my $perm_unopened = $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;view_unopened_sets&quot;</span>);
    my $perm_view_hidden = $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;view_hidden_sets&quot;</span>);
    
<span class="preprocessor">    # get formats</span>
<span class="preprocessor"></span>    my @formats;
    <span class="keywordflow">foreach</span> my $format (keys %HC_FORMATS) {
        push @formats, $format <span class="keywordflow">if</span> $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;download_hardcopy_format_$format&quot;</span>);
    }
    
<span class="preprocessor">    # get format names hash for radio buttons</span>
<span class="preprocessor"></span>    my %format_labels = map { $_ =&gt; $HC_FORMATS{$_}{name} || $_ } @formats;
    
<span class="preprocessor">    # get users for selection</span>
<span class="preprocessor"></span>    my @Users;
    <span class="keywordflow">if</span> ($perm_multiuser) {
<span class="preprocessor">        # if we&#39;re allowed to select multiple users, get all the users</span>
<span class="preprocessor"></span><span class="preprocessor">        # DBFIXME shouldn&#39;t need to pass list of users, should use iterator for results?</span>
<span class="preprocessor"></span>        @Users = $db-&gt;getUsers($db-&gt;listUsers);
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # otherwise, we get our own record only</span>
<span class="preprocessor"></span>        @Users = $db-&gt;getUser($eUserID);
    }
    
<span class="preprocessor">    # get sets for selection</span>
<span class="preprocessor"></span><span class="preprocessor">    # DBFIXME should use WHERE clause to filter on open_date and visible, rather then getting all</span>
<span class="preprocessor"></span>    my @globalSetIDs;
    my @GlobalSets;
    <span class="keywordflow">if</span> ($perm_multiuser) {
<span class="preprocessor">        # if we&#39;re allowed to select sets for multiple users, get all sets.</span>
<span class="preprocessor"></span>        @globalSetIDs = $db-&gt;listGlobalSets;
        @GlobalSets = $db-&gt;getGlobalSets(@globalSetIDs);
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # otherwise, only get the sets assigned to the effective user.</span>
<span class="preprocessor"></span><span class="preprocessor">        # note that we are getting GlobalSets, but using the list of UserSets assigned to the</span>
<span class="preprocessor"></span><span class="preprocessor">        # effective user. this is because if we pass UserSets  to ScrollingRecordList it will</span>
<span class="preprocessor"></span><span class="preprocessor">        # give us composite IDs back, which is a pain in the ass to deal with.</span>
<span class="preprocessor"></span>        @globalSetIDs = $db-&gt;listUserSets($eUserID);
        @GlobalSets = $db-&gt;getGlobalSets(@globalSetIDs);
    }
<span class="preprocessor">    # we also want to get the versioned sets for this user</span>
<span class="preprocessor"></span><span class="preprocessor">    # FIXME: this is another place where we assume that there is a </span>
<span class="preprocessor"></span><span class="preprocessor">    #    one-to-one correspondence between assignment_type =~ gateway</span>
<span class="preprocessor"></span><span class="preprocessor">    #    and versioned sets.  I think we really should have a </span>
<span class="preprocessor"></span><span class="preprocessor">    #    &quot;is_versioned&quot; flag on set objects instead.</span>
<span class="preprocessor"></span>    my @versionedSets = grep {$_-&gt;assignment_type =~ /gateway/} @GlobalSets;
    my @SetVersions = ();
    <span class="keywordflow">foreach</span> my $v (@versionedSets) {
        my @usv = map { [$eUserID, $v-&gt;set_id, $_] } ( $db-&gt;listSetVersions( $eUserID, $v-&gt;set_id ) );
        push( @SetVersions, $db-&gt;getSetVersions( @usv ) );
    }
<span class="preprocessor">    # FIXME: this is a hideous, horrible hack.  the identifying key for </span>
<span class="preprocessor"></span><span class="preprocessor">    #    a global set is the set_id.  those for a set version are the </span>
<span class="preprocessor"></span><span class="preprocessor">    #    set_id and version_id.  but this means that we have trouble </span>
<span class="preprocessor"></span><span class="preprocessor">    #    displaying them both together in HTML::scrollingRecordList.  </span>
<span class="preprocessor"></span><span class="preprocessor">    #    so we brutally play tricks with the set_id here, which probably</span>
<span class="preprocessor"></span><span class="preprocessor">    #    is not very robust, and certainly is aesthetically displeasing.</span>
<span class="preprocessor"></span><span class="preprocessor">    #    yuck.</span>
<span class="preprocessor"></span>    <span class="keywordflow">foreach</span> ( @SetVersions ) { 
        $_-&gt;set_id($_-&gt;set_id . <span class="stringliteral">&quot;,v&quot;</span> . $_-&gt;version_id); 
    }
    
<span class="preprocessor">    # filter out unwanted sets</span>
<span class="preprocessor"></span>    my @WantedGlobalSets;
    <span class="keywordflow">foreach</span> my $i (0 .. $#GlobalSets) {
        my $Set = $GlobalSets[$i];
        unless (defined $Set) {
            warn <span class="stringliteral">&quot;\$GlobalSets[$i] (ID $globalSetIDs[$i]) not defined -- skipping&quot;</span>;
            next;
        }
        next unless $Set-&gt;open_date &lt;= time or $perm_unopened;
        next unless $Set-&gt;visible or $perm_view_hidden;
<span class="preprocessor">        # also skip gateway sets, for which we have to have a </span>
<span class="preprocessor"></span><span class="preprocessor">        #    version to print something</span>
<span class="preprocessor"></span>        next <span class="keywordflow">if</span> $Set-&gt;assignment_type =~ /gateway/;
        push @WantedGlobalSets, $Set;
    }
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a9aca79fff2a4cb651d5a4aad8de20d5d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::generate_hardcopy" ref="a9aca79fff2a4cb651d5a4aad8de20d5d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::generate_hardcopy </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-generate_hardcopy' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-generate_hardcopy-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-generate_hardcopy-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-generate_hardcopy-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in generate_hardcopy: 150</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a9aca79fff2a4cb651d5a4aad8de20d5d">generate_hardcopy</a> {
    my ($self, $format, $userIDsRef, $setIDsRef) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    
    my $courseID = $r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>);
    my $userID = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    my $eUserID = $r-&gt;param(<span class="stringliteral">&quot;effectiveUser&quot;</span>);
    
<span class="preprocessor">    # we want to make the temp directory web-accessible, for error reporting</span>
<span class="preprocessor"></span><span class="preprocessor">    # use mkpath to ensure it exists (mkpath is pretty much ``mkdir -p&#39;&#39;)</span>
<span class="preprocessor"></span>    my $temp_dir_parent_path = $ce-&gt;{courseDirs}{html_temp} . <span class="stringliteral">&quot;/hardcopy&quot;</span>;
    eval { mkpath($temp_dir_parent_path) };
    <span class="keywordflow">if</span> ($@) {
        die <span class="stringliteral">&quot;Couldn&#39;t create hardcopy directory $temp_dir_parent_path: $@&quot;</span>;
    }
    
<span class="preprocessor">    # create a randomly-named working directory in the hardcopy directory</span>
<span class="preprocessor"></span>    my $temp_dir_path = eval { tempdir(<span class="stringliteral">&quot;work.XXXXXXXX&quot;</span>, DIR =&gt; $temp_dir_parent_path) };
    <span class="keywordflow">if</span> ($@) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Couldn&#39;t create temporary working directory: &quot;</span>.CGI::code(CGI::escapeHTML($@)));
        <span class="keywordflow">return</span>;
    }
<span class="preprocessor">    # make sure the directory can be read by other daemons e.g. lighttpd</span>
<span class="preprocessor"></span>    chmod 0755, $temp_dir_path;

    
<span class="preprocessor">    # do some error checking</span>
<span class="preprocessor"></span>    unless (-e $temp_dir_path) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Temporary directory &#39;&quot;</span>.CGI::code(CGI::escapeHTML($temp_dir_path))
            .<span class="stringliteral">&quot;&#39; does not exist, but creation didn&#39;t fail. This shouldn&#39;t happen.&quot;</span>);
        <span class="keywordflow">return</span>;
    }
    unless (-w $temp_dir_path) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Temporary directory &#39;&quot;</span>.CGI::code(CGI::escapeHTML($temp_dir_path))
            .<span class="stringliteral">&quot;&#39; is not writeable.&quot;</span>);
        $self-&gt;delete_temp_dir($temp_dir_path);
        <span class="keywordflow">return</span>;
    }
    
    my $tex_file_name = <span class="stringliteral">&quot;hardcopy.tex&quot;</span>;
    my $tex_file_path = <span class="stringliteral">&quot;$temp_dir_path/$tex_file_name&quot;</span>;
    
<span class="preprocessor">    #######################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # create TeX file  (callback  write_multiuser_tex,  or ??)</span>
<span class="preprocessor"></span><span class="preprocessor">    #######################################</span>
<span class="preprocessor"></span>    
    my $open_result = open my $FH, <span class="stringliteral">&quot;&gt;&quot;</span>, $tex_file_path;
    unless ($open_result) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Failed to open file &#39;&quot;</span>.CGI::code(CGI::escapeHTML($tex_file_path))
            .<span class="stringliteral">&quot;&#39; for writing: &quot;</span>.CGI::code(CGI::escapeHTML($!)));
        $self-&gt;delete_temp_dir($temp_dir_path);
        <span class="keywordflow">return</span>;
    }
    $self-&gt;write_multiuser_tex($FH, $userIDsRef, $setIDsRef);
    close $FH;
    
<span class="preprocessor">    # if no problems got rendered successfully, we can&#39;t continue</span>
<span class="preprocessor"></span>    unless ($self-&gt;{at_least_one_problem_rendered_without_error}) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;No problems rendered. Can&#39;t continue.&quot;</span>);
        $self-&gt;delete_temp_dir($temp_dir_path);
        <span class="keywordflow">return</span>;
    }
    
<span class="preprocessor">    # if no hardcopy.tex file was generated, fail now</span>
<span class="preprocessor"></span>    unless (-e <span class="stringliteral">&quot;$temp_dir_path/hardcopy.tex&quot;</span>) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;&#39;&quot;</span>.CGI::code(<span class="stringliteral">&quot;hardcopy.tex&quot;</span>).<span class="stringliteral">&quot;&#39; not written to temporary directory &#39;&quot;</span>
            .CGI::code(CGI::escapeHTML($temp_dir_path)).<span class="stringliteral">&quot;&#39;. Can&#39;t continue.&quot;</span>);
        $self-&gt;delete_temp_dir($temp_dir_path);
        <span class="keywordflow">return</span>;
    }
    
<span class="preprocessor">    ##############################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # end creation of TeX file</span>
<span class="preprocessor"></span><span class="preprocessor">    ##############################################</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    # determine base name of final file</span>
<span class="preprocessor"></span>    my $final_file_user = @$userIDsRef &gt; 1 ? <span class="stringliteral">&quot;multiuser&quot;</span> : $userIDsRef-&gt;[0];
    my $final_file_set = @$setIDsRef &gt; 1 ? <span class="stringliteral">&quot;multiset&quot;</span> : $setIDsRef-&gt;[0];
    my $final_file_basename = <span class="stringliteral">&quot;$courseID.$final_file_user.$final_file_set&quot;</span>;
    
<span class="preprocessor">    ###############################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # call format subroutine  (call back)</span>
<span class="preprocessor"></span><span class="preprocessor">    ###############################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # $final_file_name is the name of final hardcopy file</span>
<span class="preprocessor"></span><span class="preprocessor">    # @temp_files is a list of temporary files of interest used by the subroutine</span>
<span class="preprocessor"></span><span class="preprocessor">    # (all are relative to $temp_dir_path)</span>
<span class="preprocessor"></span>    my $format_subr = $HC_FORMATS{$format}{subr};
    my ($final_file_name, @temp_files) = $self-&gt;$format_subr($temp_dir_path, $final_file_basename);
    my $final_file_path = <span class="stringliteral">&quot;$temp_dir_path/$final_file_name&quot;</span>;
    
<span class="preprocessor">    #warn &quot;final_file_name=$final_file_name\n&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #warn &quot;temp_files=@temp_files\n&quot;;</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    ################################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # calculate URLs for each temp file of interest</span>
<span class="preprocessor"></span><span class="preprocessor">    #################################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # makeTempDirectory&#39;s interface forces us to reverse-engineer the name of the temp dir from the path</span>
<span class="preprocessor"></span>    my $temp_dir_parent_url = $ce-&gt;{courseURLs}{html_temp} . <span class="stringliteral">&quot;/hardcopy&quot;</span>;
    (my $temp_dir_url = $temp_dir_path) =~ s/^$temp_dir_parent_path/$temp_dir_parent_url/; 
    my %temp_file_map;
    <span class="keywordflow">foreach</span> my $temp_file_name (@temp_files) {
        $temp_file_map{$temp_file_name} = <span class="stringliteral">&quot;$temp_dir_url/$temp_file_name&quot;</span>;
    }
    
    my $final_file_url;
    
<span class="preprocessor">    ##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # make sure final file exists</span>
<span class="preprocessor"></span><span class="preprocessor">    ##################################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # returns undefined unless $final_file_path points to a file</span>
<span class="preprocessor"></span>    unless (-e $final_file_path) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Final hardcopy file &#39;&quot;</span>.CGI::code(CGI::escapeHTML($final_file_path))
            .<span class="stringliteral">&quot;&#39; not found after calling &#39;&quot;</span>.CGI::code(CGI::escapeHTML($format_subr)).<span class="stringliteral">&quot;&#39;: &quot;</span>
            .CGI::code(CGI::escapeHTML($!)));
        <span class="keywordflow">return</span> $final_file_url, %temp_file_map;
    }
    
<span class="preprocessor">    ##################################################  </span>
<span class="preprocessor"></span><span class="preprocessor">    # try to move the hardcopy file out of the temp directory</span>
<span class="preprocessor"></span><span class="preprocessor">    ##################################################</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # set $final_file_url accordingly</span>
<span class="preprocessor"></span>    my $final_file_final_path = <span class="stringliteral">&quot;$temp_dir_parent_path/$final_file_name&quot;</span>;
    my $mv_cmd = <span class="stringliteral">&quot;2&gt;&amp;1 &quot;</span> . $ce-&gt;{externalPrograms}{mv} . <span class="stringliteral">&quot; &quot;</span> . shell_quote($final_file_path, $final_file_final_path);
    my $mv_out = readpipe $mv_cmd;
    <span class="keywordflow">if</span> ($?) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Failed to move hardcopy file &#39;&quot;</span>.CGI::code(CGI::escapeHTML($final_file_name))
            .<span class="stringliteral">&quot;&#39; from &#39;&quot;</span>.CGI::code(CGI::escapeHTML($temp_dir_path)).<span class="stringliteral">&quot;&#39; to &#39;&quot;</span>
            .CGI::code(CGI::escapeHTML($temp_dir_parent_path)).<span class="stringliteral">&quot;&#39;:&quot;</span>.CGI::br()
            .CGI::pre(CGI::escapeHTML($mv_out)));
        $final_file_url = <span class="stringliteral">&quot;$temp_dir_url/$final_file_name&quot;</span>;
    } <span class="keywordflow">else</span> {
        $final_file_url = <span class="stringliteral">&quot;$temp_dir_parent_url/$final_file_name&quot;</span>;
    }
    
<span class="preprocessor">    ##################################################  </span>
<span class="preprocessor"></span><span class="preprocessor">    # remove the temp directory if there are no errors</span>
<span class="preprocessor"></span><span class="preprocessor">    ##################################################</span>
<span class="preprocessor"></span>
    unless ($self-&gt;get_errors or $PreserveTempFiles) {
        $self-&gt;delete_temp_dir($temp_dir_path);
    }
    
    warn <span class="stringliteral">&quot;Preserved temporary files in directory &#39;$temp_dir_path&#39;.\n&quot;</span> <span class="keywordflow">if</span> $PreserveTempFiles;
    
    <span class="keywordflow">return</span> $final_file_url, %temp_file_map;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a12d8bd31d18edb63dfc6f77f0f415df3"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::generate_hardcopy_pdf" ref="a12d8bd31d18edb63dfc6f77f0f415df3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::generate_hardcopy_pdf </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-generate_hardcopy_pdf' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-generate_hardcopy_pdf-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-generate_hardcopy_pdf-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-generate_hardcopy_pdf-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in generate_hardcopy_pdf: 62</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a12d8bd31d18edb63dfc6f77f0f415df3">generate_hardcopy_pdf</a> {
    my ($self, $temp_dir_path, $final_file_basename) = @_;
    
<span class="preprocessor">    # call pdflatex - we don&#39;t want to chdir in the mod_perl process, as</span>
<span class="preprocessor"></span><span class="preprocessor">    # that might step on the feet of other things (esp. in Apache 2.0)</span>
<span class="preprocessor"></span>    my $pdflatex_cmd = <span class="stringliteral">&quot;cd &quot;</span> . shell_quote($temp_dir_path) . <span class="stringliteral">&quot; &amp;&amp; &quot;</span>
        . $self-&gt;r-&gt;ce-&gt;{externalPrograms}{pdflatex}
        . <span class="stringliteral">&quot; &gt;pdflatex.stdout 2&gt;pdflatex.stderr hardcopy&quot;</span>;
    <span class="keywordflow">if</span> (my $rawexit = system $pdflatex_cmd) {
        my $exit = $rawexit &gt;&gt; 8;
        my $signal = $rawexit &amp; 127;
        my $core = $rawexit &amp; 128;
        $self-&gt;add_errors(<span class="stringliteral">&quot;Failed to convert TeX to PDF with command &#39;&quot;</span>
            .CGI::code(CGI::escapeHTML($pdflatex_cmd)).<span class="stringliteral">&quot;&#39; (exit=$exit signal=$signal core=$core).&quot;</span>);
        
<span class="preprocessor">        # read hardcopy.log and report first error</span>
<span class="preprocessor"></span>        my $hardcopy_log = <span class="stringliteral">&quot;$temp_dir_path/hardcopy.log&quot;</span>;
        <span class="keywordflow">if</span> (-e $hardcopy_log) {
            <span class="keywordflow">if</span> (open my $LOG, <span class="stringliteral">&quot;&lt;&quot;</span>, $hardcopy_log) {
                my $line;
                <span class="keywordflow">while</span> ($line = &lt;$LOG&gt;) {
                    last <span class="keywordflow">if</span> $line =~ /^!\s+/;
                }
                my $first_error = $line;
                <span class="keywordflow">while</span> ($line = &lt;$LOG&gt;) {
                    last <span class="keywordflow">if</span> $line =~ /^!\s+/;
                    $first_error .= $line;
                }
                close $LOG;
                <span class="keywordflow">if</span> (defined $first_error) {
                    $self-&gt;add_errors(<span class="stringliteral">&quot;First error in TeX log is:&quot;</span>.CGI::br().
                        CGI::pre(CGI::escapeHTML($first_error)));
                } <span class="keywordflow">else</span> {
                    $self-&gt;add_errors(<span class="stringliteral">&quot;No errors encoundered in TeX log.&quot;</span>);
                }
            } <span class="keywordflow">else</span> {
                $self-&gt;add_errors(<span class="stringliteral">&quot;Could not read TeX log: &quot;</span>.CGI::code(CGI::escapeHTML($!)));
            }
        } <span class="keywordflow">else</span> {
            $self-&gt;add_errors(<span class="stringliteral">&quot;No TeX log was found.&quot;</span>);
        }
    }
    
    my $final_file_name;
    
<span class="preprocessor">    # try rename the pdf file</span>
<span class="preprocessor"></span>    my $src_name = <span class="stringliteral">&quot;hardcopy.pdf&quot;</span>;
    my $dest_name = <span class="stringliteral">&quot;$final_file_basename.pdf&quot;</span>;
    my $mv_cmd = <span class="stringliteral">&quot;2&gt;&amp;1 &quot;</span> . $self-&gt;r-&gt;ce-&gt;{externalPrograms}{mv} . <span class="stringliteral">&quot; &quot;</span> . shell_quote(<span class="stringliteral">&quot;$temp_dir_path/$src_name&quot;</span>, <span class="stringliteral">&quot;$temp_dir_path/$dest_name&quot;</span>);
    my $mv_out = readpipe $mv_cmd;
    <span class="keywordflow">if</span> ($?) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Failed to rename &#39;&quot;</span>.CGI::code(CGI::escapeHTML($src_name)).<span class="stringliteral">&quot;&#39; to &#39;&quot;</span>
            .CGI::code(CGI::escapeHTML($dest_name)).<span class="stringliteral">&quot;&#39; in directory &#39;&quot;</span>
            .CGI::code(CGI::escapeHTML($temp_dir_path)).<span class="stringliteral">&quot;&#39;:&quot;</span>.CGI::br()
            .CGI::pre(CGI::escapeHTML($mv_out)));
        $final_file_name = $src_name;
    } <span class="keywordflow">else</span> {
        $final_file_name = $dest_name;
    }
    
    <span class="keywordflow">return</span> $final_file_name, qw/hardcopy.tex hardcopy.log hardcopy.aux pdflatex.stdout pdflatex.stderr/;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="afe3c1f87634948e2242776556c90ebbb"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::generate_hardcopy_tex" ref="afe3c1f87634948e2242776556c90ebbb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::generate_hardcopy_tex </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-generate_hardcopy_tex' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-generate_hardcopy_tex-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-generate_hardcopy_tex-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-generate_hardcopy_tex-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in generate_hardcopy_tex: 22</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#afe3c1f87634948e2242776556c90ebbb">generate_hardcopy_tex</a> {
    my ($self, $temp_dir_path, $final_file_basename) = @_;
    
    my $final_file_name;
    
<span class="preprocessor">    # try to rename tex file</span>
<span class="preprocessor"></span>    my $src_name = <span class="stringliteral">&quot;hardcopy.tex&quot;</span>;
    my $dest_name = <span class="stringliteral">&quot;$final_file_basename.tex&quot;</span>;
    my $mv_cmd = <span class="stringliteral">&quot;2&gt;&amp;1 &quot;</span> . $self-&gt;r-&gt;ce-&gt;{externalPrograms}{mv} . <span class="stringliteral">&quot; &quot;</span> . shell_quote(<span class="stringliteral">&quot;$temp_dir_path/$src_name&quot;</span>, <span class="stringliteral">&quot;$temp_dir_path/$dest_name&quot;</span>);
    my $mv_out = readpipe $mv_cmd;
    <span class="keywordflow">if</span> ($?) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Failed to rename &#39;&quot;</span>.CGI::code(CGI::escapeHTML($src_name)).<span class="stringliteral">&quot;&#39; to &#39;&quot;</span>
            .CGI::code(CGI::escapeHTML($dest_name)).<span class="stringliteral">&quot;&#39; in directory &#39;&quot;</span>
            .CGI::code(CGI::escapeHTML($temp_dir_path)).<span class="stringliteral">&quot;&#39;:&quot;</span>.CGI::br()
            .CGI::pre(CGI::escapeHTML($mv_out)));
        $final_file_name = $src_name;
    } <span class="keywordflow">else</span> {
        $final_file_name = $dest_name;
    }
    
    <span class="keywordflow">return</span> $final_file_name;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="af8df2b5a1acd0a305eddb773796d76d0"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::get_errors" ref="af8df2b5a1acd0a305eddb773796d76d0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::get_errors </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_errors' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-get_errors-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_errors-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_errors-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in get_errors: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#af8df2b5a1acd0a305eddb773796d76d0">get_errors</a> {
    my ($self) = @_;
    <span class="keywordflow">return</span> $self-&gt;{hardcopy_errors} ? @{$self-&gt;{hardcopy_errors}} : ();
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a812af2db57c15d9d3b7df8cd277abc21"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::get_errors_ref" ref="a812af2db57c15d9d3b7df8cd277abc21" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::get_errors_ref </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_errors_ref' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-get_errors_ref-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_errors_ref-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_errors_ref-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in get_errors_ref: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a812af2db57c15d9d3b7df8cd277abc21">get_errors_ref</a> {
    my ($self) = @_;
    <span class="keywordflow">return</span> $self-&gt;{hardcopy_errors};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a5b7bbbf5cc89753ae71b10f49962316d"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::pre_header_initialize" ref="a5b7bbbf5cc89753ae71b10f49962316d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::pre_header_initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-pre_header_initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-pre_header_initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-pre_header_initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-pre_header_initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in pre_header_initialize: 151</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a5b7bbbf5cc89753ae71b10f49962316d">pre_header_initialize</a> {
    my ($self) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $authz = $r-&gt;authz;
    
    my $userID = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    my $eUserID = $r-&gt;param(<span class="stringliteral">&quot;effectiveUser&quot;</span>);
    my @setIDs = $r-&gt;param(<span class="stringliteral">&quot;selected_sets&quot;</span>);
    my @userIDs = $r-&gt;param(<span class="stringliteral">&quot;selected_users&quot;</span>);
    my $hardcopy_format = $r-&gt;param(<span class="stringliteral">&quot;hardcopy_format&quot;</span>);
    my $generate_hardcopy = $r-&gt;param(<span class="stringliteral">&quot;generate_hardcopy&quot;</span>);
    my $send_existing_hardcopy = $r-&gt;param(<span class="stringliteral">&quot;send_existing_hardcopy&quot;</span>);
    my $final_file_url = $r-&gt;param(<span class="stringliteral">&quot;final_file_url&quot;</span>);
    
<span class="preprocessor">    # if there&#39;s an existing hardcopy file that can be sent, get set up to do that</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($send_existing_hardcopy) {
        $self-&gt;reply_with_redirect($final_file_url);
        $self-&gt;{final_file_url} = $final_file_url;
        $self-&gt;{send_hardcopy} = 1;
        <span class="keywordflow">return</span>;
    }

<span class="preprocessor">    # this should never happen, but apparently it did once (see bug #714), so we check for it</span>
<span class="preprocessor"></span>    die <span class="stringliteral">&quot;Parameter &#39;user&#39; not defined -- this should never happen&quot;</span> unless defined $userID;
    
    <span class="keywordflow">if</span> ($generate_hardcopy) {
        my $validation_failed = 0;
        
<span class="preprocessor">        # set default format</span>
<span class="preprocessor"></span>        $hardcopy_format = $HC_DEFAULT_FORMAT unless defined $hardcopy_format;
        
<span class="preprocessor">        # make sure format is valid</span>
<span class="preprocessor"></span>        unless (grep { $_ eq $hardcopy_format } keys %HC_FORMATS) {
            $self-&gt;addbadmessage(<span class="stringliteral">&quot;&#39;$hardcopy_format&#39; is not a valid hardcopy format.&quot;</span>);
            $validation_failed = 1;
        }
        
<span class="preprocessor">        # make sure we are allowed to generate hardcopy in this format</span>
<span class="preprocessor"></span>        unless ($authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;download_hardcopy_format_$hardcopy_format&quot;</span>)) {
            $self-&gt;addbadmessage(<span class="stringliteral">&quot;You do not have permission to generate hardcopy in $hardcopy_format format.&quot;</span>);
            $validation_failed = 1;
        }
        
<span class="preprocessor">        # is there at least one user and set selected?</span>
<span class="preprocessor"></span>        unless (@userIDs) {
            $self-&gt;addbadmessage(<span class="stringliteral">&quot;Please select at least one user and try again.&quot;</span>);
            $validation_failed = 1;
        }   

<span class="preprocessor"># when students don&#39;t select any sets the size of @setIDs is 1 with a null character in $setIDs[0].</span>
<span class="preprocessor"></span><span class="preprocessor"># when professors don&#39;t select any sets the size of @setIDs is 0. </span>
<span class="preprocessor"></span><span class="preprocessor"># the following test &quot;unless ((@setIDs) and ($setIDs[0] =~ /\S+/))&quot; catches both cases and prevents</span>
<span class="preprocessor"></span><span class="preprocessor"># warning messages in the case of a professor&#39;s empty array.</span>
<span class="preprocessor"></span>        unless ((@setIDs) and ($setIDs[0] =~ /\S+/)) {
            $self-&gt;addbadmessage(<span class="stringliteral">&quot;Please select at least one set and try again.&quot;</span>);
            $validation_failed = 1;         
        }
        
<span class="preprocessor">        # is the user allowed to request multiple sets/users at a time?</span>
<span class="preprocessor"></span>        my $perm_multiset = $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;download_hardcopy_multiset&quot;</span>);
        my $perm_multiuser = $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;download_hardcopy_multiuser&quot;</span>);
        
        my $perm_viewhidden = $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;view_hidden_work&quot;</span>);
        my $perm_viewfromip = $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;view_ip_restricted_sets&quot;</span>);
        
        <span class="keywordflow">if</span> (@setIDs &gt; 1 and not $perm_multiset) {
            $self-&gt;addbadmessage(<span class="stringliteral">&quot;You are not permitted to generate hardcopy for multiple sets. Please select a single set and try again.&quot;</span>);
            $validation_failed = 1;
        }
        <span class="keywordflow">if</span> (@userIDs &gt; 1 and not $perm_multiuser) {
            $self-&gt;addbadmessage(<span class="stringliteral">&quot;You are not permitted to generate hardcopy for multiple users. Please select a single user and try again.&quot;</span>);
            $validation_failed = 1;
        }
        <span class="keywordflow">if</span> (@userIDs and $userIDs[0] ne $eUserID and not $perm_multiuser) {
            $self-&gt;addbadmessage(<span class="stringliteral">&quot;You are not permitted to generate hardcopy for other users.&quot;</span>);
            $validation_failed = 1;
<span class="preprocessor">            # FIXME -- download_hardcopy_multiuser controls both whether a user can generate hardcopy</span>
<span class="preprocessor"></span><span class="preprocessor">            # that contains sets for multiple users AND whether she can generate hardcopy that contains</span>
<span class="preprocessor"></span><span class="preprocessor">            # sets for users other than herself. should these be separate permission levels?</span>
<span class="preprocessor"></span>        }

<span class="preprocessor">        # to check if the set has a &quot;hide_work&quot; flag, or if we aren&#39;t</span>
<span class="preprocessor"></span><span class="preprocessor">        #    allowed to view the set from the user&#39;s IP address, we </span>
<span class="preprocessor"></span><span class="preprocessor">        #    need the userset objects; if we&#39;ve not failed validation </span>
<span class="preprocessor"></span><span class="preprocessor">        #    yet, get those to check on this</span>
<span class="preprocessor"></span>        my %canShowScore = ();
        my %mergedSets = ();
        unless ($validation_failed ) {
            <span class="keywordflow">foreach</span> my $sid ( @setIDs ) {
                my($s,undef,$v) = ($sid =~ /([^,]+)(,v(\d+))?$/);
                <span class="keywordflow">foreach</span> my $uid ( @userIDs ) {
                    <span class="keywordflow">if</span> ( $perm_viewhidden &amp;&amp; $perm_viewfromip ) { 
                        $canShowScore{<span class="stringliteral">&quot;$uid!$sid&quot;</span>} = 1;
                    } <span class="keywordflow">else</span> {
                        my $userSet;
                        <span class="keywordflow">if</span> ( defined($v) ) {
                            $userSet = $db-&gt;getMergedSetVersion($uid,$s,$v);
                        } <span class="keywordflow">else</span> {
                            $userSet = $db-&gt;getMergedSet($uid,$s);
                        }
                        $mergedSets{<span class="stringliteral">&quot;$uid!$sid&quot;</span>} = $userSet;
                        <span class="keywordflow">if</span> ( ! $perm_viewhidden &amp;&amp;
                             defined( $userSet-&gt;hide_work ) &amp;&amp;
                             ( $userSet-&gt;hide_work eq <span class="charliteral">&#39;Y&#39;</span> ||
                               ( $userSet-&gt;hide_work eq <span class="stringliteral">&#39;BeforeAnswerDate&#39;</span> &amp;&amp;
                             time &lt; $userSet-&gt;answer_date ) ) ) {
                            $validation_failed = 1;
                            $self-&gt;addbadmessage(<span class="stringliteral">&quot;You are not permitted to generate a hardcopy for a set with hidden work.&quot;</span>);
                            last;
                        }

                        <span class="keywordflow">if</span> ( $authz-&gt;invalidIPAddress($userSet) ) {
                            $validation_failed = 1;
                            $self-&gt;addbadmessage(<span class="stringliteral">&quot;You are not allowed to generate a &quot;</span> .
                                         <span class="stringliteral">&quot;hardcopy for &quot;</span> . $userSet-&gt;set_id . 
                                         <span class="stringliteral">&quot; from your IP address, &quot;</span> .
                                         $r-&gt;connection-&gt;remote_ip . <span class="stringliteral">&quot;.&quot;</span>);
                            last;
                        }

                        $canShowScore{<span class="stringliteral">&quot;$uid!$sid&quot;</span>} = 
                            ( ! defined( $userSet-&gt;hide_score ) ||
                              $userSet-&gt;hide_score eq <span class="stringliteral">&#39;&#39;</span> ) ||
                            ( $userSet -&gt;hide_score eq <span class="charliteral">&#39;N&#39;</span> ||
                              ( $userSet-&gt;hide_score eq <span class="stringliteral">&#39;BeforeAnswerDate&#39;</span> &amp;&amp;
                                time &gt;= $userSet-&gt;answer_date ) );
<span class="preprocessor">#   die(&quot;hide_score = &quot;, $userSet-&gt;hide_score, &quot;; canshow{$uid!$sid} = &quot;, (($canShowScore{&quot;$uid!$sid&quot;})?&quot;True&quot;:&quot;False&quot;), &quot;\n&quot;);</span>
<span class="preprocessor"></span>
                    }
                    last <span class="keywordflow">if</span> $validation_failed;
                }
            }
        }
        
        unless ($validation_failed) {
            $self-&gt;{canShowScore} = \%canShowScore;
            $self-&gt;{mergedSets} = \%mergedSets;
            my ($final_file_url, %temp_file_map) = $self-&gt;generate_hardcopy($hardcopy_format, \@userIDs, \@setIDs);
            <span class="keywordflow">if</span> ($self-&gt;get_errors) {
<span class="preprocessor">                # store the URLs in self hash so that body() can make a link to it</span>
<span class="preprocessor"></span>                $self-&gt;{final_file_url} = $final_file_url;
                $self-&gt;{temp_file_map} = \%temp_file_map;
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # send the file only</span>
<span class="preprocessor"></span>                $self-&gt;reply_with_redirect($final_file_url);
            }
        }
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="adfe61230e5dc3ba2285fb64e41df4d2b"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::write_multiset_tex" ref="adfe61230e5dc3ba2285fb64e41df4d2b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::write_multiset_tex </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-write_multiset_tex' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-write_multiset_tex-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-write_multiset_tex-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-write_multiset_tex-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in write_multiset_tex: 22</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#adfe61230e5dc3ba2285fb64e41df4d2b">write_multiset_tex</a> {
    my ($self, $FH, $targetUserID, @setIDs) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    
<span class="preprocessor">    # get user record</span>
<span class="preprocessor"></span>    my $TargetUser = $db-&gt;getUser($targetUserID); # checked
    unless ($TargetUser) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Can&#39;t generate hardcopy for user &#39;&quot;</span>.CGI::code(CGI::escapeHTML($targetUserID)).<span class="stringliteral">&quot;&#39; -- no such user exists.\n&quot;</span>);
        <span class="keywordflow">return</span>;
    }
    
<span class="preprocessor">    # get set divider</span>
<span class="preprocessor"></span>    my $divider = $ce-&gt;{webworkFiles}-&gt;{hardcopySnippets}-&gt;{setDivider};
    
<span class="preprocessor">    # write each set</span>
<span class="preprocessor"></span>    <span class="keywordflow">while</span> (defined (my $setID = shift @setIDs)) {
        $self-&gt;write_set_tex($FH, $TargetUser, $setID);
        $self-&gt;write_tex_file($FH, $divider) <span class="keywordflow">if</span> @setIDs; # divide sets, but not after the last <span class="keyword">set</span>
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7f18738b9bb688ca30328bb5d2023a51"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::write_multiuser_tex" ref="a7f18738b9bb688ca30328bb5d2023a51" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::write_multiuser_tex </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-write_multiuser_tex' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-write_multiuser_tex-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-write_multiuser_tex-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-write_multiuser_tex-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in write_multiuser_tex: 25</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a7f18738b9bb688ca30328bb5d2023a51">write_multiuser_tex</a> {
    my ($self, $FH, $userIDsRef, $setIDsRef) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    
    my @userIDs = @$userIDsRef;
    my @setIDs = @$setIDsRef;
    
<span class="preprocessor">    # get snippets</span>
<span class="preprocessor"></span>    my $preamble = $ce-&gt;{webworkFiles}-&gt;{hardcopySnippets}-&gt;{preamble};
    my $postamble = $ce-&gt;{webworkFiles}-&gt;{hardcopySnippets}-&gt;{postamble};
    my $divider = $ce-&gt;{webworkFiles}-&gt;{hardcopySnippets}-&gt;{userDivider};
    
<span class="preprocessor">    # write preamble</span>
<span class="preprocessor"></span>    $self-&gt;write_tex_file($FH, $preamble);
    
<span class="preprocessor">    # write section for each user</span>
<span class="preprocessor"></span>    <span class="keywordflow">while</span> (defined (my $userID = shift @userIDs)) {
        $self-&gt;write_multiset_tex($FH, $userID, @setIDs);
        $self-&gt;write_tex_file($FH, $divider) <span class="keywordflow">if</span> @userIDs; # divide users, but not after the last user
    }
    
<span class="preprocessor">    # write postamble</span>
<span class="preprocessor"></span>    $self-&gt;write_tex_file($FH, $postamble);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2beb2d1c510efaf02acd1860353a85ba"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::write_problem_tex" ref="a2beb2d1c510efaf02acd1860353a85ba" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::write_problem_tex </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-write_problem_tex' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-write_problem_tex-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-write_problem_tex-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-write_problem_tex-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in write_problem_tex: 215</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a2beb2d1c510efaf02acd1860353a85ba">write_problem_tex</a> {
    my ($self, $FH, $TargetUser, $MergedSet, $problemID, $pgFile) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $authz  = $r-&gt;authz;
    my $userID = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);
    my $versioned = $self-&gt;{versioned};
    my %canShowScore = %{$self-&gt;{canShowScore}};

    my @errors;
    
<span class="preprocessor">    # get problem record</span>
<span class="preprocessor"></span>    my $MergedProblem;
    <span class="keywordflow">if</span> ($problemID) {
<span class="preprocessor">        # a non-zero problem ID was given -- load that problem</span>
<span class="preprocessor"></span><span class="preprocessor">            # we use $versioned to determine which merging routine to use</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( $versioned ) {
            $MergedProblem = $db-&gt;getMergedProblemVersion($MergedSet-&gt;user_id, $MergedSet-&gt;set_id, $MergedSet-&gt;version_id, $problemID);

        } <span class="keywordflow">else</span> {
            $MergedProblem = $db-&gt;getMergedProblem($MergedSet-&gt;user_id, $MergedSet-&gt;set_id, $problemID); # checked
        }
        
<span class="preprocessor">        # handle nonexistent problem</span>
<span class="preprocessor"></span>        unless ($MergedProblem) {
            $self-&gt;add_errors(<span class="stringliteral">&quot;Can&#39;t generate hardcopy for problem &#39;&quot;</span>
                .CGI::code(CGI::escapeHTML($problemID)).<span class="stringliteral">&quot;&#39; in set &#39;&quot;</span>
                .CGI::code(CGI::escapeHTML($MergedSet-&gt;set_id))
                .<span class="stringliteral">&quot;&#39; for user &#39;&quot;</span>.CGI::code(CGI::escapeHTML($MergedSet-&gt;user_id))
                .<span class="stringliteral">&quot;&#39; -- problem does not exist in that set or is not assigned to that user.&quot;</span>);
            <span class="keywordflow">return</span>;
        }
    } elsif ($pgFile) {
<span class="preprocessor">        # otherwise, we try an explicit PG file</span>
<span class="preprocessor"></span>        $MergedProblem = $db-&gt;newUserProblem(
            user_id =&gt; $MergedSet-&gt;user_id,
            set_id =&gt; $MergedSet-&gt;set_id,
            problem_id =&gt; 0,
            source_file =&gt; $pgFile,
            num_correct   =&gt; 0,
            num_incorrect =&gt; 0,
        );
        die <span class="stringliteral">&quot;newUserProblem failed -- WTF?&quot;</span> unless $MergedProblem; # <span class="keyword">this</span> should never happen
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # this shouldn&#39;t happen -- error out for real</span>
<span class="preprocessor"></span>        die <span class="stringliteral">&quot;write_problem_tex needs either a non-zero \$problemID or a \$pgFile&quot;</span>;
    }
    
<span class="preprocessor">    # figure out if we&#39;re allowed to get correct answers, hints, and solutions</span>
<span class="preprocessor"></span><span class="preprocessor">    # (eventually, we&#39;d like to be able to use the same code as Problem)</span>
<span class="preprocessor"></span>    my $versionName = $MergedSet-&gt;set_id . 
        (( $versioned ) ?  <span class="stringliteral">&quot;,v&quot;</span> . $MergedSet-&gt;version_id : <span class="stringliteral">&#39;&#39;</span>);

    my $showCorrectAnswers  = $r-&gt;param(<span class="stringliteral">&quot;showCorrectAnswers&quot;</span>) || 0;
    my $printStudentAnswers = $r-&gt;param(<span class="stringliteral">&quot;printStudentAnswers&quot;</span>) || 0;
    my $showHints           = $r-&gt;param(<span class="stringliteral">&quot;showHints&quot;</span>)          || 0;
    my $showSolutions       = $r-&gt;param(<span class="stringliteral">&quot;showSolutions&quot;</span>)      || 0;

    unless( ( $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;show_correct_answers_before_answer_date&quot;</span>) or
          ( time &gt; $MergedSet-&gt;answer_date or 
            ( $versioned &amp;&amp; 
              $MergedProblem-&gt;num_correct + 
              $MergedProblem-&gt;num_incorrect &gt;= 
              $MergedSet-&gt;attempts_per_version &amp;&amp;
              $MergedSet-&gt;due_date == $MergedSet-&gt;answer_date ) ) ) &amp;&amp;
        ( $canShowScore{$MergedSet-&gt;user_id . <span class="stringliteral">&quot;!$versionName&quot;</span>} ) ) {
        $showCorrectAnswers = 0;
        $showSolutions      = 0;
    }
    
<span class="preprocessor">    # FIXME -- there can be a problem if the $siteDefaults{timezone} is not defined?  Why is this?</span>
<span class="preprocessor"></span><span class="preprocessor">    # why does it only occur with hardcopy?</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # we need an additional translation option for versioned sets; also,</span>
<span class="preprocessor"></span><span class="preprocessor">    #   for versioned sets include old answers in the set if we&#39;re also </span>
<span class="preprocessor"></span><span class="preprocessor">    #   asking for the answers</span>
<span class="preprocessor"></span>    my $transOpts = 
        { # translation options
            displayMode     =&gt; <span class="stringliteral">&quot;tex&quot;</span>,
            showHints       =&gt; $showHints          ? 1 : 0, # insure that <span class="keyword">this</span> value is numeric
            showSolutions   =&gt; $showSolutions      ? 1 : 0, # (or what? -sam)
            processAnswers  =&gt; ($showCorrectAnswers || $printStudentAnswers) ? 1 : 0,
            permissionLevel =&gt; $db-&gt;getPermissionLevel($userID)-&gt;permission,
        };

    <span class="keywordflow">if</span> ( $versioned &amp;&amp; $MergedProblem-&gt;problem_id != 0 ) {

        $transOpts-&gt;{QUIZ_PREFIX} = <span class="charliteral">&#39;Q&#39;</span> . sprintf(<span class="stringliteral">&quot;%04d&quot;</span>,$MergedProblem-&gt;problem_id()) . <span class="charliteral">&#39;_&#39;</span>;

    }
    my $formFields = { };
    <span class="keywordflow">if</span> ( $showCorrectAnswers ||$printStudentAnswers ) { 
            my %oldAnswers = decodeAnswers($MergedProblem-&gt;last_answer);
            $formFields-&gt;{$_} = $oldAnswers{$_} <span class="keywordflow">foreach</span> (keys %oldAnswers);
            print $FH <span class="stringliteral">&quot;%% decoded old answers, saved. (keys = &quot;</span> . join(<span class="charliteral">&#39;,&#39;</span>, keys(%oldAnswers)) . <span class="stringliteral">&quot;\n&quot;</span>;
        }

<span class="preprocessor">#   warn(&quot;problem &quot;, $MergedProblem-&gt;problem_id, &quot;: source = &quot;, $MergedProblem-&gt;source_file, &quot;\n&quot;);</span>
<span class="preprocessor"></span>
    my $pg = <a class="code" href="classWeBWorK_1_1PG.html">WeBWorK::PG</a>-&gt;new(
        $ce,
        $TargetUser,
        scalar($r-&gt;param(<span class="stringliteral">&#39;key&#39;</span>)), # avoid multiple-values problem
        $MergedSet,
        $MergedProblem,
        $MergedSet-&gt;psvn,
        $formFields, # no form fields!
        $transOpts,
    );
    
<span class="preprocessor">    # only bother to generate this info if there were warnings or errors</span>
<span class="preprocessor"></span>    my $edit_url;
    my $problem_name;
    my $problem_desc;
    <span class="keywordflow">if</span> ($pg-&gt;{warnings} ne <span class="stringliteral">&quot;&quot;</span> or $pg-&gt;{flags}-&gt;{error_flag}) {
        my $edit_urlpath = $r-&gt;urlpath-&gt;newFromModule(
            <span class="stringliteral">&quot;WeBWorK::ContentGenerator::Instructor::PGProblemEditor&quot;</span>, $r,
            courseID  =&gt; $r-&gt;urlpath-&gt;arg(<span class="stringliteral">&quot;courseID&quot;</span>),
            setID     =&gt; $MergedProblem-&gt;set_id,
            problemID =&gt; $MergedProblem-&gt;problem_id,
        );
        
        <span class="keywordflow">if</span> ($MergedProblem-&gt;problem_id == 0) {
<span class="preprocessor">            # link for an fake problem (like a header file)</span>
<span class="preprocessor"></span>            $edit_url = $self-&gt;systemLink($edit_urlpath,
                params =&gt; {
                    sourceFilePath =&gt; $MergedProblem-&gt;source_file,
                    problemSeed    =&gt; $MergedProblem-&gt;problem_seed,
                },
            );
        } <span class="keywordflow">else</span> {
<span class="preprocessor">            # link for a real problem</span>
<span class="preprocessor"></span>            $edit_url = $self-&gt;systemLink($edit_urlpath);
        }
        
        <span class="keywordflow">if</span> ($MergedProblem-&gt;problem_id == 0) {
            $problem_name = <span class="stringliteral">&quot;snippet&quot;</span>;
            $problem_desc = $problem_name.<span class="stringliteral">&quot; &#39;&quot;</span>.$MergedProblem-&gt;source_file
                .<span class="stringliteral">&quot;&#39; for set &#39;&quot;</span>.$MergedProblem-&gt;set_id.<span class="stringliteral">&quot;&#39; and user &#39;&quot;</span>
                .$MergedProblem-&gt;user_id.<span class="stringliteral">&quot;&#39;&quot;</span>;
        } <span class="keywordflow">else</span> {
            $problem_name = <span class="stringliteral">&quot;problem&quot;</span>;
            $problem_desc = $problem_name.<span class="stringliteral">&quot; &#39;&quot;</span>.$MergedProblem-&gt;problem_id
                .<span class="stringliteral">&quot;&#39; in set &#39;&quot;</span>.$MergedProblem-&gt;set_id.<span class="stringliteral">&quot;&#39; for user &#39;&quot;</span>
                .$MergedProblem-&gt;user_id.<span class="stringliteral">&quot;&#39;&quot;</span>;
        }
    }
        
<span class="preprocessor">    # deal with PG warnings</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($pg-&gt;{warnings} ne <span class="stringliteral">&quot;&quot;</span>) {
        $self-&gt;add_errors(CGI::a({href=&gt;$edit_url, target=&gt;<span class="stringliteral">&quot;WW_Editor&quot;</span>}, <span class="stringliteral">&quot;[edit]&quot;</span>)
            .<span class="stringliteral">&quot; Warnings encountered while processing $problem_desc. &quot;</span>
            .<span class="stringliteral">&quot;Error text:&quot;</span>.CGI::br().CGI::pre(CGI::escapeHTML($pg-&gt;{warnings}))
        );
    }
    
<span class="preprocessor">    # deal with PG errors</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($pg-&gt;{flags}-&gt;{error_flag}) {
        $self-&gt;add_errors(CGI::a({href=&gt;$edit_url, target=&gt;<span class="stringliteral">&quot;WW_Editor&quot;</span>}, <span class="stringliteral">&quot;[edit]&quot;</span>)
            .<span class="stringliteral">&quot; Errors encountered while processing $problem_desc. &quot;</span>
            .<span class="stringliteral">&quot;This $problem_name has been omitted from the hardcopy. &quot;</span>
            .<span class="stringliteral">&quot;Error text:&quot;</span>.CGI::br().CGI::pre(CGI::escapeHTML($pg-&gt;{errors}))
        );
        <span class="keywordflow">return</span>;
    }
    
<span class="preprocessor">    # if we got here, there were no errors (because errors cause a return above)</span>
<span class="preprocessor"></span>    $self-&gt;{at_least_one_problem_rendered_without_error} = 1;

    print $FH <span class="stringliteral">&quot;{\\bf Problem $versioned.}\n&quot;</span> 
        <span class="keywordflow">if</span> ( $versioned &amp;&amp; $MergedProblem-&gt;problem_id != 0 );
    print $FH $pg-&gt;{body_text};

    my @ans_entry_order = defined($pg-&gt;{flags}-&gt;{ANSWER_ENTRY_ORDER}) ? @{$pg-&gt;{flags}-&gt;{ANSWER_ENTRY_ORDER}} : ( );

<span class="preprocessor">    # print the list of student answers if it is requested</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (  $printStudentAnswers &amp;&amp; 
         $MergedProblem-&gt;problem_id != 0 &amp;&amp; @ans_entry_order ) {
            my $recScore = $pg-&gt;{state}-&gt;{recorded_score};
            my $corrMsg = <span class="stringliteral">&#39;&#39;</span>;
            <span class="keywordflow">if</span> ( $recScore == 1 ) {
                $corrMsg = <span class="stringliteral">&#39; (correct)&#39;</span>;
            } elsif ( $recScore == 0 ) {
                $corrMsg = <span class="stringliteral">&#39; (incorrect)&#39;</span>;
            } <span class="keywordflow">else</span> {
                $corrMsg = <span class="stringliteral">&quot; (score $recScore)&quot;</span>;
            }
        my $stuAnswers = <span class="stringliteral">&quot;\\par{\\small{\\it Answer(s) submitted:}\n&quot;</span> .
            <span class="stringliteral">&quot;\\vspace{-\\parskip}\\begin{itemize}\n&quot;</span>;
        <span class="keywordflow">for</span> my $ansName ( @ans_entry_order ) {
            my $stuAns = $pg-&gt;{answers}-&gt;{$ansName}-&gt;{original_student_ans};
            $stuAnswers .= <span class="stringliteral">&quot;\\item\\begin{verbatim}$stuAns\\end{verbatim}\n&quot;</span>;
        }
        $stuAnswers .= <span class="stringliteral">&quot;\\end{itemize}}$corrMsg\\par\n&quot;</span>;
        print $FH $stuAnswers;
    }
    
<span class="preprocessor">    # write the list of correct answers is appropriate; ANSWER_ENTRY_ORDER</span>
<span class="preprocessor"></span><span class="preprocessor">    #   isn&#39;t defined for versioned sets?  this seems odd FIXME  GWCHANGE</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($showCorrectAnswers &amp;&amp; $MergedProblem-&gt;problem_id != 0 &amp;&amp; @ans_entry_order) {
        my $correctTeX = <span class="stringliteral">&quot;\\par{\\small{\\it Correct Answers:}\n&quot;</span>
            . <span class="stringliteral">&quot;\\vspace{-\\parskip}\\begin{itemize}\n&quot;</span>;
        
        <span class="keywordflow">foreach</span> my $ansName (@ans_entry_order) {
            my $correctAnswer = $pg-&gt;{answers}-&gt;{$ansName}-&gt;{correct_ans};
            $correctTeX .= <span class="stringliteral">&quot;\\item\\begin{verbatim}$correctAnswer\\end{verbatim}\n&quot;</span>;
<span class="preprocessor">            # FIXME: What about vectors (where TeX will complain about &lt; and &gt; outside of math mode)?</span>
<span class="preprocessor"></span>        }
        
        $correctTeX .= <span class="stringliteral">&quot;\\end{itemize}}\\par\n&quot;</span>;
        
        print $FH $correctTeX;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a71cd787eeea8b8462bfd29572684d391"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::write_set_tex" ref="a71cd787eeea8b8462bfd29572684d391" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::write_set_tex </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-write_set_tex' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-write_set_tex-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-write_set_tex-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-write_set_tex-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in write_set_tex: 102</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#a71cd787eeea8b8462bfd29572684d391">write_set_tex</a> {
    my ($self, $FH, $TargetUser, $setID) = @_;
    my $r = $self-&gt;r;
    my $ce = $r-&gt;ce;
    my $db = $r-&gt;db;
    my $authz  = $r-&gt;authz;
    my $userID = $r-&gt;param(<span class="stringliteral">&quot;user&quot;</span>);

<span class="preprocessor">    # we may already have the MergedSet from checking hide_work and </span>
<span class="preprocessor"></span><span class="preprocessor">    #    hide_score in pre_header_initialize; check to see if that&#39;s true,</span>
<span class="preprocessor"></span><span class="preprocessor">    #    and otherwise, get the set.</span>
<span class="preprocessor"></span>    my %mergedSets = %{$self-&gt;{mergedSets}};
    my $uid = $TargetUser-&gt;user_id;
    my $MergedSet;
    my $versioned = 0;
    <span class="keywordflow">if</span> ( defined( $mergedSets{<span class="stringliteral">&quot;$uid!$setID&quot;</span>} ) ) {
        $MergedSet = $mergedSets{<span class="stringliteral">&quot;$uid!$setID&quot;</span>};
        $versioned = ($setID =~ /,v(\d+)$/) ? $1 : 0;
    } <span class="keywordflow">else</span> {
        <span class="keywordflow">if</span> ( $setID =~ /(.+),v(\d+)$/ ) {
            $setID = $1;
            $versioned = $2;
        }
        <span class="keywordflow">if</span> ( $versioned ) {
            $MergedSet = $db-&gt;getMergedSetVersion($TargetUser-&gt;user_id, $setID, $versioned);
        } <span class="keywordflow">else</span> {
            $MergedSet = $db-&gt;getMergedSet($TargetUser-&gt;user_id, $setID); # checked
        }
    }
<span class="preprocessor">    # save versioned info for use in write_problem_tex</span>
<span class="preprocessor"></span>    $self-&gt;{versioned} = $versioned;

    unless ($MergedSet) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Can&#39;t generate hardcopy for set &#39;&#39;&quot;</span>.CGI::code(CGI::escapeHTML($setID))
            .<span class="stringliteral">&quot;&#39; for user &#39;&quot;</span>.CGI::code(CGI::escapeHTML($TargetUser-&gt;user_id))
            .<span class="stringliteral">&quot;&#39; -- set is not assigned to that user.&quot;</span>);
        <span class="keywordflow">return</span>;
    }
    
<span class="preprocessor">    # see if the *real* user is allowed to access this problem set</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($MergedSet-&gt;open_date &gt; time and not $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;view_unopened_sets&quot;</span>)) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Can&#39;t generate hardcopy for set &#39;&quot;</span>.CGI::code(CGI::escapeHTML($setID))
            .<span class="stringliteral">&quot;&#39; for user &#39;&quot;</span>.CGI::code(CGI::escapeHTML($TargetUser-&gt;user_id))
            .<span class="stringliteral">&quot;&#39; -- set is not yet open.&quot;</span>);
        <span class="keywordflow">return</span>;
    }
    <span class="keywordflow">if</span> (not $MergedSet-&gt;visible and not $authz-&gt;hasPermissions($userID, <span class="stringliteral">&quot;view_hidden_sets&quot;</span>)) {
        $self-&gt;addbadmessage(<span class="stringliteral">&quot;Can&#39;t generate hardcopy for set &#39;&quot;</span>.CGI::code(CGI::escapeHTML($setID))
            .<span class="stringliteral">&quot;&#39; for user &#39;&quot;</span>.CGI::code(CGI::escapeHTML($TargetUser-&gt;user_id))
            .<span class="stringliteral">&quot;&#39; -- set is not visible to students.&quot;</span>);
        <span class="keywordflow">return</span>;
    }
    
<span class="preprocessor">    # get snippets</span>
<span class="preprocessor"></span>    my $header = $MergedSet-&gt;hardcopy_header
        ? $MergedSet-&gt;hardcopy_header
        : $ce-&gt;{webworkFiles}-&gt;{hardcopySnippets}-&gt;{setHeader};
  <span class="keywordflow">if</span> ($header eq <span class="stringliteral">&#39;defaultHeader&#39;</span>) {$header = $ce-&gt;{webworkFiles}-&gt;{hardcopySnippets}-&gt;{setHeader};}
    my $footer = $ce-&gt;{webworkFiles}-&gt;{hardcopySnippets}-&gt;{setFooter};
    my $divider = $ce-&gt;{webworkFiles}-&gt;{hardcopySnippets}-&gt;{problemDivider};
    
<span class="preprocessor">    # get list of problem IDs</span>
<span class="preprocessor"></span><span class="preprocessor">    # DBFIXME use ORDER BY in database</span>
<span class="preprocessor"></span>    my @problemIDs = sort { $a &lt;=&gt; $b } $db-&gt;listUserProblems($MergedSet-&gt;user_id, $MergedSet-&gt;set_id);

<span class="preprocessor">    # for versioned sets (gateways), we might have problems in a random</span>
<span class="preprocessor"></span><span class="preprocessor">    # order; reset the order of the problemIDs if this is the case</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( defined( $MergedSet-&gt;problem_randorder ) &amp;&amp; 
         $MergedSet-&gt;problem_randorder ) {
        my @newOrder = ();

<span class="preprocessor">    # to set the same order each time we set the random seed to the psvn,</span>
<span class="preprocessor"></span><span class="preprocessor">    # and to avoid messing with the system random number generator we use</span>
<span class="preprocessor"></span><span class="preprocessor">    # our own PGrandom object</span>
<span class="preprocessor"></span>        my $pgrand = PGrandom-&gt;new();
        $pgrand-&gt;srand( $MergedSet-&gt;psvn );
        <span class="keywordflow">while</span> ( @problemIDs ) {
            my $i = int($pgrand-&gt;rand(scalar(@problemIDs)));
            push( @newOrder, $problemIDs[$i] );
            splice(@problemIDs, $i, 1);
        }
        @problemIDs = @newOrder;
    }
            
    
<span class="preprocessor">    # write set header</span>
<span class="preprocessor"></span>    $self-&gt;write_problem_tex($FH, $TargetUser, $MergedSet, 0, $header); # 0 =&gt; pg file specified directly
    
<span class="preprocessor">    # write each problem</span>
<span class="preprocessor"></span><span class="preprocessor">    # for versioned problem sets (gateway tests) we like to include </span>
<span class="preprocessor"></span><span class="preprocessor">    #   problem numbers</span>
<span class="preprocessor"></span>    my $i = 1;
    <span class="keywordflow">while</span> (my $problemID = shift @problemIDs) {
        $self-&gt;write_tex_file($FH, $divider);
        $self-&gt;{versioned} = $i <span class="keywordflow">if</span> $versioned;
        $self-&gt;write_problem_tex($FH, $TargetUser, $MergedSet, $problemID);
        $i++;
    }
    
<span class="preprocessor">    # write footer</span>
<span class="preprocessor"></span>    $self-&gt;write_problem_tex($FH, $TargetUser, $MergedSet, 0, $footer); # 0 =&gt; pg file specified directly
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae8b3b13e9ba93ec88761c5147696c4b2"></a><!-- doxytag: member="WeBWorK::ContentGenerator::Hardcopy::write_tex_file" ref="ae8b3b13e9ba93ec88761c5147696c4b2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::ContentGenerator::Hardcopy::write_tex_file </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-write_tex_file' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-write_tex_file-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-write_tex_file-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-write_tex_file-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in write_tex_file: 11</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1ContentGenerator_1_1Hardcopy.html#ae8b3b13e9ba93ec88761c5147696c4b2">write_tex_file</a> {
    my ($self, $FH, $file) = @_;
    
    my $tex = eval { readFile($file) };
    <span class="keywordflow">if</span> ($@) {
        $self-&gt;add_errors(<span class="stringliteral">&quot;Failed to include TeX file &#39;&quot;</span>.CGI::code(CGI::escapeHTML($file)).<span class="stringliteral">&quot;&#39;: &quot;</span>
            .CGI::escapeHTML($@));
    } <span class="keywordflow">else</span> {
        print $FH $tex;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="Hardcopy_8pm_source.html">Hardcopy.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:57:23 2012 for WeBWorK2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
