<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PG: PGcomplexmacros.pl Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>PGcomplexmacros.pl</h1><a href="lib_2Parser_2Legacy_2PGcomplexmacros_8pl.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor"># This file     is PGcomplexmacros.pl</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor"># This includes the subroutines for the ANS macros, that</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor"># is, macros allowing a more flexible answer checking</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor">####################################################################</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span><span class="preprocessor"># Copyright @ 1995-2002 The WeBWorK Team</span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor"># All Rights Reserved</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span><span class="preprocessor">####################################################################</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#$Id$</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 =head1 NAME
<a name="l00012"></a>00012 
<a name="l00013"></a>00013     Macros <span class="keywordflow">for</span> complex numbers <span class="keywordflow">for</span> the <a class="code" href="classWeBWorK_1_1PG.html">PG</a> language
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 =head1 SYNPOSIS
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 =head1 DESCRIPTION
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 =cut
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 BEGIN{
<a name="l00025"></a>00025     be_strict();
<a name="l00026"></a>00026     
<a name="l00027"></a>00027 }
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 sub _PGcomplexmacros_init {
<a name="l00032"></a>00032 }
<a name="l00033"></a>00033 <span class="preprocessor"># export functions from Complex1.</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="keywordflow">foreach</span> my $f (@Complex1::EXPORT) {
<a name="l00036"></a>00036 <span class="preprocessor">#       #PG_restricted_eval(&quot;\*$f = \*Complex1::$f&quot;); # this is too clever -- </span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">                                                      # the original subroutines are destroyed</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#           next if $f eq &#39;sqrt&#39;;  #exporting the square root caused conflicts with the standard version</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#                                       # You can still use Complex1::sqrt to take square root of complex numbers</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#           next if $f eq &#39;log&#39;;  #exporting loq caused conflicts with the standard version</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#                               # You can still use Complex1::log to take square root of complex numbers</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a>00043     next <span class="keywordflow">if</span> $f eq <span class="charliteral">&#39;i&#39;</span> || $f eq <span class="stringliteral">&#39;pi&#39;</span>;
<a name="l00044"></a>00044     my $code = PG_restricted_eval(<span class="stringliteral">&quot;\\&amp;CommonFunction::$f&quot;</span>);
<a name="l00045"></a>00045     <span class="keywordflow">if</span> (defined($code) &amp;&amp; defined(&amp;{$code})) {
<a name="l00046"></a>00046         $CommonFunction::function{$f} = <span class="stringliteral">&quot;Complex1::$f&quot;</span>;  # PGcommonMacros now takes care of this.
<a name="l00047"></a>00047     } <span class="keywordflow">else</span> {
<a name="l00048"></a>00048         my $string = qq{sub main::$f {&amp;Complex1::$f}};
<a name="l00049"></a>00049         PG_restricted_eval($string);
<a name="l00050"></a>00050     }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor"># You need to add </span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor"># sub i();  # to your problem or else to dangerousMacros.pl</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor"># in order to use expressions such as 1 +3*i;</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor"># Without this prototype you would have to write 1+3*i();</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor"># The prototype has to be defined at compile time, but dangerousMacros.pl is complied first.</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#Complex1::display_format(&#39;cartesian&#39;);</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="preprocessor"># number format used frequently in strict prefilters</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>my $number = <span class="stringliteral">&#39;([+-]?)(?=\d|\.\d)\d*(\.\d*)?(E([+-]?\d+))?&#39;</span>;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 =head3 cplx_cmp
<a name="l00069"></a>00069     
<a name="l00070"></a>00070 <span class="preprocessor"> #  This subroutine compares complex numbers.</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor"> #  Available prefilters include:</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor"> #  each of these are called by cplx_cmp( answer, mode =&gt; &#39;(prefilter name)&#39; )</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor"> #  &#39;std&#39;           The standard comparison method for complex numbers. This option it the default</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor"> #              and works with any combination of cartesian numbers, polar numbers, and</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor"> #              functions. The default display method is cartesian, for all methods, but if</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="preprocessor"> #              the student answer is polar, even in part, then their answer will be displayed</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor"> #              that way.</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor"> #  &#39;strict_polar&#39;      This is still under developement. The idea is to check to make sure that there</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor"> #              only a single term in front of the e and after it... but the method does not</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="preprocessor"> #              check to make sure that the i is in the exponent, nor does it handle cases</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span><span class="preprocessor"> #              where the polar has e** coefficients.</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="preprocessor"> #  &#39;strict_num_cartesian&#39;  This prefilter allows only complex numbers of the form &quot;a+bi&quot; where a and b</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="preprocessor"> #              are strictly numbers.</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="preprocessor"> #  &#39;strict_num_polar&#39;  This prefilter allows only complex numbers of the form &quot;ae^(bi)&quot; where a and b</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span><span class="preprocessor"> #              are strictly numbers.</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span><span class="preprocessor"> #  &#39;strict&#39;        This is a combination of strict_num_cartesian and strict_num_polar, so it</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor"> #              allows complex numbers of either the form &quot;a+bi&quot; or &quot;ae^(bi)&quot; where a and b</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span><span class="preprocessor"> #              are strictly numbers.</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 =cut
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 my %cplx_context = (
<a name="l00094"></a>00094     <span class="stringliteral">&#39;std&#39;</span> =&gt; <span class="stringliteral">&#39;Complex&#39;</span>,
<a name="l00095"></a>00095     <span class="stringliteral">&#39;strict&#39;</span> =&gt; <span class="stringliteral">&#39;LimitedComplex-strict&#39;</span>,
<a name="l00096"></a>00096     <span class="stringliteral">&#39;strict_polar&#39;</span> =&gt; <span class="stringliteral">&#39;LimitedComplex-polar&#39;</span>,
<a name="l00097"></a>00097     <span class="stringliteral">&#39;strict_cartesian&#39;</span> =&gt; <span class="stringliteral">&#39;LimitedComplex-cartesian&#39;</span>,
<a name="l00098"></a>00098     <span class="stringliteral">&#39;strict_num_polar&#39;</span> =&gt; <span class="stringliteral">&#39;LimitedComplex-polar-strict&#39;</span>,
<a name="l00099"></a>00099     <span class="stringliteral">&#39;strict_num_cartesian&#39;</span> =&gt; <span class="stringliteral">&#39;LimitedComplex-cartesian-strict&#39;</span>,
<a name="l00100"></a>00100 );
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 sub cplx_cmp {
<a name="l00103"></a>00103     <span class="keywordflow">return</span> original_cplx_cmp(@_) if $main::useOldAnswerMacros;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     my $correctAnswer = shift;
<a name="l00106"></a>00106     my %cplx_params = @_;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="preprocessor">#</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span><span class="preprocessor">    #  Get default options</span>
<a name="l00110"></a>00110 <span class="preprocessor"></span><span class="preprocessor">    #</span>
<a name="l00111"></a>00111 <span class="preprocessor"></span>    assign_option_aliases( \%cplx_params,
<a name="l00112"></a>00112         <span class="stringliteral">&#39;reltol&#39;</span>        =&gt;  <span class="stringliteral">&#39;relTol&#39;</span>,
<a name="l00113"></a>00113     );
<a name="l00114"></a>00114     set_default_options(\%cplx_params,
<a name="l00115"></a>00115         <span class="stringliteral">&#39;tolType&#39;</span>       =&gt;  (defined($cplx_params{tol}) ) ? <span class="stringliteral">&#39;absolute&#39;</span> : <span class="stringliteral">&#39;relative&#39;</span>,
<a name="l00116"></a>00116             # <span class="keywordflow">default</span> mode should be relative, to obtain <span class="keyword">this</span> tol must not be defined
<a name="l00117"></a>00117         <span class="stringliteral">&#39;tolerance&#39;</span>     =&gt;  $main::numAbsTolDefault, 
<a name="l00118"></a>00118         <span class="stringliteral">&#39;relTol&#39;</span>        =&gt;  $main::numRelPercentTolDefault,
<a name="l00119"></a>00119         <span class="stringliteral">&#39;zeroLevel&#39;</span>     =&gt;  $main::numZeroLevelDefault,
<a name="l00120"></a>00120         <span class="stringliteral">&#39;zeroLevelTol&#39;</span>      =&gt;  $main::numZeroLevelTolDefault,
<a name="l00121"></a>00121         <span class="stringliteral">&#39;format&#39;</span>        =&gt;  $main::numFormatDefault,
<a name="l00122"></a>00122         <span class="stringliteral">&#39;debug&#39;</span>         =&gt;  0,
<a name="l00123"></a>00123         <span class="stringliteral">&#39;mode&#39;</span>          =&gt;  <span class="stringliteral">&#39;std&#39;</span>,
<a name="l00124"></a>00124         <span class="stringliteral">&#39;strings&#39;</span>       =&gt;  undef,
<a name="l00125"></a>00125     );
<a name="l00126"></a>00126     my $format          =   $cplx_params{<span class="stringliteral">&#39;format&#39;</span>};
<a name="l00127"></a>00127     my $mode            =   $cplx_params{<span class="stringliteral">&#39;mode&#39;</span>};
<a name="l00128"></a>00128     
<a name="l00129"></a>00129     <span class="keywordflow">if</span>( $cplx_params{tolType} eq <span class="stringliteral">&#39;relative&#39;</span> ) {
<a name="l00130"></a>00130         $cplx_params{<span class="stringliteral">&#39;tolerance&#39;</span>} = .01*$cplx_params{<span class="stringliteral">&#39;relTol&#39;</span>};
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     my $context = $cplx_context{$mode};
<a name="l00134"></a>00134     unless ($context) {$context = <span class="stringliteral">&quot;Complex&quot;</span>; warn <span class="stringliteral">&quot;Unknown mode &#39;$mode&#39;&quot;</span>}
<a name="l00135"></a>00135     $context = <a class="code" href="classParser_1_1Context.html">Parser::Context</a>-&gt;getCopy(\%main::context,$context);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="preprocessor">    #</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span><span class="preprocessor">    #  Set the format for the context</span>
<a name="l00139"></a>00139 <span class="preprocessor"></span><span class="preprocessor">    #</span>
<a name="l00140"></a>00140 <span class="preprocessor"></span>    $context-&gt;{format}{number} = $cplx_params{<span class="stringliteral">&#39;format&#39;</span>} <span class="keywordflow">if</span> $cplx_params{<span class="stringliteral">&#39;format&#39;</span>};
<a name="l00141"></a>00141     
<a name="l00142"></a>00142 <span class="preprocessor">    #</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span><span class="preprocessor">    #  Add the strings to the context</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span><span class="preprocessor">    #</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ($cplx_params{<a class="code" href="PGstringevaluators_8pl.html#a06b59ff01c251186550d61193ec7f328">strings</a>}) {
<a name="l00146"></a>00146       <span class="keywordflow">foreach</span> my $string (@{$cplx_params{<a class="code" href="PGstringevaluators_8pl.html#a06b59ff01c251186550d61193ec7f328">strings</a>}}) {
<a name="l00147"></a>00147         my %tex = ($string =~ m/(-?)inf(inity)?/i)? (TeX =&gt; <span class="stringliteral">&quot;$1\\infty&quot;</span>): ();
<a name="l00148"></a>00148         $context-&gt;strings-&gt;add(uc($string) =&gt; {%tex})
<a name="l00149"></a>00149           unless $context-&gt;strings-&gt;get(uc($string));
<a name="l00150"></a>00150       }
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="preprocessor">    #</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span><span class="preprocessor">    #  Set the tolerances</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span><span class="preprocessor">    #</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ($cplx_params{tolType} eq <span class="stringliteral">&#39;absolute&#39;</span>) {
<a name="l00157"></a>00157       $context-&gt;flags-&gt;set(
<a name="l00158"></a>00158         tolerance =&gt; $cplx_params{tolerance},
<a name="l00159"></a>00159         tolType =&gt; <span class="stringliteral">&#39;absolute&#39;</span>,
<a name="l00160"></a>00160       );
<a name="l00161"></a>00161     } <span class="keywordflow">else</span> {
<a name="l00162"></a>00162       $context-&gt;flags-&gt;set(
<a name="l00163"></a>00163         tolerance =&gt; .01*$cplx_params{tolerance},
<a name="l00164"></a>00164         tolType =&gt; <span class="stringliteral">&#39;relative&#39;</span>,
<a name="l00165"></a>00165       );
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167     $context-&gt;flags-&gt;set(
<a name="l00168"></a>00168       zeroLevel =&gt; $cplx_params{zeroLevel},
<a name="l00169"></a>00169       zeroLevelTol =&gt; $cplx_params{zeroLevelTol},
<a name="l00170"></a>00170     );
<a name="l00171"></a>00171 
<a name="l00172"></a>00172 <span class="preprocessor">    #</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span><span class="preprocessor">    #  Get the proper Parser object for the professor&#39;s answer</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span><span class="preprocessor">    #  using the initialized context</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span><span class="preprocessor">    #</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>    my $oldContext = <a class="code" href="classParser_1_1Context.html">Parser::Context</a>-&gt;current(\%main::context,$context); my $z;
<a name="l00177"></a>00177     <span class="keywordflow">if</span> (ref($correctAnswer) =~ /^<a class="code" href="classComplex1.html">Complex1</a>?$/) {
<a name="l00178"></a>00178       $z = <a class="code" href="classValue_1_1Complex.html">Value::Complex</a>-&gt;new($correctAnswer-&gt;Re,$correctAnswer-&gt;Im);
<a name="l00179"></a>00179     } <span class="keywordflow">else</span> {
<a name="l00180"></a>00180       $z = <a class="code" href="classValue_1_1Formula.html">Value::Formula</a>-&gt;new($correctAnswer);
<a name="l00181"></a>00181       die <span class="stringliteral">&quot;The professor&#39;s answer can&#39;t be a formula&quot;</span> unless $z-&gt;isConstant;
<a name="l00182"></a>00182       $z = $z-&gt;eval; $z = <span class="keyword">new</span> <a class="code" href="classValue_1_1Complex.html">Value::Complex</a>($z) unless <a class="code" href="classValue.html">Value</a>::class($z) eq &#39;String&#39;;
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184     $z-&gt;{<a class="code" href="classValue.html#add93b80ff80a64824c703ee12d9a3f0e">correct_ans</a>} = $correctAnswer;
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="preprocessor">    #</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span><span class="preprocessor">    #  Get the answer checker from the parser object</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span><span class="preprocessor">    #</span>
<a name="l00189"></a>00189 <span class="preprocessor"></span>    my $cmp = $z-&gt;cmp;
<a name="l00190"></a>00190     $cmp-&gt;install_pre_filter(sub {
<a name="l00191"></a>00191       my $rh_ans = shift;
<a name="l00192"></a>00192       $rh_ans-&gt;{original_student_ans} = $rh_ans-&gt;{student_ans};
<a name="l00193"></a>00193       $rh_ans-&gt;{original_correct_ans} = $rh_ans-&gt;{correct_ans};
<a name="l00194"></a>00194       <span class="keywordflow">return</span> $rh_ans;
<a name="l00195"></a>00195     });
<a name="l00196"></a>00196     $cmp-&gt;install_post_filter(sub {
<a name="l00197"></a>00197       my $rh_ans = shift; my $z = $rh_ans-&gt;{student_value};
<a name="l00198"></a>00198 <span class="preprocessor">      #</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span><span class="preprocessor">      #  Stringify student answer (use polar form if student did)</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span><span class="preprocessor">      #</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (ref($z) &amp;&amp; $z-&gt;isNumber) {
<a name="l00202"></a>00202         $z = <a class="code" href="classValue_1_1Complex.html">Value::Complex</a>-&gt;new($z); # promote real to complex
<a name="l00203"></a>00203         <span class="keywordflow">if</span> ($rh_ans-&gt;{original_student_ans} =~ m/(^|[^a-zA-Z])e\s*(\^|\*\*)/) {
<a name="l00204"></a>00204           my ($a,$b) = ($z-&gt;mod,$z-&gt;arg);
<a name="l00205"></a>00205           unless ($context-&gt;flag(<span class="stringliteral">&#39;strict_numeric&#39;</span>)) {
<a name="l00206"></a>00206         my $rt = (<span class="keyword">new</span> <a class="code" href="classComplex.html">Complex</a>($z-&gt;Re-&gt;value,$z-&gt;Im-&gt;value))-&gt;stringify_polar;
<a name="l00207"></a>00207         ($a,$b) = ($rt =~ m/\[(.*),(.*)\]/);
<a name="l00208"></a>00208           }
<a name="l00209"></a>00209           $a = <a class="code" href="classValue_1_1Real.html">Value::Real</a>-&gt;new($a)-&gt;string;
<a name="l00210"></a>00210           $b = <a class="code" href="classValue_1_1Real.html">Value::Real</a>-&gt;new($b)-&gt;string <span class="keywordflow">if</span> <a class="code" href="classValue.html#a6e27e345d159fc9e3fcc8d2ac6b56dee">Value::matchNumber</a>($b);
<a name="l00211"></a>00211           <span class="keywordflow">if</span> ($b eq <span class="charliteral">&#39;0&#39;</span>) {
<a name="l00212"></a>00212         $rh_ans-&gt;{student_ans} = $a;
<a name="l00213"></a>00213           } <span class="keywordflow">else</span> {
<a name="l00214"></a>00214         <span class="keywordflow">if</span> ($a eq <span class="charliteral">&#39;1&#39;</span>) {$a = <span class="stringliteral">&#39;&#39;</span>} elsif ($a eq <span class="stringliteral">&#39;-1&#39;</span>) {$a = <span class="charliteral">&#39;-&#39;</span>} <span class="keywordflow">else</span> {$a .= <span class="charliteral">&#39;*&#39;</span>}
<a name="l00215"></a>00215         <span class="keywordflow">if</span> ($b eq <span class="charliteral">&#39;1&#39;</span>) {$b = <span class="charliteral">&#39;i&#39;</span>} elsif ($b eq <span class="stringliteral">&#39;-1&#39;</span>) {$b = <span class="stringliteral">&#39;(-i)&#39;</span>} <span class="keywordflow">else</span> {$b = <span class="stringliteral">&quot;($b i)&quot;</span>}
<a name="l00216"></a>00216         $rh_ans-&gt;{student_ans} = $a.<span class="stringliteral">&#39;e^&#39;</span>.$b;
<a name="l00217"></a>00217           }
<a name="l00218"></a>00218         } <span class="keywordflow">else</span> {
<a name="l00219"></a>00219           $rh_ans-&gt;{student_ans} = $rh_ans-&gt;{student_value}-&gt;string;
<a name="l00220"></a>00220         }
<a name="l00221"></a>00221       }
<a name="l00222"></a>00222       <span class="keywordflow">return</span> $rh_ans;
<a name="l00223"></a>00223     });
<a name="l00224"></a>00224     $cmp-&gt;{debug} = $cplx_params{debug};
<a name="l00225"></a>00225     <a class="code" href="classParser_1_1Context.html">Parser::Context</a>-&gt;current(\%main::context,$oldContext);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="keywordflow">return</span> $cmp;
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="preprocessor">#</span>
<a name="l00231"></a>00231 <span class="preprocessor"></span><span class="preprocessor">#  The original version, for backward compatibility</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span><span class="preprocessor">#  (can be removed when the Parser-based version is more fully tested.)</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span>sub original_cplx_cmp {
<a name="l00235"></a>00235     my $correctAnswer = shift;
<a name="l00236"></a>00236     my %cplx_params = @_;
<a name="l00237"></a>00237     
<a name="l00238"></a>00238     assign_option_aliases( \%cplx_params,
<a name="l00239"></a>00239         <span class="stringliteral">&#39;reltol&#39;</span>        =&gt;  <span class="stringliteral">&#39;relTol&#39;</span>,
<a name="l00240"></a>00240     );
<a name="l00241"></a>00241     set_default_options(\%cplx_params,
<a name="l00242"></a>00242         <span class="stringliteral">&#39;tolType&#39;</span>       =&gt;  (defined($cplx_params{tol}) ) ? <span class="stringliteral">&#39;absolute&#39;</span> : <span class="stringliteral">&#39;relative&#39;</span>,
<a name="l00243"></a>00243             # <span class="keywordflow">default</span> mode should be relative, to obtain <span class="keyword">this</span> tol must not be defined
<a name="l00244"></a>00244         <span class="stringliteral">&#39;tolerance&#39;</span>     =&gt;  $main::numAbsTolDefault, 
<a name="l00245"></a>00245         <span class="stringliteral">&#39;relTol&#39;</span>        =&gt;  $main::numRelPercentTolDefault,
<a name="l00246"></a>00246         <span class="stringliteral">&#39;zeroLevel&#39;</span>     =&gt;  $main::numZeroLevelDefault,
<a name="l00247"></a>00247         <span class="stringliteral">&#39;zeroLevelTol&#39;</span>      =&gt;  $main::numZeroLevelTolDefault,
<a name="l00248"></a>00248         <span class="stringliteral">&#39;format&#39;</span>        =&gt;  $main::numFormatDefault,
<a name="l00249"></a>00249         <span class="stringliteral">&#39;debug&#39;</span>         =&gt;  0,
<a name="l00250"></a>00250         <span class="stringliteral">&#39;mode&#39;</span>          =&gt;  <span class="stringliteral">&#39;std&#39;</span>,
<a name="l00251"></a>00251         <span class="stringliteral">&#39;strings&#39;</span>       =&gt;  undef,
<a name="l00252"></a>00252     );
<a name="l00253"></a>00253     my $format          =   $cplx_params{<span class="stringliteral">&#39;format&#39;</span>};
<a name="l00254"></a>00254     my $mode            =   $cplx_params{<span class="stringliteral">&#39;mode&#39;</span>};
<a name="l00255"></a>00255     
<a name="l00256"></a>00256     <span class="keywordflow">if</span>( $cplx_params{tolType} eq <span class="stringliteral">&#39;relative&#39;</span> ) {
<a name="l00257"></a>00257         $cplx_params{<span class="stringliteral">&#39;tolerance&#39;</span>} = .01*$cplx_params{<span class="stringliteral">&#39;relTol&#39;</span>};
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259     
<a name="l00260"></a>00260     my $formattedCorrectAnswer;
<a name="l00261"></a>00261     my $correct_num_answer;
<a name="l00262"></a>00262     my $corrAnswerIsString = 0;
<a name="l00263"></a>00263     
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     <span class="keywordflow">if</span> (defined($cplx_params{<a class="code" href="PGstringevaluators_8pl.html#a06b59ff01c251186550d61193ec7f328">strings</a>}) &amp;&amp; $cplx_params{<a class="code" href="PGstringevaluators_8pl.html#a06b59ff01c251186550d61193ec7f328">strings</a>}) {
<a name="l00266"></a>00266         my $legalString = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00267"></a>00267         my @legalStrings = @{$cplx_params{<a class="code" href="PGstringevaluators_8pl.html#a06b59ff01c251186550d61193ec7f328">strings</a>}};
<a name="l00268"></a>00268         $correct_num_answer = $correctAnswer;
<a name="l00269"></a>00269         $formattedCorrectAnswer = $correctAnswer;
<a name="l00270"></a>00270         <span class="keywordflow">foreach</span> $legalString (@legalStrings) {
<a name="l00271"></a>00271             <span class="keywordflow">if</span> ( uc($correctAnswer) eq uc($legalString) ) {
<a name="l00272"></a>00272                 $corrAnswerIsString = 1;
<a name="l00273"></a>00273                 
<a name="l00274"></a>00274                 last;
<a name="l00275"></a>00275             }
<a name="l00276"></a>00276         }         ## at <span class="keyword">this</span> point $corrAnswerIsString = 0 iff correct answer is numeric
<a name="l00277"></a>00277     } <span class="keywordflow">else</span> {
<a name="l00278"></a>00278         $correct_num_answer = $correctAnswer;
<a name="l00279"></a>00279         $formattedCorrectAnswer = prfmt( $correctAnswer, $cplx_params{<span class="stringliteral">&#39;format&#39;</span>} );
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281     $correct_num_answer = math_constants($correct_num_answer);
<a name="l00282"></a>00282     
<a name="l00283"></a>00283     my $PGanswerMessage = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 <span class="preprocessor">#########################################################################</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span><span class="preprocessor">#  The following lines don&#39;t have any effect (other than to take time and produce errors</span>
<a name="l00287"></a>00287 <span class="preprocessor"></span><span class="preprocessor">#  in the error log).  The $correctVal is replaced on the line following the comments,</span>
<a name="l00288"></a>00288 <span class="preprocessor"></span><span class="preprocessor">#  and the error values are never used.  It LOOKS like this was supposed to perform a</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span><span class="preprocessor">#  check on the professor&#39;s answer, but that is not occurring.  (There used to be some</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span><span class="preprocessor">#  error checking, but that was removed in version 1.9 and it had been commented out</span>
<a name="l00291"></a>00291 <span class="preprocessor"></span><span class="preprocessor">#  prior to that because it was always producing errors.  This is because $correct_num_answer</span>
<a name="l00292"></a>00292 <span class="preprocessor"></span><span class="preprocessor">#  usually is somethine like &quot;1+4i&quot;, which will produce a &quot;missing operation before &#39;i&#39;&quot;</span>
<a name="l00293"></a>00293 <span class="preprocessor"></span><span class="preprocessor">#  error, and &quot;1-i&quot; wil produce an &quot;amiguous use of &#39;-i&#39; resolved as &#39;-&amp;i&#39;&quot; message.</span>
<a name="l00294"></a>00294 <span class="preprocessor"></span><span class="preprocessor">#  You probably need a call to check_syntax and the other filters that are used on</span>
<a name="l00295"></a>00295 <span class="preprocessor"></span><span class="preprocessor">#  the student answer first. (Unless the item is already a reference to a Complex,</span>
<a name="l00296"></a>00296 <span class="preprocessor"></span><span class="preprocessor">#  in which canse you should just accept it.)</span>
<a name="l00297"></a>00297 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00298"></a>00298 <span class="preprocessor"></span><span class="preprocessor">#   my ($inVal,$correctVal,$PG_eval_errors,$PG_full_error_report);</span>
<a name="l00299"></a>00299 <span class="preprocessor"></span><span class="preprocessor">#   my $correctVal;</span>
<a name="l00300"></a>00300 <span class="preprocessor"></span><span class="preprocessor">#   if (defined($correct_num_answer) &amp;&amp; $correct_num_answer =~ /\S/ &amp;&amp; $corrAnswerIsString == 0 )   {</span>
<a name="l00301"></a>00301 <span class="preprocessor"></span><span class="preprocessor">#           ($correctVal, $PG_eval_errors,$PG_full_error_report) = PG_answer_eval($correct_num_answer);</span>
<a name="l00302"></a>00302 <span class="preprocessor"></span><span class="preprocessor">#   } else { # case of a string answer</span>
<a name="l00303"></a>00303 <span class="preprocessor"></span><span class="preprocessor">#       $PG_eval_errors = &#39; &#39;;</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span><span class="preprocessor">#       $correctVal = $correctAnswer;</span>
<a name="l00305"></a>00305 <span class="preprocessor"></span><span class="preprocessor">#   }   </span>
<a name="l00306"></a>00306 <span class="preprocessor"></span><span class="preprocessor">########################################################################</span>
<a name="l00307"></a>00307 <span class="preprocessor"></span>    my $correctVal = $correct_num_answer;
<a name="l00308"></a>00308     $correctVal = cplx( $correctVal, 0 ) unless ref($correctVal) =~/^<a class="code" href="classComplex.html">Complex</a>?/ || $corrAnswerIsString == 1;
<a name="l00309"></a>00309     
<a name="l00310"></a>00310     <span class="preprocessor">#construct the answer evaluator </span>
<a name="l00311"></a>00311 <span class="preprocessor"></span>        my $answer_evaluator             = <span class="keyword">new</span> <a class="code" href="classAnswerEvaluator.html">AnswerEvaluator</a>; 
<a name="l00312"></a>00312         $answer_evaluator-&gt;{debug}       = $cplx_params{debug};
<a name="l00313"></a>00313         $answer_evaluator-&gt;ans_hash(     
<a name="l00314"></a>00314                             correct_ans             =&gt;  $correctVal,
<a name="l00315"></a>00315                             type                    =&gt;  <span class="stringliteral">&quot;cplx_cmp&quot;</span>,
<a name="l00316"></a>00316                             tolerance               =&gt;  $cplx_params{tolerance},
<a name="l00317"></a>00317                             tolType                 =&gt;  <span class="stringliteral">&#39;absolute&#39;</span>, #   $cplx_params{tolType},
<a name="l00318"></a>00318                             original_correct_ans    =&gt;  $formattedCorrectAnswer,
<a name="l00319"></a>00319                             answerIsString          =&gt;  $corrAnswerIsString,
<a name="l00320"></a>00320                             answer_form             =&gt;  <span class="stringliteral">&#39;cartesian&#39;</span>,
<a name="l00321"></a>00321         );
<a name="l00322"></a>00322         my ($in, $formattedSubmittedAnswer);
<a name="l00323"></a>00323     $answer_evaluator-&gt;install_pre_filter(sub {my $rh_ans = shift; 
<a name="l00324"></a>00324         $rh_ans-&gt;{original_student_ans} = $rh_ans-&gt;{student_ans}; $rh_ans;}
<a name="l00325"></a>00325     );
<a name="l00326"></a>00326     <span class="keywordflow">if</span> (defined($cplx_params{<a class="code" href="PGstringevaluators_8pl.html#a06b59ff01c251186550d61193ec7f328">strings</a>}) &amp;&amp; $cplx_params{<a class="code" href="PGstringevaluators_8pl.html#a06b59ff01c251186550d61193ec7f328">strings</a>}) {
<a name="l00327"></a>00327             $answer_evaluator-&gt;install_pre_filter(\&amp;check_strings, %cplx_params);
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     $answer_evaluator-&gt;install_pre_filter(\&amp;check_syntax);
<a name="l00331"></a>00331     $answer_evaluator-&gt;install_pre_filter(\&amp;math_constants);
<a name="l00332"></a>00332     $answer_evaluator-&gt;install_pre_filter(\&amp;cplx_constants);
<a name="l00333"></a>00333     $answer_evaluator-&gt;install_pre_filter(\&amp;check_for_polar);
<a name="l00334"></a>00334     <span class="keywordflow">if</span> ($mode eq <span class="stringliteral">&#39;std&#39;</span>) {
<a name="l00335"></a>00335 <span class="preprocessor">                # do nothing    </span>
<a name="l00336"></a>00336 <span class="preprocessor"></span>    } elsif ($mode eq <span class="stringliteral">&#39;strict_polar&#39;</span>) {
<a name="l00337"></a>00337         $answer_evaluator-&gt;install_pre_filter(\&amp;is_a_polar);
<a name="l00338"></a>00338     } elsif ($mode eq <span class="stringliteral">&#39;strict_num_cartesian&#39;</span>) {
<a name="l00339"></a>00339         $answer_evaluator-&gt;install_pre_filter(\&amp;is_a_numeric_cartesian);
<a name="l00340"></a>00340     } elsif ($mode eq <span class="stringliteral">&#39;strict_num_polar&#39;</span>) {
<a name="l00341"></a>00341         $answer_evaluator-&gt;install_pre_filter(\&amp;is_a_numeric_polar);
<a name="l00342"></a>00342     } elsif ($mode eq <span class="stringliteral">&#39;strict&#39;</span>) {
<a name="l00343"></a>00343         $answer_evaluator-&gt;install_pre_filter(\&amp;is_a_numeric_complex);
<a name="l00344"></a>00344     } <span class="keywordflow">else</span> {    
<a name="l00345"></a>00345         $PGanswerMessage = <span class="stringliteral">&#39;Tell your professor that there is an error in his or her answer mechanism. No mode was specified.&#39;</span>;
<a name="l00346"></a>00346         $formattedSubmittedAnswer = $in;
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="keywordflow">if</span> ($corrAnswerIsString == 0 ){     # avoiding running compare_cplx when correct answer is a <span class="keywordtype">string</span>.
<a name="l00350"></a>00350         $answer_evaluator-&gt;install_evaluator(\&amp;compare_cplx, %cplx_params);
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352       
<a name="l00353"></a>00353 
<a name="l00354"></a>00354     $answer_evaluator-&gt;install_post_filter(\&amp;fix_answers_for_display);
<a name="l00355"></a>00355     $answer_evaluator-&gt;install_post_filter(\&amp;fix_for_polar_display);
<a name="l00356"></a>00356     
<a name="l00357"></a>00357     $answer_evaluator-&gt;install_post_filter(sub {my $rh_ans = shift; 
<a name="l00358"></a>00358         <span class="keywordflow">return</span> $rh_ans unless $rh_ans-&gt;catch_error(<span class="stringliteral">&#39;EVAL&#39;</span>);
<a name="l00359"></a>00359         $rh_ans-&gt;{student_ans} = $rh_ans-&gt;{original_student_ans}. <span class="charliteral">&#39; &#39;</span>. $rh_ans-&gt;{error_message};
<a name="l00360"></a>00360         $rh_ans-&gt;clear_error(<span class="stringliteral">&#39;EVAL&#39;</span>); } 
<a name="l00361"></a>00361     );
<a name="l00362"></a>00362     $answer_evaluator-&gt;install_post_filter(sub {my $rh_ans = shift; $rh_ans-&gt;clear_error(<span class="stringliteral">&#39;SYNTAX&#39;</span>); } );
<a name="l00363"></a>00363     $answer_evaluator-&gt;install_post_filter(sub {my $rh_ans = shift; $rh_ans-&gt;clear_error(<span class="stringliteral">&#39;POLAR&#39;</span>); } );
<a name="l00364"></a>00364     $answer_evaluator-&gt;install_post_filter(sub {my $rh_ans = shift; $rh_ans-&gt;clear_error(<span class="stringliteral">&#39;CARTESIAN&#39;</span>); } );
<a name="l00365"></a>00365     $answer_evaluator-&gt;install_post_filter(sub {my $rh_ans = shift; $rh_ans-&gt;clear_error(<span class="stringliteral">&#39;COMPLEX&#39;</span>); } );
<a name="l00366"></a>00366     $answer_evaluator-&gt;install_post_filter(sub {my $rh_ans = shift; $rh_ans-&gt;clear_error(<span class="stringliteral">&#39;STRING&#39;</span>); } );
<a name="l00367"></a>00367     $answer_evaluator;
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 =head3 compare_cplx
<a name="l00372"></a>00372 
<a name="l00373"></a>00373 <span class="preprocessor"> #      This is a filter: it accepts and returns an AnswerHash object.</span>
<a name="l00374"></a>00374 <span class="preprocessor"></span><span class="preprocessor"> #</span>
<a name="l00375"></a>00375 <span class="preprocessor"></span><span class="preprocessor"> #      Usage:  compare_cplx(ans_hash, %options)</span>
<a name="l00376"></a>00376 <span class="preprocessor"></span><span class="preprocessor"> #</span>
<a name="l00377"></a>00377 <span class="preprocessor"></span><span class="preprocessor"> #      Compares two complex numbers by comparing their real and imaginary parts</span>
<a name="l00378"></a>00378 <span class="preprocessor"></span>
<a name="l00379"></a>00379 =cut
<a name="l00380"></a>00380 
<a name="l00381"></a>00381 sub compare_cplx {
<a name="l00382"></a>00382     my ($rh_ans, %options) = @_;
<a name="l00383"></a>00383     my ($inVal,$PG_eval_errors,$PG_full_error_report) = PG_answer_eval($rh_ans-&gt;{student_ans});
<a name="l00384"></a>00384     
<a name="l00385"></a>00385     <span class="keywordflow">if</span> ($PG_eval_errors) {
<a name="l00386"></a>00386         $rh_ans-&gt;throw_error(<span class="stringliteral">&#39;EVAL&#39;</span>,<span class="stringliteral">&#39;There is a syntax error in your answer&#39;</span>);
<a name="l00387"></a>00387         $rh_ans-&gt;{ans_message} = clean_up_error_msg($PG_eval_errors);
<a name="l00388"></a>00388          <span class="keywordflow">return</span> $rh_ans;
<a name="l00389"></a>00389     } <span class="keywordflow">else</span> {
<a name="l00390"></a>00390         $rh_ans-&gt;{student_ans} = prfmt($inVal,$options{format});
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392     
<a name="l00393"></a>00393     $inVal = cplx($inVal,0) unless ref($inVal) =~/<a class="code" href="classComplex.html">Complex</a>/;
<a name="l00394"></a>00394     my $permitted_error_Re;
<a name="l00395"></a>00395     my $permitted_error_Im;
<a name="l00396"></a>00396     if ($rh_ans-&gt;{tolType} eq <span class="stringliteral">&#39;absolute&#39;</span>)   {
<a name="l00397"></a>00397         $permitted_error_Re = $rh_ans-&gt;{tolerance};
<a name="l00398"></a>00398         $permitted_error_Im = $rh_ans-&gt;{tolerance};
<a name="l00399"></a>00399     }
<a name="l00400"></a>00400     elsif ( abs($rh_ans-&gt;{correct_ans}) &lt;= $options{zeroLevel}) {
<a name="l00401"></a>00401             $permitted_error_Re = $options{zeroLevelTol};  ## want $tol to be non zero
<a name="l00402"></a>00402             $permitted_error_Im = $options{zeroLevelTol};  ## want $tol to be non zero
<a name="l00403"></a>00403     }
<a name="l00404"></a>00404     <span class="keywordflow">else</span> {
<a name="l00405"></a>00405         $permitted_error_Re =  abs($rh_ans-&gt;{tolerance}*$rh_ans-&gt;{correct_ans}-&gt;Complex::Re);
<a name="l00406"></a>00406         $permitted_error_Im =  abs($rh_ans-&gt;{tolerance}*$rh_ans-&gt;{correct_ans}-&gt;Complex::Im);
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408     
<a name="l00409"></a>00409     $rh_ans-&gt;{score} = 1 <span class="keywordflow">if</span> ( abs( $rh_ans-&gt;{correct_ans}-&gt;Complex::Re - $inVal-&gt;Complex::Re) &lt;=
<a name="l00410"></a>00410     $permitted_error_Re &amp;&amp; abs($rh_ans-&gt;{correct_ans}-&gt;Complex::Im - $inVal-&gt;Complex::Im )&lt;= $permitted_error_Im  );
<a name="l00411"></a>00411     
<a name="l00412"></a>00412     $rh_ans;
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 =head3 multi_cmp
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 <span class="preprocessor"> #  </span>
<a name="l00418"></a>00418 <span class="preprocessor"></span><span class="preprocessor"> #  Checks a comma separated string of  items against an array of evaluators.</span>
<a name="l00419"></a>00419 <span class="preprocessor"></span><span class="preprocessor"> #  For example this is useful for checking all of the complex roots of an equation.</span>
<a name="l00420"></a>00420 <span class="preprocessor"></span><span class="preprocessor"> #  Each student answer must be evaluated as correct by a DISTINCT answer evalutor.</span>
<a name="l00421"></a>00421 <span class="preprocessor"></span><span class="preprocessor"> #  </span>
<a name="l00422"></a>00422 <span class="preprocessor"></span><span class="preprocessor"> #  This answer checker will only work reliably if each answer checker corresponds</span>
<a name="l00423"></a>00423 <span class="preprocessor"></span><span class="preprocessor"> #  to a distinct correct answer.  For example if one answer checker requires</span>
<a name="l00424"></a>00424 <span class="preprocessor"></span><span class="preprocessor"> #  any positive number, and the second requires the answer 1, then 1,2 might</span>
<a name="l00425"></a>00425 <span class="preprocessor"></span><span class="preprocessor"> #  be judged incorrect since 1, satisifes the first answer checker, but 2 doesn&#39;t</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span><span class="preprocessor"> #  satisfy the second.  2,1 would work however. Avoid this type of use!!</span>
<a name="l00427"></a>00427 <span class="preprocessor"></span><span class="preprocessor"> #  </span>
<a name="l00428"></a>00428 <span class="preprocessor"></span><span class="preprocessor"> #  Including backtracking to fit the answers as best possible to each answer evaluator</span>
<a name="l00429"></a>00429 <span class="preprocessor"></span><span class="preprocessor"> #  in the best possible way, is beyond the ambitions of this evaluator.</span>
<a name="l00430"></a>00430 <span class="preprocessor"></span>
<a name="l00431"></a>00431 =cut 
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 sub multi_cmp {
<a name="l00434"></a>00434     my $ra_answer_evaluators = shift;  # array of evaluators
<a name="l00435"></a>00435     my %options = @_;
<a name="l00436"></a>00436     my @answer_evaluators = @{$ra_answer_evaluators};
<a name="l00437"></a>00437     my $backup_ans_eval = $answer_evaluators[0];
<a name="l00438"></a>00438     my $multi_ans_evaluator = <span class="keyword">new</span> <a class="code" href="classAnswerEvaluator.html">AnswerEvaluator</a>;
<a name="l00439"></a>00439     $multi_ans_evaluator-&gt;{debug}=$options{debug} <span class="keywordflow">if</span> defined($options{debug});
<a name="l00440"></a>00440     $multi_ans_evaluator-&gt;install_evaluator( sub { 
<a name="l00441"></a>00441         my $rh_ans = shift;
<a name="l00442"></a>00442         
<a name="l00443"></a>00443         my @student_answers = split/\s*,\s*/,$rh_ans-&gt;{student_ans};
<a name="l00444"></a>00444         my @evaluated_ans_hashes = ();
<a name="l00445"></a>00445         <span class="keywordflow">for</span> ( my $j=0; $j&lt;@student_answers; $j++ ) {
<a name="l00446"></a>00446 <span class="preprocessor">            # find an answer evaluator which marks this answer correct.</span>
<a name="l00447"></a>00447 <span class="preprocessor"></span>            my $student_ans = $student_answers[$j];
<a name="l00448"></a>00448             my $temp_hash;
<a name="l00449"></a>00449             <span class="keywordflow">for</span> ( my $i=0; $i&lt;@answer_evaluators; $i++ ) {
<a name="l00450"></a>00450                 my $evaluator = $answer_evaluators[$i];
<a name="l00451"></a>00451                 $temp_hash = <span class="keyword">new</span> <a class="code" href="classAnswerHash.html">AnswerHash</a>; # make a copy of the answer hash resulting from the evaluation
<a name="l00452"></a>00452                 %$temp_hash = %{$evaluator-&gt;evaluate($student_ans)}; 
<a name="l00453"></a>00453                 <span class="keywordflow">if</span> (($temp_hash-&gt;{score} == 1)) {
<a name="l00454"></a>00454 <span class="preprocessor">                    # save evaluated answer</span>
<a name="l00455"></a>00455 <span class="preprocessor"></span>                    push @evaluated_ans_hashes, $temp_hash;
<a name="l00456"></a>00456 <span class="preprocessor">                    # remove answer evaluator and check the next answer</span>
<a name="l00457"></a>00457 <span class="preprocessor"></span>                    splice(@answer_evaluators,$i,1);
<a name="l00458"></a>00458                     last;
<a name="l00459"></a>00459                 }
<a name="l00460"></a>00460             } 
<a name="l00461"></a>00461 <span class="preprocessor">            # if we exit the loop without finding a correct evaluation:</span>
<a name="l00462"></a>00462 <span class="preprocessor"></span><span class="preprocessor">            # make sure every answer is evaluated, even extra answers for which </span>
<a name="l00463"></a>00463 <span class="preprocessor"></span><span class="preprocessor">            # there will be no answer evaluators left.</span>
<a name="l00464"></a>00464 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (not defined($temp_hash) ) { # make sure every answer is evaluated, even extra answers.
<a name="l00465"></a>00465                 my $evaluator = $backup_ans_eval;
<a name="l00466"></a>00466                 $temp_hash = <span class="keyword">new</span> <a class="code" href="classAnswerHash.html">AnswerHash</a>; # make a copy of the answer hash resulting from the evaluation
<a name="l00467"></a>00467                 %$temp_hash = %{$evaluator-&gt;evaluate($student_ans)}; 
<a name="l00468"></a>00468                 $temp_hash-&gt;{score} =0;  # <span class="keyword">this</span> was an extra answer -- clearly incorrect
<a name="l00469"></a>00469                 $temp_hash-&gt;{correct_ans} = <span class="stringliteral">&quot;too many answers&quot;</span>;
<a name="l00470"></a>00470             }
<a name="l00471"></a>00471 <span class="preprocessor">            # now make sure that even  answers which </span>
<a name="l00472"></a>00472 <span class="preprocessor"></span><span class="preprocessor">            # don&#39;t never evaluate correctly are still recorded in the list</span>
<a name="l00473"></a>00473 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ( $temp_hash-&gt;{score} &lt;1) {
<a name="l00474"></a>00474                 push @evaluated_ans_hashes, $temp_hash;
<a name="l00475"></a>00475             }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477                 
<a name="l00478"></a>00478         }
<a name="l00479"></a>00479 <span class="preprocessor">        # construct the final answer hash</span>
<a name="l00480"></a>00480 <span class="preprocessor"></span>        my @saved_evaluated_ans_hashes = @evaluated_ans_hashes;
<a name="l00481"></a>00481         my $rh_ans_out = shift @evaluated_ans_hashes;
<a name="l00482"></a>00482         <span class="keywordflow">while</span> (@evaluated_ans_hashes) {
<a name="l00483"></a>00483             my $temp_hash = shift @evaluated_ans_hashes;
<a name="l00484"></a>00484             $rh_ans_out =$rh_ans_out-&gt;AND($temp_hash);
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486         $rh_ans_out-&gt;{original_student_ans} = $rh_ans-&gt;{student_ans};
<a name="l00487"></a>00487         $rh_ans_out-&gt;{student_ans} = $rh_ans-&gt;{student_ans};
<a name="l00488"></a>00488         $rh_ans_out-&gt;{score}=0 unless @{$ra_answer_evaluators} == @student_answers; # require the  correct number of answers
<a name="l00489"></a>00489         $rh_ans_out-&gt;{_filter_name} = <span class="stringliteral">&#39;multi_cmp&#39;</span>;
<a name="l00490"></a>00490         $rh_ans_out-&gt;{intermediate_response_evaluations} = [@saved_evaluated_ans_hashes];
<a name="l00491"></a>00491         $rh_ans_out;
<a name="l00492"></a>00492     });
<a name="l00493"></a>00493     $multi_ans_evaluator;
<a name="l00494"></a>00494 }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496 sub cplx_constants {
<a name="l00497"></a>00497     my($in,%options) = @_;
<a name="l00498"></a>00498     my $rh_ans;
<a name="l00499"></a>00499     my $process_ans_hash = ( ref( $in ) eq &#39;<a class="code" href="classAnswerHash.html">AnswerHash</a>&#39; ) ? 1 : 0 ;
<a name="l00500"></a>00500     if ($process_ans_hash) {
<a name="l00501"></a>00501         $rh_ans = $in;
<a name="l00502"></a>00502         $in = $rh_ans-&gt;{student_ans};
<a name="l00503"></a>00503     } 
<a name="l00504"></a>00504 <span class="preprocessor">    # The code fragment above allows this filter to be used when the input is simply a string</span>
<a name="l00505"></a>00505 <span class="preprocessor"></span><span class="preprocessor">    # as well as when the input is an AnswerHash, and options.</span>
<a name="l00506"></a>00506 <span class="preprocessor"></span>    $in =~ s/\bi\b/(i)/g;  # <span class="keywordflow">try</span> to keep -i being recognized as a file reference
<a name="l00507"></a>00507 <span class="preprocessor">                           # and recognized as a function whose output is an imaginary number</span>
<a name="l00508"></a>00508 <span class="preprocessor"></span>                                                             
<a name="l00509"></a>00509     <span class="keywordflow">if</span> ($process_ans_hash)   {
<a name="l00510"></a>00510         $rh_ans-&gt;{student_ans}=$in;
<a name="l00511"></a>00511         <span class="keywordflow">return</span> $rh_ans;
<a name="l00512"></a>00512     } <span class="keywordflow">else</span> {
<a name="l00513"></a>00513         <span class="keywordflow">return</span> $in;
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 =head2 Utility <a class="code" href="PGstringevaluators_8pl.html#a432234fc3d5710ff4fdc5eacd9a0eae2">functions</a> 
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="preprocessor"> #  for checking the form of a number or of the C&lt;student_ans&gt; field in an answer hash</span>
<a name="l00520"></a>00520 <span class="preprocessor"></span>
<a name="l00521"></a>00521 =cut
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 
<a name="l00524"></a>00524 <span class="preprocessor"># Output is text displaying the complex numver in &quot;e to the i theta&quot; form. The</span>
<a name="l00525"></a>00525 <span class="preprocessor"></span><span class="preprocessor"># formats for the argument theta is determined by the option C&lt;theta_format&gt; and the</span>
<a name="l00526"></a>00526 <span class="preprocessor"></span><span class="preprocessor"># format for the modulus is determined by the C&lt;r_format&gt; option.</span>
<a name="l00527"></a>00527 <span class="preprocessor"></span>
<a name="l00528"></a>00528 <span class="preprocessor">#this basically just checks for &quot;e^&quot; which unfortunately will show something like (e^4)*i as a polar, this should be changed</span>
<a name="l00529"></a>00529 <span class="preprocessor"></span>sub check_for_polar{
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     my($in,%options) = @_;
<a name="l00532"></a>00532     my $rh_ans;
<a name="l00533"></a>00533     my $process_ans_hash = ( ref( $in ) eq &#39;<a class="code" href="classAnswerHash.html">AnswerHash</a>&#39; ) ? 1 : 0 ;
<a name="l00534"></a>00534     if ($process_ans_hash) {
<a name="l00535"></a>00535         $rh_ans = $in;
<a name="l00536"></a>00536         $in = $rh_ans-&gt;{student_ans};
<a name="l00537"></a>00537     } 
<a name="l00538"></a>00538 <span class="preprocessor">    # The code fragment above allows this filter to be used when the input is simply a string</span>
<a name="l00539"></a>00539 <span class="preprocessor"></span><span class="preprocessor">    # as well as when the input is an AnswerHash, and options.</span>
<a name="l00540"></a>00540 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( $in =~ /2.71828182845905\*\*/ ){
<a name="l00541"></a>00541         $rh_ans-&gt;{answer_form} = <span class="stringliteral">&#39;polar&#39;</span>;
<a name="l00542"></a>00542     } <span class="keywordflow">else</span> {
<a name="l00543"></a>00543         $rh_ans-&gt;{answer_form} = <span class="stringliteral">&#39;cartesian&#39;</span>;
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545     $rh_ans;
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 <span class="preprocessor">## allows only for numbers of the form a+bi and ae^(bi), where a and b are strict numbers</span>
<a name="l00553"></a>00553 <span class="preprocessor"></span>sub is_a_numeric_complex {
<a name="l00554"></a>00554     my ($num,%options) =    @_;
<a name="l00555"></a>00555     my $process_ans_hash = ( ref( $num ) eq &#39;<a class="code" href="classAnswerHash.html">AnswerHash</a>&#39; ) ? 1 : 0 ;
<a name="l00556"></a>00556     my ($rh_ans);
<a name="l00557"></a>00557     if ($process_ans_hash) {
<a name="l00558"></a>00558         $rh_ans = $num;
<a name="l00559"></a>00559         $num = $rh_ans-&gt;{student_ans};
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561     
<a name="l00562"></a>00562     my $is_a_number = 0;
<a name="l00563"></a>00563     <span class="keywordflow">return</span> $is_a_number unless defined($num);
<a name="l00564"></a>00564     $num =~ s/^\s*<span class="comment">//; ## remove initial spaces</span>
<a name="l00565"></a>00565     $num =~ s/\s*$<span class="comment">//; ## remove trailing spaces</span>
<a name="l00566"></a>00566     
<a name="l00567"></a>00567     <span class="keywordflow">if</span> ($num =~
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 /^($number[+,-]?($number\*\(i\)|\(i\)|\(i\)\*$number)|($number\*\(i\)|-?\(i\)|-?\(i\)\*$number)([+,-]$number)?|($number\*)?2.71828182845905\*\*\(($number\*\(i\)|\(i\)\*$number|i|-\(i\))\)|$number)$/){
<a name="l00570"></a>00570         $is_a_number = 1;
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572     
<a name="l00573"></a>00573     <span class="keywordflow">if</span> ($process_ans_hash)   {
<a name="l00574"></a>00574             <span class="keywordflow">if</span> ($is_a_number == 1 ) {
<a name="l00575"></a>00575                 $rh_ans-&gt;{student_ans}=$num;
<a name="l00576"></a>00576                 <span class="keywordflow">return</span> $rh_ans;
<a name="l00577"></a>00577             } <span class="keywordflow">else</span> {
<a name="l00578"></a>00578                 $rh_ans-&gt;{student_ans} = <span class="stringliteral">&quot;Incorrect number format:  You must enter a numeric complex, e.g. a+bi</span>
<a name="l00579"></a>00579 <span class="stringliteral">            or a*e^(bi)&quot;</span>;
<a name="l00580"></a>00580                 $rh_ans-&gt;throw_error(<span class="stringliteral">&#39;COMPLEX&#39;</span>, <span class="stringliteral">&#39;You must enter a number, e.g. -6, 5.3, or 6.12E-3&#39;</span>);
<a name="l00581"></a>00581                 <span class="keywordflow">return</span> $rh_ans;
<a name="l00582"></a>00582             }
<a name="l00583"></a>00583     } <span class="keywordflow">else</span> {
<a name="l00584"></a>00584         <span class="keywordflow">return</span> $is_a_number;
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="preprocessor">## allows only for the form a + bi, where a and b are strict numbers</span>
<a name="l00589"></a>00589 <span class="preprocessor"></span>sub is_a_numeric_cartesian {
<a name="l00590"></a>00590     my ($num,%options) =    @_;
<a name="l00591"></a>00591     my $process_ans_hash = ( ref( $num ) eq &#39;<a class="code" href="classAnswerHash.html">AnswerHash</a>&#39; ) ? 1 : 0 ;
<a name="l00592"></a>00592     my ($rh_ans);
<a name="l00593"></a>00593     if ($process_ans_hash) {
<a name="l00594"></a>00594         $rh_ans = $num;
<a name="l00595"></a>00595         $num = $rh_ans-&gt;{student_ans};
<a name="l00596"></a>00596     }
<a name="l00597"></a>00597     
<a name="l00598"></a>00598     my $is_a_number = 0;
<a name="l00599"></a>00599     <span class="keywordflow">return</span> $is_a_number unless defined($num);
<a name="l00600"></a>00600     $num =~ s/^\s*<span class="comment">//; ## remove initial spaces</span>
<a name="l00601"></a>00601     $num =~ s/\s*$<span class="comment">//; ## remove trailing spaces</span>
<a name="l00602"></a>00602     
<a name="l00603"></a>00603     <span class="keywordflow">if</span> ($num =~
<a name="l00604"></a>00604 
<a name="l00605"></a>00605 /^($number[+,-]?($number\*\(i\)|\(i\)|\(i\)\*$number)|($number\*\(i\)|-?\(i\)|-?\(i\)\*$number)([+,-]$number)?|$number)$/){
<a name="l00606"></a>00606         $is_a_number = 1;
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608     
<a name="l00609"></a>00609     <span class="keywordflow">if</span> ($process_ans_hash)   {
<a name="l00610"></a>00610             <span class="keywordflow">if</span> ($is_a_number == 1 ) {
<a name="l00611"></a>00611                 $rh_ans-&gt;{student_ans}=$num;
<a name="l00612"></a>00612                 <span class="keywordflow">return</span> $rh_ans;
<a name="l00613"></a>00613             } <span class="keywordflow">else</span> {
<a name="l00614"></a>00614                 $rh_ans-&gt;{student_ans} = <span class="stringliteral">&quot;Incorrect number format:  You must enter a numeric cartesian, e.g. a+bi&quot;</span>;
<a name="l00615"></a>00615                 $rh_ans-&gt;throw_error(<span class="stringliteral">&#39;CARTESIAN&#39;</span>, <span class="stringliteral">&#39;You must enter a number, e.g. -6, 5.3, or 6.12E-3&#39;</span>);
<a name="l00616"></a>00616                 <span class="keywordflow">return</span> $rh_ans;
<a name="l00617"></a>00617             }
<a name="l00618"></a>00618     } <span class="keywordflow">else</span> {
<a name="l00619"></a>00619         <span class="keywordflow">return</span> $is_a_number;
<a name="l00620"></a>00620     }
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 <span class="preprocessor">## allows only for the form ae^(bi), where a and b are strict numbers</span>
<a name="l00624"></a>00624 <span class="preprocessor"></span>sub is_a_numeric_polar {
<a name="l00625"></a>00625     my ($num,%options) =    @_;
<a name="l00626"></a>00626     my $process_ans_hash = ( ref( $num ) eq &#39;<a class="code" href="classAnswerHash.html">AnswerHash</a>&#39; ) ? 1 : 0 ;
<a name="l00627"></a>00627     my ($rh_ans);
<a name="l00628"></a>00628     if ($process_ans_hash) {
<a name="l00629"></a>00629         $rh_ans = $num;
<a name="l00630"></a>00630         $num = $rh_ans-&gt;{student_ans};
<a name="l00631"></a>00631     }
<a name="l00632"></a>00632     
<a name="l00633"></a>00633     my $is_a_number = 0;
<a name="l00634"></a>00634     <span class="keywordflow">return</span> $is_a_number unless defined($num);
<a name="l00635"></a>00635     $num =~ s/^\s*<span class="comment">//; ## remove initial spaces</span>
<a name="l00636"></a>00636     $num =~ s/\s*$<span class="comment">//; ## remove trailing spaces</span>
<a name="l00637"></a>00637     <span class="keywordflow">if</span> ($num =~
<a name="l00638"></a>00638     /^($number|($number\*)?2.71828182845905\*\*\(($number\*\(i\)|\(i\)\*$number|i|-\(i\))\))$/){
<a name="l00639"></a>00639         $is_a_number = 1;
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641     
<a name="l00642"></a>00642     <span class="keywordflow">if</span> ($process_ans_hash)   {
<a name="l00643"></a>00643             <span class="keywordflow">if</span> ($is_a_number == 1 ) {
<a name="l00644"></a>00644                 $rh_ans-&gt;{student_ans}=$num;
<a name="l00645"></a>00645                 <span class="keywordflow">return</span> $rh_ans;
<a name="l00646"></a>00646             } <span class="keywordflow">else</span> {
<a name="l00647"></a>00647                 $rh_ans-&gt;{student_ans} = <span class="stringliteral">&quot;Incorrect number format:  You must enter a numeric polar, e.g. a*e^(bi)&quot;</span>;
<a name="l00648"></a>00648                 $rh_ans-&gt;throw_error(<span class="stringliteral">&#39;POLAR&#39;</span>, <span class="stringliteral">&#39;You must enter a number, e.g. -6, 5.3, or 6.12E-3&#39;</span>);
<a name="l00649"></a>00649                 <span class="keywordflow">return</span> $rh_ans;
<a name="l00650"></a>00650             }
<a name="l00651"></a>00651     } <span class="keywordflow">else</span> {
<a name="l00652"></a>00652         <span class="keywordflow">return</span> $is_a_number;
<a name="l00653"></a>00653     }
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 <span class="preprocessor">#this subroutine mearly captures what is before and after the &quot;e**&quot; it does not verify that the &quot;i&quot; is there, or in the</span>
<a name="l00658"></a>00658 <span class="preprocessor"></span><span class="preprocessor">#exponent this must eventually be addresed</span>
<a name="l00659"></a>00659 <span class="preprocessor"></span>sub is_a_polar {
<a name="l00660"></a>00660     my ($num,%options) =    @_;
<a name="l00661"></a>00661     my $process_ans_hash = ( ref( $num ) eq &#39;<a class="code" href="classAnswerHash.html">AnswerHash</a>&#39; ) ? 1 : 0 ;
<a name="l00662"></a>00662     my ($rh_ans);
<a name="l00663"></a>00663     if ($process_ans_hash) {
<a name="l00664"></a>00664         $rh_ans = $num;
<a name="l00665"></a>00665         $num = $rh_ans-&gt;{student_ans};
<a name="l00666"></a>00666     }
<a name="l00667"></a>00667     
<a name="l00668"></a>00668     my $is_a_number = 0;
<a name="l00669"></a>00669     <span class="keywordflow">return</span> $is_a_number unless defined($num);
<a name="l00670"></a>00670     $num =~ s/^\s*<span class="comment">//; ## remove initial spaces</span>
<a name="l00671"></a>00671     $num =~ s/\s*$<span class="comment">//; ## remove trailing spaces</span>
<a name="l00672"></a>00672     $num =~ /^(.*)\*2.71828182845905\*\*(.*)/;
<a name="l00673"></a>00673 <span class="preprocessor">    #warn &quot;rho: &quot;, $1;</span>
<a name="l00674"></a>00674 <span class="preprocessor"></span><span class="preprocessor">    #warn &quot;theta: &quot;, $2;</span>
<a name="l00675"></a>00675 <span class="preprocessor"></span>    <span class="keywordflow">if</span>( defined( $1 ) ){
<a name="l00676"></a>00676         <span class="keywordflow">if</span>( &amp;single_term( $1 ) &amp;&amp; &amp;single_term( $2 ) )
<a name="l00677"></a>00677         {
<a name="l00678"></a>00678             $is_a_number = 1;
<a name="l00679"></a>00679         }
<a name="l00680"></a>00680     }
<a name="l00681"></a>00681     <span class="keywordflow">if</span> ($process_ans_hash)   {
<a name="l00682"></a>00682             <span class="keywordflow">if</span> ($is_a_number == 1 ) {
<a name="l00683"></a>00683                 $rh_ans-&gt;{student_ans}=$num;
<a name="l00684"></a>00684                 <span class="keywordflow">return</span> $rh_ans;
<a name="l00685"></a>00685             } <span class="keywordflow">else</span> {
<a name="l00686"></a>00686                 $rh_ans-&gt;{student_ans} = <span class="stringliteral">&quot;Incorrect number format:  You must enter a polar, e.g. a*e^(bi)&quot;</span>;
<a name="l00687"></a>00687                 $rh_ans-&gt;throw_error(<span class="stringliteral">&#39;POLAR&#39;</span>, <span class="stringliteral">&#39;You must enter a number, e.g. -6, 5.3, or 6.12E-3&#39;</span>);
<a name="l00688"></a>00688                 <span class="keywordflow">return</span> $rh_ans;
<a name="l00689"></a>00689             }
<a name="l00690"></a>00690     } <span class="keywordflow">else</span> {
<a name="l00691"></a>00691         <span class="keywordflow">return</span> $is_a_number;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 =head4 single_term()
<a name="l00696"></a>00696 
<a name="l00697"></a>00697  <span class="preprocessor">#  This subroutine takes in a string, which is a mathematical expresion, and determines whether or not</span>
<a name="l00698"></a>00698 <span class="preprocessor"></span><span class="preprocessor"> #  it is a single term. This is accoplished using a stack. Open parenthesis pluses and minuses are all</span>
<a name="l00699"></a>00699 <span class="preprocessor"></span><span class="preprocessor"> #  added onto the stack, and when a closed parenthesis is reached, the stack is popped untill the open</span>
<a name="l00700"></a>00700 <span class="preprocessor"></span><span class="preprocessor"> #  parenthesis is found. If the original was a single term, the stack should be empty after</span>
<a name="l00701"></a>00701 <span class="preprocessor"></span><span class="preprocessor"> #  evaluation. If there is anything left ( + or - ) then false is returned.</span>
<a name="l00702"></a>00702 <span class="preprocessor"></span><span class="preprocessor"> #  Of course, the unary operator &quot;-&quot; must be handled... if it is a unary operator, and not a regular -</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span><span class="preprocessor"> #  the only place it could occur unambiguously without being surrounded by parenthesis, is the very</span>
<a name="l00704"></a>00704 <span class="preprocessor"></span><span class="preprocessor"> #  first position. So that case is checked before the loop begins.</span>
<a name="l00705"></a>00705 <span class="preprocessor"></span>    
<a name="l00706"></a>00706 =cut
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 sub single_term{
<a name="l00709"></a>00709     my $term = shift;
<a name="l00710"></a>00710     my @stack;
<a name="l00711"></a>00711     $term = reverse $term;
<a name="l00712"></a>00712     <span class="keywordflow">if</span>( length $term &gt;= 1 )
<a name="l00713"></a>00713     {
<a name="l00714"></a>00714         my $temp = chop $term;
<a name="l00715"></a>00715         <span class="keywordflow">if</span>( $temp ne <span class="stringliteral">&quot;-&quot;</span> ){ $term .= $temp; }
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717     <span class="keywordflow">while</span>( length $term &gt;= 1 ){
<a name="l00718"></a>00718         my $character = chop $term;
<a name="l00719"></a>00719         <span class="keywordflow">if</span>( $character eq <span class="stringliteral">&quot;+&quot;</span> || $character eq <span class="stringliteral">&quot;-&quot;</span> || $character eq <span class="stringliteral">&quot;(&quot;</span> ){
<a name="l00720"></a>00720             push @stack, $character;
<a name="l00721"></a>00721         }elsif( $character eq <span class="stringliteral">&quot;)&quot;</span> ){
<a name="l00722"></a>00722             <span class="keywordflow">while</span>( pop @stack ne <span class="stringliteral">&quot;(&quot;</span> ){}
<a name="l00723"></a>00723         }
<a name="l00724"></a>00724         
<a name="l00725"></a>00725     }
<a name="l00726"></a>00726     <span class="keywordflow">if</span>( scalar @stack == 0 ){ <span class="keywordflow">return</span> 1;}<span class="keywordflow">else</span>{ <span class="keywordflow">return</span> 0;}
<a name="l00727"></a>00727 }
<a name="l00728"></a>00728 
<a name="l00729"></a>00729 <span class="preprocessor"># changes default to display as a polar</span>
<a name="l00730"></a>00730 <span class="preprocessor"></span>sub fix_for_polar_display{
<a name="l00731"></a>00731     my ($rh_ans, %options) = @_;
<a name="l00732"></a>00732     <span class="keywordflow">if</span>( ref( $rh_ans-&gt;{student_ans} ) =~ /<a class="code" href="classComplex.html">Complex</a>/ &amp;&amp; $rh_ans-&gt;{answer_form} eq <span class="stringliteral">&#39;polar&#39;</span> ){
<a name="l00733"></a>00733         $rh_ans-&gt;{student_ans}-&gt;display_format( <span class="stringliteral">&#39;polar&#39;</span>);
<a name="l00734"></a>00734 <span class="preprocessor">        ## these lines of code have the polar displayed as re^(theta) instead of [rho,theta]</span>
<a name="l00735"></a>00735 <span class="preprocessor"></span>        $rh_ans-&gt;{student_ans} =~ s/,<span class="comment">/*e^\(/;</span>
<a name="l00736"></a>00736 <span class="comment">        $rh_ans-&gt;{student_ans} =~ s/\[//;</span>
<a name="l00737"></a>00737 <span class="comment">        $rh_ans-&gt;{student_ans} =~ s/\]/i\)/;</span>
<a name="l00738"></a>00738 <span class="comment">        }</span>
<a name="l00739"></a>00739 <span class="comment">    $rh_ans;</span>
<a name="l00740"></a>00740 <span class="comment">}</span>
<a name="l00741"></a>00741 <span class="comment"></span>
<a name="l00742"></a>00742 <span class="comment"># this does not seem to be in use, so I&#39;m commenting it out.  Mike Gage 6/27/05</span>
<a name="l00743"></a>00743 <span class="comment"></span>
<a name="l00744"></a>00744 <span class="comment"># sub cplx_cmp2 {</span>
<a name="l00745"></a>00745 <span class="comment">  ####.............###########</span>
<a name="l00746"></a>00746 <span class="comment"># }</span>
<a name="l00747"></a>00747 <span class="comment"></span>
<a name="l00748"></a>00748 <span class="comment"># this does not seem to be in use, so I&#39;m commenting it out.  Mike Gage 6/27/05</span>
<a name="l00749"></a>00749 <span class="comment"></span>
<a name="l00750"></a>00750 <span class="comment"># sub cplx_cmp_mult {</span>
<a name="l00751"></a>00751 <span class="comment">  ####.............###########</span>
<a name="l00752"></a>00752 <span class="comment"># }</span>
<a name="l00753"></a>00753 <span class="comment"></span>
<a name="l00754"></a>00754 <span class="comment"># this does not seem to be in use, so I&#39;m commenting it out.  Mike Gage 6/27/05</span>
<a name="l00755"></a>00755 <span class="comment"></span>
<a name="l00756"></a>00756 <span class="comment"># sub answer_mult{</span>
<a name="l00757"></a>00757 <span class="comment">  ####.............###########</span>
<a name="l00758"></a>00758 <span class="comment"># }</span>
<a name="l00759"></a>00759 <span class="comment"># </span>
<a name="l00760"></a>00760 <span class="comment"># sub multi_cmp_old{</span>
<a name="l00761"></a>00761 <span class="comment">  ####.............###########</span>
<a name="l00762"></a>00762 <span class="comment"># }</span>
<a name="l00763"></a>00763 <span class="comment"></span>
<a name="l00764"></a>00764 <span class="comment"># this does not seem to be in use, so I&#39;m commenting it out.  Mike Gage 6/27/05</span>
<a name="l00765"></a>00765 <span class="comment"></span>
<a name="l00766"></a>00766 <span class="comment"># sub mult_cmp{</span>
<a name="l00767"></a>00767 <span class="comment">  ####.............###########</span>
<a name="l00768"></a>00768 <span class="comment"># }</span>
<a name="l00769"></a>00769 <span class="comment"></span>
<a name="l00770"></a>00770 <span class="comment"></span>
<a name="l00771"></a>00771 <span class="comment">1;</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:54:55 2012 for PG by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
