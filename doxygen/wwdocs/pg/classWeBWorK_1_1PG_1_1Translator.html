<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PG: WeBWorK::PG::Translator Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespaceWeBWorK.html">WeBWorK</a>::<a class="el" href="namespaceWeBWorK_1_1PG.html">PG</a>::<a class="el" href="classWeBWorK_1_1PG_1_1Translator.html">Translator</a>
  </div>
</div>
<div class="contents">
<h1>WeBWorK::PG::Translator Class Reference</h1><!-- doxytag: class="WeBWorK::PG::Translator" --><!-- doxytag: inherits="WeBWorK::PG" --><div class="dynheader">
Inheritance diagram for WeBWorK::PG::Translator:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1PG_1_1Translator__inherit__graph.png" border="0" usemap="#WeBWorK_1_1PG_1_1Translator_inherit__map" alt="Inheritance graph"/></div>
<map name="WeBWorK_1_1PG_1_1Translator_inherit__map" id="WeBWorK_1_1PG_1_1Translator_inherit__map">
<area shape="rect" href="classWeBWorK_1_1PG.html" title="WeBWorK::PG" alt="" coords="39,5,148,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for WeBWorK::PG::Translator:</div>
<div class="dynsection">
<div class="center"><img src="classWeBWorK_1_1PG_1_1Translator__coll__graph.png" border="0" usemap="#WeBWorK_1_1PG_1_1Translator_coll__map" alt="Collaboration graph"/></div>
<map name="WeBWorK_1_1PG_1_1Translator_coll__map" id="WeBWorK_1_1PG_1_1Translator_coll__map">
<area shape="rect" href="classWeBWorK_1_1PG.html" title="WeBWorK::PG" alt="" coords="39,5,148,32"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classWeBWorK_1_1PG_1_1Translator-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a3bf2816348f52fe32cad43286615c208">grade_problem</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#af3bac483103300020f8ef3ca8ab43ec2">avg_problem_grader</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a8047e2659d759707b9f61e0900905c67">Main::be_strict</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a887f17730aa20cca0b4ab1a30d2ddc1c">PG_restricted_eval</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#acb9b8bef224f082ea2f550dce5b576d3">PG_restricted_eval_helper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a4416c14dd38dd007ade3e380ab5357f9">process_answers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a317550b236c465aa971f6a1f9f099b67">r_text</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#af5d5e5dc7c2a890bc64145bc7e9ddd22">rf_problem_grader</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#acabd05c3460e43cb02407459807a1aa8">emit</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a5b9a83c282ac755b961518314df3d061">rh_evaluated_answers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a1084e8d1414edef7aa67a6fd2ef1d6a9">PG_answer_eval</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ad0429c6f4f82059b2c2bef229dea4143">PG_errorMessage</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#af3a1478e1de125c7f446dfb7a6e4ed06">time_it</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ae65dcd601c0a78d6ebd75078eb6b94ce">default_preprocess_code</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a3c36ecbc8b680d8703dff270020e7be8">new</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a6d0f4eececaaf6eb56d11e2b8dfa588d">dumpvar</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a03bcf6d790a57567796f951f4e93c134">rh_correct_answers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a2d92cfec49c0244698780a7ca4f086d0">a_text</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a156e5644df6ffa85a3748ca96127b8de">permit</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ac3066cb9e95011edfbb99ab8497ecdb8">ra_text</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a7a12ca9631bd5926d557ca003526dc46">deny</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a697a5fb7e1b1f9061914f47ae53f97a6">set_mask</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ad26733fb735b5593158c614a1b87b4a6">pre_load_macro_files</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a01cca4a23974480a1cdcca7d9848524c">filter_answer</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a147d6d396009a3cf9935d2c88692348e">translate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#aa2229d8f40940a33e0aa9c9f6be0ec87">post_header</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ac6c535a0561d7f536ed0e0f5d8a4daf4">rf_std_problem_grader</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a41db5e3bc6853461b001a18457aed21b">load_extra_packages</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ab42670011f0f8b62554bb9f45d8528a7">errors</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a087b52953f6da548597ffb08a65221c5">PGsort</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a55f8559c2175943e444cf0328f80c2c5">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#af2a567286bb304baf7feca7a92d4254e">PG_macro_file_eval</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#aa62d4bcdad525a2225fb8f5d09eff073">rf_safety_filter</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#afe9e74f48895480761b8e2509969b8ed">evaluate_modules</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ad2367a7298f90577f47292afa873ea26">r_post_header</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a0a0257e7e8d573f75e4898c33732afb6">std_problem_grader</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ab02e3b1824e199b2514bb39a42725f59">rh_problem_result</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a1a3c997585e195be6a01d92cf549a324">mask</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a6b2ab281e2d3410477ca40f28e807c36">share_from</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ac131457932554b54c3564d931804f651">rh_flags</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a4649df619515a99bde061622135b9f9a">source_file</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a1d282942a816b4f5add58f21f18d4931">be_strict</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ac152d184f158c8632818d961c2bc6aeb">default_postprocess_code</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a33db27c53aa96f70c0f18dffcc8601ad">PG_undef_var_check</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a672685544bd714e99adcd6b79baf8187">unrestricted_load</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a6024fb17151788751b97b6fc8693ed06">environment</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a48081d1a14da28d5a0fd0cc5e240c2a9">old_std_problem_grader</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ae5cc0539a056777639e5d782f4621da6">source_string</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ad2b36b2fb86ed82115a97faa9d7fee16">h_flags</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a318c50c2128714efd1f71634b5ccce14">safetyFilter</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#adc49691ce92dc7596ff702a2063f5282">h_answers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a1343a0821c2970658cb7a543fdbb064a">r_header</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#acb5c9a3f90d28f370114efda3dd393db">rf_avg_problem_grader</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#aa884ced774ba6d6b389fc0b2a3a6779f">nameSpace</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a4a71e2b8b0a0ad86a36d7a89cec5898e">header</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h2><a class="anchor" id="NAME">
NAME</a></h2>
<p><a class="el" href="classWeBWorK_1_1PG_1_1Translator.html">WeBWorK::PG::Translator</a> - Evaluate <a class="el" href="classWeBWorK_1_1PG.html">PG</a> code and evaluate answers safely</p>
<h2><a class="anchor" id="SYNPOSIS">
SYNPOSIS</a></h2>
<pre>    my $pt = new <a class="el" href="classWeBWorK_1_1PG_1_1Translator.html">WeBWorK::PG::Translator</a>;      # create a translator;
    $pt-&gt;environment(\%envir);      # provide the environment variable for the problem
    $pt-&gt;<a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a55f8559c2175943e444cf0328f80c2c5">initialize()</a>;              # initialize the translator
    $pt-&gt; <a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a697a5fb7e1b1f9061914f47ae53f97a6">set_mask()</a>;               # set the operation mask for the translator safe compartment
    $pt-&gt;source_string($source);    # provide the source string for the problem</pre><pre>    $pt -&gt; unrestricted_load("${courseScriptsDirectory}PG.pl");
    $pt -&gt; unrestricted_load("${courseScriptsDirectory}dangerousMacros.pl");
                                    # load the unprotected macro files
                                    # these files are evaluated with the Safe compartment wide open
                                    # other macros are loaded from within the problem using loadMacros</pre><pre>    $pt -&gt;<a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a147d6d396009a3cf9935d2c88692348e">translate()</a>;              # translate the problem (the out following 4 pieces of information are created)</pre><pre>    $PG_PROBLEM_TEXT_ARRAY_REF = $pt-&gt;<a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#ac3066cb9e95011edfbb99ab8497ecdb8">ra_text()</a>;              # output text for the body of the HTML file (in array form)
    $PG_PROBLEM_TEXT_REF = $pt-&gt;<a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a317550b236c465aa971f6a1f9f099b67">r_text()</a>;                     # output text for the body of the HTML file
    $PG_HEADER_TEXT_REF = $pt-&gt;r_header;#\$PG_HEADER_TEXT;    # text for the header of the HTML file
    $PG_POST_HEADER_TEXT_REF = $pt-&gt;r_post_header
    $PG_ANSWER_HASH_REF = $pt-&gt;rh_correct_answers;            # a hash of answer evaluators
    $PG_FLAGS_REF = $pt -&gt;rh_flags;                           # misc. status flags.</pre><pre>    $pt -&gt; process_answers(\%inputs);    # evaluates all of the answers using submitted answers from %input</pre><pre>    my $rh_answer_results = $pt-&gt;rh_evaluated_answers;  # provides a hash of the results of evaluating the answers.
    my $rh_problem_result = $pt-&gt;grade_problem;         # grades the problem using the default problem grading method.</pre><h2><a class="anchor" id="DESCRIPTION">
DESCRIPTION</a></h2>
<p>This module defines an object which will translate a problem written in the Problem Generating (<a class="el" href="classWeBWorK_1_1PG.html">PG</a>) language</p>
<h3><a class="anchor" id="be_strict">
be_strict</a></h3>
<p>This creates a substitute for </p>
<div class="fragment"><pre class="fragment">use strict;
</pre></div><p> which cannot be used in <a class="el" href="classWeBWorK_1_1PG.html">PG</a> problem sets or <a class="el" href="classWeBWorK_1_1PG.html">PG</a> macro files. Use this way to imitate the behavior of </p>
<div class="fragment"><pre class="fragment">use strict;
</pre></div>  <pre>	BEGIN {
		<a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a1d282942a816b4f5add58f21f18d4931">be_strict()</a>; # an alias for use strict.
		             # This means that all global variable
		             # must contain main:: as a prefix.
	}</pre><h3><a class="anchor" id="evaluate_modules">
evaluate_modules</a></h3>
<pre>	Usage:  $obj -&gt; evaluate_modules('WWPlot', 'Fun', 'Circle');
	        $obj -&gt; evaluate_modules('reset');</pre><p>Adds the modules <a class="el" href="WWPlot_8pm.html">WWPlot.pm</a>, <a class="el" href="Fun_8pm.html">Fun.pm</a> and <a class="el" href="Circle_8pm.html">Circle.pm</a> in the courseScripts directory to the list of modules which can be used by the <a class="el" href="classWeBWorK_1_1PG.html">PG</a> problems. The keyword 'reset' or 'erase' erases the list of modules already loaded</p>
<h3><a class="anchor" id="load_extra_packages">
load_extra_packages</a></h3>
<pre>	Usage:  $obj -&gt; load_extra_packages('AlgParserWithImplicitExpand',
	                                    'Expr','ExprWithImplicitExpand');</pre><p>Loads extra packages for modules that contain more than one package. Works in conjunction with evaluate_modules. It is assumed that the file containing the extra packages (along with the base pachage name which is the same as the name of the file minus the .pm extension) has already been loaded using evaluate_modules =cut</p>
<h3><a class="anchor" id="new__Creates_the_translator_object">
. new</a></h3>
<p>Creates the translator object. </p>
<p>(b) The following routines defined within the <a class="el" href="classWeBWorK_1_1PG.html">PG</a> module are shared: </p>
<pre>	&amp;be_strict
	&amp;read_whole_problem_file
	&amp;convertPath
	&amp;surePathToTmpFile
	&amp;fileFromPath
	&amp;directoryFromPath
	&amp;createFile</pre><pre>	&amp;includePGtext</pre><pre>	&amp;PG_answer_eval
	&amp;PG_restricted_eval</pre><pre>	&amp;send_mail_to
	&amp;PGsort</pre><p>In addition the environment hash </p>
<div class="fragment"><pre class="fragment">\%envir
</pre></div><p> is shared. This variable is unpacked when <a class="el" href="PG_8pl.html">PG.pl</a> is run and provides most of the environment variables for each problem template. </p>
<pre>	&lt;A href =
	"${Global::webworkDocsURL}techdescription/pglanguage/PGenvironment.html"&gt; environment variables&lt;/A&gt;</pre><p>(c) Sharing macros: </p>
<p>The macros shared with the safe compartment are </p>
<pre>	'&amp;read_whole_problem_file'
	'&amp;convertPath'
	'&amp;surePathToTmpFile'
	'&amp;fileFromPath'
	'&amp;directoryFromPath'
	'&amp;createFile'
	'&amp;PG_answer_eval'
	'&amp;PG_restricted_eval'
	'&amp;be_strict'
	'&amp;send_mail_to'
	'&amp;PGsort'
	'&amp;dumpvar'
	'&amp;includePGtext'</pre><h3><a class="anchor" id="Safe_compartment_pass_through_macros">
Safe compartment pass through macros</a></h3>
<h3><a class="anchor" id="set_mask">
set_mask</a></h3>
<p>(e) Now we close the safe compartment. Only the certain operations can be used within <a class="el" href="classWeBWorK_1_1PG.html">PG</a> problems and the <a class="el" href="classWeBWorK_1_1PG.html">PG</a> macro files. These include the subroutines shared with the safe compartment as defined above and most Perl commands which do not involve file access, access to the system or evaluation. </p>
<p>Specifically the following are allowed </p>
<pre>	time()
		# gives the current Unix time
		# used to determine whether solutions are visible.
	atan, sin cos exp log sqrt
		# arithemetic commands -- more are defined in <a class="el" href="PGauxiliaryFunctions_8pl.html">PGauxiliaryFunctions.pl</a></pre><p>The following are specifically not allowed: </p>
<pre>	eval()
	unlink, symlink, system, exec
	print require</pre><h3><a class="anchor" id="PG_errorMessage">
PG_errorMessage</a></h3>
<p>This routine processes error messages by fixing file names and adding traceback information. It loops through the function calls via caller() in order to give more information about where the error occurred. Since the loadMacros() files and the .pg file itself are handled via various kinds of eval calls, the caller() information does not contain the file names. So we have saved them in the $main::__files__ hash, which we look up here and use to replace the (eval nnn) file names that are in the caller stack. We shorten the filenames by removing the templates or root directories when possible, so they are easier to read. </p>
<p>We skip any nested calls to <a class="el" href="classParser.html">Parser</a>:: or <a class="el" href="classValue.html">Value</a>:: so that these act more like perl built-in functions. </p>
<p>We stop when we find a routine in the <a class="el" href="classWeBWorK.html">WeBWorK</a>:: package, or an __ANON__ routine, in order to avoid reporting the <a class="el" href="classWeBWorK_1_1PG.html">PG</a> translator calls that surround the pg file. Finally, there is usually one more eval before that, so we remove it as well. </p>
<p>File names are shortened, when possible, by replacing the templates directory with [TMPL], the <a class="el" href="classWeBWorK.html">WeBWorK</a> root directory by [WW] and the <a class="el" href="classWeBWorK_1_1PG.html">PG</a> root directory by [<a class="el" href="classWeBWorK_1_1PG.html">PG</a>].</p>
<h3><a class="anchor" id="PG_undef_var_check">
PG_undef_var_check</a></h3>
<pre> Produces warnings of this type in order to help you guess which local variable is undefined
 Warning: Use of uninitialized value in concatenation (.) or string at mpu.cgi line 25.
 Possible variables are:
           '$GLOBAL_VARIABLE' =&gt; \'global',
           '$t' =&gt; \undef,
           '$s' =&gt; \'regular output'</pre><h3><a class="anchor" id="Translate">
Translate</a></h3>
<h3><a class="anchor" id="Answer_evaluation_methods">
Answer evaluation methods</a></h3>
<h3>access methods</h3>
<pre>	$obj-&gt;rh_student_answers</pre><h3>process_answers</h3>
<pre>	$obj-&gt;<a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#a4416c14dd38dd007ade3e380ab5357f9">process_answers()</a></pre><h3>grade_problem</h3>
<pre>	$obj-&gt;rh_problem_state(%problem_state);  # sets the current problem state
	$obj-&gt;grade_problem(%form_options);</pre><h3>safetyFilter</h3>
<pre>	($filtered_ans, $errors) = $obj -&gt;filter_ans($ans)
                               $obj -&gt;<a class="el" href="classWeBWorK_1_1PG_1_1Translator.html#aa62d4bcdad525a2225fb8f5d09eff073">rf_safety_filter()</a></pre><h3><a class="anchor" id="PGsort">
PGsort</a></h3>
<p>Because of the way sort is optimized in Perl, the symbols $a and $b have special significance. </p>
<div class="fragment"><pre class="fragment">sort {$a&amp;lt;=
</pre></div><p> $b} @list&gt;</p>
<div class="fragment"><pre class="fragment">sort {$a cmp $b} \@list
</pre></div>  <p>sorts the list numerically and lexically respectively. </p>
<p>If </p>
<div class="fragment"><pre class="fragment">my $a;
</pre></div><p> is used in a problem, before the sort routine is defined in a macro, then things get badly confused. To correct this the macro PGsort is defined below. It is evaluated before the problem template is read. In <a class="el" href="PGbasicmacros_8pl.html">PGbasicmacros.pl</a>, the two subroutines </p>
<pre>	PGsort sub { $_[0] &lt; $_[1] }, @list;
	PGsort sub { $_[0] lt $_[1] }, @list;</pre><p>(called num_sort and lex_sort) provide slightly slower, but safer, routines for the <a class="el" href="classWeBWorK_1_1PG.html">PG</a> language. (The subroutines for ordering are <b>required</b>. Note the commas!)</p>
<h3><a class="anchor" id="includePGtext">
includePGtext</a></h3>
<pre>	includePGtext($string_ref, $envir_ref)</pre><p>Calls </p>
<div class="fragment"><pre class="fragment">createPGtext
</pre></div><p> recursively with the $safeCompartment variable set to 0 so that the rendering continues in the current safe compartment. The output is the same as the output from createPGtext. This is used in processing some of the sample CAPA files.</p>
<h3><a class="anchor" id="PG_restricted_eval">
PG_restricted_eval</a></h3>
<pre>	PG_restricted_eval($string)</pre><p>Evaluated in package 'main'. Result of last statement is returned. When called from within a safe compartment the safe compartment package is 'main'.</p>
<h3><a class="anchor" id="PG_answer_eval">
PG_answer_eval</a></h3>
<pre>	PG_answer_eval($string)</pre><p>Evaluated in package defined by the current safe compartment. Result of last statement is returned. When called from within a safe compartment the safe compartment package is 'main'. </p>
<p>There is still some confusion about how these two evaluation subroutines work and how best to define them. It is useful to have two evaluation procedures since at some point one might like to make the answer evaluations more stringent. </p>

<p>Definition at line <a class="el" href="Translator_8pm_source.html#l00256">256</a> of file <a class="el" href="Translator_8pm_source.html">Translator.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a2d92cfec49c0244698780a7ca4f086d0"></a><!-- doxytag: member="WeBWorK::PG::Translator::a_text" ref="a2d92cfec49c0244698780a7ca4f086d0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::a_text </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-a_text' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-a_text-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-a_text-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-a_text-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in a_text: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a2d92cfec49c0244698780a7ca4f086d0">a_text</a> {
    my $self  = shift;
    @{$self-&gt;{PG_PROBLEM_TEXT_ARRAY_REF}};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="af3bac483103300020f8ef3ca8ab43ec2"></a><!-- doxytag: member="WeBWorK::PG::Translator::avg_problem_grader" ref="af3bac483103300020f8ef3ca8ab43ec2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::avg_problem_grader </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-avg_problem_grader' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-avg_problem_grader-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-avg_problem_grader-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-avg_problem_grader-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in avg_problem_grader: 49</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af3bac483103300020f8ef3ca8ab43ec2">avg_problem_grader</a>{
    my $rh_evaluated_answers = shift;
    my $rh_problem_state = shift;
    my %form_options = @_;
    my %evaluated_answers = %{$rh_evaluated_answers};
<span class="preprocessor">    #  The hash $rh_evaluated_answers typically contains:</span>
<span class="preprocessor"></span><span class="preprocessor">    #      &#39;answer1&#39; =&gt; 34, &#39;answer2&#39;=&gt; &#39;Mozart&#39;, etc.</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # By default the  old problem state is simply passed back out again.</span>
<span class="preprocessor"></span>    my %problem_state = %$rh_problem_state;


<span class="preprocessor">    # %form_options might include</span>
<span class="preprocessor"></span><span class="preprocessor">    # The user login name</span>
<span class="preprocessor"></span><span class="preprocessor">    # The permission level of the user</span>
<span class="preprocessor"></span><span class="preprocessor">    # The studentLogin name for this psvn.</span>
<span class="preprocessor"></span><span class="preprocessor">    # Whether the form is asking for a refresh or is submitting a new answer.</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # initial setup of the answer</span>
<span class="preprocessor"></span>    my  $total=0;
    my %problem_result = (
        score =&gt; 0,
        errors =&gt; <span class="stringliteral">&#39;&#39;</span>,
        type =&gt; <span class="stringliteral">&#39;avg_problem_grader&#39;</span>,
        msg =&gt; <span class="stringliteral">&#39;&#39;</span>,
    );
    my $count = keys %evaluated_answers;
    $problem_result{msg} = <span class="stringliteral">&#39;You can earn partial credit on this problem.&#39;</span> <span class="keywordflow">if</span> $count &gt;1;
<span class="preprocessor">    # Return unless answers have been submitted</span>
<span class="preprocessor"></span>    unless ($form_options{answers_submitted} == 1) {
        <span class="keywordflow">return</span>(\%problem_result,\%problem_state);
    }
<span class="preprocessor">    # Answers have been submitted -- process them.</span>
<span class="preprocessor"></span>    <span class="keywordflow">foreach</span> my $ans_name (keys %evaluated_answers) {
        $total += $evaluated_answers{$ans_name}-&gt;{score};
    }
<span class="preprocessor">    # Calculate score rounded to three places to avoid roundoff problems</span>
<span class="preprocessor"></span>    $problem_result{score} = ($count) ? $total/$count : 0 ; # give zero <span class="keywordflow">if</span> no answers have been evaluated.
    # increase recorded score <span class="keywordflow">if</span> the current score is greater.
    $problem_state{recorded_score}=0 unless defined $problem_state{recorded_score};
    $problem_state{recorded_score} = $problem_result{score} <span class="keywordflow">if</span> $problem_result{score} &gt; $problem_state{recorded_score};


    $problem_state{num_of_correct_ans}++ <span class="keywordflow">if</span> $total == $count;
    $problem_state{num_of_incorrect_ans}++ <span class="keywordflow">if</span> $total &lt; $count ;
    warn <span class="stringliteral">&quot;Error in grading this problem the total $total is larger than $count&quot;</span> <span class="keywordflow">if</span> $total &gt; $count;
    (\%problem_result, \%problem_state);

}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1d282942a816b4f5add58f21f18d4931"></a><!-- doxytag: member="WeBWorK::PG::Translator::be_strict" ref="a1d282942a816b4f5add58f21f18d4931" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::be_strict </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-be_strict' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-be_strict-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-be_strict-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-be_strict-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in be_strict: 4</span>
<span class="preprocessor"></span>    sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a1d282942a816b4f5add58f21f18d4931">be_strict</a> {
        require <span class="stringliteral">&#39;ww_strict.pm&#39;</span>;
        strict::import();
    }
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac152d184f158c8632818d961c2bc6aeb"></a><!-- doxytag: member="WeBWorK::PG::Translator::default_postprocess_code" ref="ac152d184f158c8632818d961c2bc6aeb" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::default_postprocess_code </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-default_postprocess_code' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-default_postprocess_code-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-default_postprocess_code-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-default_postprocess_code-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in default_postprocess_code: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ac152d184f158c8632818d961c2bc6aeb">default_postprocess_code</a> {
    my $evalString_ref = shift;
    $evalString_ref;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae65dcd601c0a78d6ebd75078eb6b94ce"></a><!-- doxytag: member="WeBWorK::PG::Translator::default_preprocess_code" ref="ae65dcd601c0a78d6ebd75078eb6b94ce" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::default_preprocess_code </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-default_preprocess_code' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-default_preprocess_code-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-default_preprocess_code-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-default_preprocess_code-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in default_preprocess_code: 21</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ae65dcd601c0a78d6ebd75078eb6b94ce">default_preprocess_code</a> {
    my $evalString = shift;
<span class="preprocessor">    # BEGIN_TEXT and END_TEXT must occur on a line by themselves.</span>
<span class="preprocessor"></span>    $evalString =~ s/\n\s*END_TEXT[\s;]*\n/\nEND_TEXT\n/g;
    $evalString =~ s/\n\s*END_PGML[\s;]*\n/\nEND_PGML\n/g;
    $evalString =~ s/\n\s*END_PGML_SOLUTION[\s;]*\n/\nEND_PGML_SOLUTION\n/g;
    $evalString =~ s/\n\s*END_PGML_HINT[\s;]*\n/\nEND_PGML_HINT\n/g;
    $evalString =~ s/\n\s*END_SOLUTION[\s;]*\n/\nEND_SOLUTION\n/g;
    $evalString =~ s/\n\s*END_HINT[\s;]*\n/\nEND_HINT\n/g;
    $evalString =~ s/\n\s*BEGIN_TEXT[\s;]*\n/\nTEXT\(EV3P\(&lt;&lt;<span class="stringliteral">&#39;END_TEXT&#39;</span>\)\);\n/g;
    $evalString =~ s/\n\s*BEGIN_PGML[\s;]*\n/\nTEXT\(PGML::Format2\(&lt;&lt;<span class="stringliteral">&#39;END_PGML&#39;</span>\)\);\n/g;
    $evalString =~ s/\n\s*BEGIN_PGML_SOLUTION[\s;]*\n/\nSOLUTION\(PGML::Format2\(&lt;&lt;<span class="stringliteral">&#39;END_PGML_SOLUTION&#39;</span>\)\);\n/g;
    $evalString =~ s/\n\s*BEGIN_PGML_HINT[\s;]*\n/\nHINT\(PGML::Format2\(&lt;&lt;<span class="stringliteral">&#39;END_PGML_SOLUTION&#39;</span>\)\);\n/g;
    $evalString =~ s/\n\s*BEGIN_SOLUTION[\s;]*\n/\nSOLUTION\(EV3P\(&lt;&lt;<span class="stringliteral">&#39;END_SOLUTION&#39;</span>\)\);\n/g;
    $evalString =~ s/\n\s*BEGIN_HINT[\s;]*\n/\nHINT\(EV3P\(&lt;&lt;<span class="stringliteral">&#39;END_HINT&#39;</span>\)\);\n/g;
    $evalString =~ s/ENDDOCUMENT.*/ENDDOCUMENT();/s; # <span class="keyword">remove</span> text after ENDDOCUMENT

    $evalString =~ s/\\/\\\\/g;    # \ can<span class="stringliteral">&#39;t be used for escapes because of TeX conflict</span>
<span class="stringliteral">    $evalString =~ s/~~/\\/g;      # use ~~ as escape instead, use # for comments</span>
<span class="stringliteral">    $evalString;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a7a12ca9631bd5926d557ca003526dc46"></a><!-- doxytag: member="WeBWorK::PG::Translator::deny" ref="a7a12ca9631bd5926d557ca003526dc46" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::deny </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-deny' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-deny-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-deny-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-deny-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in deny: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a7a12ca9631bd5926d557ca003526dc46">deny</a> {

    my $self = shift;
    my @array = shift;
    my $safe_compartment = $self-&gt;{safe};
    $safe_compartment-&gt;deny(@array);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a6d0f4eececaaf6eb56d11e2b8dfa588d"></a><!-- doxytag: member="WeBWorK::PG::Translator::dumpvar" ref="a6d0f4eececaaf6eb56d11e2b8dfa588d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::dumpvar </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-dumpvar' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-dumpvar-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-dumpvar-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-dumpvar-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in dumpvar: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a6d0f4eececaaf6eb56d11e2b8dfa588d">dumpvar</a> {
    my ($packageName) = @_;

    local(*alias);
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="acabd05c3460e43cb02407459807a1aa8"></a><!-- doxytag: member="WeBWorK::PG::Translator::emit" ref="acabd05c3460e43cb02407459807a1aa8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::emit </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-emit' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-emit-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-emit-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-emit-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in emit: 38</span>
<span class="preprocessor"></span>    sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acabd05c3460e43cb02407459807a1aa8">emit</a> {
        print @_;
    }
    
    *stash = *{<span class="stringliteral">&quot;${packageName}::&quot;</span>};
    $, = <span class="stringliteral">&quot;  &quot;</span>;
    
    <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acabd05c3460e43cb02407459807a1aa8">emit</a> <span class="stringliteral">&quot;Content-type: text/html\n\n&lt;PRE&gt;\n&quot;</span>;
    
    
    <span class="keywordflow">while</span> ( ($varName, $globValue) = each %stash) {
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acabd05c3460e43cb02407459807a1aa8">emit</a> <span class="stringliteral">&quot;$varName\n&quot;</span>;
        
    *alias = $globValue;
    next <span class="keywordflow">if</span> $varName=~/<a class="code" href="classmain.html">main</a>/;
    
<span class="preprocessor">    #if (defined($alias) ) {  # get rid of defined since this is deprecated</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($alias ) {
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acabd05c3460e43cb02407459807a1aa8">emit</a> <span class="stringliteral">&quot;  \$$varName $alias \n&quot;</span>;
    }
    
    <span class="keywordflow">if</span> ( @alias) {
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acabd05c3460e43cb02407459807a1aa8">emit</a> <span class="stringliteral">&quot;  \@$varName @alias \n&quot;</span>;
    }
    <span class="keywordflow">if</span> (%alias ) {
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acabd05c3460e43cb02407459807a1aa8">emit</a> <span class="stringliteral">&quot;  %$varName \n&quot;</span>;
        <span class="keywordflow">foreach</span> $key (keys %alias) {
            <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acabd05c3460e43cb02407459807a1aa8">emit</a> <span class="stringliteral">&quot;    $key =&gt; $alias{$key}\n&quot;</span>;
        }



    }
    }
    <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acabd05c3460e43cb02407459807a1aa8">emit</a> <span class="stringliteral">&quot;&lt;/PRE&gt;&lt;/PRE&gt;&quot;</span>;


}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a6024fb17151788751b97b6fc8693ed06"></a><!-- doxytag: member="WeBWorK::PG::Translator::environment" ref="a6024fb17151788751b97b6fc8693ed06" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::environment </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-environment' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-environment-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-environment-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-environment-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in environment: 12</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a6024fb17151788751b97b6fc8693ed06">environment</a>{
    my $self = shift;
    my $envirref = shift;
    <span class="keywordflow">if</span> ( defined($envirref) )  {
        <span class="keywordflow">if</span> (ref($envirref) eq <span class="stringliteral">&#39;HASH&#39;</span>) {
            %{ $self -&gt; {envir} } = %$envirref;
        } <span class="keywordflow">else</span> {
            $self -&gt;{errors} .= <span class="stringliteral">&quot;ERROR: The environment method for PG_translate objects requires a reference to a hash&quot;</span>;
        }
    }
    $self-&gt;{envir} ; #reference to current <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a6024fb17151788751b97b6fc8693ed06">environment</a>
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab42670011f0f8b62554bb9f45d8528a7"></a><!-- doxytag: member="WeBWorK::PG::Translator::errors" ref="ab42670011f0f8b62554bb9f45d8528a7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::errors </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-errors' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-errors-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-errors-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-errors-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in errors: 4</span>
<span class="preprocessor"></span>sub errors{
    my $self = shift;
    $self-&gt;{errors};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="afe9e74f48895480761b8e2509969b8ed"></a><!-- doxytag: member="WeBWorK::PG::Translator::evaluate_modules" ref="afe9e74f48895480761b8e2509969b8ed" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::evaluate_modules </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-evaluate_modules' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-evaluate_modules-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-evaluate_modules-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-evaluate_modules-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in evaluate_modules: 17</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#afe9e74f48895480761b8e2509969b8ed">evaluate_modules</a> {
    my $self = shift;
    my @modules = @_;
    local $SIG{__DIE__} = <span class="stringliteral">&quot;DEFAULT&quot;</span>; # we<span class="stringliteral">&#39;re going to be eval()ing code</span>
<span class="stringliteral">    foreach (@modules) {</span>
<span class="stringliteral">        #warn &quot;attempting to load $_\n&quot;;</span>
<span class="stringliteral">        # ensure that the name is in fact a base name</span>
<span class="stringliteral">        s/\.pm$// and warn &quot;fixing your broken package name: $_.pm =&gt; $_&quot;;</span>
<span class="stringliteral">        # call runtime_use on the package name</span>
<span class="stringliteral">        # don&#39;</span>t worry -- runtime_use won<span class="stringliteral">&#39;t load a package twice!</span>
<span class="stringliteral">        #eval { runtime_use $_ };                   # </span>
<span class="stringliteral">        eval &quot;package Main; require $_; import $_&quot;; # change for WW1</span>
<span class="stringliteral">        warn &quot;Failed to evaluate module $_: $@&quot; if $@;</span>
<span class="stringliteral">        # record this in the appropriate place</span>
<span class="stringliteral">        push @{$self-&gt;{ra_included_modules}}, &quot;\%${_}::&quot;;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a01cca4a23974480a1cdcca7d9848524c"></a><!-- doxytag: member="WeBWorK::PG::Translator::filter_answer" ref="a01cca4a23974480a1cdcca7d9848524c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::filter_answer </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-filter_answer' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-filter_answer-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-filter_answer-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-filter_answer-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in filter_answer: 22</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a01cca4a23974480a1cdcca7d9848524c">filter_answer</a> {
    my $self = shift;
    my $ans = shift;
    my @filtered_answers;
    my $errors=<span class="stringliteral">&#39;&#39;</span>;
    <span class="keywordflow">if</span> (ref($ans) eq <span class="stringliteral">&#39;ARRAY&#39;</span>) {   #handle the <span class="keywordflow">case</span> where the answer comes from several inputs with the same name
<span class="preprocessor">                                  # In many cases this will be passed as a reference to an array</span>
<span class="preprocessor"></span><span class="preprocessor">                                  # if it is passed as a single string (separated by \0 characters) as </span>
<span class="preprocessor"></span><span class="preprocessor">                                  # some early versions of CGI behave, then </span>
<span class="preprocessor"></span><span class="preprocessor">                                  # it is unclear what will happen when the answer is filtered.</span>
<span class="preprocessor"></span>        <span class="keywordflow">foreach</span> my $item (@{$ans}) {
            my ($filtered_ans, $error) = &amp;{ $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#aa62d4bcdad525a2225fb8f5d09eff073">rf_safety_filter</a>} } ($item);
            push(@filtered_answers, $filtered_ans);
            $errors .= <span class="stringliteral">&quot; &quot;</span>. $error <span class="keywordflow">if</span> $error;  # add error message <span class="keywordflow">if</span> error is non-zero.
        }
        (\@filtered_answers,$errors);
    
    } <span class="keywordflow">else</span> {
        &amp;{ $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#aa62d4bcdad525a2225fb8f5d09eff073">rf_safety_filter</a>} } ($ans);
    }
    
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3bf2816348f52fe32cad43286615c208"></a><!-- doxytag: member="WeBWorK::PG::Translator::grade_problem" ref="a3bf2816348f52fe32cad43286615c208" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::grade_problem </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-grade_problem' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-grade_problem-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-grade_problem-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-grade_problem-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in grade_problem: 21</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a3bf2816348f52fe32cad43286615c208">grade_problem</a> {
    my $self = shift;
    no strict;
    local %rf_options = @_;
    local $rf_grader = $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af5d5e5dc7c2a890bc64145bc7e9ddd22">rf_problem_grader</a>};
    local $rh_answers = $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a5b9a83c282ac755b961518314df3d061">rh_evaluated_answers</a>};
    local $rh_state = $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a>};
    $self-&gt;{safe}-&gt;share(<span class="stringliteral">&#39;$rf_grader&#39;</span>,<span class="stringliteral">&#39;$rh_answers&#39;</span>,<span class="stringliteral">&#39;$rh_state&#39;</span>,<span class="stringliteral">&#39;%rf_options&#39;</span>);
<span class="preprocessor">############################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># FIXME</span>
<span class="preprocessor"></span><span class="preprocessor"># warning messages are not being transmitted from this evaluation</span>
<span class="preprocessor"></span><span class="preprocessor"># ??????</span>
<span class="preprocessor"></span><span class="preprocessor">############################################</span>
<span class="preprocessor"></span>
    ($self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ab02e3b1824e199b2514bb39a42725f59">rh_problem_result</a>},$self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a>}) =
        $self-&gt;{safe}-&gt;reval(<span class="stringliteral">&#39;&amp;{$rf_grader}($rh_answers,$rh_state,%rf_options)&#39;</span>);
    use strict;
    die $@ <span class="keywordflow">if</span> $@;
    ($self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ab02e3b1824e199b2514bb39a42725f59">rh_problem_result</a>}, $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a>});
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="adc49691ce92dc7596ff702a2063f5282"></a><!-- doxytag: member="WeBWorK::PG::Translator::h_answers" ref="adc49691ce92dc7596ff702a2063f5282" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::h_answers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-h_answers' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-h_answers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-h_answers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-h_answers-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in h_answers: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#adc49691ce92dc7596ff702a2063f5282">h_answers</a>{
    my $self = shift;
    %{$self-&gt;{PG_ANSWER_HASH_REF}};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad2b36b2fb86ed82115a97faa9d7fee16"></a><!-- doxytag: member="WeBWorK::PG::Translator::h_flags" ref="ad2b36b2fb86ed82115a97faa9d7fee16" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::h_flags </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-h_flags' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-h_flags-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-h_flags-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-h_flags-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in h_flags: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad2b36b2fb86ed82115a97faa9d7fee16">h_flags</a> {
    my $self = shift;
    %{$self-&gt;{PG_FLAGS_REF}};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4a71e2b8b0a0ad86a36d7a89cec5898e"></a><!-- doxytag: member="WeBWorK::PG::Translator::header" ref="a4a71e2b8b0a0ad86a36d7a89cec5898e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::header </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-header' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-header-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-header-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-header-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in header: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a4a71e2b8b0a0ad86a36d7a89cec5898e">header</a> {
    my $self = shift;
    ${$self-&gt;{PG_HEADER_TEXT_REF}};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a55f8559c2175943e444cf0328f80c2c5"></a><!-- doxytag: member="WeBWorK::PG::Translator::initialize" ref="a55f8559c2175943e444cf0328f80c2c5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in initialize: 18</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a55f8559c2175943e444cf0328f80c2c5">initialize</a> {
    my $self = shift;
    my $safe_cmpt = $self-&gt;{safe};
<span class="preprocessor">    #print &quot;initializing safeCompartment&quot;,$safe_cmpt -&gt; root(), &quot;\n&quot;;</span>
<span class="preprocessor"></span>
    $safe_cmpt -&gt; share(keys %shared_subroutine_hash);
    no strict;
    local(%envir) = %{ $self -&gt;{envir} };
    $safe_cmpt -&gt; share(<span class="stringliteral">&#39;%envir&#39;</span>);
<span class="preprocessor">    #local($rf_answer_eval) = sub { $self-&gt;PG_answer_eval(@_); };</span>
<span class="preprocessor"></span><span class="preprocessor">    #local($rf_restricted_eval) = sub { $self-&gt;PG_restricted_eval(@_); };</span>
<span class="preprocessor"></span><span class="preprocessor">    #$safe_cmpt -&gt; share(&#39;$rf_answer_eval&#39;);</span>
<span class="preprocessor"></span><span class="preprocessor">    #$safe_cmpt -&gt; share(&#39;$rf_restricted_eval&#39;);</span>
<span class="preprocessor"></span>    use strict;
        
    $safe_cmpt -&gt; <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a6b2ab281e2d3410477ca40f28e807c36">share_from</a>(<span class="stringliteral">&#39;main&#39;</span>, $self-&gt;{ra_included_modules} );
<span class="preprocessor">        # the above line will get changed when we fix the PG modules thing. heh heh.</span>
<span class="preprocessor">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a41db5e3bc6853461b001a18457aed21b"></a><!-- doxytag: member="WeBWorK::PG::Translator::load_extra_packages" ref="a41db5e3bc6853461b001a18457aed21b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::load_extra_packages </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-load_extra_packages' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-load_extra_packages-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-load_extra_packages-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-load_extra_packages-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in load_extra_packages: 15</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a41db5e3bc6853461b001a18457aed21b">load_extra_packages</a>{
    my $self = shift;
    my @package_list = @_;
    my $package_name;
    
    <span class="keywordflow">foreach</span> (@package_list) {
<span class="preprocessor">        # ensure that the name is in fact a base name</span>
<span class="preprocessor"></span>        s/\.pm$<span class="comment">// and warn &quot;fixing your broken package name: $_.pm =&gt; $_&quot;;</span>
<span class="preprocessor">        # import symbols from the extra package</span>
<span class="preprocessor"></span>        <span class="keyword">import</span> $_;
        warn <span class="stringliteral">&quot;Failed to evaluate module $_: $@&quot;</span> <span class="keywordflow">if</span> $@;
<span class="preprocessor">        # record this in the appropriate place</span>
<span class="preprocessor"></span>        push @{$self-&gt;{ra_included_modules}}, <span class="stringliteral">&quot;\%${_}::&quot;</span>;
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a8047e2659d759707b9f61e0900905c67"></a><!-- doxytag: member="WeBWorK::PG::Translator::Main::be_strict" ref="a8047e2659d759707b9f61e0900905c67" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::Main::be_strict </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a1a3c997585e195be6a01d92cf549a324"></a><!-- doxytag: member="WeBWorK::PG::Translator::mask" ref="a1a3c997585e195be6a01d92cf549a324" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::mask </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-mask' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-mask-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-mask-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-mask-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in mask: 6</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a1a3c997585e195be6a01d92cf549a324">mask</a> {
    my $self = shift;
    my $mask = shift;
    my $safe_compartment = $self-&gt;{safe};
    $safe_compartment-&gt;mask($mask);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa884ced774ba6d6b389fc0b2a3a6779f"></a><!-- doxytag: member="WeBWorK::PG::Translator::nameSpace" ref="aa884ced774ba6d6b389fc0b2a3a6779f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::nameSpace </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-nameSpace' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-nameSpace-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-nameSpace-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-nameSpace-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in nameSpace: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#aa884ced774ba6d6b389fc0b2a3a6779f">nameSpace</a> {
    my $self = shift;
    $self-&gt;{safe}-&gt;root;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a3c36ecbc8b680d8703dff270020e7be8"></a><!-- doxytag: member="WeBWorK::PG::Translator::new" ref="a3c36ecbc8b680d8703dff270020e7be8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::new </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-new' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-new-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-new-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-new-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in new: 35</span>
<span class="preprocessor"></span>sub <span class="keyword">new</span> {
    my $class = shift;
    my $safe_cmpt = <span class="keyword">new</span> WWSafe; #(<span class="stringliteral">&#39;PG_priv&#39;</span>);
    my $self = {
        preprocess_code           =&gt;  \&amp;<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ae65dcd601c0a78d6ebd75078eb6b94ce">default_preprocess_code</a>,
        postprocess_code           =&gt; \&amp;<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ac152d184f158c8632818d961c2bc6aeb">default_postprocess_code</a>,
        envir                     =&gt; undef,
        PG_PROBLEM_TEXT_ARRAY_REF =&gt; [],
        PG_PROBLEM_TEXT_REF       =&gt; 0,
        PG_HEADER_TEXT_REF        =&gt; 0,
        PG_POST_HEADER_TEXT_REF   =&gt; 0,
        PG_ANSWER_HASH_REF        =&gt; {},
        PG_FLAGS_REF              =&gt; {},
        rh_pgcore                 =&gt; undef,    # ref to <a class="code" href="classPGcore.html">PGcore</a> <span class="keywordtype">object</span>
        safe                      =&gt; $safe_cmpt,
        safe_compartment_name     =&gt; $safe_cmpt-&gt;root,
        errors                    =&gt; <span class="stringliteral">&quot;&quot;</span>,
        source                    =&gt; <span class="stringliteral">&quot;&quot;</span>,
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a03bcf6d790a57567796f951f4e93c134">rh_correct_answers</a>        =&gt; {},
        rh_student_answers        =&gt; {},
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a5b9a83c282ac755b961518314df3d061">rh_evaluated_answers</a>      =&gt; {},
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ab02e3b1824e199b2514bb39a42725f59">rh_problem_result</a>         =&gt; {},
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a>          =&gt; {
            recorded_score       =&gt; 0, # the score recorded in the data base
            num_of_correct_ans   =&gt; 0, # the number of correct attempts at doing the problem
            num_of_incorrect_ans =&gt; 0, # the number of incorrect attempts
        },
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af5d5e5dc7c2a890bc64145bc7e9ddd22">rf_problem_grader</a>         =&gt; \&amp;<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a0257e7e8d573f75e4898c33732afb6">std_problem_grader</a>,
        <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#aa62d4bcdad525a2225fb8f5d09eff073">rf_safety_filter</a>          =&gt; \&amp;<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a318c50c2128714efd1f71634b5ccce14">safetyFilter</a>,
<span class="preprocessor">        # ra_included_modules is now populated independantly of @class_modules:</span>
<span class="preprocessor"></span>        ra_included_modules       =&gt; [], # [ <span class="keyword">@class</span>_modules ],
<span class="preprocessor">        #rh_directories            =&gt; {},</span>
<span class="preprocessor"></span>    };
    bless $self, $class;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a48081d1a14da28d5a0fd0cc5e240c2a9"></a><!-- doxytag: member="WeBWorK::PG::Translator::old_std_problem_grader" ref="a48081d1a14da28d5a0fd0cc5e240c2a9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::old_std_problem_grader </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-old_std_problem_grader' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-old_std_problem_grader-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-old_std_problem_grader-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-old_std_problem_grader-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in old_std_problem_grader: 24</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a48081d1a14da28d5a0fd0cc5e240c2a9">old_std_problem_grader</a>{
    my $rh_evaluated_answers = shift;
    my %flags = @_;  # not doing anything with these yet
    my %evaluated_answers = %{$rh_evaluated_answers};
    my  $allAnswersCorrectQ=1;
    <span class="keywordflow">foreach</span> my $ans_name (keys %evaluated_answers) {
<span class="preprocessor">    # I&#39;m not sure if this check is really useful.</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> (ref($evaluated_answers{$ans_name} ) eq <span class="stringliteral">&#39;HASH&#39;</span> ) {
            $allAnswersCorrectQ = 0 unless( 1 == $evaluated_answers{$ans_name}-&gt;{score} );
        } <span class="keywordflow">else</span> {
            warn <span class="stringliteral">&quot;Error: Answer $ans_name is not a hash&quot;</span>;
            warn <span class="stringliteral">&quot;$evaluated_answers{$ans_name}&quot;</span>;
        }
    }
<span class="preprocessor">    # Notice that &quot;all answers are correct&quot; if there are no questions.</span>
<span class="preprocessor"></span>    { score             =&gt; $allAnswersCorrectQ,
      prev_tries        =&gt; 0,
      partial_credit    =&gt; $allAnswersCorrectQ,
      errors            =&gt;  <span class="stringliteral">&quot;&quot;</span>,
      type              =&gt; <span class="stringliteral">&#39;old_std_problem_grader&#39;</span>,
      flags             =&gt; {}, # not doing anything with these yet
    };  # hash output

}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a156e5644df6ffa85a3748ca96127b8de"></a><!-- doxytag: member="WeBWorK::PG::Translator::permit" ref="a156e5644df6ffa85a3748ca96127b8de" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::permit </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-permit' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-permit-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-permit-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-permit-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in permit: 6</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a156e5644df6ffa85a3748ca96127b8de">permit</a> {
    my $self = shift;
    my @array = shift;
    my $safe_compartment = $self-&gt;{safe};
    $safe_compartment-&gt;permit(@array);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1084e8d1414edef7aa67a6fd2ef1d6a9"></a><!-- doxytag: member="WeBWorK::PG::Translator::PG_answer_eval" ref="a1084e8d1414edef7aa67a6fd2ef1d6a9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::PG_answer_eval </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-PG_answer_eval' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-PG_answer_eval-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-PG_answer_eval-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-PG_answer_eval-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in PG_answer_eval: 31</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a1084e8d1414edef7aa67a6fd2ef1d6a9">PG_answer_eval</a> {
   local($string) = shift;   # I made <span class="keyword">this</span> local just in <span class="keywordflow">case</span> -- see <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a887f17730aa20cca0b4ab1a30d2ddc1c">PG_restricted_eval</a>
   my $errors = <span class="stringliteral">&#39;&#39;</span>;
   my $full_error_report = <span class="stringliteral">&#39;&#39;</span>;
   my ($pck,$file,$line) = caller; 
<span class="preprocessor">    # Because of the global variable $PG::compartment_name and $PG::safe_cmpt</span>
<span class="preprocessor"></span><span class="preprocessor">    # only one problem safe compartment can be active at a time.</span>
<span class="preprocessor"></span><span class="preprocessor">    # This might cause problems at some point.  In that case a cleverer way</span>
<span class="preprocessor"></span><span class="preprocessor">    # of insuring that the package stays in scope until the answer is evaluated</span>
<span class="preprocessor"></span><span class="preprocessor">    # will be required.</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    # This is pretty tricky and doesn&#39;t always work right.</span>
<span class="preprocessor"></span><span class="preprocessor">    # We seem to need PG_priv instead of main when PG_answer_eval is called within a completion</span>
<span class="preprocessor"></span><span class="preprocessor">    # &#39;package PG_priv; &#39;</span>
<span class="preprocessor"></span>    
        local $SIG{__WARN__} = sub {die(@_)};  # make warn die, so all errors are reported.
    local $SIG{__DIE__} = <span class="stringliteral">&quot;DEFAULT&quot;</span>;
    
    no strict;
    my $out = eval(<span class="stringliteral">&#39;package main;&#39;</span>.$string);
    $out = <span class="stringliteral">&#39;&#39;</span> unless defined($out);
    $errors .= $@;
    $full_error_report = <span class="stringliteral">&quot;ERROR: at line $line of file $file</span>
<span class="stringliteral">                $errors</span>
<span class="stringliteral">                The calling package is $pck\n&quot;</span> <span class="keywordflow">if</span> defined($errors) &amp;&amp; $errors =~/\S/;
    use strict;
    
    <span class="keywordflow">return</span> (wantarray) ?  ($out, $errors,$full_error_report) : $out;


}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad0429c6f4f82059b2c2bef229dea4143"></a><!-- doxytag: member="WeBWorK::PG::Translator::PG_errorMessage" ref="ad0429c6f4f82059b2c2bef229dea4143" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::PG_errorMessage </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-PG_errorMessage' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-PG_errorMessage-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-PG_errorMessage-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-PG_errorMessage-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in PG_errorMessage: 44</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad0429c6f4f82059b2c2bef229dea4143">PG_errorMessage</a> {
  my $return = shift; my $frame = 2; # <span class="keywordflow">return</span> can be <span class="stringliteral">&#39;message&#39;</span> or <span class="stringliteral">&#39;traceback&#39;</span>
  my $message = join(<span class="stringliteral">&quot;\n&quot;</span>,@_); $message =~ s/\.?\s+$<span class="comment">//;</span>
  my $files = eval (<span class="stringliteral">&#39;$main::__files__&#39;</span>); $files = {} unless $files;
  my $tmpl = $files-&gt;{tmpl} || <span class="charliteral">&#39;$&#39;</span>;
  my $root = $files-&gt;{root} || <span class="charliteral">&#39;$&#39;</span>;
  my $pg   = $files-&gt;{pg}   || <span class="charliteral">&#39;$&#39;</span>;
<span class="preprocessor">  #</span>
<span class="preprocessor"></span><span class="preprocessor">  #  Fix initial message file names</span>
<span class="preprocessor"></span><span class="preprocessor">  #</span>
<span class="preprocessor"></span>  $message =~ s! $tmpl! [TMPL]!g; $message =~ s! $root! [WW]!g; $message =~ s! $pg! [<a class="code" href="classWeBWorK_1_1PG.html">PG</a>]!g;
  $message =~ s/(\(eval \d+\)) (line (\d+))/$2 of $1/;
  <span class="keywordflow">while</span> ($message =~ m/of (?:file )?(\(eval \d+\))/ &amp;&amp; defined($files-&gt;{$1})) {
    my $name = $files-&gt;{$1};
    $name =~ s!^$tmpl![TMPL]!; $name =~ s!^$root![WW]!; $name =~ s!^$pg![<a class="code" href="classWeBWorK_1_1PG.html">PG</a>]!;
    $message =~ s/\(eval \d+\)/$name/g;
  }
<span class="preprocessor">  #</span>
<span class="preprocessor"></span><span class="preprocessor">  #  Return just the message if that&#39;s all we want, or</span>
<span class="preprocessor"></span><span class="preprocessor">  #   if the message already includes a stack trace</span>
<span class="preprocessor"></span><span class="preprocessor">  #</span>
<span class="preprocessor"></span>  <span class="keywordflow">return</span> $message.<span class="stringliteral">&quot;\n&quot;</span> <span class="keywordflow">if</span> $return eq <span class="stringliteral">&#39;message&#39;</span> || $message =~ m/\n   Died within/;
<span class="preprocessor">  #</span>
<span class="preprocessor"></span><span class="preprocessor">  #  Look through caller stack for traceback information</span>
<span class="preprocessor"></span><span class="preprocessor">  #</span>
<span class="preprocessor"></span>  my @trace = ($message);
  my $skipParser = (caller(3))[3] =~ m/^(<a class="code" href="classParser.html">Parser</a>|<a class="code" href="classValue.html">Value</a>)::/;
  <span class="keywordflow">while</span> (my ($pkg,$file,$line,$subname) = caller($frame++)) {
    last <span class="keywordflow">if</span> ($subname =~ m/^(Safe::reval|main::__ANON__)/);
    next <span class="keywordflow">if</span> $skipParser &amp;&amp; $subname =~ m/^(<a class="code" href="classParser.html">Parser</a>|<a class="code" href="classValue.html">Value</a>)::/;  # skip <a class="code" href="classParser.html">Parser</a> and <a class="code" href="classValue.html">Value</a> calls
    next <span class="keywordflow">if</span> $subname =~ m/__ANON__/;
    $file = $files-&gt;{$file} || $file;
    $file =~ s!^$tmpl![TMPL]!; $file =~ s!^$root![WW]!; $file =~ s!^$pg![<a class="code" href="classWeBWorK_1_1PG.html">PG</a>]!;
    $message =  <span class="stringliteral">&quot;   from within $subname called at line $line of $file&quot;</span>;
    push @trace, $message; $skipParser = 0;
  }
  splice(@trace,1,1) while $trace[1] &amp;&amp; $trace[1] =~ m/within \(eval\)/;
  pop @trace while $trace[-1] &amp;&amp; $trace[-1] =~ m/within \(eval\)/;
  $trace[1] =~ s/   from/   Died/ if $trace[1];
  <span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">  #  report the full traceback</span>
<span class="preprocessor"></span><span class="preprocessor">  #</span>
<span class="preprocessor"></span>  <span class="keywordflow">return</span> join(<span class="stringliteral">&quot;\n&quot;</span>,@trace,<span class="stringliteral">&#39;&#39;</span>);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="af2a567286bb304baf7feca7a92d4254e"></a><!-- doxytag: member="WeBWorK::PG::Translator::PG_macro_file_eval" ref="af2a567286bb304baf7feca7a92d4254e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::PG_macro_file_eval </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-PG_macro_file_eval' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-PG_macro_file_eval-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-PG_macro_file_eval-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-PG_macro_file_eval-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in PG_macro_file_eval: 17</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af2a567286bb304baf7feca7a92d4254e">PG_macro_file_eval</a> {      # would like to modify <span class="keyword">this</span> so that it requires use strict on the files that it evaluates.
    my $string = shift;
    my ($pck,$file,$line) = caller;
    
    local $SIG{__WARN__} = <span class="stringliteral">&quot;DEFAULT&quot;</span>;
    local $SIG{__DIE__} = <span class="stringliteral">&quot;DEFAULT&quot;</span>;
    
    no strict;
    my $out = eval  (<span class="stringliteral">&quot;package main; be_strict();\n&quot;</span> . $string );
    my $errors =$@;
    my $full_error_report = <span class="stringliteral">&quot;PG_macro_file_eval detected error at line $line of file $file \n&quot;</span>
                . $errors .
                <span class="stringliteral">&quot;The calling package is $pck\n&quot;</span> <span class="keywordflow">if</span> defined($errors) &amp;&amp; $errors =~/\S/;
    use strict;
    
    <span class="keywordflow">return</span> (wantarray) ?  ($out, $errors,$full_error_report) : $out;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a887f17730aa20cca0b4ab1a30d2ddc1c"></a><!-- doxytag: member="WeBWorK::PG::Translator::PG_restricted_eval" ref="a887f17730aa20cca0b4ab1a30d2ddc1c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::PG_restricted_eval </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-PG_restricted_eval' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-PG_restricted_eval-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-PG_restricted_eval-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-PG_restricted_eval-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in PG_restricted_eval: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a887f17730aa20cca0b4ab1a30d2ddc1c">PG_restricted_eval</a> {
    my $string = shift;
    my $out = <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acb9b8bef224f082ea2f550dce5b576d3">PG_restricted_eval_helper</a>($string);
    my $err = $@;
    my $err_report = $err <span class="keywordflow">if</span> $err =~ /\S/;
    <span class="keywordflow">return</span> wantarray ? ($out, $err, $err_report) : $out;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="acb9b8bef224f082ea2f550dce5b576d3"></a><!-- doxytag: member="WeBWorK::PG::Translator::PG_restricted_eval_helper" ref="acb9b8bef224f082ea2f550dce5b576d3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::PG_restricted_eval_helper </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-PG_restricted_eval_helper' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-PG_restricted_eval_helper-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-PG_restricted_eval_helper-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-PG_restricted_eval_helper-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in PG_restricted_eval_helper: 6</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acb9b8bef224f082ea2f550dce5b576d3">PG_restricted_eval_helper</a> {
    no strict;
    local $SIG{__WARN__} = <span class="stringliteral">&quot;DEFAULT&quot;</span>;
    local $SIG{__DIE__} = <span class="stringliteral">&quot;DEFAULT&quot;</span>;
    <span class="keywordflow">return</span> eval(<span class="stringliteral">&quot;package main;\n&quot;</span> . $_[0]);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a33db27c53aa96f70c0f18dffcc8601ad"></a><!-- doxytag: member="WeBWorK::PG::Translator::PG_undef_var_check" ref="a33db27c53aa96f70c0f18dffcc8601ad" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::PG_undef_var_check </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-PG_undef_var_check' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-PG_undef_var_check-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-PG_undef_var_check-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-PG_undef_var_check-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in PG_undef_var_check: 14</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a33db27c53aa96f70c0f18dffcc8601ad">PG_undef_var_check</a> {
    <span class="keywordflow">if</span>($_[0] !~ /^Use of uninitialized value/) {
        <span class="keywordflow">return</span> @_;
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # If there are objects, the output can be VERY large when you increase this</span>
<span class="preprocessor"></span>        local $Data::Dumper::Maxdepth = 2;
<span class="preprocessor">        # takes all lexical variables from caller-nemaspace</span>
<span class="preprocessor"></span>        my $possibles = Data::Dumper::Dumper({ %{PadWalker::peek_my(1)}, %{PadWalker::peek_our(1)} });
        
        $possibles ne <span class="stringliteral">&quot;\$VAR1 = {};\n&quot;</span> ? ($possibles =~ s/^.*?\n(.*)\n.*?\n$/$1/ms) : ($possibles = <span class="stringliteral">&#39;&#39;</span>);
        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Warning: &quot;</span> . join(<span class="stringliteral">&#39;, &#39;</span>, @_) . <span class="stringliteral">&quot;Possible variables are:\n$possibles\n&quot;</span>;
    }

}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a087b52953f6da548597ffb08a65221c5"></a><!-- doxytag: member="WeBWorK::PG::Translator::PGsort" ref="a087b52953f6da548597ffb08a65221c5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::PGsort </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-PGsort' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-PGsort-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-PGsort-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-PGsort-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in PGsort: 14</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a087b52953f6da548597ffb08a65221c5">PGsort</a> {
         my $cmp = shift;
     die <span class="stringliteral">&quot;Must supply an ordering function with PGsort: PGsort  sub {\$_[0]  &lt; \$_[1] }, \@list\n&quot;</span> unless ref($cmp) eq &#39;CODE&#39;;
         if (@_ == 0) { <span class="keywordflow">return</span> () }
         <span class="keywordflow">else</span> {
           my $b_item = shift;
           my ($small, $large);
           my $a_item;
           <span class="keywordflow">for</span> $a_item (@_) {
             push @{&amp;$cmp($a_item, $b_item) ? $small : $large}, $a_item;
           }
           <span class="keywordflow">return</span> (<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a087b52953f6da548597ffb08a65221c5">PGsort</a>($cmp, @$small), $b_item, <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a087b52953f6da548597ffb08a65221c5">PGsort</a>($cmp, @$large));
         }
       }
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa2229d8f40940a33e0aa9c9f6be0ec87"></a><!-- doxytag: member="WeBWorK::PG::Translator::post_header" ref="aa2229d8f40940a33e0aa9c9f6be0ec87" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::post_header </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-post_header' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-post_header-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-post_header-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-post_header-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in post_header: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#aa2229d8f40940a33e0aa9c9f6be0ec87">post_header</a> {
    my $self = shift;
    ${$self-&gt;{PG_POST_HEADER_TEXT_REF}};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad26733fb735b5593158c614a1b87b4a6"></a><!-- doxytag: member="WeBWorK::PG::Translator::pre_load_macro_files" ref="ad26733fb735b5593158c614a1b87b4a6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::pre_load_macro_files </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-pre_load_macro_files' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-pre_load_macro_files-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-pre_load_macro_files-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-pre_load_macro_files-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in pre_load_macro_files: 118</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad26733fb735b5593158c614a1b87b4a6">pre_load_macro_files</a> {
    <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af3a1478e1de125c7f446dfb7a6e4ed06">time_it</a>(<span class="stringliteral">&quot;Begin pre_load_macro_files&quot;</span>);
    my $self                = shift;
    my $cached_safe_cmpt    = shift;
    my $dirName             = shift;
    my @fileNameList        = @_;
    my $debugON             = 0;    # This helps with debugging the loading of macro files

<span class="preprocessor">################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#    prepare safe_cache</span>
<span class="preprocessor"></span><span class="preprocessor">################################################################</span>
<span class="preprocessor"></span>    $cached_safe_cmpt -&gt; share(keys %shared_subroutine_hash);
    no strict;
    local(%envir) = %{ $self -&gt;{envir} };
    $cached_safe_cmpt -&gt; share(<span class="stringliteral">&#39;%envir&#39;</span>);
    use strict;
    $cached_safe_cmpt -&gt; <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a6b2ab281e2d3410477ca40f28e807c36">share_from</a>(<span class="stringliteral">&#39;main&#39;</span>, $self-&gt;{ra_included_modules} );
    $cached_safe_cmpt-&gt;mask(Opcode::full_opset());  # allow no operations
    $cached_safe_cmpt-&gt;permit(qw(   :<span class="keywordflow">default</span> ));
    $cached_safe_cmpt-&gt;permit(qw(time));  # used to determine whether solutions are visible.
    $cached_safe_cmpt-&gt;permit(qw( atan2 sin cos exp log sqrt ));

<span class="preprocessor">    # just to make sure we&#39;ll deny some things specifically</span>
<span class="preprocessor"></span>    $cached_safe_cmpt-&gt;deny(qw(entereval));
    $cached_safe_cmpt-&gt;deny(qw (  unlink symlink system exec ));
    $cached_safe_cmpt-&gt;deny(qw(print require));

<span class="preprocessor">################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#    read in macro files</span>
<span class="preprocessor"></span><span class="preprocessor">################################################################</span>
<span class="preprocessor"></span>
    <span class="keywordflow">foreach</span> my $fileName (@fileNameList)   {
<span class="preprocessor">        # determine whether the file has already been loaded by checking for</span>
<span class="preprocessor"></span><span class="preprocessor">        # subroutine named _${macro_file_name}_init</span>
<span class="preprocessor"></span>        my $macro_file_name = $fileName;
        $macro_file_name =~s/\.pl<span class="comment">//;  # trim off the extension</span>
        $macro_file_name =~s/\.pg<span class="comment">//;  # sometimes the extension is .pg (e.g. CAPA files)</span>
        my $init_subroutine_name      = <span class="stringliteral">&quot;_${macro_file_name}_init&quot;</span>;
        my $macro_file_loaded = defined(&amp;{$cached_safe_cmpt-&gt;root.<span class="stringliteral">&quot;::$init_subroutine_name&quot;</span>}) ? 1 : 0; 
    
        
        <span class="keywordflow">if</span> ( $macro_file_loaded  )     {
            warn <span class="stringliteral">&quot;$macro_file_name is already loaded&quot;</span> <span class="keywordflow">if</span> $debugON;
         }<span class="keywordflow">else</span> {
            warn <span class="stringliteral">&quot;reading and evaluating $macro_file_name from $dirName/$fileName&quot;</span> <span class="keywordflow">if</span> $debugON;
<span class="preprocessor">            ### read in file</span>
<span class="preprocessor"></span>            my $filePath = <span class="stringliteral">&quot;$dirName/$fileName&quot;</span>;
            local(*MACROFILE);
            local($/);
            $/ = undef;   # allows us to treat the file as a single line
            open(MACROFILE, <span class="stringliteral">&quot;&lt;$filePath&quot;</span>) || die <span class="stringliteral">&quot;Cannot open file: $filePath&quot;</span>;
            my $string = &lt;MACROFILE&gt;;
            close(MACROFILE);
            

<span class="preprocessor">################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#    Evaluate macro files</span>
<span class="preprocessor"></span><span class="preprocessor">################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#    FIXME  The following hardwired behavior should be modifiable</span>
<span class="preprocessor"></span><span class="preprocessor">#    either in the procedure call or in global.conf:</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor">#    PG.pl, IO.pl and dangerousMacros.pl are loaded without restriction</span>
<span class="preprocessor"></span><span class="preprocessor">#    All other files are loaded with restriction</span>
<span class="preprocessor"></span><span class="preprocessor">#     </span>
<span class="preprocessor"></span><span class="preprocessor">            # construct a regex that matches only these three files safely</span>
<span class="preprocessor"></span>            my @unrestricted_files = (); #  no longer needed? FIXME w/<a class="code" href="classWeBWorK_1_1PG.html">PG</a>.pl dangerousMacros.pl IO.pl/;
            my $unrestricted_files = join(<span class="stringliteral">&quot;|&quot;</span>, map { quotemeta } @unrestricted_files);
            
            my $store_mask; 
            <span class="keywordflow">if</span> ($fileName =~ /^($unrestricted_files)$/) {
                $store_mask = $cached_safe_cmpt-&gt;mask();
                $cached_safe_cmpt -&gt;mask(Opcode::empty_opset());
            }           
            $cached_safe_cmpt -&gt; reval(<span class="stringliteral">&#39;BEGIN{push @main::__eval__,__FILE__}; package main; &#39;</span> .$string);
            warn <span class="stringliteral">&quot;preload Macros: errors in compiling $macro_file_name:&lt;br&gt; $@&quot;</span> <span class="keywordflow">if</span> $@;
            $self-&gt;{envir}{__files__}{$cached_safe_cmpt-&gt;reval(<span class="stringliteral">&#39;pop @main::__eval__&#39;</span>)} = $filePath;
            <span class="keywordflow">if</span> ($fileName =~ /^($unrestricted_files)$/) {
                $cached_safe_cmpt -&gt;mask($store_mask);
                warn <span class="stringliteral">&quot;mask restored after $fileName&quot;</span> <span class="keywordflow">if</span> $debugON;
            }
            

        }
    }
    
<span class="preprocessor">################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># load symbol table</span>
<span class="preprocessor"></span><span class="preprocessor">################################################################################</span>
<span class="preprocessor"></span>    warn <span class="stringliteral">&quot;begin loading symbol table &quot;</span>  <span class="keywordflow">if</span> $debugON;
    no strict <span class="stringliteral">&#39;refs&#39;</span>;
    my %symbolHash  = %{$cached_safe_cmpt-&gt;root.<span class="stringliteral">&#39;::&#39;</span>};
    use strict <span class="stringliteral">&#39;refs&#39;</span>;
    my @subroutine_names;

    <span class="keywordflow">foreach</span> my $name (keys %symbolHash) {
<span class="preprocessor">        # weed out internal symbols</span>
<span class="preprocessor"></span>        next <span class="keywordflow">if</span> $name =~ /^(INC|_|__ANON__|<a class="code" href="classmain.html">main</a>::)$/;
        <span class="keywordflow">if</span> ( defined(&amp;{*{$symbolHash{$name}}})  )  {
<span class="preprocessor">#               warn &quot;subroutine $name&quot; if $debugON;;</span>
<span class="preprocessor"></span>            push(@subroutine_names, <span class="stringliteral">&quot;&amp;$name&quot;</span>);      
        }      
    }
    
    warn <span class="stringliteral">&quot;Loading symbols into active safe compartment:&lt;br&gt; &quot;</span>, join(<span class="stringliteral">&quot; &quot;</span>,sort @subroutine_names) <span class="keywordflow">if</span> $debugON;
    $self-&gt;{safe} -&gt; <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a6b2ab281e2d3410477ca40f28e807c36">share_from</a>($cached_safe_cmpt-&gt;root,[@subroutine_names]);
    
<span class="preprocessor">    # Also need to share the cached safe compartment symbol hash in the current safe compartment. </span>
<span class="preprocessor"></span><span class="preprocessor">    # This is necessary because the macro files have been read into the cached safe compartment</span>
<span class="preprocessor"></span><span class="preprocessor">    # So all subroutines have the implied names  Safe::Root1::subroutine</span>
<span class="preprocessor"></span><span class="preprocessor">    # When they call each other we need to make sure that they can reach each other</span>
<span class="preprocessor"></span><span class="preprocessor">    # through the Safe::Root1 symbol table.</span>
<span class="preprocessor"></span>
    $self-&gt;{safe} -&gt; share(<span class="charliteral">&#39;%&#39;</span>.$cached_safe_cmpt-&gt;root.<span class="stringliteral">&#39;::&#39;</span>);
    warn <span class="stringliteral">&#39;Sharing &#39;</span>.<span class="charliteral">&#39;%&#39;</span>. $cached_safe_cmpt-&gt;root. <span class="stringliteral">&#39;::&#39;</span>  <span class="keywordflow">if</span> $debugON;
    <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af3a1478e1de125c7f446dfb7a6e4ed06">time_it</a>(<span class="stringliteral">&quot;End pre_load_macro_files&quot;</span>);
<span class="preprocessor">    # return empty string.</span>
<span class="preprocessor"></span>    <span class="stringliteral">&#39;&#39;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4416c14dd38dd007ade3e380ab5357f9"></a><!-- doxytag: member="WeBWorK::PG::Translator::process_answers" ref="a4416c14dd38dd007ade3e380ab5357f9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::process_answers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-process_answers' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-process_answers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-process_answers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-process_answers-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in process_answers: 102</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a4416c14dd38dd007ade3e380ab5357f9">process_answers</a>{
    my $self = shift;
    my @in = @_;
    my %h_student_answers;
    <span class="keywordflow">if</span> (ref($in[0]) eq <span class="stringliteral">&#39;HASH&#39;</span> ) {
        %h_student_answers = %{ $in[0] };  #receiving a reference to a hash of answers
    } <span class="keywordflow">else</span> {
        %h_student_answers = @in;          # receiving a hash of answers
    }
    my $rh_correct_answers = $self-&gt;rh_correct_answers();
    my @answer_entry_order = ( defined($self-&gt;{PG_FLAGS_REF}-&gt;{ANSWER_ENTRY_ORDER}) ) ?
                          @{$self-&gt;{PG_FLAGS_REF}-&gt;{ANSWER_ENTRY_ORDER}} : keys %{$rh_correct_answers};

<span class="preprocessor">    # define custom warn/die handlers for answer evaluation. these used to be inside</span>
<span class="preprocessor"></span><span class="preprocessor">    # the foreach loop around the conditional involving $rf_fun, but for efficiency</span>
<span class="preprocessor"></span><span class="preprocessor">    # we&#39;ve moved it out here. This means that the handlers will be active during the</span>
<span class="preprocessor"></span><span class="preprocessor">    # code before and after the actual answer evaluation.</span>
<span class="preprocessor"></span>    
    my $outer_sig_warn = $SIG{__WARN__};
    local $SIG{__WARN__} = sub {
        ref $outer_sig_warn eq <span class="stringliteral">&quot;CODE&quot;</span>
            ? &amp;$outer_sig_warn(<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad0429c6f4f82059b2c2bef229dea4143">PG_errorMessage</a>(<span class="stringliteral">&#39;message&#39;</span>, $_[0]))
            : warn <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad0429c6f4f82059b2c2bef229dea4143">PG_errorMessage</a>(<span class="stringliteral">&#39;message&#39;</span>, $_[0]);
    };
    
<span class="preprocessor">    # the die handler is a closure over %errorTable and $outer_sig_die.</span>
<span class="preprocessor"></span><span class="preprocessor">    # </span>
<span class="preprocessor"></span><span class="preprocessor">    # %errorTable accumulates a &quot;full&quot; error message for each error that occurs during</span>
<span class="preprocessor"></span><span class="preprocessor">    # answer evaluation. then, right after the evaluation (which is done within a call</span>
<span class="preprocessor"></span><span class="preprocessor">    # to Safe::reval), $@ is checked and it&#39;s value is looked up in %errorTable to get</span>
<span class="preprocessor"></span><span class="preprocessor">    # the full error to report.</span>
<span class="preprocessor"></span><span class="preprocessor">    # </span>
<span class="preprocessor"></span><span class="preprocessor">    # my question: why is this a hash? this is die, so once one occurs, we exit the reval.</span>
<span class="preprocessor"></span><span class="preprocessor">    # wouldn&#39;t it be sufficient to have a scalar like $backtrace_for_last_error?</span>
<span class="preprocessor"></span><span class="preprocessor">    # </span>
<span class="preprocessor"></span><span class="preprocessor">    # Note that %errorTable is cleared for each answer.</span>
<span class="preprocessor"></span>    my %errorTable;
    my $outer_sig_die = $SIG{__DIE__};
    local $SIG{__DIE__} = sub {
        
<span class="preprocessor">        # this chunk taken from dpvc&#39;s original handler</span>
<span class="preprocessor"></span>        my $fullerror = <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad0429c6f4f82059b2c2bef229dea4143">PG_errorMessage</a>(<span class="stringliteral">&#39;traceback&#39;</span>, @_);
        my ($error,$traceback) = split /\n/, $fullerror, 2;
        $fullerror =~ s/\n   /&lt;BR&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;/g; $fullerror =~ s/\n/&lt;BR&gt;/g;
        $error .= <span class="stringliteral">&quot;\n&quot;</span>;
        $errorTable{$error} = $fullerror;
<span class="preprocessor">        # end of dpvc&#39;s original code</span>
<span class="preprocessor"></span>        
        ref $outer_sig_die eq <span class="stringliteral">&quot;CODE&quot;</span>
            ? &amp;$outer_sig_die($error)
            : die $error;
    };
    
<span class="preprocessor">    # apply each instructors answer to the corresponding student answer</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">foreach</span> my $ans_name ( @answer_entry_order ) {
        my ($ans, $errors) = $self-&gt;filter_answer( $h_student_answers{$ans_name} );
        no strict;
<span class="preprocessor">        # evaluate the answers inside the safe compartment.</span>
<span class="preprocessor"></span>        local($rf_fun,$temp_ans) = (undef,undef);
        <span class="keywordflow">if</span> ( defined($rh_correct_answers -&gt;{$ans_name} ) ) {
            $rf_fun  = $rh_correct_answers-&gt;{$ans_name};
        } <span class="keywordflow">else</span> {
            warn <span class="stringliteral">&quot;There is no answer evaluator for the question labeled $ans_name&quot;</span>;
        }
        $temp_ans  = $ans;
        $temp_ans = <span class="stringliteral">&#39;&#39;</span> unless defined($temp_ans); #make sure that answer is always defined
<span class="preprocessor">                                                  # in case the answer evaluator forgets to check</span>
<span class="preprocessor"></span>        $self-&gt;{safe}-&gt;share(<span class="stringliteral">&#39;$rf_fun&#39;</span>,<span class="stringliteral">&#39;$temp_ans&#39;</span>);
        
<span class="preprocessor">        # clear %errorTable for each problem</span>
<span class="preprocessor"></span>        %errorTable = (); # is the error table being used? perhaps by math objects?
        
        my $rh_ans_evaluation_result;
        <span class="keywordflow">if</span> (ref($rf_fun) eq <span class="stringliteral">&#39;CODE&#39;</span> ) {
            $rh_ans_evaluation_result = $self-&gt;{safe} -&gt;reval( <span class="stringliteral">&#39;&amp;{ $rf_fun }($temp_ans, ans_label =&gt; \&#39;&#39;</span>.$ans_name.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&#39; ) ;</span>
<span class="stringliteral">            warn &quot;Error in Translator.pm::process_answers: Answer $ans_name: |$temp_ans|\n $@\n&quot; if $@;</span>
<span class="stringliteral">        } elsif (ref($rf_fun) =~ /AnswerEvaluator/)   {</span>
<span class="stringliteral">            $rh_ans_evaluation_result = $self-&gt;{safe} -&gt;reval(&#39;</span>$rf_fun-&gt;evaluate($temp_ans, ans_label =&gt; \<span class="stringliteral">&#39;&#39;</span>.$ans_name.<span class="charliteral">&#39;\&#39;</span>)<span class="stringliteral">&#39;);</span>
<span class="stringliteral">            $@ = $errorTable{$@} if $@ &amp;&amp; defined($errorTable{$@});  #Are we redefining error messages here?</span>
<span class="stringliteral">            warn &quot;Error in Translator.pm::process_answers: Answer $ans_name: |$temp_ans|\n $@\n&quot; if $@;</span>
<span class="stringliteral">            warn &quot;Evaluation error: Answer $ans_name:&lt;BR&gt;\n&quot;, </span>
<span class="stringliteral">                $rh_ans_evaluation_result-&gt;error_flag(), &quot; :: &quot;,</span>
<span class="stringliteral">                $rh_ans_evaluation_result-&gt;error_message(),&quot;&lt;BR&gt;\n&quot; </span>
<span class="stringliteral">                    if defined($rh_ans_evaluation_result)  </span>
<span class="stringliteral">                        and defined($rh_ans_evaluation_result-&gt;error_flag());</span>
<span class="stringliteral">        } else {</span>
<span class="stringliteral">            warn &quot;Error in Translator.pm::process_answers: Answer $ans_name:&lt;BR&gt;\n Unrecognized evaluator type |&quot;, ref($rf_fun), &quot;|&quot;;</span>
<span class="stringliteral">        }   </span>
<span class="stringliteral">        </span>
<span class="stringliteral">        use strict;</span>
<span class="stringliteral">        unless ( ( ref($rh_ans_evaluation_result) eq &#39;</span>HASH<span class="stringliteral">&#39;) or ( ref($rh_ans_evaluation_result) eq &#39;</span><a class="code" href="classAnswerHash.html">AnswerHash</a><span class="stringliteral">&#39;) ) {</span>
<span class="stringliteral">            warn &quot;Error in Translator.pm::process_answers: Answer $ans_name:&lt;BR&gt;\n</span>
<span class="stringliteral">                Answer evaluators must return a hash or an AnswerHash type, not type |&quot;, </span>
<span class="stringliteral">                ref($rh_ans_evaluation_result), &quot;|&quot;;</span>
<span class="stringliteral">        }</span>
<span class="stringliteral">        $rh_ans_evaluation_result -&gt;{ans_message} .= &quot;$errors \n&quot; if $errors;</span>
<span class="stringliteral">        $rh_ans_evaluation_result -&gt;{ans_name} = $ans_name;</span>
<span class="stringliteral">        $self-&gt;{rh_evaluated_answers}-&gt;{$ans_name} = $rh_ans_evaluation_result;</span>
<span class="stringliteral">    }</span>
<span class="stringliteral">    $self-&gt;rh_evaluated_answers;</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a1343a0821c2970658cb7a543fdbb064a"></a><!-- doxytag: member="WeBWorK::PG::Translator::r_header" ref="a1343a0821c2970658cb7a543fdbb064a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::r_header </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-r_header' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-r_header-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-r_header-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-r_header-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in r_header: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a1343a0821c2970658cb7a543fdbb064a">r_header</a> {
    my $self = shift;
    $self-&gt;{PG_HEADER_TEXT_REF};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ad2367a7298f90577f47292afa873ea26"></a><!-- doxytag: member="WeBWorK::PG::Translator::r_post_header" ref="ad2367a7298f90577f47292afa873ea26" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::r_post_header </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-r_post_header' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-r_post_header-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-r_post_header-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-r_post_header-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in r_post_header: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad2367a7298f90577f47292afa873ea26">r_post_header</a> {
    my $self = shift;
    $self-&gt;{PG_POST_HEADER_TEXT_REF};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a317550b236c465aa971f6a1f9f099b67"></a><!-- doxytag: member="WeBWorK::PG::Translator::r_text" ref="a317550b236c465aa971f6a1f9f099b67" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::r_text </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-r_text' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-r_text-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-r_text-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-r_text-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in r_text: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a317550b236c465aa971f6a1f9f099b67">r_text</a> {
    my $self  = shift;
    $self-&gt;{PG_PROBLEM_TEXT_REF};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac3066cb9e95011edfbb99ab8497ecdb8"></a><!-- doxytag: member="WeBWorK::PG::Translator::ra_text" ref="ac3066cb9e95011edfbb99ab8497ecdb8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::ra_text </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-ra_text' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-ra_text-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-ra_text-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-ra_text-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in ra_text: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ac3066cb9e95011edfbb99ab8497ecdb8">ra_text</a> {
    my $self  = shift;
    $self-&gt;{PG_PROBLEM_TEXT_ARRAY_REF};

}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="acb5c9a3f90d28f370114efda3dd393db"></a><!-- doxytag: member="WeBWorK::PG::Translator::rf_avg_problem_grader" ref="acb5c9a3f90d28f370114efda3dd393db" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::rf_avg_problem_grader </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rf_avg_problem_grader' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rf_avg_problem_grader-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rf_avg_problem_grader-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rf_avg_problem_grader-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rf_avg_problem_grader: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#acb5c9a3f90d28f370114efda3dd393db">rf_avg_problem_grader</a> {
    my $self = shift;
    <span class="keywordflow">return</span> \&amp;<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af3bac483103300020f8ef3ca8ab43ec2">avg_problem_grader</a>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="af5d5e5dc7c2a890bc64145bc7e9ddd22"></a><!-- doxytag: member="WeBWorK::PG::Translator::rf_problem_grader" ref="af5d5e5dc7c2a890bc64145bc7e9ddd22" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::rf_problem_grader </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rf_problem_grader' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rf_problem_grader-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rf_problem_grader-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rf_problem_grader-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rf_problem_grader: 11</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af5d5e5dc7c2a890bc64145bc7e9ddd22">rf_problem_grader</a> {
    my $self = shift;
    my $in = shift;
    <span class="keywordflow">return</span> $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af5d5e5dc7c2a890bc64145bc7e9ddd22">rf_problem_grader</a>} unless defined($in);
    <span class="keywordflow">if</span> (ref($in) =~/CODE/ ) {
        $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af5d5e5dc7c2a890bc64145bc7e9ddd22">rf_problem_grader</a>} = $in;
    } <span class="keywordflow">else</span> {
        die <span class="stringliteral">&quot;ERROR: Attempted to install a problem grader which was not a reference to a subroutine.&quot;</span>;
    }
    $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af5d5e5dc7c2a890bc64145bc7e9ddd22">rf_problem_grader</a>}
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aa62d4bcdad525a2225fb8f5d09eff073"></a><!-- doxytag: member="WeBWorK::PG::Translator::rf_safety_filter" ref="aa62d4bcdad525a2225fb8f5d09eff073" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::rf_safety_filter </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rf_safety_filter' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rf_safety_filter-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rf_safety_filter-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rf_safety_filter-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rf_safety_filter: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#aa62d4bcdad525a2225fb8f5d09eff073">rf_safety_filter</a> {
    my $self = shift;
    my $rf_filter = shift;
    $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#aa62d4bcdad525a2225fb8f5d09eff073">rf_safety_filter</a>} = $rf_filter <span class="keywordflow">if</span> $rf_filter and ref($rf_filter) eq &#39;CODE&#39;;
    warn &quot;The safety_filter must be a reference to a subroutine&quot; unless ref($rf_filter) eq &#39;CODE&#39; ;
    $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#aa62d4bcdad525a2225fb8f5d09eff073">rf_safety_filter</a>}
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac6c535a0561d7f536ed0e0f5d8a4daf4"></a><!-- doxytag: member="WeBWorK::PG::Translator::rf_std_problem_grader" ref="ac6c535a0561d7f536ed0e0f5d8a4daf4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::rf_std_problem_grader </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rf_std_problem_grader' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rf_std_problem_grader-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rf_std_problem_grader-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rf_std_problem_grader-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rf_std_problem_grader: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ac6c535a0561d7f536ed0e0f5d8a4daf4">rf_std_problem_grader</a> {
    my $self = shift;
    <span class="keywordflow">return</span> \&amp;<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a0257e7e8d573f75e4898c33732afb6">std_problem_grader</a>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a03bcf6d790a57567796f951f4e93c134"></a><!-- doxytag: member="WeBWorK::PG::Translator::rh_correct_answers" ref="a03bcf6d790a57567796f951f4e93c134" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::rh_correct_answers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rh_correct_answers' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rh_correct_answers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rh_correct_answers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rh_correct_answers-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rh_correct_answers: 12</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a03bcf6d790a57567796f951f4e93c134">rh_correct_answers</a> {
    my $self = shift;
    my @in = @_;
    <span class="keywordflow">return</span> $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a03bcf6d790a57567796f951f4e93c134">rh_correct_answers</a>} <span class="keywordflow">if</span> @in == 0;

    <span class="keywordflow">if</span> ( ref($in[0]) eq <span class="stringliteral">&#39;HASH&#39;</span> ) {
        $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a03bcf6d790a57567796f951f4e93c134">rh_correct_answers</a>} = { %{ $in[0] } }; # store a copy of the hash
    } <span class="keywordflow">else</span> {
        $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a03bcf6d790a57567796f951f4e93c134">rh_correct_answers</a>} = { @in }; # store a copy of the hash
    }
    $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a03bcf6d790a57567796f951f4e93c134">rh_correct_answers</a>}
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a5b9a83c282ac755b961518314df3d061"></a><!-- doxytag: member="WeBWorK::PG::Translator::rh_evaluated_answers" ref="a5b9a83c282ac755b961518314df3d061" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::rh_evaluated_answers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rh_evaluated_answers' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rh_evaluated_answers-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rh_evaluated_answers-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rh_evaluated_answers-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rh_evaluated_answers: 12</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a5b9a83c282ac755b961518314df3d061">rh_evaluated_answers</a> {
    my $self = shift;
    my @in = @_;
    <span class="keywordflow">return</span> $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a5b9a83c282ac755b961518314df3d061">rh_evaluated_answers</a>} <span class="keywordflow">if</span> @in == 0;

    <span class="keywordflow">if</span> ( ref($in[0]) eq <span class="stringliteral">&#39;HASH&#39;</span> ) {
        $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a5b9a83c282ac755b961518314df3d061">rh_evaluated_answers</a>} = { %{ $in[0] } }; # store a copy of the hash
    } <span class="keywordflow">else</span> {
        $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a5b9a83c282ac755b961518314df3d061">rh_evaluated_answers</a>} = { @in }; # store a copy of the hash
    }
    $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a5b9a83c282ac755b961518314df3d061">rh_evaluated_answers</a>};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ac131457932554b54c3564d931804f651"></a><!-- doxytag: member="WeBWorK::PG::Translator::rh_flags" ref="ac131457932554b54c3564d931804f651" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::rh_flags </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rh_flags' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rh_flags-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rh_flags-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rh_flags-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rh_flags: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ac131457932554b54c3564d931804f651">rh_flags</a> {
    my $self = shift;
    $self-&gt;{PG_FLAGS_REF};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ab02e3b1824e199b2514bb39a42725f59"></a><!-- doxytag: member="WeBWorK::PG::Translator::rh_problem_result" ref="ab02e3b1824e199b2514bb39a42725f59" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::rh_problem_result </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rh_problem_result' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rh_problem_result-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rh_problem_result-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rh_problem_result-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rh_problem_result: 12</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ab02e3b1824e199b2514bb39a42725f59">rh_problem_result</a> {
    my $self = shift;
    my @in = @_;
    <span class="keywordflow">return</span> $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ab02e3b1824e199b2514bb39a42725f59">rh_problem_result</a>} <span class="keywordflow">if</span> @in == 0;

    <span class="keywordflow">if</span> ( ref($in[0]) eq <span class="stringliteral">&#39;HASH&#39;</span> ) {
        $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ab02e3b1824e199b2514bb39a42725f59">rh_problem_result</a>} = { %{ $in[0] } }; # store a copy of the hash
    } <span class="keywordflow">else</span> {
        $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ab02e3b1824e199b2514bb39a42725f59">rh_problem_result</a>} = { @in }; # store a copy of the hash
    }
    $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ab02e3b1824e199b2514bb39a42725f59">rh_problem_result</a>};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a0a93e6878bf2f3da590d65785496e67f"></a><!-- doxytag: member="WeBWorK::PG::Translator::rh_problem_state" ref="a0a93e6878bf2f3da590d65785496e67f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::rh_problem_state </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-rh_problem_state' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-rh_problem_state-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-rh_problem_state-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-rh_problem_state-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in rh_problem_state: 12</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a> {
    my $self = shift;
    my @in = @_;
    <span class="keywordflow">return</span> $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a>} <span class="keywordflow">if</span> @in == 0;

    <span class="keywordflow">if</span> ( ref($in[0]) eq <span class="stringliteral">&#39;HASH&#39;</span> ) {
        $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a>} = { %{ $in[0] } }; # store a copy of the hash
    } <span class="keywordflow">else</span> {
        $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a>} = { @in }; # store a copy of the hash
    }
    $self-&gt;{<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a93e6878bf2f3da590d65785496e67f">rh_problem_state</a>};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a318c50c2128714efd1f71634b5ccce14"></a><!-- doxytag: member="WeBWorK::PG::Translator::safetyFilter" ref="a318c50c2128714efd1f71634b5ccce14" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::safetyFilter </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-safetyFilter' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-safetyFilter-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-safetyFilter-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-safetyFilter-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in safetyFilter: 26</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a318c50c2128714efd1f71634b5ccce14">safetyFilter</a> {
        my $answer = shift;  # accepts one answer and checks it
        my $submittedAnswer = $answer;
        $answer = <span class="stringliteral">&#39;&#39;</span> unless defined $answer;
        my ($errorno);
        $answer =~ tr/\000-\037/ /;
<span class="preprocessor">   #### Return if answer field is empty ########</span>
<span class="preprocessor"></span>        unless ($answer =~ /\S/) {
<span class="preprocessor">#           $errorno = &quot;&lt;BR&gt;No answer was submitted.&quot;;</span>
<span class="preprocessor"></span>            $errorno = 0;  ## don<span class="stringliteral">&#39;t report blank answer as error</span>
<span class="stringliteral"></span>
<span class="stringliteral">            return ($answer,$errorno);</span>
<span class="stringliteral">            }</span>
<span class="stringliteral">   ######### replace ^ with **    (for exponentiation)</span>
<span class="stringliteral">   #    $answer =~ s/\^/**/g;</span>
<span class="stringliteral">   ######### Return if  forbidden characters are found</span>
<span class="stringliteral">        unless ($answer =~ /^[a-zA-Z0-9_\-\+ \t\/@%\*\.\n^\(\)]+$/ )  {</span>
<span class="stringliteral">            $answer =~ tr/a-zA-Z0-9_\-\+ \t\/@%\*\.\n^\(\)/#/c;</span>
<span class="stringliteral">            $errorno = &quot;&lt;BR&gt;There are forbidden characters in your answer: $submittedAnswer&lt;BR&gt;&quot;;</span>
<span class="stringliteral"></span>
<span class="stringliteral">            return ($answer,$errorno);</span>
<span class="stringliteral">            }</span>
<span class="stringliteral"></span>
<span class="stringliteral">        $errorno = 0;</span>
<span class="stringliteral">        return($answer, $errorno);</span>
<span class="stringliteral">}</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a697a5fb7e1b1f9061914f47ae53f97a6"></a><!-- doxytag: member="WeBWorK::PG::Translator::set_mask" ref="a697a5fb7e1b1f9061914f47ae53f97a6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::set_mask </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-set_mask' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-set_mask-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-set_mask-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-set_mask-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in set_mask: 13</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a697a5fb7e1b1f9061914f47ae53f97a6">set_mask</a> {
    my $self = shift;
    my $safe_cmpt = $self -&gt;{safe};
    $safe_cmpt-&gt;mask(Opcode::full_opset());  # allow no operations
    $safe_cmpt-&gt;permit(qw(   :<span class="keywordflow">default</span> ));
    $safe_cmpt-&gt;permit(qw(time));  # used to determine whether solutions are visible.
    $safe_cmpt-&gt;permit(qw( atan2 sin cos exp log sqrt ));

<span class="preprocessor">    # just to make sure we&#39;ll deny some things specifically</span>
<span class="preprocessor"></span>    $safe_cmpt-&gt;deny(qw(entereval));
    $safe_cmpt-&gt;deny(qw (  unlink symlink system exec ));
    $safe_cmpt-&gt;deny(qw(print require));
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a6b2ab281e2d3410477ca40f28e807c36"></a><!-- doxytag: member="WeBWorK::PG::Translator::share_from" ref="a6b2ab281e2d3410477ca40f28e807c36" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::share_from </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-share_from' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-share_from-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-share_from-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-share_from-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in share_from: 7</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a6b2ab281e2d3410477ca40f28e807c36">share_from</a> {
    my $self = shift;
    my $pckg_name = shift;
    my $array_ref =shift;
    my $safe_compartment = $self-&gt;{safe};
    $safe_compartment-&gt;share_from($pckg_name,$array_ref);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a4649df619515a99bde061622135b9f9a"></a><!-- doxytag: member="WeBWorK::PG::Translator::source_file" ref="a4649df619515a99bde061622135b9f9a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::source_file </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-source_file' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-source_file-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-source_file-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-source_file-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in source_file: 19</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a4649df619515a99bde061622135b9f9a">source_file</a> {
    my $self = shift;
    my $filePath = shift;
    local(*SOURCEFILE);
    local($/);
    $/ = undef;   # allows us to treat the file as a single line
    my $err = <span class="stringliteral">&quot;&quot;</span>;
    <span class="keywordflow">if</span> ( open(SOURCEFILE, <span class="stringliteral">&quot;&lt;$filePath&quot;</span>) ) {
        $self -&gt; {source} = &lt;SOURCEFILE&gt;;
        close(SOURCEFILE);
    } <span class="keywordflow">else</span> {
        $self-&gt;{errors} .= <span class="stringliteral">&quot;Can&#39;t open file: $filePath&quot;</span>;
        croak( <span class="stringliteral">&quot;Can&#39;t open file: $filePath\n&quot;</span> );
    }



    $err;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae5cc0539a056777639e5d782f4621da6"></a><!-- doxytag: member="WeBWorK::PG::Translator::source_string" ref="ae5cc0539a056777639e5d782f4621da6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::source_string </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-source_string' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-source_string-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-source_string-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-source_string-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in source_string: 13</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ae5cc0539a056777639e5d782f4621da6">source_string</a> {
    my $self = shift;
    my $temp = shift;
    my $out;
    <span class="keywordflow">if</span> ( ref($temp) eq <span class="stringliteral">&#39;SCALAR&#39;</span>) {
        $self-&gt;{source} = $$temp;
        $out = $self-&gt;{source};
    } elsif ($temp) {
        $self-&gt;{source} = $temp;
        $out = $self-&gt;{source};
    }
    $self -&gt; {source};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a0a0257e7e8d573f75e4898c33732afb6"></a><!-- doxytag: member="WeBWorK::PG::Translator::std_problem_grader" ref="a0a0257e7e8d573f75e4898c33732afb6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::std_problem_grader </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-std_problem_grader' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-std_problem_grader-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-std_problem_grader-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-std_problem_grader-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in std_problem_grader: 72</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a0a0257e7e8d573f75e4898c33732afb6">std_problem_grader</a>{
    my $rh_evaluated_answers = shift;
    my $rh_problem_state = shift;
    my %form_options = @_;
    my %evaluated_answers = %{$rh_evaluated_answers};
<span class="preprocessor">    #  The hash $rh_evaluated_answers typically contains:</span>
<span class="preprocessor"></span><span class="preprocessor">    #      &#39;answer1&#39; =&gt; 34, &#39;answer2&#39;=&gt; &#39;Mozart&#39;, etc.</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # By default the  old problem state is simply passed back out again.</span>
<span class="preprocessor"></span>    my %problem_state = %$rh_problem_state;


<span class="preprocessor">    # %form_options might include</span>
<span class="preprocessor"></span><span class="preprocessor">    # The user login name</span>
<span class="preprocessor"></span><span class="preprocessor">    # The permission level of the user</span>
<span class="preprocessor"></span><span class="preprocessor">    # The studentLogin name for this psvn.</span>
<span class="preprocessor"></span><span class="preprocessor">    # Whether the form is asking for a refresh or is submitting a new answer.</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # initial setup of the answer</span>
<span class="preprocessor"></span>    my %problem_result = ( score                =&gt; 0,
                           errors               =&gt; <span class="stringliteral">&#39;&#39;</span>,
                           type                 =&gt; <span class="stringliteral">&#39;std_problem_grader&#39;</span>,
                           msg                  =&gt; <span class="stringliteral">&#39;&#39;</span>,
                         );
<span class="preprocessor">    # Checks</span>
<span class="preprocessor"></span>
    my $ansCount = keys %evaluated_answers;  # <span class="keyword">get</span> the number of answers
    unless ($ansCount &gt; 0 ) {
        $problem_result{msg} = <span class="stringliteral">&quot;This problem did not ask any questions.&quot;</span>;
        <span class="keywordflow">return</span>(\%problem_result,\%problem_state);
    }

    <span class="keywordflow">if</span> ($ansCount &gt; 1 ) {
        $problem_result{msg} = <span class="stringliteral">&#39;In order to get credit for this problem all answers must be correct.&#39;</span> ;
    }

    unless (defined( $form_options{answers_submitted}) and $form_options{answers_submitted} == 1) {
        <span class="keywordflow">return</span>(\%problem_result,\%problem_state);
    }

    my  $allAnswersCorrectQ=1;
    <span class="keywordflow">foreach</span> my $ans_name (keys %evaluated_answers) {
<span class="preprocessor">    # I&#39;m not sure if this check is really useful.</span>
<span class="preprocessor"></span>        <span class="keywordflow">if</span> ( ( ref($evaluated_answers{$ans_name} ) eq <span class="stringliteral">&#39;HASH&#39;</span> ) or ( ref($evaluated_answers{$ans_name}) eq <span class="stringliteral">&#39;AnswerHash&#39;</span> ) ) {
            $allAnswersCorrectQ = 0 unless( 1 == $evaluated_answers{$ans_name}-&gt;{score} );
        } <span class="keywordflow">else</span> {
            warn <span class="stringliteral">&quot;Error: Answer $ans_name is not a hash&quot;</span>;
            warn <span class="stringliteral">&quot;$evaluated_answers{$ans_name}&quot;</span>;
            warn <span class="stringliteral">&quot;This probably means that the answer evaluator is for this answer is not working correctly.&quot;</span>;
            $problem_result{error} = <span class="stringliteral">&quot;Error: Answer $ans_name is not a hash: $evaluated_answers{$ans_name}&quot;</span>;
        }
    }
<span class="preprocessor">    # report the results</span>
<span class="preprocessor"></span>    $problem_result{score} = $allAnswersCorrectQ;

<span class="preprocessor">    # I don&#39;t like to put in this bit of code.</span>
<span class="preprocessor"></span><span class="preprocessor">    # It makes it hard to construct error free problem graders</span>
<span class="preprocessor"></span><span class="preprocessor">    # I would prefer to know that the problem score was numeric.</span>
<span class="preprocessor"></span>    unless ($problem_state{recorded_score} =~ /^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/ ) {
        $problem_state{recorded_score} = 0;  # This gets rid of non-numeric scores
    }
<span class="preprocessor">    #</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ($allAnswersCorrectQ == 1 or $problem_state{recorded_score} == 1) {
        $problem_state{recorded_score} = 1;
    } <span class="keywordflow">else</span> {
        $problem_state{recorded_score} = 0;
    }

    $problem_state{num_of_correct_ans}++ <span class="keywordflow">if</span> $allAnswersCorrectQ == 1;
    $problem_state{num_of_incorrect_ans}++ <span class="keywordflow">if</span> $allAnswersCorrectQ == 0;
    (\%problem_result, \%problem_state);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="af3a1478e1de125c7f446dfb7a6e4ed06"></a><!-- doxytag: member="WeBWorK::PG::Translator::time_it" ref="af3a1478e1de125c7f446dfb7a6e4ed06" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::time_it </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-time_it' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-time_it-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-time_it-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-time_it-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in time_it: 4</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#af3a1478e1de125c7f446dfb7a6e4ed06">time_it</a> {
    my $msg = shift;    
    $WeBWorK::timer-&gt;continue(<span class="stringliteral">&quot;PG macro:&quot;</span>. $msg) <span class="keywordflow">if</span> defined($WeBWorK::timer);
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a147d6d396009a3cf9935d2c88692348e"></a><!-- doxytag: member="WeBWorK::PG::Translator::translate" ref="a147d6d396009a3cf9935d2c88692348e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::translate </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-translate' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-translate-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-translate-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-translate-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in translate: 247</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a147d6d396009a3cf9935d2c88692348e">translate</a> {
    my $self = shift;
    my @PROBLEM_TEXT_OUTPUT = ();
    my $safe_cmpt = $self -&gt;{safe};
    my $evalString = $self -&gt; {source};
    $self -&gt;{errors} .= qq{ERROR:  This problem file was empty!\n} unless ($evalString) ;
    $self -&gt;{errors} .= qq{ERROR:  You must define the <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a6024fb17151788751b97b6fc8693ed06">environment</a> before translating.}
         unless defined( $self-&gt;{envir} );
    
<span class="preprocessor">    # install handlers for warn and die that call PG_errorMessage.</span>
<span class="preprocessor"></span><span class="preprocessor">    # if the existing signal handler is not a coderef, the built-in warn or</span>
<span class="preprocessor"></span><span class="preprocessor">    # die function is called. this does not account for the case where the</span>
<span class="preprocessor"></span><span class="preprocessor">    # handler is set to &quot;IGNORE&quot; or to the name of a function. in these cases</span>
<span class="preprocessor"></span><span class="preprocessor">    # the built-in function will be called.</span>
<span class="preprocessor"></span>    
    my $outer_sig_warn = $SIG{__WARN__};
    local $SIG{__WARN__} = sub {
        ref $outer_sig_warn eq <span class="stringliteral">&quot;CODE&quot;</span>
            ? &amp;$outer_sig_warn(<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad0429c6f4f82059b2c2bef229dea4143">PG_errorMessage</a>(<span class="stringliteral">&#39;message&#39;</span>, $_[0]))
            : warn <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad0429c6f4f82059b2c2bef229dea4143">PG_errorMessage</a>(<span class="stringliteral">&#39;message&#39;</span>, $_[0]);
    };
    
    my $outer_sig_die = $SIG{__DIE__};
    local $SIG{__DIE__} = sub {
        ref $outer_sig_die eq <span class="stringliteral">&quot;CODE&quot;</span>
            ? &amp;$outer_sig_die(<a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad0429c6f4f82059b2c2bef229dea4143">PG_errorMessage</a>(<span class="stringliteral">&#39;traceback&#39;</span>, $_[0]))
            : die <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#ad0429c6f4f82059b2c2bef229dea4143">PG_errorMessage</a>(<span class="stringliteral">&#39;traceback&#39;</span>, $_[0]);
    };

=pod

(3) B&lt;Preprocess the problem text&gt;

The input text is subjected to two global replacements.
First every incidence of

    BEGIN_TEXT
    problem text
    END_TEXT

is replaced by

    TEXT( EV3( &lt;&lt;&#39;END_TEXT&#39; ) );
    problem text
    END_TEXT

The first construction is syntactic sugar for the second. This is explained
in C&lt;PGbasicmacros.pl&gt;.

Second every incidence
of \ (backslash) is replaced by \\ (<span class="keywordtype">double</span> backslash).  Third each incidence of
~~ is replaced by a single backslash.

This is done to alleviate a basic
incompatibility between TeX and Perl. TeX uses backslashes constantly to denote
a command word (as opposed to text which is to be entered literally).  Perl
uses backslash to escape the following symbol.  This escape
mechanism takes place immediately when a Perl script is compiled and takes
place throughout the code and within every quoted <span class="keywordtype">string</span> (both <span class="keywordtype">double</span> and single
quoted strings) with the single exception of single quoted &quot;here&quot; documents.
That is backlashes which appear in

    TEXT(&lt;&lt;&#39;EOF&#39;);
    ... text including \{   \} <span class="keywordflow">for</span> example
    EOF

are the only ones not immediately evaluated.  This behavior makes it very difficult
to use TeX notation <span class="keywordflow">for</span> defining mathematics within text.

The initial global
replacement, before compiling a <a class="code" href="classWeBWorK_1_1PG.html">PG</a> problem, allows one to use backslashes within
text without doubling them. (The anomolous behavior inside single quoted <span class="stringliteral">&quot;here&quot;</span>
documents is compensated <span class="keywordflow">for</span> by the behavior of the evaluation macro EV3.) This
makes typing TeX easy, but introduces one difficulty in entering normal Perl code.

The second global replacement provides a work around <span class="keywordflow">for</span> <span class="keyword">this</span> -- use ~~ when you
would ordinarily use a backslash in Perl code.
In order to define a carriage <span class="keywordflow">return</span> use ~~n rather than \n; in order to define
a reference to a variable you must use ~~@array rather than \@array. This is
annoying and a source of simple compiler errors, but must be lived with.

The problems are not evaluated in strict mode, so global variables can be used
without warnings.



=cut

<span class="preprocessor">############################################################################</span>
<span class="preprocessor"></span>

<span class="preprocessor">            ##########################################</span>
<span class="preprocessor"></span><span class="preprocessor">            ###### PG preprocessing code #############</span>
<span class="preprocessor"></span><span class="preprocessor">            ##########################################</span>
<span class="preprocessor"></span>            
                $evalString = &amp;{$self-&gt;{preprocess_code}}($evalString);

             
<span class="preprocessor">#               # default_preprocess_code</span>
<span class="preprocessor"></span><span class="preprocessor">#               # BEGIN_TEXT and END_TEXT must occur on a line by themselves.</span>
<span class="preprocessor"></span><span class="preprocessor">#               $evalString =~ s/\n\s*END_TEXT[\s;]*\n/\nEND_TEXT\n/g;</span>
<span class="preprocessor"></span><span class="preprocessor">#               $evalString =~ s/\n\s*BEGIN_TEXT[\s;]*\n/\nTEXT\(EV3\(&lt;&lt;&#39;END_TEXT&#39;\)\);\n/g;</span>
<span class="preprocessor"></span><span class="preprocessor">#               $evalString =~ s/ENDDOCUMENT.*/ENDDOCUMENT();/s; # remove text after ENDDOCUMENT</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#               $evalString =~ s/\\/\\\\/g;    # \ can&#39;t be used for escapes because of TeX conflict</span>
<span class="preprocessor"></span><span class="preprocessor">#               $evalString =~ s/~~/\\/g;      # use ~~ as escape instead, use # for comments</span>
<span class="preprocessor"></span>

=pod

(4) B&lt;Evaluate the problem text&gt;

Evaluate the text within the safe compartment.  Save the errors. The safe
compartment is a <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a3c36ecbc8b680d8703dff270020e7be8">new</a> one unless the $safeCompartment was set to zero in which
case the previously defined safe compartment is used. (See item 1.)

=cut

                my ($PG_PROBLEM_TEXT_REF, $PG_HEADER_TEXT_REF, $PG_POST_HEADER_TEXT_REF,$PG_ANSWER_HASH_REF, $PG_FLAGS_REF, $PGcore)
                      =$safe_cmpt-&gt;reval(&quot;   $evalString&quot;);
                      

<span class="preprocessor"># This section could use some more error messages.  In particular if a problem doesn&#39;t produce the right output, the user needs</span>
<span class="preprocessor"></span><span class="preprocessor"># information about which problem was at fault.</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span>
<span class="preprocessor">#################</span>
<span class="preprocessor"></span><span class="preprocessor"># FIXME The various warning message tracks are still being sorted out</span>
<span class="preprocessor"></span><span class="preprocessor"># WARNING and DEBUG tracks are being handled elsewhere (in Problem.pm?)</span>
<span class="preprocessor"></span><span class="preprocessor">#################</span>
<span class="preprocessor"></span>                $self-&gt;{errors} .= $@;

                
<span class="preprocessor">#               $self-&gt;{errors}.=join(CGI::br(), @{$PGcore-&gt;{WARNING_messages}} );</span>
<span class="preprocessor"></span><span class="preprocessor">#               $self-&gt;{errors}.=join(CGI::br(), @{$PGcore-&gt;{DEBUG_messages  }} );</span>
<span class="preprocessor"></span><span class="preprocessor">#######################################################################</span>
<span class="preprocessor"></span>
<span class="preprocessor">#               push(@PROBLEM_TEXT_OUTPUT   ,   split(/(\n)/,$$PG_PROBLEM_TEXT_REF)  ) if  defined($$PG_PROBLEM_TEXT_REF  );</span>
<span class="preprocessor"></span>                push(@PROBLEM_TEXT_OUTPUT   ,   split(/^/,$$PG_PROBLEM_TEXT_REF)  ) if  ref($PG_PROBLEM_TEXT_REF  ) eq &#39;SCALAR&#39;;
                                                                                 <span class="preprocessor">## This is better than using defined($$PG_PROBLEM_TEXT_REF)</span>
<span class="preprocessor"></span><span class="preprocessor">                                                                                 ## Because more pleasant feedback is given</span>
<span class="preprocessor"></span><span class="preprocessor">                                                                                 ## when the problem doesn&#39;t render.</span>
<span class="preprocessor"></span><span class="preprocessor">                 # try to get the \n to appear at the end of the line</span>
<span class="preprocessor"></span>
        use strict;
<span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        ##########  end  EVALUATION code                                  ###########</span>
<span class="preprocessor"></span><span class="preprocessor">        #############################################################################</span>
<span class="preprocessor"></span>
<span class="preprocessor">            ##########################################</span>
<span class="preprocessor"></span><span class="preprocessor">            ###### PG postprocessing code #############</span>
<span class="preprocessor"></span><span class="preprocessor">            ##########################################</span>
<span class="preprocessor"></span>            $PG_PROBLEM_TEXT_REF = &amp;{$self-&gt;{postprocess_code}}($PG_PROBLEM_TEXT_REF);


=pod

(5) B&lt;Process errors&gt;

The error provided by Perl
is truncated slightly and returned. In the text
<span class="keywordtype">string</span> which would normally contain the rendered problem.

The original text <span class="keywordtype">string</span> is given line numbers and concatenated to
the errors.

=cut



        <span class="preprocessor">##########################################</span>
<span class="preprocessor"></span><span class="preprocessor">        ###### PG error processing code ##########</span>
<span class="preprocessor"></span><span class="preprocessor">        ##########################################</span>
<span class="preprocessor"></span>        my (@input,$lineNumber,$line);
        <span class="keywordflow">if</span> ($self -&gt; {errors}) {
<span class="preprocessor">                #($self -&gt; {errors}) =~ s/&lt;/&amp;lt/g;</span>
<span class="preprocessor"></span><span class="preprocessor">                #($self -&gt; {errors}) =~ s/&gt;/&amp;gt/g;</span>
<span class="preprocessor"></span><span class="preprocessor">           #try to clean up errors so they will look ok</span>
<span class="preprocessor"></span>                $self -&gt;{errors} =~ s/\[[^\]]+?\] [^ ]+?\.pl:<span class="comment">//gm;   #erase [Fri Dec 31 12:58:30 1999] processProblem7.pl:</span>
<span class="preprocessor">                #$self -&gt; {errors} =~ s/eval\s+&#39;(.|[\n|r])*$//;</span>
<span class="preprocessor"></span><span class="preprocessor">            #end trying to clean up errors so they will look ok</span>
<span class="preprocessor"></span>

                push(@PROBLEM_TEXT_OUTPUT   ,  qq!\n&lt;A NAME=<span class="stringliteral">&quot;problem! .</span>
<span class="stringliteral">                    $self-&gt;{envir} -&gt;{&#39;probNum&#39;} .</span>
<span class="stringliteral">                    qq!&quot;</span>&gt;&lt;PRE&gt;        Problem!.
                    $self-&gt;{envir} -&gt;{<span class="stringliteral">&#39;probNum&#39;</span>}.
                    qq!\nERROR caught by Translator <span class="keywordflow">while</span> processing problem file:! .
                    $self-&gt;{envir}-&gt;{<span class="stringliteral">&#39;probFileName&#39;</span>}.
                    <span class="stringliteral">&quot;\n****************\r\n&quot;</span> .
                    $self -&gt; {errors}.<span class="stringliteral">&quot;\r\n&quot;</span> .
                    <span class="stringliteral">&quot;****************&lt;BR&gt;\n&quot;</span>);

               push(@PROBLEM_TEXT_OUTPUT   , <span class="stringliteral">&quot;------Input Read\r\n&quot;</span>);
               $self-&gt;{source} =~ s/&lt;/&amp;lt;/g;
               @input=split(<span class="stringliteral">&quot;\n&quot;</span>, $self-&gt;{source});
               $lineNumber = 1;
                <span class="keywordflow">foreach</span> $line (@input) {
                    chomp($line);
                    push(@PROBLEM_TEXT_OUTPUT, <span class="stringliteral">&quot;$lineNumber\t\t$line\r\n&quot;</span>);
                    $lineNumber ++;
                }
                push(@PROBLEM_TEXT_OUTPUT  ,<span class="stringliteral">&quot;\n-----&lt;BR&gt;&lt;/PRE&gt;\r\n&quot;</span>);



        }

=pod

(6) B&lt;Prepare return values&gt;

    Returns:
            $PG_PROBLEM_TEXT_ARRAY_REF -- Reference to a <span class="keywordtype">string</span> containing the rendered text.
            $PG_HEADER_TEXT_REF -- Reference to a <span class="keywordtype">string</span> containing material to placed in the <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a4a71e2b8b0a0ad86a36d7a89cec5898e">header</a> (for use by JavaScript)
            $PG_POST_HEADER_TEXT_REF -- Reference to a <span class="keywordtype">string</span> containing material to placed in body above form (for use by Sage)
            $PG_ANSWER_HASH_REF -- Reference to an array containing the answer evaluators.
            $PG_FLAGS_REF -- Reference to a hash containing flags and other references:
                &#39;error_flag&#39; is set to 1 if there were errors in rendering
            $PGcore -- the <a class="code" href="classPGcore.html">PGcore</a> <span class="keywordtype">object</span>

=cut

        <span class="preprocessor">## we need to make sure that the other output variables are defined</span>
<span class="preprocessor"></span>
<span class="preprocessor">                ## If the eval failed with errors, one or more of these variables won&#39;t be defined.</span>
<span class="preprocessor"></span>                $PG_ANSWER_HASH_REF = {}      unless defined($PG_ANSWER_HASH_REF);
                $PG_HEADER_TEXT_REF = \( <span class="stringliteral">&quot;&quot;</span> ) unless defined($PG_HEADER_TEXT_REF);
                $PG_POST_HEADER_TEXT_REF = \( <span class="stringliteral">&quot;&quot;</span> ) unless defined($PG_POST_HEADER_TEXT_REF);
                $PG_FLAGS_REF = {}            unless defined($PG_FLAGS_REF);

                $PG_FLAGS_REF-&gt;{<span class="stringliteral">&#39;error_flag&#39;</span>} = 1     <span class="keywordflow">if</span> $self -&gt; {errors};
        my $PG_PROBLEM_TEXT                     = join(<span class="stringliteral">&quot;&quot;</span>,@PROBLEM_TEXT_OUTPUT);


        $self -&gt;{ PG_PROBLEM_TEXT_REF   }       = \$PG_PROBLEM_TEXT;
        $self -&gt;{ PG_PROBLEM_TEXT_ARRAY_REF }   = \@PROBLEM_TEXT_OUTPUT;
        $self -&gt;{ PG_HEADER_TEXT_REF    }       = $PG_HEADER_TEXT_REF;
        $self -&gt;{ PG_POST_HEADER_TEXT_REF   }   = $PG_POST_HEADER_TEXT_REF;
        $self -&gt;{ <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a03bcf6d790a57567796f951f4e93c134">rh_correct_answers</a>    }       = $PG_ANSWER_HASH_REF;
        $self -&gt;{ PG_FLAGS_REF          }       = $PG_FLAGS_REF;
        $self -&gt;{ rh_pgcore             }       = $PGcore;
        
<span class="preprocessor">        #warn &quot;PGcore is &quot;, ref($PGcore), &quot; in Translator&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">        #$self -&gt;{errors};</span>
<span class="preprocessor">}  # end translate</span>
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a672685544bd714e99adcd6b79baf8187"></a><!-- doxytag: member="WeBWorK::PG::Translator::unrestricted_load" ref="a672685544bd714e99adcd6b79baf8187" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method WeBWorK::PG::Translator::unrestricted_load </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-unrestricted_load' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-unrestricted_load-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-unrestricted_load-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-unrestricted_load-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in unrestricted_load: 52</span>
<span class="preprocessor"></span>sub <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a672685544bd714e99adcd6b79baf8187">unrestricted_load</a> {
    my $self = shift;
    my $filePath = shift;
    my $safe_cmpt = $self -&gt;{safe};
    my $store_mask = $safe_cmpt-&gt;mask();
    $safe_cmpt-&gt;mask(Opcode::empty_opset());
    my $safe_cmpt_package_name = $safe_cmpt-&gt;root();
    
    my $macro_file_name = fileFromPath($filePath);
    $macro_file_name =~s/\.pl<span class="comment">//;  # trim off the extenstion</span>
    my $export_subroutine_name = <span class="stringliteral">&quot;_${macro_file_name}_export&quot;</span>;
    my $init_subroutine_name = <span class="stringliteral">&quot;${safe_cmpt_package_name}::_${macro_file_name}_init&quot;</span>;

    my $local_errors = <span class="stringliteral">&quot;&quot;</span>;
    no strict;
<span class="preprocessor">    #  warn &quot;dangerousMacros main:: contains &lt;br&gt;\n  &quot;.join(&quot;&lt;br&gt;\n &quot;, %main::) if $debugON;</span>
<span class="preprocessor"></span>    my $init_subroutine  = eval { \&amp;{$init_subroutine_name} };
    warn <span class="stringliteral">&quot;No init routine for $init_subroutine_name: $@&quot;</span> <span class="keywordflow">if</span>  $debugON and $@;
    use strict;
    my $macro_file_loaded = ref($init_subroutine) =~ /CODE/;

<span class="preprocessor">    #print STDERR &quot;$macro_file_name   has not yet been loaded\n&quot; unless $macro_file_loaded; </span>
<span class="preprocessor"></span>    unless ($macro_file_loaded) {
<span class="preprocessor">        ## load the $filePath file</span>
<span class="preprocessor"></span><span class="preprocessor">        ## Using rdo insures that the $filePath file is loaded for every problem, allowing initializations to occur.</span>
<span class="preprocessor"></span><span class="preprocessor">        ## Ordinary mortals should not be fooling with the fundamental macros in these files.  </span>
<span class="preprocessor"></span>        my $local_errors = <span class="stringliteral">&quot;&quot;</span>;
        <span class="keywordflow">if</span> (-r $filePath ) {
            my $rdoResult = $safe_cmpt-&gt;rdo($filePath);
<span class="preprocessor">            #warn &quot;unrestricted load:  $filePath\n&quot;;</span>
<span class="preprocessor"></span>            $local_errors =<span class="stringliteral">&quot;\nThere were problems compiling the file:\n $filePath\n $@\n&quot;</span> <span class="keywordflow">if</span> $@;
            $self -&gt;{errors} .= $local_errors <span class="keywordflow">if</span> $local_errors;
            use strict;
        } <span class="keywordflow">else</span> {
            $local_errors = <span class="stringliteral">&quot;Can&#39;t open file $filePath for reading\n&quot;</span>;
            $self -&gt;{errors} .= $local_errors <span class="keywordflow">if</span> $local_errors;
        }
        $safe_cmpt -&gt; <a class="code" href="classWeBWorK_1_1PG_1_1Translator.html#a1a3c997585e195be6a01d92cf549a324">mask</a>($store_mask);
        
    }
<span class="preprocessor">    # try again to define the initization subroutine</span>
<span class="preprocessor"></span>    $init_subroutine  = eval { \&amp;{<span class="stringliteral">&quot;$init_subroutine_name&quot;</span>} };
    $macro_file_loaded  = ref($init_subroutine) =~ /CODE/;
    <span class="keywordflow">if</span> ( $macro_file_loaded ) {

<span class="preprocessor">            #warn &quot;unrestricted load:  initializing $macro_file_name  $init_subroutine&quot; ;</span>
<span class="preprocessor"></span>            &amp;$init_subroutine();
    }
    $local_errors .= <span class="stringliteral">&quot;\nUnknown error.  Unable to load $filePath\n&quot;</span> <span class="keywordflow">if</span> ($local_errors eq <span class="stringliteral">&#39;&#39;</span> and not $macro_file_loaded);
<span class="preprocessor">    #print STDERR &quot;$filePath is properly loaded\n\n&quot; if $macro_file_loaded;</span>
<span class="preprocessor"></span>    $local_errors;
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="Translator_8pm_source.html">Translator.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:55:06 2012 for PG by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
