<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PG: contextFraction.pl Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>contextFraction.pl</h1><a href="contextFraction_8pl.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 =head1 NAME
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 contextFraction.pl - Implements a MathObject <span class="keyword">class </span>for Fractions.
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 =head1 DESCRIPTION
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 This <a class="code" href="classcontext.html">context</a> implements a <a class="code" href="classFraction.html">Fraction</a> <span class="keywordtype">object</span> that works like a Real, but
<a name="l00008"></a>00008 keeps the numerator and denominator separate.  It provides methods <span class="keywordflow">for</span>
<a name="l00009"></a>00009 reducing the fractions, and <span class="keywordflow">for</span> allowing fractions with a whole-number
<a name="l00010"></a>00010 preceeding it, as in 4 1/2 <span class="keywordflow">for</span> <span class="stringliteral">&quot;four and one half&quot;</span>.  The answer
<a name="l00011"></a>00011 checker can require that students reduce their results, and there are
<a name="l00012"></a>00012 contexts that don<span class="stringliteral">&#39;t allow entery of decimal values (only fractions),</span>
<a name="l00013"></a>00013 <span class="stringliteral">and that don&#39;</span>t allow any operators or functions (other than division
<a name="l00014"></a>00014 and negation).
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 To use these contexts, first load the contextFraction.pl file:
<a name="l00017"></a>00017 
<a name="l00018"></a>00018     loadMacros(<span class="stringliteral">&quot;contextFraction.pl&quot;</span>);
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 and then select the appropriate <a class="code" href="classcontext.html">context</a> -- one of the following:
<a name="l00021"></a>00021 
<a name="l00022"></a>00022     Context(<span class="stringliteral">&quot;Fraction&quot;</span>);
<a name="l00023"></a>00023     Context(<span class="stringliteral">&quot;Fraction-NoDecimals&quot;</span>);
<a name="l00024"></a>00024     Context(<span class="stringliteral">&quot;LimitedFraction&quot;</span>);
<a name="l00025"></a>00025         Context(<span class="stringliteral">&quot;LimitedProperFraction&quot;</span>);
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 The first is the most general, and allows fractions to be intermixed
<a name="l00028"></a>00028 with real numbers, so 1/2 + .5 would be allowed.  Also, 1/2.5 is
<a name="l00029"></a>00029 allowed, though it produces a real number, not a fraction, since <span class="keyword">this</span>
<a name="l00030"></a>00030 fraction <span class="keyword">class </span>only <span class="keyword">implements</span> fractions of integers.  All operators
<a name="l00031"></a>00031 and <a class="code" href="PGstringevaluators_8pl.html#a432234fc3d5710ff4fdc5eacd9a0eae2">functions</a> are defined, so there are no restrictions on what is
<a name="l00032"></a>00032 allowed by the student.
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 The second does not allow decimal numbers to be entered, but they can
<a name="l00035"></a>00035 still be produced as the result of function calls, or by named
<a name="l00036"></a>00036 constants such as &quot;pi&quot;.  For example, 1/sqrt(2) is allowed (and
<a name="l00037"></a>00037 produces a real number result).  All <a class="code" href="PGstringevaluators_8pl.html#a432234fc3d5710ff4fdc5eacd9a0eae2">functions</a> and operations are
<a name="l00038"></a>00038 defined, and the only real difference between this and the previous
<a name="l00039"></a>00039 <a class="code" href="classcontext.html">context</a> is that decimal numbers can&#39;t be typed in explicitly.
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 The third <a class="code" href="classcontext.html">context</a> limits the operations that can be performed: in
<a name="l00042"></a>00042 addition to not being able to type decimal numbers, no operations
<a name="l00043"></a>00043 other than division and negation are allowed, and no function calls at
<a name="l00044"></a>00044 all.  Thus 1/sqrt(2) would be illegal, as would 1/2 + 2.  The student
<a name="l00045"></a>00045 must enter a whole number or a fraction in this <a class="code" href="classcontext.html">context</a>.  It is also
<a name="l00046"></a>00046 permissible to enter a whole number WITH a fraction, as in 2 1/2 for
<a name="l00047"></a>00047 &quot;two and one half&quot;, or 5/2.
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 The fourth is the same as LimiteFraction, but students must enter proper
<a name="l00050"></a>00050 fractions, and results are shown as proper fractions.
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 You can use the Compute() function to generate fraction objects, or
<a name="l00053"></a>00053 the <a class="code" href="classFraction.html">Fraction</a>() constructor to make one explicitly.  For example:
<a name="l00054"></a>00054 
<a name="l00055"></a>00055     Context(&quot;Fraction&quot;);
<a name="l00056"></a>00056     $a = Compute(&quot;1/2&quot;);
<a name="l00057"></a>00057     $b = Compute(&quot;4 - 1/6&quot;);
<a name="l00058"></a>00058     $c = Compute(&quot;(4/9)^(1/2)&quot;);
<a name="l00059"></a>00059     
<a name="l00060"></a>00060     Context(&quot;LimitedFraction&quot;);
<a name="l00061"></a>00061     $d = Compute(&quot;4 2/3&quot;);
<a name="l00062"></a>00062     $e = Compute(&quot;-1 1/2&quot;);
<a name="l00063"></a>00063     
<a name="l00064"></a>00064     $f = <a class="code" href="classFraction.html">Fraction</a>(-2,5);
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 Note that $c will be 2/3, $d will be 14/3, $e will be -3/2, and $f
<a name="l00067"></a>00067 will be -2/5.
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 Once you have created a fraction object, you can use it as you would
<a name="l00070"></a>00070 any real number.  For example:
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     Context(&quot;Fraction&quot;);
<a name="l00073"></a>00073     $a = Compute(&quot;1/2&quot;);
<a name="l00074"></a>00074     $b = Compute(&quot;1/3&quot;);
<a name="l00075"></a>00075     $c = $a - $b;
<a name="l00076"></a>00076     $d = asin($a);
<a name="l00077"></a>00077     $e = $b**2;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 Here $c will be the equivalent of Compute(&quot;1/6&quot;), $d will be
<a name="l00080"></a>00080 equivalent to Compute(&quot;pi/6&quot;), and $e will be the same as Compute(&quot;1/9&quot;);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 You can an answer checker for a fraction in the same way as you do for
<a name="l00083"></a>00083 ALL MathObjects -- via its cmp() method:
<a name="l00084"></a>00084 
<a name="l00085"></a>00085     <a class="code" href="PGstringevaluators_8pl.html#a33aa1133c9196fed55af79d192977ed3">ANS</a>(Compute(&quot;1/2&quot;)-&gt;cmp);
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 or
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     $b = Compute(&quot;1/2&quot;);
<a name="l00090"></a>00090     <a class="code" href="PGstringevaluators_8pl.html#a33aa1133c9196fed55af79d192977ed3">ANS</a>($b-&gt;cmp);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 There are several options to the cmp() method that control how the
<a name="l00093"></a>00093 answer checker will work.  The first is controls whether unreduced
<a name="l00094"></a>00094 fractions are accepted as correct.  Unreduced fractions are allowed in
<a name="l00095"></a>00095 the <a class="code" href="classFraction.html">Fraction</a> and <a class="code" href="classFraction.html">Fraction</a>-NoDecimals contexts, but not in the
<a name="l00096"></a>00096 LimitedFraction <a class="code" href="classcontext.html">context</a>.  You can control this using the
<a name="l00097"></a>00097 studentsMustReduceFractions option:
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     Context(&quot;Fraction&quot;);
<a name="l00100"></a>00100     <a class="code" href="PGstringevaluators_8pl.html#a33aa1133c9196fed55af79d192977ed3">ANS</a>(Compute(&quot;1/2&quot;)-&gt;cmp(studentsMustReduceFractions=&gt;1));
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 or
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     Context(&quot;LimitedFraction&quot;);
<a name="l00105"></a>00105     <a class="code" href="PGstringevaluators_8pl.html#a33aa1133c9196fed55af79d192977ed3">ANS</a>(Compute(&quot;1/2&quot;)-&gt;cmp(studentsMustReduceFractions=&gt;0));
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 The second controls whether warnings are issued when students don&#39;t
<a name="l00108"></a>00108 reduce their answers, or to mark the answer incorrect silently.  This
<a name="l00109"></a>00109 is specified by the showFractionReductionWarnings option.  The default
<a name="l00110"></a>00110 is to report the warnings, but this option has an effect only when
<a name="l00111"></a>00111 studentsMustReduceFractions is 1, and so only in the LimitedFraction
<a name="l00112"></a>00112 <a class="code" href="classcontext.html">context</a>.  For example,
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     Context(&quot;LimitedFraction&quot;);
<a name="l00115"></a>00115     <a class="code" href="PGstringevaluators_8pl.html#a33aa1133c9196fed55af79d192977ed3">ANS</a>(Compute(&quot;1/2&quot;)-&gt;cmp(showFractionReductionWarnings=&gt;0));
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 turns off these warnings.
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 The final option, requireFraction, specifies whether a fraction MUST
<a name="l00120"></a>00120 be entered (e.g. one would have to enter 2/1 for a whole number).  The
<a name="l00121"></a>00121 default is 0.
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 In addition to these options for cmp(), there are Context flags that
<a name="l00124"></a>00124 control how fractions are handled.  These include the following.
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 =over
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 =item S&lt;C&lt;&lt; reduceFractions &gt;&gt;&gt;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 This determines whether fractions are reduced automatically when they
<a name="l00131"></a>00131 are created.  The default is to reduce fractions (except when
<a name="l00132"></a>00132 studentsMustReduceFractions is set), so Compute(&quot;4/6&quot;) would produce
<a name="l00133"></a>00133 the fraction 2/3.  To leave fractions unreduced, set
<a name="l00134"></a>00134 reduceFractions=&gt;0.  The LimitedFraction <a class="code" href="classcontext.html">context</a> has
<a name="l00135"></a>00135 studentsMustReduceFractions set, so reduceFractions is unset
<a name="l00136"></a>00136 automatically for students, but not for correct answers, so
<a name="l00137"></a>00137 <a class="code" href="classFraction.html">Fraction</a>(2,4) would still produce 1/2, even though 2/4 would not be
<a name="l00138"></a>00138 allowed in a student answer.
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 =item S&lt;C&lt;&lt; strictFractions &gt;&gt;&gt;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 This determines whether division is allowed only between integers or
<a name="l00143"></a>00143 not.  If you want to prevent division from accepting non-integers,
<a name="l00144"></a>00144 then set strictFractions=&gt;1 (and also strictMinus=&gt;1 and
<a name="l00145"></a>00145 strictMultiplication=&gt;1).  These are all three 0 by default in the
<a name="l00146"></a>00146 <a class="code" href="classFraction.html">Fraction</a> and <a class="code" href="classFraction.html">Fraction</a>-NoDecimals contexts, but 1 in LimitedFraction.
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 =item S&lt;C&lt;&lt; allowMixedNumbers &gt;&gt;&gt;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 This determines whether a space between a whole number and a fraction
<a name="l00151"></a>00151 is interpretted as implicit multiplication (as it usually would be in
<a name="l00152"></a>00152 WeBWorK), or as addition, allowing &quot;4 1/2&quot; to mean &quot;4 and 1/2&quot;.  By
<a name="l00153"></a>00153 default, it acts as multiplication in the <a class="code" href="classFraction.html">Fraction</a> and
<a name="l00154"></a>00154 <a class="code" href="classFraction.html">Fraction</a>-NoDecimals contexts, and as addition in LimitedFraction.  If
<a name="l00155"></a>00155 you set allowMixedNumbers=&gt;1 you should also set reduceConstants=&gt;0.
<a name="l00156"></a>00156 This parameter used to be named allowProperFractions, which is
<a name="l00157"></a>00157 deprecated, but you can still use it for backward-compatibility.
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 =item S&lt;C&lt;&lt; showMixedNumbers &gt;&gt;&gt;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 This controls whether fractions are displayed as proper fractions or
<a name="l00162"></a>00162 not.  When set, 5/2 will be displayed as 2 1/2 in the answer preview
<a name="l00163"></a>00163 area, otherwise it will be displayed as 5/2.  This flag is 0 by
<a name="l00164"></a>00164 default in the <a class="code" href="classFraction.html">Fraction</a> and <a class="code" href="classFraction.html">Fraction</a>-NoDecimals contexts, and 1 in
<a name="l00165"></a>00165 LimitedFraction.  This parameter used to be named showProperFractions,
<a name="l00166"></a>00166 which is deprecated, but you can still use it for
<a name="l00167"></a>00167 backward-compatibility.
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 =item S&lt;C&lt;&lt; requireProperFractions &gt;&gt;&gt;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 This determines whether fractions MUST be entered as proper fractions.
<a name="l00172"></a>00172 It is 0 by default, meaning improper fractions are allowed.  When set,
<a name="l00173"></a>00173 you will not be able to enter 5/2 as a fraction, but must use &quot;2 1/2&quot;.
<a name="l00174"></a>00174 This flag is allowed only when strictFractions is in effect.  Set it
<a name="l00175"></a>00175 to 1 only when you also set allowMixedNumbers, or you will not be able
<a name="l00176"></a>00176 to specify fractions bigger than one.  It is off by default in all
<a name="l00177"></a>00177 four contexts.  You should not set both requireProperFractions and
<a name="l00178"></a>00178 requirePureFractions to 1.
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 =item S&lt;C&lt;&lt; requirePureFractions &gt;&gt;&gt;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 This determines whether fractions MUST be entered as pure fractions
<a name="l00183"></a>00183 rather than mixed numbers.  If allowMixedNumbers is also set, then
<a name="l00184"></a>00184 mixed numbers will be properly interpretted, but will produce a
<a name="l00185"></a>00185 warning message and be marked incorrect; that is, 2 3/4 would be
<a name="l00186"></a>00186 recognized as 2+3/4 rather than 2*3/4, but would generate a message
<a name="l00187"></a>00187 indicating that mixed numbers are not allowed.  This flag is off by
<a name="l00188"></a>00188 default in all four contexts.  You should not set both
<a name="l00189"></a>00189 requirePureFractions and requireProperFractions to 1.
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 =back
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <a class="code" href="classFraction.html">Fraction</a> objects have two methods that can be useful when
<a name="l00194"></a>00194 reduceFractions is set to 0.  The reduce() method will reduce a
<a name="l00195"></a>00195 fraction to lowest terms, and the isReduced() method returns true when
<a name="l00196"></a>00196 the fraction is reduced and false otherwise.
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 If you wish to convert a fraction to its numeric (real number) form,
<a name="l00199"></a>00199 use the Real() constructor to coerce it to a real.  E.g.,
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     $a = Compute(&quot;1/2&quot;);
<a name="l00202"></a>00202     $r = Real($a);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 would set $r to the value 0.5.  Similarly, use <a class="code" href="classFraction.html">Fraction</a>() to convert a
<a name="l00205"></a>00205 real number to (an approximating) fraction.  E.g.,
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     $r = Real(.5);
<a name="l00208"></a>00208     $a = <a class="code" href="classFraction.html">Fraction</a>($r);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 would set $a to be 1/2.  The fraction produced is good to about 6
<a name="l00211"></a>00211 decimal places, so it can&#39;t be used for numbers that are too small.
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 A side-effect of using the <a class="code" href="classFraction.html">Fraction</a> <a class="code" href="classcontext.html">context</a> is that fractions can be
<a name="l00214"></a>00214 used to take powers of negative numbers when the reduced form of the
<a name="l00215"></a>00215 fraction has an odd denominator.  Thus (-8)^(1/3) will produce -2 as a
<a name="l00216"></a>00216 result, while in the standard Numeric <a class="code" href="classcontext.html">context</a> it would produce an
<a name="l00217"></a><a class="code" href="classcontext_1_1Fraction.html">00217</a> error.
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 =cut
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 sub _contextFraction_init {<a class="code" href="classcontext_1_1Fraction.html#a6ccf29ee459d0894f78c050e0102488d">context::Fraction::Init</a>()};
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="preprocessor">###########################################################################</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>
<a name="l00225"></a>00225 <span class="keyword">package </span>context::Fraction;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <span class="preprocessor">#</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span><span class="preprocessor">#  Initialize the contexts and make the creator function.</span>
<a name="l00229"></a>00229 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span>sub Init {
<a name="l00231"></a>00231   my $context = $main::context{<a class="code" href="classcontext_1_1Fraction.html">Fraction</a>} = <a class="code" href="classParser_1_1Context.html">Parser::Context</a>-&gt;getCopy(<span class="stringliteral">&quot;Numeric&quot;</span>);
<a name="l00232"></a>00232   $context-&gt;{name} = <span class="stringliteral">&quot;Fraction&quot;</span>;
<a name="l00233"></a>00233   $context-&gt;{pattern}{signedNumber} = <span class="stringliteral">&#39;(?:&#39;</span>.$context-&gt;{pattern}{signedNumber}.<span class="stringliteral">&#39;|-?\d+/-?\d+)&#39;</span>;
<a name="l00234"></a>00234   $context-&gt;operators-&gt;set(
<a name="l00235"></a>00235      <span class="stringliteral">&quot;/&quot;</span>  =&gt; {<span class="keyword">class </span>=&gt; &quot;context::Fraction::BOP::divide&quot;},
<a name="l00236"></a>00236      &quot;<span class="comment">//&quot; =&gt; {class =&gt; &quot;context::Fraction::BOP::divide&quot;},</span>
<a name="l00237"></a>00237      &quot;/ &quot; =&gt; {<span class="keyword">class </span>=&gt; &quot;context::Fraction::BOP::divide&quot;},
<a name="l00238"></a>00238      &quot; /&quot; =&gt; {<span class="keyword">class </span>=&gt; &quot;context::Fraction::BOP::divide&quot;},
<a name="l00239"></a>00239      &quot;u-&quot; =&gt; {<span class="keyword">class </span>=&gt; &quot;context::Fraction::UOP::minus&quot;},
<a name="l00240"></a>00240      &quot; &quot;  =&gt; {precedence =&gt; 2.8, <span class="keywordtype">string</span> =&gt; <span class="stringliteral">&#39; *&#39;</span>},
<a name="l00241"></a>00241      <span class="stringliteral">&quot; *&quot;</span> =&gt; {<span class="keyword">class </span>=&gt; &quot;context::Fraction::BOP::multiply&quot;, precedence =&gt; 2.8},
<a name="l00242"></a>00242 <span class="preprocessor">     #  precedence is lower to get proper parens in string() and TeX() calls</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>     <span class="stringliteral">&quot;  &quot;</span> =&gt; {precedence =&gt; 2.7, associativity =&gt; <span class="stringliteral">&#39;left&#39;</span>, type =&gt; <span class="stringliteral">&#39;bin&#39;</span>, <span class="keywordtype">string</span> =&gt; <span class="charliteral">&#39; &#39;</span>,
<a name="l00244"></a>00244               <span class="keyword">class </span>=&gt; &#39;context::Fraction::BOP::multiply&#39;, <a class="code" href="classcontext_1_1Fraction.html#ad518a75a46324318ef49f871cd347d49">TeX</a> =&gt; [<span class="charliteral">&#39; &#39;</span>,<span class="charliteral">&#39; &#39;</span>], hidden =&gt; 1},
<a name="l00245"></a>00245   );
<a name="l00246"></a>00246   $context-&gt;flags-&gt;set(
<a name="l00247"></a>00247     reduceFractions =&gt; 1,
<a name="l00248"></a>00248     strictFractions =&gt; 0, strictMinus =&gt; 0, strictMultiplication =&gt; 0,
<a name="l00249"></a>00249     allowMixedNumbers =&gt; 0,  # also <span class="keyword">set</span> reduceConstants =&gt; 0 <span class="keywordflow">if</span> you change <span class="keyword">this</span>
<a name="l00250"></a>00250     requireProperFractions =&gt; 0,
<a name="l00251"></a>00251     requirePureFractions =&gt; 0,
<a name="l00252"></a>00252     showMixedNumbers =&gt; 0,
<a name="l00253"></a>00253   );
<a name="l00254"></a>00254   $context-&gt;reduction-&gt;set(<span class="stringliteral">&#39;a/b&#39;</span> =&gt; 1,<span class="stringliteral">&#39;a b/c&#39;</span> =&gt; 1, <span class="stringliteral">&#39;0 a/b&#39;</span> =&gt; 1);
<a name="l00255"></a>00255   $context-&gt;{value}{<a class="code" href="classFraction.html">Fraction</a>} = <span class="stringliteral">&quot;context::Fraction::Fraction&quot;</span>;
<a name="l00256"></a>00256   $context-&gt;{value}{Real} = <span class="stringliteral">&quot;context::Fraction::Real&quot;</span>;
<a name="l00257"></a>00257   $context-&gt;{<a class="code" href="classparser.html">parser</a>}{<a class="code" href="classValue.html">Value</a>} = <span class="stringliteral">&quot;context::Fraction::Value&quot;</span>;
<a name="l00258"></a>00258   $context-&gt;{<a class="code" href="classparser.html">parser</a>}{Number} = <span class="stringliteral">&quot;Parser::Legacy::LimitedNumeric::Number&quot;</span>;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   $context = $main::context{<span class="stringliteral">&#39;Fraction-NoDecimals&#39;</span>} = $context-&gt;copy;
<a name="l00261"></a>00261   $context-&gt;{name} = <span class="stringliteral">&quot;Fraction-NoDecimals&quot;</span>;
<a name="l00262"></a>00262   <a class="code" href="classParser_1_1Number.html#a3a4feb2a2386828c8a874f8cdbf33d45">Parser::Number::NoDecimals</a>($context);
<a name="l00263"></a>00263   $context-&gt;{error}{msg}{<span class="stringliteral">&quot;You are not allowed to type decimal numbers in this problem&quot;</span>} =
<a name="l00264"></a>00264     <span class="stringliteral">&quot;You are only allowed to enter fractions, not decimal numbers&quot;</span>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   $context = $main::context{LimitedFraction} = $context-&gt;copy;
<a name="l00267"></a>00267   $context-&gt;{name} = <span class="stringliteral">&quot;LimitedFraction&quot;</span>;
<a name="l00268"></a>00268   $context-&gt;operators-&gt;undefine(
<a name="l00269"></a>00269      <span class="charliteral">&#39;+&#39;</span>, <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;*&#39;</span>, <span class="stringliteral">&#39;* &#39;</span>, <span class="charliteral">&#39;^&#39;</span>, <span class="stringliteral">&#39;**&#39;</span>,
<a name="l00270"></a>00270      <span class="charliteral">&#39;U&#39;</span>, <span class="charliteral">&#39;.&#39;</span>, <span class="stringliteral">&#39;&gt;&lt;&#39;</span>, <span class="stringliteral">&#39;u+&#39;</span>, <span class="charliteral">&#39;!&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39;,&#39;</span>,
<a name="l00271"></a>00271   );
<a name="l00272"></a>00272   $context-&gt;parens-&gt;undefine(<span class="charliteral">&#39;|&#39;</span>,<span class="charliteral">&#39;{&#39;</span>,<span class="charliteral">&#39;[&#39;</span>);
<a name="l00273"></a>00273   $context-&gt;functions-&gt;disable(<span class="stringliteral">&#39;All&#39;</span>);
<a name="l00274"></a>00274   $context-&gt;flags-&gt;set(
<a name="l00275"></a>00275     strictFractions =&gt; 1, strictMinus =&gt; 1, strictMultiplication =&gt; 1,
<a name="l00276"></a>00276     allowMixedNumbers =&gt; 1, reduceConstants =&gt; 0,
<a name="l00277"></a>00277     showMixedNumbers =&gt; 1,
<a name="l00278"></a>00278   );
<a name="l00279"></a>00279   $context-&gt;{cmpDefaults}{<a class="code" href="classFraction.html">Fraction</a>} = {studentsMustReduceFractions =&gt; 1};
<a name="l00280"></a>00280 
<a name="l00281"></a>00281   $context = $main::context{LimitedProperFraction} = $context-&gt;copy;
<a name="l00282"></a>00282   $context-&gt;flags-&gt;set(requireProperFractions =&gt; 1);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284   main::PG_restricted_eval(<span class="stringliteral">&#39;sub Fraction {Value-&gt;Package(&quot;Fraction()&quot;)-&gt;new(@_)};&#39;</span>);
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="preprocessor">#</span>
<a name="l00288"></a>00288 <span class="preprocessor"></span><span class="preprocessor">#  Convert a real to a reduced fraction approximation</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span><a class="code" href="classcontext_1_1Fraction.html#a9966027789f7827dd45ac242f82e7b59">sub</a> <a class="code" href="classcontext_1_1Fraction.html#a43ef260239cd1fbc11320557616ed5e8">toFraction</a> {
<a name="l00291"></a>00291   my $context = shift; my $x = shift;
<a name="l00292"></a>00292   my $Real = $context-&gt;Package(<span class="stringliteral">&quot;Real&quot;</span>);
<a name="l00293"></a>00293   my $d = 1000000;
<a name="l00294"></a>00294   my ($a,$b) = <a class="code" href="classcontext_1_1Fraction.html#a6d3fed61144055fedac17c6ac196b918">reduce</a>(<span class="keywordtype">int</span>($x*$d),$d);
<a name="l00295"></a>00295   <span class="keywordflow">return</span> [$Real-&gt;make($a),$Real-&gt;make($b)];
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 <span class="preprocessor">#</span>
<a name="l00299"></a>00299 <span class="preprocessor"></span><span class="preprocessor">#  Greatest Common Divisor</span>
<a name="l00300"></a>00300 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00301"></a>00301 <span class="preprocessor"></span><a class="code" href="classcontext_1_1Fraction.html#a9966027789f7827dd45ac242f82e7b59">sub</a> <a class="code" href="classcontext_1_1Fraction.html#a1ad6364e60f9c7f6e8f4711d41373e12">gcd</a> {
<a name="l00302"></a>00302   my $a = <a class="code" href="classcontext_1_1Fraction.html#a80e851ae90b534e95df6f3c66a305456">abs</a>(shift); my $b = <a class="code" href="classcontext_1_1Fraction.html#a80e851ae90b534e95df6f3c66a305456">abs</a>(shift);
<a name="l00303"></a>00303   ($a,$b) = ($b,$a) <span class="keywordflow">if</span> $a &lt; $b;
<a name="l00304"></a>00304   <span class="keywordflow">return</span> $a <span class="keywordflow">if</span> $b == 0;
<a name="l00305"></a>00305   my $r = $a % $b;
<a name="l00306"></a>00306   <span class="keywordflow">while</span> ($r != 0) {
<a name="l00307"></a>00307     ($a,$b) = ($b,$r);
<a name="l00308"></a>00308     $r = $a % $b;
<a name="l00309"></a>00309   }
<a name="l00310"></a>00310   <span class="keywordflow">return</span> $b;
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <span class="preprocessor">#</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span><span class="preprocessor">#  Least Common Multiple</span>
<a name="l00315"></a>00315 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span><a class="code" href="classcontext_1_1Fraction.html#a9966027789f7827dd45ac242f82e7b59">sub</a> <a class="code" href="classcontext_1_1Fraction.html#a11f07e0dcf7163b3d57e9cfa08e36fed">lcm</a> {
<a name="l00317"></a>00317   my ($a,$b) = @_;
<a name="l00318"></a>00318   <span class="keywordflow">return</span> ($a/<a class="code" href="classcontext_1_1Fraction.html#a1ad6364e60f9c7f6e8f4711d41373e12">gcd</a>($a,$b))*$b;
<a name="l00319"></a>00319 }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 <span class="preprocessor">#</span>
<a name="l00323"></a>00323 <span class="preprocessor"></span><span class="preprocessor">#  Reduced fraction</span>
<a name="l00324"></a>00324 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span><a class="code" href="classcontext_1_1Fraction.html#a9966027789f7827dd45ac242f82e7b59">sub</a> <a class="code" href="classcontext_1_1Fraction.html#a6d3fed61144055fedac17c6ac196b918">reduce</a> {
<a name="l00326"></a>00326   my $a = shift; my $b = shift;
<a name="l00327"></a>00327   ($a,$b) = (-$a,-$b) <span class="keywordflow">if</span> $b &lt; 0;
<a name="l00328"></a>00328   my $gcd = <a class="code" href="classcontext_1_1Fraction.html#a1ad6364e60f9c7f6e8f4711d41373e12">gcd</a>($a,$b);
<a name="l00329"></a>00329   <span class="keywordflow">return</span> ($a/$gcd,$b/$gcd);
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="preprocessor">###########################################################################</span>
<a name="l00333"></a>00333 <span class="preprocessor"></span>
<a name="l00334"></a>00334 <span class="keyword">package </span>context::Fraction::BOP::divide;
<a name="l00335"></a>00335 our @ISA = (<span class="stringliteral">&#39;Parser::BOP::divide&#39;</span>);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="preprocessor">#</span>
<a name="l00338"></a>00338 <span class="preprocessor"></span><span class="preprocessor">#  Create a Fraction or Real from the given data</span>
<a name="l00339"></a>00339 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00340"></a>00340 <span class="preprocessor"></span>sub _eval {
<a name="l00341"></a>00341   my $self = shift; my $context = $self-&gt;{equation}{<a class="code" href="classcontext.html">context</a>};
<a name="l00342"></a>00342   <span class="keywordflow">return</span> $_[0]/$_[1] <span class="keywordflow">if</span> <a class="code" href="classValue.html#a43e6b7aa1e386a5a9056190d0ac3cbb3">Value::isValue</a>($_[0]) || <a class="code" href="classValue.html#a43e6b7aa1e386a5a9056190d0ac3cbb3">Value::isValue</a>($_[1]);
<a name="l00343"></a>00343   my $n = $context-&gt;Package(<span class="stringliteral">&quot;Fraction&quot;</span>)-&gt;make($context,@_);
<a name="l00344"></a>00344   $n-&gt;{isHorizontal} = 1 <span class="keywordflow">if</span> $self-&gt;{def}{noFrac};
<a name="l00345"></a>00345   <span class="keywordflow">return</span> $n;
<a name="l00346"></a>00346 }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348 <span class="preprocessor">#</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span><span class="preprocessor">#  When strictFraction is in effect, only allow division</span>
<a name="l00350"></a>00350 <span class="preprocessor"></span><span class="preprocessor">#  with integers and negative integers</span>
<a name="l00351"></a>00351 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00352"></a>00352 <span class="preprocessor"></span>sub _check {
<a name="l00353"></a>00353   my $self = shift;
<a name="l00354"></a>00354   $self-&gt;SUPER::_check;
<a name="l00355"></a>00355   <span class="keywordflow">return</span> unless $self-&gt;context-&gt;flag(<span class="stringliteral">&quot;strictFractions&quot;</span>);
<a name="l00356"></a>00356   $self-&gt;Error(<span class="stringliteral">&quot;The numerator of a fraction must be an integer&quot;</span>)
<a name="l00357"></a>00357     unless $self-&gt;{lop}-&gt;class =~ /INTEGER|MINUS/;
<a name="l00358"></a>00358   $self-&gt;Error(<span class="stringliteral">&quot;The denominator of a fraction must be a (non-negative) integer&quot;</span>)
<a name="l00359"></a>00359     unless $self-&gt;{rop}-&gt;class eq <span class="stringliteral">&#39;INTEGER&#39;</span>;
<a name="l00360"></a>00360   $self-&gt;Error(<span class="stringliteral">&quot;The numerator must be less than the denominator in a proper fraction&quot;</span>)
<a name="l00361"></a>00361     <span class="keywordflow">if</span> $self-&gt;context-&gt;flag(<span class="stringliteral">&quot;requireProperFractions&quot;</span>) &amp;&amp; CORE::abs($self-&gt;{lop}-&gt;eval) &gt;= CORE::abs($self-&gt;{rop}-&gt;eval);
<a name="l00362"></a>00362 }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="preprocessor">#</span>
<a name="l00365"></a>00365 <span class="preprocessor"></span><span class="preprocessor">#  Reduce the fraction, if it is one, otherwise do the usual reduce</span>
<a name="l00366"></a>00366 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00367"></a>00367 <span class="preprocessor"></span>sub reduce {
<a name="l00368"></a>00368   my $self = shift;
<a name="l00369"></a>00369   <span class="keywordflow">return</span> $self-&gt;SUPER::reduce unless $self-&gt;class eq <span class="stringliteral">&#39;FRACTION&#39;</span>;
<a name="l00370"></a>00370   my $reduce = $self-&gt;{equation}{<a class="code" href="classcontext.html">context</a>}{reduction};
<a name="l00371"></a>00371   <span class="keywordflow">return</span> $self-&gt;{lop} <span class="keywordflow">if</span> $self-&gt;{rop}{isOne} &amp;&amp; $reduce-&gt;{<span class="stringliteral">&#39;x/1&#39;</span>};
<a name="l00372"></a>00372   $self-&gt;Error(<span class="stringliteral">&quot;Division by zero&quot;</span>), <span class="keywordflow">return</span> $self <span class="keywordflow">if</span> $self-&gt;{rop}{isZero};
<a name="l00373"></a>00373   <span class="keywordflow">return</span> $self-&gt;{lop} <span class="keywordflow">if</span> $self-&gt;{lop}{isZero} &amp;&amp; $reduce-&gt;{<span class="stringliteral">&#39;0/x&#39;</span>};
<a name="l00374"></a>00374   <span class="keywordflow">if</span> ($reduce-&gt;{<span class="stringliteral">&#39;a/b&#39;</span>}) {
<a name="l00375"></a>00375     my ($a,$b) = <a class="code" href="classcontext_1_1Fraction.html#a6d3fed61144055fedac17c6ac196b918">context::Fraction::reduce</a>($self-&gt;{lop}-&gt;eval,$self-&gt;{rop}-&gt;eval);
<a name="l00376"></a>00376     <span class="keywordflow">if</span> ($self-&gt;{lop}-&gt;class eq <span class="stringliteral">&#39;INTEGER&#39;</span>) {$self-&gt;{lop}{value} = $a} <span class="keywordflow">else</span> {$self-&gt;{lop}{op}{value} = -$a}
<a name="l00377"></a>00377     $self-&gt;{rop}{value} = $b;
<a name="l00378"></a>00378   }
<a name="l00379"></a>00379   <span class="keywordflow">return</span> $self;
<a name="l00380"></a>00380 }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="preprocessor">#</span>
<a name="l00383"></a>00383 <span class="preprocessor"></span><span class="preprocessor">#  Display minus signs outside the fraction</span>
<a name="l00384"></a>00384 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span>sub TeX {
<a name="l00386"></a>00386   my $self = shift; my $bop = $self-&gt;{def};
<a name="l00387"></a>00387   <span class="keywordflow">return</span> $self-&gt;SUPER::TeX(@_) <span class="keywordflow">if</span> $self-&gt;class ne <span class="stringliteral">&#39;FRACTION&#39;</span> || $bop-&gt;{noFrac};
<a name="l00388"></a>00388   my ($precedence,$showparens,$position,$outerRight) = @_;
<a name="l00389"></a>00389   $showparens = <span class="stringliteral">&#39;&#39;</span> unless defined($showparens);
<a name="l00390"></a>00390   my $addparens =
<a name="l00391"></a>00391       defined($precedence) &amp;&amp;
<a name="l00392"></a>00392       ($showparens eq <span class="stringliteral">&#39;all&#39;</span> || ($precedence &gt; $bop-&gt;{precedence} &amp;&amp; $showparens ne <span class="stringliteral">&#39;nofractions&#39;</span>) ||
<a name="l00393"></a>00393       ($precedence == $bop-&gt;{precedence} &amp;&amp; ($bop-&gt;{associativity} eq <span class="stringliteral">&#39;right&#39;</span> || $showparens eq <span class="stringliteral">&#39;same&#39;</span>)));
<a name="l00394"></a>00394 
<a name="l00395"></a>00395   my $TeX = $self-&gt;eval-&gt;TeX;
<a name="l00396"></a>00396   $TeX = <span class="stringliteral">&#39;\left(&#39;</span>.$TeX.<span class="stringliteral">&#39;\right)&#39;</span> <span class="keywordflow">if</span> ($addparens);
<a name="l00397"></a>00397   <span class="keywordflow">return</span> $TeX;
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="preprocessor">#</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span><span class="preprocessor">#  Indicate if the value is a fraction or not</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00403"></a>00403 <span class="preprocessor"></span>sub <span class="keyword">class </span>{
<a name="l00404"></a>00404   my $self = shift;
<a name="l00405"></a>00405   <span class="keywordflow">return</span> <span class="stringliteral">&quot;FRACTION&quot;</span> <span class="keywordflow">if</span> $self-&gt;{lop}-&gt;class =~ /INTEGER|MINUS/ &amp;&amp;
<a name="l00406"></a>00406                        $self-&gt;{rop}-&gt;class eq <span class="stringliteral">&#39;INTEGER&#39;</span>;
<a name="l00407"></a>00407   <span class="keywordflow">return</span> $self-&gt;SUPER::class;
<a name="l00408"></a>00408 }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 <span class="preprocessor">###########################################################################</span>
<a name="l00411"></a>00411 <span class="preprocessor"></span>
<a name="l00412"></a>00412 <span class="keyword">package </span>context::Fraction::BOP::multiply;
<a name="l00413"></a>00413 our @ISA = (<span class="stringliteral">&#39;Parser::BOP::multiply&#39;</span>);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="preprocessor">#</span>
<a name="l00416"></a>00416 <span class="preprocessor"></span><span class="preprocessor">#  For proper fractions, add the integer to the fraction</span>
<a name="l00417"></a>00417 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00418"></a>00418 <span class="preprocessor"></span>sub _eval {
<a name="l00419"></a>00419   my ($self,$a,$b)= @_;
<a name="l00420"></a>00420   <span class="keywordflow">return</span> ($a &gt;= 0 ? $a + $b : $a - $b);
<a name="l00421"></a>00421 }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 <span class="preprocessor">#</span>
<a name="l00424"></a>00424 <span class="preprocessor"></span><span class="preprocessor">#  If the implied multiplication represents a proper fraction with a</span>
<a name="l00425"></a>00425 <span class="preprocessor"></span><span class="preprocessor">#  preceeding integer, then switch to the proper fraction operator</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span><span class="preprocessor">#  (for proper handling of string() and TeX() calls), otherwise,</span>
<a name="l00427"></a>00427 <span class="preprocessor"></span><span class="preprocessor">#  convert the object to a standard multiplication.</span>
<a name="l00428"></a>00428 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00429"></a>00429 <span class="preprocessor"></span>sub _check {
<a name="l00430"></a>00430   my $self = shift;
<a name="l00431"></a>00431   $self-&gt;SUPER::_check;
<a name="l00432"></a>00432   my $isFraction = 0;
<a name="l00433"></a>00433   my $allowMixedNumbers = $self-&gt;context-&gt;flag(<span class="stringliteral">&quot;allowProperFractions&quot;</span>);
<a name="l00434"></a>00434   $allowMixedNumbers = $self-&gt;context-&gt;flag(<span class="stringliteral">&quot;allowMixedNumbers&quot;</span>)
<a name="l00435"></a>00435     unless defined($allowMixedNumbers) &amp;&amp; $allowMixedNumbers ne <span class="stringliteral">&quot;&quot;</span>;
<a name="l00436"></a>00436   <span class="keywordflow">if</span> ($allowMixedNumbers) {
<a name="l00437"></a>00437     $isFraction = ($self-&gt;{lop}-&gt;class =~ /INTEGER|MINUS/ &amp;&amp; !$self-&gt;{lop}{hadParens} &amp;&amp;
<a name="l00438"></a>00438                    $self-&gt;{rop}-&gt;class eq <span class="stringliteral">&#39;FRACTION&#39;</span> &amp;&amp; !$self-&gt;{rop}{hadParens} &amp;&amp;
<a name="l00439"></a>00439                    $self-&gt;{rop}-&gt;eval &gt;= 0);
<a name="l00440"></a>00440   }
<a name="l00441"></a>00441   <span class="keywordflow">if</span> ($isFraction) {
<a name="l00442"></a>00442     $self-&gt;Error(<span class="stringliteral">&quot;Mixed numbers are not allowed; you must use a pure fraction&quot;</span>)
<a name="l00443"></a>00443       <span class="keywordflow">if</span> ($self-&gt;context-&gt;flag(<span class="stringliteral">&quot;requirePureFractions&quot;</span>));
<a name="l00444"></a>00444     $self-&gt;{isFraction} = 1; $self-&gt;{bop} = <span class="stringliteral">&quot;  &quot;</span>;
<a name="l00445"></a>00445     $self-&gt;{def} = $self-&gt;context-&gt;{operators}{$self-&gt;{bop}};
<a name="l00446"></a>00446     <span class="keywordflow">if</span> ($self-&gt;{lop}-&gt;class eq <span class="stringliteral">&#39;MINUS&#39;</span>) {
<a name="l00447"></a>00447 <span class="preprocessor">      #</span>
<a name="l00448"></a>00448 <span class="preprocessor"></span><span class="preprocessor">      #  Hack to replace BOP with unary negation of BOP.</span>
<a name="l00449"></a>00449 <span class="preprocessor"></span><span class="preprocessor">      #  (When check() is changed to accept a return value,</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span><span class="preprocessor">      #   this will not be necessary.)</span>
<a name="l00451"></a>00451 <span class="preprocessor"></span><span class="preprocessor">      #</span>
<a name="l00452"></a>00452 <span class="preprocessor"></span>      my $copy = bless {%$self}, ref($self); $copy-&gt;{lop} = $copy-&gt;{lop}{op};
<a name="l00453"></a>00453       my $neg = $self-&gt;Item(<span class="stringliteral">&quot;UOP&quot;</span>)-&gt;new($self-&gt;{equation},<span class="stringliteral">&quot;u-&quot;</span>,$copy);
<a name="l00454"></a>00454       map {<span class="keyword">delete</span> $self-&gt;{$_}} (keys %$self);
<a name="l00455"></a>00455       map {$self-&gt;{$_} = $neg-&gt;{$_}} (keys %$neg);
<a name="l00456"></a>00456       bless $self, ref($neg);
<a name="l00457"></a>00457     }
<a name="l00458"></a>00458   } <span class="keywordflow">else</span> {
<a name="l00459"></a>00459     $self-&gt;Error(<span class="stringliteral">&quot;Can&#39;t use implied multiplication in this context&quot;</span>,$self-&gt;{bop})
<a name="l00460"></a>00460       <span class="keywordflow">if</span> $self-&gt;context-&gt;flag(<span class="stringliteral">&quot;strictMultiplication&quot;</span>);
<a name="l00461"></a>00461     bless $self, $ISA[0];
<a name="l00462"></a>00462   }
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 <span class="preprocessor">#</span>
<a name="l00466"></a>00466 <span class="preprocessor"></span><span class="preprocessor">#  Indicate if the value is a fraction or not</span>
<a name="l00467"></a>00467 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00468"></a>00468 <span class="preprocessor"></span>sub <span class="keyword">class </span>{
<a name="l00469"></a>00469   my $self = shift;
<a name="l00470"></a>00470   <span class="keywordflow">return</span> <span class="stringliteral">&quot;FRACTION&quot;</span> <span class="keywordflow">if</span> $self-&gt;{isFraction};
<a name="l00471"></a>00471   <span class="keywordflow">return</span> $self-&gt;SUPER::class;
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474 <span class="preprocessor">#</span>
<a name="l00475"></a>00475 <span class="preprocessor"></span><span class="preprocessor">#  Reduce the fraction</span>
<a name="l00476"></a>00476 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00477"></a>00477 <span class="preprocessor"></span>sub reduce {
<a name="l00478"></a>00478   my $self = shift;
<a name="l00479"></a>00479   my $reduce = $self-&gt;{equation}{<a class="code" href="classcontext.html">context</a>}{reduction};
<a name="l00480"></a>00480   my ($a,($b,$c)) = (CORE::abs($self-&gt;{lop}-&gt;eval),$self-&gt;{rop}-&gt;eval-&gt;value);
<a name="l00481"></a>00481   <span class="keywordflow">if</span> ($reduce-&gt;{<span class="stringliteral">&#39;a b/c&#39;</span>}) {
<a name="l00482"></a>00482     ($b,$c) = <a class="code" href="classcontext_1_1Fraction.html#a6d3fed61144055fedac17c6ac196b918">context::Fraction::reduce</a>($b,$c) <span class="keywordflow">if</span> $reduce-&gt;{<span class="stringliteral">&#39;a/b&#39;</span>};
<a name="l00483"></a>00483     $a += int($b/$c); $b = $b % $c;
<a name="l00484"></a>00484     $self-&gt;{lop}{value} = $a;
<a name="l00485"></a>00485     $self-&gt;{rop}{lop}{value} = $b;
<a name="l00486"></a>00486     $self-&gt;{rop}{rop}{value} = $c;
<a name="l00487"></a>00487     <span class="keywordflow">return</span> $self-&gt;{lop} <span class="keywordflow">if</span> $b == 0 || $c == 1;
<a name="l00488"></a>00488   }
<a name="l00489"></a>00489   <span class="keywordflow">return</span> $self-&gt;{rop} <span class="keywordflow">if</span> $a == 0 &amp;&amp; $reduce-&gt;{<span class="stringliteral">&#39;0 a/b&#39;</span>};
<a name="l00490"></a>00490   <span class="keywordflow">return</span> $self;
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 <span class="preprocessor">###########################################################################</span>
<a name="l00494"></a>00494 <span class="preprocessor"></span>
<a name="l00495"></a>00495 <span class="keyword">package </span>context::Fraction::UOP::minus;
<a name="l00496"></a>00496 our @ISA = (<span class="stringliteral">&#39;Parser::UOP::minus&#39;</span>);
<a name="l00497"></a>00497 
<a name="l00498"></a>00498 <span class="preprocessor">#</span>
<a name="l00499"></a>00499 <span class="preprocessor"></span><span class="preprocessor">#  For strict fractions, only allow minus on certain operands</span>
<a name="l00500"></a>00500 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00501"></a>00501 <span class="preprocessor"></span>sub _check {
<a name="l00502"></a>00502   my $self = shift;
<a name="l00503"></a>00503   $self-&gt;SUPER::_check;
<a name="l00504"></a>00504   $self-&gt;{hadParens} = 1 <span class="keywordflow">if</span> $self-&gt;{op}{hadParens};
<a name="l00505"></a>00505   <span class="keywordflow">return</span> unless $self-&gt;context-&gt;flag(<span class="stringliteral">&quot;strictMinus&quot;</span>);
<a name="l00506"></a>00506   my $uop = $self-&gt;{def}{<span class="keywordtype">string</span>} || $self-&gt;{uop};
<a name="l00507"></a>00507   $self-&gt;Error(<span class="stringliteral">&quot;You can only use &#39;%s&#39; with (non-negative) numbers&quot;</span>,$uop)
<a name="l00508"></a>00508     unless $self-&gt;{op}-&gt;class =~ /Number|INTEGER|FRACTION/;
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="preprocessor">#</span>
<a name="l00512"></a>00512 <span class="preprocessor"></span><span class="preprocessor">#  class is MINUS if it is a negative number</span>
<a name="l00513"></a>00513 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00514"></a>00514 <span class="preprocessor"></span>sub <span class="keyword">class </span>{
<a name="l00515"></a>00515   my $self = shift;
<a name="l00516"></a>00516   <span class="keywordflow">return</span> <span class="stringliteral">&quot;MINUS&quot;</span> <span class="keywordflow">if</span> $self-&gt;{op}-&gt;class =~ /Number|INTEGER/;
<a name="l00517"></a>00517   $self-&gt;SUPER::class;
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 <span class="preprocessor">#</span>
<a name="l00521"></a>00521 <span class="preprocessor"></span><span class="preprocessor">#  make isNeg properly handle the modified class</span>
<a name="l00522"></a>00522 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00523"></a>00523 <span class="preprocessor"></span>sub isNeg {
<a name="l00524"></a>00524   my $self = shift;
<a name="l00525"></a>00525   <span class="keywordflow">return</span> ($self-&gt;class =~ /<a class="code" href="classParser_1_1Legacy_1_1LimitedComplex_1_1UOP.html">UOP</a>|MINUS/ &amp;&amp; $self-&gt;{uop} eq <span class="stringliteral">&#39;u-&#39;</span> &amp;&amp; !$self-&gt;{op}-&gt;{isInfinite});
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="preprocessor">###########################################################################</span>
<a name="l00530"></a>00530 <span class="preprocessor"></span>
<a name="l00531"></a>00531 <span class="keyword">package </span>context::Fraction::Value;
<a name="l00532"></a>00532 our @ISA = (<span class="stringliteral">&#39;Parser::Value&#39;</span>);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 <span class="preprocessor">#</span>
<a name="l00535"></a>00535 <span class="preprocessor"></span><span class="preprocessor">#  Indicate if the Value object is a fraction or not</span>
<a name="l00536"></a>00536 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00537"></a>00537 <span class="preprocessor"></span><a class="code" href="classValue.html#a39a759e158fb6b2e1403676331abb04a">sub</a> <span class="keyword">class </span>{
<a name="l00538"></a>00538   my $self = shift;
<a name="l00539"></a>00539   <span class="keywordflow">return</span> <span class="stringliteral">&quot;FRACTION&quot;</span> <span class="keywordflow">if</span> $self-&gt;{<a class="code" href="classValue.html#a9c2ed65a400149f0cdf95c0a6d9841dc">value</a>}-&gt;classMatch(<span class="stringliteral">&#39;Fraction&#39;</span>);
<a name="l00540"></a>00540   <span class="keywordflow">return</span> $self-&gt;SUPER::class;
<a name="l00541"></a>00541 }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 <span class="preprocessor">#</span>
<a name="l00544"></a>00544 <span class="preprocessor"></span><span class="preprocessor">#  Handle reductions of negative fractions</span>
<a name="l00545"></a>00545 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00546"></a>00546 <span class="preprocessor"></span>sub reduce {
<a name="l00547"></a>00547   my $self = shift;
<a name="l00548"></a>00548   my $reduce = $self-&gt;context-&gt;{reduction};
<a name="l00549"></a>00549   <span class="keywordflow">if</span> ($self-&gt;{value}-&gt;class eq <span class="stringliteral">&#39;Fraction&#39;</span>) {
<a name="l00550"></a>00550     $self-&gt;{value} = $self-&gt;{value}-&gt;reduce;
<a name="l00551"></a>00551     <span class="keywordflow">if</span> ($reduce-&gt;{<span class="stringliteral">&#39;-n&#39;</span>} &amp;&amp; $self-&gt;{value}{data}[0] &lt; 0) {
<a name="l00552"></a>00552       $self-&gt;{value}{data}[0] = -$self-&gt;{value}{data}[0];
<a name="l00553"></a>00553       <span class="keywordflow">return</span> <a class="code" href="classParser_1_1UOP.html#a55798431fdea859a2c7443867bd90c02">Parser::UOP::Neg</a>($self);
<a name="l00554"></a>00554     }
<a name="l00555"></a>00555     <span class="keywordflow">return</span> $self;
<a name="l00556"></a>00556   }
<a name="l00557"></a>00557   <span class="keywordflow">return</span> $self-&gt;SUPER::reduce;
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="preprocessor">###########################################################################</span>
<a name="l00561"></a>00561 <span class="preprocessor"></span>
<a name="l00562"></a>00562 <span class="keyword">package </span>context::Fraction::Real;
<a name="l00563"></a>00563 our @ISA = (<span class="stringliteral">&#39;Value::Real&#39;</span>);
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 <span class="preprocessor">#</span>
<a name="l00566"></a>00566 <span class="preprocessor"></span><span class="preprocessor">#  Allow Real to convert Fractions to Reals</span>
<a name="l00567"></a>00567 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00568"></a>00568 <span class="preprocessor"></span>sub <span class="keyword">new</span> {
<a name="l00569"></a>00569   my $self = shift; my $context = (<a class="code" href="classValue.html#a2d6d7d0072c75611908bf0a79080e8df">Value::isContext</a>($_[0]) ? shift : $self-&gt;context);
<a name="l00570"></a>00570   my $x = shift;
<a name="l00571"></a>00571   $x = $context-&gt;Package(<span class="stringliteral">&quot;Formula&quot;</span>)-&gt;new($context,$x)-&gt;eval <span class="keywordflow">if</span> ref($x) eq &quot;&quot; &amp;&amp; $x =~ m!/!;
<a name="l00572"></a>00572   $x = $x-&gt;eval if scalar(@_) == 0 &amp;&amp; <a class="code" href="classValue.html">Value</a>::classMatch($x,&#39;<a class="code" href="classFraction.html">Fraction</a>&#39;);
<a name="l00573"></a>00573   $self-&gt;SUPER::new($context,$x,@_);
<a name="l00574"></a>00574 }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 <span class="preprocessor">#</span>
<a name="l00577"></a>00577 <span class="preprocessor"></span><span class="preprocessor">#  Since the signed number pattern now include fractions, we need to make sure</span>
<a name="l00578"></a>00578 <span class="preprocessor"></span><span class="preprocessor">#  we handle them when a real is made and it looks like a fraction</span>
<a name="l00579"></a>00579 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00580"></a>00580 <span class="preprocessor"></span>sub make {
<a name="l00581"></a>00581   my $self = shift; my $context = (<a class="code" href="classValue.html#a2d6d7d0072c75611908bf0a79080e8df">Value::isContext</a>($_[0]) ? shift : $self-&gt;context);
<a name="l00582"></a>00582   my $x = shift;
<a name="l00583"></a>00583   $x = $context-&gt;Package(<span class="stringliteral">&quot;Formula&quot;</span>)-&gt;new($context,$x)-&gt;eval <span class="keywordflow">if</span> ref($x) eq &quot;&quot; &amp;&amp; $x =~ m!/!;
<a name="l00584"></a>00584   $x = $x-&gt;eval if scalar(@_) == 0 &amp;&amp; <a class="code" href="classValue.html">Value</a>::classMatch($x,&#39;Fraction&#39;);
<a name="l00585"></a>00585   $self-&gt;SUPER::make($context,$x,@_);
<a name="l00586"></a>00586 }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="preprocessor">###########################################################################</span>
<a name="l00589"></a>00589 <span class="preprocessor"></span><span class="preprocessor">###########################################################################</span>
<a name="l00590"></a>00590 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00591"></a>00591 <span class="preprocessor"></span><span class="preprocessor">#  Implements the MathObject for fractions</span>
<a name="l00592"></a>00592 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00593"></a>00593 <span class="preprocessor"></span>
<a name="l00594"></a>00594 <span class="keyword">package </span>context::Fraction::Fraction;
<a name="l00595"></a>00595 our @ISA = (<span class="stringliteral">&#39;Value&#39;</span>);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 sub <span class="keyword">new</span> {
<a name="l00598"></a>00598   my $self = shift; my $class = ref($self) || $self;
<a name="l00599"></a>00599   my $context = (<a class="code" href="classValue.html#a2d6d7d0072c75611908bf0a79080e8df">Value::isContext</a>($_[0]) ? shift : $self-&gt;context);
<a name="l00600"></a>00600   my $x = shift; $x = [$x,@_] <span class="keywordflow">if</span> scalar(@_) &gt; 0;
<a name="l00601"></a>00601   <span class="keywordflow">return</span> $x-&gt;inContext($context) <span class="keywordflow">if</span> <a class="code" href="classValue.html#a3518cd4f61c793378c1a59f4ddc67226">Value::classMatch</a>($x,<span class="stringliteral">&#39;Fraction&#39;</span>);
<a name="l00602"></a>00602   $x = [$x] unless ref($x) eq &#39;ARRAY&#39;; $x-&gt;[1] = 1 if scalar(@{$x}) == 1;
<a name="l00603"></a>00603   <a class="code" href="classValue.html#a26f0e9926e446d67e29db24fd4300279">Value::Error</a>(<span class="stringliteral">&quot;Can&#39;t convert ARRAY of length %d to %s&quot;</span>,scalar(@{$x}),<a class="code" href="classValue.html#a829339083cd1066f3262960939a2d818">Value::showClass</a>($self))
<a name="l00604"></a>00604     unless (scalar(@{$x}) == 2);
<a name="l00605"></a>00605   $x-&gt;[0] = <a class="code" href="classValue.html#a43a81d16f2f6aee0019772bf09626569">Value::makeValue</a>($x-&gt;[0],<a class="code" href="classcontext.html">context</a>=&gt;$context);
<a name="l00606"></a>00606   $x-&gt;[1] = <a class="code" href="classValue.html#a43a81d16f2f6aee0019772bf09626569">Value::makeValue</a>($x-&gt;[1],<a class="code" href="classcontext.html">context</a>=&gt;$context);
<a name="l00607"></a>00607   <span class="keywordflow">return</span> $x-&gt;[0] <span class="keywordflow">if</span> <a class="code" href="classValue.html#a3518cd4f61c793378c1a59f4ddc67226">Value::classMatch</a>($x-&gt;[0],<span class="stringliteral">&#39;Fraction&#39;</span>) &amp;&amp; scalar(@_) == 0;
<a name="l00608"></a>00608   $x = <a class="code" href="classcontext_1_1Fraction.html#a43ef260239cd1fbc11320557616ed5e8">context::Fraction::toFraction</a>($context,$x-&gt;[0]-&gt;value) <span class="keywordflow">if</span> <a class="code" href="classValue.html#a5dc063f052a2338b5dac72016bf024b1">Value::isReal</a>($x-&gt;[0]) &amp;&amp; scalar(@_) == 0;
<a name="l00609"></a>00609   <span class="keywordflow">return</span> $self-&gt;formula($x) <span class="keywordflow">if</span> <a class="code" href="classValue.html#afa346ffc3c989970326e02766a63523a">Value::isFormula</a>($x-&gt;[0]) || <a class="code" href="classValue.html#afa346ffc3c989970326e02766a63523a">Value::isFormula</a>($x-&gt;[1]);
<a name="l00610"></a>00610   <a class="code" href="classValue.html#a26f0e9926e446d67e29db24fd4300279">Value::Error</a>(<span class="stringliteral">&quot;Fraction numerators must be integers&quot;</span>) unless isInteger($x-&gt;[0]);
<a name="l00611"></a>00611   <a class="code" href="classValue.html">Value</a>::Error(&quot;Fraction denominators must be integers&quot;) unless isInteger($x-&gt;[1]);
<a name="l00612"></a>00612   my ($a,$b) = ($x-&gt;[0]-&gt;value,$x-&gt;[1]-&gt;value); ($a,$b) = (-$a,-$b) if $b &lt; 0;
<a name="l00613"></a>00613   <a class="code" href="classValue.html">Value</a>::Error(&quot;Denominator can&#39;t be zero&quot;) if $b == 0;
<a name="l00614"></a>00614   ($a,$b) = <a class="code" href="classcontext.html">context</a>::Fraction::reduce($a,$b) if $context-&gt;flag(&quot;reduceFractions&quot;);
<a name="l00615"></a>00615   bless {data =&gt; [$a,$b], <a class="code" href="classcontext.html">context</a> =&gt; $context}, $class;
<a name="l00616"></a>00616 }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618 <span class="preprocessor">#</span>
<a name="l00619"></a>00619 <span class="preprocessor"></span><span class="preprocessor">#  Produce a real if one of the terms is not an integer</span>
<a name="l00620"></a>00620 <span class="preprocessor"></span><span class="preprocessor">#  otherwise produce a fraction.</span>
<a name="l00621"></a>00621 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00622"></a>00622 <span class="preprocessor"></span>sub make {
<a name="l00623"></a>00623   my $self = shift; my $class = ref($self) || $self;
<a name="l00624"></a>00624   my $context = (<a class="code" href="classValue.html#a2d6d7d0072c75611908bf0a79080e8df">Value::isContext</a>($_[0]) ? shift : $self-&gt;context);
<a name="l00625"></a>00625   push(@_,0) if scalar(@_) == 0; push(@_,1) if scalar(@_) == 1;
<a name="l00626"></a>00626   my ($a,$b) = @_; ($a,$b) = (-$a,-$b) if $b &lt; 0;
<a name="l00627"></a>00627   return $context-&gt;Package(&quot;Real&quot;)-&gt;make($context,$a/$b) unless isInteger($a) &amp;&amp; isInteger($b);
<a name="l00628"></a>00628   ($a,$b) = <a class="code" href="classcontext.html">context</a>::Fraction::reduce($a,$b) if $context-&gt;flag(&quot;reduceFractions&quot;);
<a name="l00629"></a>00629   bless {data =&gt; [$a,$b], <a class="code" href="classcontext.html">context</a> =&gt; $context}, $class;
<a name="l00630"></a>00630 }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632 <span class="preprocessor">#</span>
<a name="l00633"></a>00633 <span class="preprocessor"></span><span class="preprocessor">#  Promote to a fraction, allowing reals to be $x/1 even when</span>
<a name="l00634"></a>00634 <span class="preprocessor"></span><span class="preprocessor">#  not an integer (later $self-&gt;make() will produce a Real in</span>
<a name="l00635"></a>00635 <span class="preprocessor"></span><span class="preprocessor">#  that case)</span>
<a name="l00636"></a>00636 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00637"></a>00637 <span class="preprocessor"></span>sub promote {
<a name="l00638"></a>00638   my $self = shift; my $class = ref($self) || $self;
<a name="l00639"></a>00639   my $context = (<a class="code" href="classValue.html#a2d6d7d0072c75611908bf0a79080e8df">Value::isContext</a>($_[0]) ? shift : $self-&gt;context);
<a name="l00640"></a>00640   my $x = (scalar(@_) ? shift : $self);
<a name="l00641"></a>00641   <span class="keywordflow">if</span> (scalar(@_) == 0) {
<a name="l00642"></a>00642     <span class="keywordflow">return</span> $x-&gt;inContext($context) <span class="keywordflow">if</span> ref($x) eq $class;
<a name="l00643"></a>00643     return (bless {data =&gt; [$x-&gt;value,1], <a class="code" href="classcontext.html">context</a> =&gt; $context}, $class) <span class="keywordflow">if</span> <a class="code" href="classValue.html#a5dc063f052a2338b5dac72016bf024b1">Value::isReal</a>($x);
<a name="l00644"></a>00644     <span class="keywordflow">return</span> (bless {data =&gt; [$x,1], <a class="code" href="classcontext.html">context</a> =&gt; $context}, $class) <span class="keywordflow">if</span> <a class="code" href="classValue.html#a6e27e345d159fc9e3fcc8d2ac6b56dee">Value::matchNumber</a>($x);
<a name="l00645"></a>00645   }
<a name="l00646"></a>00646   <span class="keywordflow">return</span> $self-&gt;new($context,$x,@_);
<a name="l00647"></a>00647 }
<a name="l00648"></a>00648 
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 <span class="preprocessor">#</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span><span class="preprocessor">#  Create a new formula from the number</span>
<a name="l00652"></a>00652 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00653"></a>00653 <span class="preprocessor"></span>sub formula {
<a name="l00654"></a>00654   my $self = shift; my $value = shift;
<a name="l00655"></a>00655   my $formula = $self-&gt;Package(<span class="stringliteral">&quot;Formula&quot;</span>)-&gt;blank($self-&gt;context);
<a name="l00656"></a>00656   my ($l,$r) = <a class="code" href="classValue.html#ab6aa11298bc3cfb02debd81334d076ad">Value::toFormula</a>($formula,@{$value});
<a name="l00657"></a>00657   $formula-&gt;{tree} = $formula-&gt;Item(<span class="stringliteral">&quot;BOP&quot;</span>)-&gt;new($formula,<span class="charliteral">&#39;/&#39;</span>,$l,$r);
<a name="l00658"></a>00658   <span class="keywordflow">return</span> $formula;
<a name="l00659"></a>00659 }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661 <span class="preprocessor">#</span>
<a name="l00662"></a>00662 <span class="preprocessor"></span><span class="preprocessor">#  Return the real number type</span>
<a name="l00663"></a>00663 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00664"></a>00664 <span class="preprocessor"></span>sub typeRef {<span class="keywordflow">return</span> $Value::Type{number}}
<a name="l00665"></a>00665 sub length {2}
<a name="l00666"></a>00666 
<a name="l00667"></a>00667 sub isZero {(shift)-&gt;{data}[0] == 0}
<a name="l00668"></a>00668 sub isOne {(shift)-&gt;eval == 1}
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 #
<a name="l00671"></a>00671 #  Return the real value
<a name="l00672"></a>00672 #
<a name="l00673"></a>00673 sub eval {
<a name="l00674"></a>00674   my $self = shift;
<a name="l00675"></a>00675   my ($a,$b) = $self-&gt;value;
<a name="l00676"></a>00676   <span class="keywordflow">return</span> $a/$b;
<a name="l00677"></a>00677 }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 <span class="preprocessor">#</span>
<a name="l00680"></a>00680 <span class="preprocessor"></span><span class="preprocessor">#  Parts are not Value objects, so don&#39;t transfer</span>
<a name="l00681"></a>00681 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00682"></a>00682 <span class="preprocessor"></span>sub transferFlags {}
<a name="l00683"></a>00683 
<a name="l00684"></a>00684 <span class="preprocessor">#</span>
<a name="l00685"></a>00685 <span class="preprocessor"></span><span class="preprocessor">#  Check if a value is an integer</span>
<a name="l00686"></a>00686 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00687"></a>00687 <span class="preprocessor"></span>sub isInteger {
<a name="l00688"></a>00688   my $n = shift;
<a name="l00689"></a>00689   $n = $n-&gt;value <span class="keywordflow">if</span> <a class="code" href="classValue.html#a5dc063f052a2338b5dac72016bf024b1">Value::isReal</a>($n);
<a name="l00690"></a>00690   <span class="keywordflow">return</span> $n =~ m/^-?\d+$/;
<a name="l00691"></a>00691 };
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 <span class="preprocessor">#</span>
<a name="l00694"></a>00694 <span class="preprocessor"></span><span class="preprocessor">#  Get a flag that has been renamed</span>
<a name="l00695"></a>00695 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00696"></a>00696 <span class="preprocessor"></span>sub getFlagWithAlias {
<a name="l00697"></a>00697   my $self = shift; my $flag = shift; my $alias = shift;
<a name="l00698"></a>00698   <span class="keywordflow">return</span> $self-&gt;getFlag($alias,$self-&gt;getFlag($flag));
<a name="l00699"></a>00699 }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 
<a name="l00702"></a>00702 <span class="preprocessor">##################################################</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00704"></a>00704 <span class="preprocessor"></span><span class="preprocessor">#  Binary operations</span>
<a name="l00705"></a>00705 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00706"></a>00706 <span class="preprocessor"></span>
<a name="l00707"></a>00707 sub add {
<a name="l00708"></a>00708   my ($self,$l,$r,$other) = <a class="code" href="classValue.html#a3d59dfdd1b3de5574c3745ca282d76b5">Value::checkOpOrderWithPromote</a>(@_);
<a name="l00709"></a>00709   my (($a,$b),($c,$d)) = ($l-&gt;value,$r-&gt;value);
<a name="l00710"></a>00710   my $M = <a class="code" href="classcontext_1_1Fraction.html#a11f07e0dcf7163b3d57e9cfa08e36fed">context::Fraction::lcm</a>($b,$d);
<a name="l00711"></a>00711   <span class="keywordflow">return</span> $self-&gt;inherit($other)-&gt;make($a*($M/$b)+$c*($M/$d),$M);
<a name="l00712"></a>00712 }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714 sub sub {
<a name="l00715"></a>00715   my ($self,$l,$r,$other) = <a class="code" href="classValue.html#a3d59dfdd1b3de5574c3745ca282d76b5">Value::checkOpOrderWithPromote</a>(@_);
<a name="l00716"></a>00716   my (($a,$b),($c,$d)) = ($l-&gt;value,$r-&gt;value);
<a name="l00717"></a>00717   my $M = <a class="code" href="classcontext_1_1Fraction.html#a11f07e0dcf7163b3d57e9cfa08e36fed">context::Fraction::lcm</a>($b,$d);
<a name="l00718"></a>00718   <span class="keywordflow">return</span> $self-&gt;inherit($other)-&gt;make($a*($M/$b)-$c*($M/$d),$M);
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 sub mult {
<a name="l00722"></a>00722   my ($self,$l,$r,$other) = <a class="code" href="classValue.html#a3d59dfdd1b3de5574c3745ca282d76b5">Value::checkOpOrderWithPromote</a>(@_);
<a name="l00723"></a>00723   my (($a,$b),($c,$d)) = ($l-&gt;value,$r-&gt;value);
<a name="l00724"></a>00724   <span class="keywordflow">return</span> $self-&gt;inherit($other)-&gt;make($a*$c,$b*$d);
<a name="l00725"></a>00725 }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727 sub div {
<a name="l00728"></a>00728   my ($self,$l,$r,$other) = <a class="code" href="classValue.html#a3d59dfdd1b3de5574c3745ca282d76b5">Value::checkOpOrderWithPromote</a>(@_);
<a name="l00729"></a>00729   my (($a,$b),($c,$d)) = ($l-&gt;value,$r-&gt;value);
<a name="l00730"></a>00730   <a class="code" href="classValue.html#a26f0e9926e446d67e29db24fd4300279">Value::Error</a>(<span class="stringliteral">&quot;Division by zero&quot;</span>) if $c == 0;
<a name="l00731"></a>00731   return $self-&gt;inherit($other)-&gt;make($a*$d,$b*$c);
<a name="l00732"></a>00732 }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734 sub power {
<a name="l00735"></a>00735   my ($self,$l,$r,$other) = <a class="code" href="classValue.html#a3d59dfdd1b3de5574c3745ca282d76b5">Value::checkOpOrderWithPromote</a>(@_);
<a name="l00736"></a>00736   my (($a,$b),($c,$d)) = ($l-&gt;value,$r-&gt;reduce-&gt;value);
<a name="l00737"></a>00737   ($a,$b,$c) = ($b,$a,-$c) <span class="keywordflow">if</span> $c &lt; 0;
<a name="l00738"></a>00738   my ($x,$y) = ($c == 1 ? ($a,$b) : ($a**$c,$b**$c));
<a name="l00739"></a>00739   <span class="keywordflow">if</span> ($d != 1) {
<a name="l00740"></a>00740     <span class="keywordflow">if</span> ($x &lt; 0 &amp;&amp; $d % 2 == 1) {$x = -(-$x)**(1/$d)} <span class="keywordflow">else</span> {$x = $x**(1/$d)};
<a name="l00741"></a>00741     <span class="keywordflow">if</span> ($y &lt; 0 &amp;&amp; $d % 2 == 1) {$y = -(-$y)**(1/$d)} <span class="keywordflow">else</span> {$y = $y**(1/$d)};
<a name="l00742"></a>00742   }
<a name="l00743"></a>00743   <span class="keywordflow">return</span> $self-&gt;inherit($other)-&gt;make($x,$y) unless $x eq <span class="stringliteral">&#39;nan&#39;</span> || $y eq <span class="stringliteral">&#39;nan&#39;</span>;
<a name="l00744"></a>00744   <a class="code" href="classValue.html#a26f0e9926e446d67e29db24fd4300279">Value::Error</a>(<span class="stringliteral">&quot;Can&#39;t raise a negative number to a non-integer power&quot;</span>) if $a*$b &lt; 0;
<a name="l00745"></a>00745   <a class="code" href="classValue.html">Value</a>::<a class="code" href="classValue.html#a26f0e9926e446d67e29db24fd4300279">Error</a>(&quot;Result of exponention is not a number&quot;);
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 <a class="code" href="classValue.html#a39a759e158fb6b2e1403676331abb04a">sub</a> <a class="code" href="classValue.html#add776dc9ad03fee29f2d18415f08544c">compare</a> {
<a name="l00749"></a>00749   my ($self,$l,$r) = <a class="code" href="classValue.html#a3d59dfdd1b3de5574c3745ca282d76b5">Value::checkOpOrderWithPromote</a>(@_);
<a name="l00750"></a>00750   <span class="keywordflow">return</span> $l-&gt;eval &lt;=&gt; $r-&gt;eval;
<a name="l00751"></a>00751 }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753 <span class="preprocessor">##################################################</span>
<a name="l00754"></a>00754 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00755"></a>00755 <span class="preprocessor"></span><span class="preprocessor">#   Numeric functions</span>
<a name="l00756"></a>00756 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00757"></a>00757 <span class="preprocessor"></span>
<a name="l00758"></a>00758 sub abs  {my $self = shift; $self-&gt;make(CORE::abs($self-&gt;{data}[0]),CORE::abs($self-&gt;{data}[1]))}
<a name="l00759"></a>00759 sub neg  {my $self = shift; $self-&gt;make(-($self-&gt;{data}[0]),$self-&gt;{data}[1])}
<a name="l00760"></a>00760 sub exp  {my $self = shift; $self-&gt;make(CORE::exp($self-&gt;eval))}
<a name="l00761"></a>00761 sub log  {my $self = shift; $self-&gt;make(CORE::log($self-&gt;eval))}
<a name="l00762"></a>00762 sub sqrt {my $self = shift; $self-&gt;make(CORE::sqrt($self-&gt;{data}[0]),CORE::sqrt($self-&gt;{data}[1]))}
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 <span class="preprocessor">##################################################</span>
<a name="l00765"></a>00765 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00766"></a>00766 <span class="preprocessor"></span><span class="preprocessor">#   Trig functions</span>
<a name="l00767"></a>00767 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00768"></a>00768 <span class="preprocessor"></span>
<a name="l00769"></a>00769 sub sin {my $self = shift; $self-&gt;make(CORE::sin($self-&gt;eval))}
<a name="l00770"></a>00770 sub cos {my $self = shift; $self-&gt;make(CORE::cos($self-&gt;eval))}
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 sub atan2 {
<a name="l00773"></a>00773   my ($self,$l,$r,$other) = <a class="code" href="classValue.html#a3d59dfdd1b3de5574c3745ca282d76b5">Value::checkOpOrderWithPromote</a>(@_);
<a name="l00774"></a>00774   <span class="keywordflow">return</span> $self-&gt;inherit($other)-&gt;make(CORE::atan2($l-&gt;eval,$r-&gt;eval));
<a name="l00775"></a>00775 }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 <span class="preprocessor">##################################################</span>
<a name="l00778"></a>00778 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00779"></a>00779 <span class="preprocessor"></span><span class="preprocessor">#  Utility</span>
<a name="l00780"></a>00780 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00781"></a>00781 <span class="preprocessor"></span>
<a name="l00782"></a>00782 sub reduce {
<a name="l00783"></a>00783   my $self = shift;
<a name="l00784"></a>00784   my ($a,$b) = <a class="code" href="classcontext_1_1Fraction.html#a6d3fed61144055fedac17c6ac196b918">context::Fraction::reduce</a>($self-&gt;value);
<a name="l00785"></a>00785   <span class="keywordflow">return</span> $self-&gt;make($a,$b);
<a name="l00786"></a>00786 }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 sub isReduced {
<a name="l00789"></a>00789   my $self = shift;
<a name="l00790"></a>00790   my (($a,$b),($c,$d)) = ($self-&gt;value,$self-&gt;reduce-&gt;value);
<a name="l00791"></a>00791   <span class="keywordflow">return</span> $a == $c &amp;&amp; $b == $d;
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 <span class="preprocessor">##################################################</span>
<a name="l00795"></a>00795 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00796"></a>00796 <span class="preprocessor"></span><span class="preprocessor">#  Formatting</span>
<a name="l00797"></a>00797 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00798"></a>00798 <span class="preprocessor"></span>
<a name="l00799"></a>00799 sub <span class="keywordtype">string</span> {
<a name="l00800"></a>00800   my $self = shift; my $equation = shift; my $prec = shift;
<a name="l00801"></a>00801   my ($a,$b) = @{$self-&gt;{data}}; my $n = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00802"></a>00802   <span class="keywordflow">return</span> $a <span class="keywordflow">if</span> $b == 1;
<a name="l00803"></a>00803   <span class="keywordflow">if</span> ($self-&gt;getFlagWithAlias(<span class="stringliteral">&quot;showMixedNumbers&quot;</span>,<span class="stringliteral">&quot;showProperFractions&quot;</span>) &amp;&amp; CORE::abs($a) &gt; $b)
<a name="l00804"></a>00804     {$n = int($a/$b); $a = CORE::abs($a) % $b; $n .= <span class="stringliteral">&quot; &quot;</span> unless $a == 0}
<a name="l00805"></a>00805   $n .= <span class="stringliteral">&quot;$a/$b&quot;</span> unless $a == 0 &amp;&amp; $n ne <span class="stringliteral">&#39;&#39;</span>;
<a name="l00806"></a>00806   $n = <span class="stringliteral">&quot;($n)&quot;</span> <span class="keywordflow">if</span> defined $prec &amp;&amp; $prec &gt;= 1;
<a name="l00807"></a>00807   <span class="keywordflow">return</span> $n;
<a name="l00808"></a>00808 }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 sub TeX {
<a name="l00811"></a>00811   my $self = shift; my $equation = shift; my $prec = shift;
<a name="l00812"></a>00812   my ($a,$b) = @{$self-&gt;{data}}; my $n = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00813"></a>00813   <span class="keywordflow">return</span> $a <span class="keywordflow">if</span> $b == 1;
<a name="l00814"></a>00814   <span class="keywordflow">if</span> ($self-&gt;getFlagWithAlias(<span class="stringliteral">&quot;showMixedNumbers&quot;</span>,<span class="stringliteral">&quot;showProperFractions&quot;</span>) &amp;&amp; CORE::abs($a) &gt; $b)
<a name="l00815"></a>00815     {$n = int($a/$b); $a = CORE::abs($a) % $b; $n .= <span class="stringliteral">&quot; &quot;</span> unless $a == 0}
<a name="l00816"></a>00816   my $s = <span class="stringliteral">&quot;&quot;</span>; ($a,$s) = (-$a,<span class="stringliteral">&quot;-&quot;</span>) <span class="keywordflow">if</span> $a &lt; 0;
<a name="l00817"></a>00817   $n .= ($self-&gt;{isHorizontal} ? <span class="stringliteral">&quot;$s$a/$b&quot;</span> : <span class="stringliteral">&quot;${s}{\\textstyle\\frac{$a}{$b}}&quot;</span>)
<a name="l00818"></a>00818     unless $a == 0 &amp;&amp; $n ne <span class="stringliteral">&#39;&#39;</span>;
<a name="l00819"></a>00819   $n = <span class="stringliteral">&quot;\\left($n\\right)&quot;</span> <span class="keywordflow">if</span> defined $prec &amp;&amp; $prec &gt;= 1;
<a name="l00820"></a>00820   <span class="keywordflow">return</span> $n;
<a name="l00821"></a>00821 }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 sub pdot {
<a name="l00824"></a>00824   my $self = shift; my $n = $self-&gt;string;
<a name="l00825"></a>00825   $n = <span class="charliteral">&#39;(&#39;</span>.$n.<span class="charliteral">&#39;)&#39;</span> <span class="keywordflow">if</span> $n =~ m![^0-9]!;  #  add parens <span class="keywordflow">if</span> not just a number
<a name="l00826"></a>00826   <span class="keywordflow">return</span> $n;
<a name="l00827"></a>00827 }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 <span class="preprocessor">###########################################################################</span>
<a name="l00830"></a>00830 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00831"></a>00831 <span class="preprocessor"></span><span class="preprocessor">#  Answer Checker</span>
<a name="l00832"></a>00832 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00833"></a>00833 <span class="preprocessor"></span>
<a name="l00834"></a>00834 sub cmp_defaults {(
<a name="l00835"></a>00835   shift-&gt;SUPER::cmp_defaults(@_),
<a name="l00836"></a>00836   ignoreInfinity =&gt; 1,
<a name="l00837"></a>00837   studentsMustReduceFractions =&gt; 0,
<a name="l00838"></a>00838   showFractionReduceWarnings =&gt; 1,
<a name="l00839"></a>00839   requireFraction =&gt; 0,
<a name="l00840"></a>00840 )}
<a name="l00841"></a>00841 
<a name="l00842"></a>00842 sub cmp_contextFlags {
<a name="l00843"></a>00843   my $self = shift; my $ans = shift;
<a name="l00844"></a>00844   <span class="keywordflow">return</span> (
<a name="l00845"></a>00845     $self-&gt;SUPER::cmp_contextFlags($ans),
<a name="l00846"></a>00846     reduceFractions =&gt; !$ans-&gt;{studentsMustReduceFractions},
<a name="l00847"></a>00847   );
<a name="l00848"></a>00848 }
<a name="l00849"></a>00849 
<a name="l00850"></a>00850 sub cmp_class {<span class="stringliteral">&quot;a fraction of integers&quot;</span>}
<a name="l00851"></a>00851 
<a name="l00852"></a>00852 sub typeMatch {
<a name="l00853"></a>00853   my $self = shift; my $other = shift; my $ans = shift;
<a name="l00854"></a>00854   <span class="keywordflow">return</span> 1 unless ref($other);
<a name="l00855"></a>00855   <span class="keywordflow">return</span> 0 <span class="keywordflow">if</span> <a class="code" href="classValue.html#afa346ffc3c989970326e02766a63523a">Value::isFormula</a>($other);
<a name="l00856"></a>00856   <span class="keywordflow">return</span> 1 <span class="keywordflow">if</span> $other-&gt;type eq <span class="stringliteral">&#39;Infinity&#39;</span> &amp;&amp; $ans-&gt;{ignoreInfinity};
<a name="l00857"></a>00857   <span class="keywordflow">return</span> 0 <span class="keywordflow">if</span> $ans-&gt;{requireFraction} &amp;&amp; !$other-&gt;classMatch(<span class="stringliteral">&quot;Fraction&quot;</span>);
<a name="l00858"></a>00858   $self-&gt;type eq $other-&gt;type;
<a name="l00859"></a>00859 }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 sub cmp_postprocess {
<a name="l00862"></a>00862   my $self = shift; my $ans = shift;
<a name="l00863"></a>00863   my $student = $ans-&gt;{student_value};
<a name="l00864"></a>00864   <span class="keywordflow">return</span> <span class="keywordflow">if</span> $ans-&gt;{isPreview} ||
<a name="l00865"></a>00865             !$ans-&gt;{studentsMustReduceFractions} ||
<a name="l00866"></a>00866         !<a class="code" href="classValue.html#a3518cd4f61c793378c1a59f4ddc67226">Value::classMatch</a>($student,<span class="stringliteral">&#39;Fraction&#39;</span>) ||
<a name="l00867"></a>00867         $student-&gt;isReduced;
<a name="l00868"></a>00868   $ans-&gt;score(0);
<a name="l00869"></a>00869   $self-&gt;cmp_Error($ans,<span class="stringliteral">&quot;Your fraction is not reduced&quot;</span>) <span class="keywordflow">if</span> $ans-&gt;{showFractionReduceWarnings};
<a name="l00870"></a>00870 }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872 <span class="preprocessor">###########################################################################</span>
<a name="l00873"></a>00873 <span class="preprocessor"></span>
<a name="l00874"></a>00874 1;
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:54:54 2012 for PG by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
