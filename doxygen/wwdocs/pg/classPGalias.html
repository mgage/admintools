<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PG: PGalias Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>PGalias Class Reference</h1><!-- doxytag: class="PGalias" -->
<p><a href="classPGalias-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Avaliable Methods</h2></td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrp9be22fb8347fa3884856571d2a5f020b"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#abd2c663386273cea7447e3277f19709f">alias_for_gif_in_html_mode</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#ae0c0ed594d83c258932ddcafab8acf01">alias_for_gif_in_tex_mode</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#a9726370fecbdaa8291e2221d55d1f732">make_alias</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#a082e2067f46ca5300f11384ce99a2f20">add_resource</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#add2a5c271e9aa62a2a5c0956787ee33f">findMacroFile</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#a579233f6f4cef98896267bdf3f8e4514">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#a2043c9543bc2cec279eb73d6adcadb17">alias_for_png_in_tex_mode</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#a8a1977779bf8ed55e3284426783e034f">check_parameters</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#aac93aa1548b4ef064e8971b411dd00ff">alias_for_html</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#abf78a0e9619e8fc1be826a527b5be2a6">findAppletCodebase</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#a57e608ca16b4a2cb716f5ba115837f6a">alias_for_png_in_html_mode</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#a08e64de8324961599183ce129ea01d84">new</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#a53030db600b5522d9e6098569e3f74f2">check_url</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public method&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classPGalias.html#a9ff94b22df43e2fd830d67bae33a137d">get_resource</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p># new # Create one alias object per question (and per <a class="el" href="classPGcore.html">PGcore</a> object) # Check that information is intact # Construct unique id stub seeds -- the id stub seed is for this <a class="el" href="classPGalias.html">PGalias</a> object which is # attached to all the resource files (except equations) for this question. # Keep list of external links </p>

<p>Definition at line <a class="el" href="PGalias_8pm_source.html#l00122">122</a> of file <a class="el" href="PGalias_8pm_source.html">PGalias.pm</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a082e2067f46ca5300f11384ce99a2f20"></a><!-- doxytag: member="PGalias::add_resource" ref="a082e2067f46ca5300f11384ce99a2f20" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::add_resource </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-add_resource' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-add_resource-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-add_resource-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-add_resource-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in add_resource: 9</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#a082e2067f46ca5300f11384ce99a2f20">add_resource</a> {
    my $self = shift;
    my ($aux_file_id,$resource) =@_;
    <span class="keywordflow">if</span> ( ref($resource) =~/<a class="code" href="classPGresource.html">PGresource</a>/ ) {
        $self-&gt;{resource_list}-&gt;{$aux_file_id} = $resource;
    } <span class="keywordflow">else</span> {
        $self-&gt;warning_message(<span class="stringliteral">&quot;$aux_file_id does not refer to a a valid resource $resource&quot;</span>);
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="abd2c663386273cea7447e3277f19709f"></a><!-- doxytag: member="PGalias::alias_for_gif_in_html_mode" ref="abd2c663386273cea7447e3277f19709f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::alias_for_gif_in_html_mode </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-alias_for_gif_in_html_mode' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-alias_for_gif_in_html_mode-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-alias_for_gif_in_html_mode-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-alias_for_gif_in_html_mode-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in alias_for_gif_in_html_mode: 89</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#abd2c663386273cea7447e3277f19709f">alias_for_gif_in_html_mode</a> {
    my $self = shift;
    my $aux_file_id = shift;
<span class="preprocessor">#    warn &quot;entering alias_for_gif_in_html_mode $aux_file_id&quot;;</span>
<span class="preprocessor"></span>    
    my $envir               = $self-&gt;{envir};   
    my $fileName            = $self-&gt;{fileName};
    my $htmlDirectory       = $envir-&gt;{htmlDirectory};
    my $htmlURL             = $envir-&gt;{htmlURL};
    my $tempDirectory       = $envir-&gt;{tempDirectory};
    my $tempURL             = $envir-&gt;{tempURL};
    my $studentLogin        = $envir-&gt;{studentLogin};
    my $psvn          = $envir-&gt;{psvn};
    my $setNumber           = $envir-&gt;{setNumber};
    my $probNum             = $envir-&gt;{probNum};
    my $displayMode         = $envir-&gt;{displayMode};
    my $externalGif2EpsPath = $envir-&gt;{externalGif2EpsPath};
    my $externalPng2EpsPath = $envir-&gt;{externalPng2EpsPath};
    
    my $templateDirectory   = $self-&gt;{templateDirectory};
    
    
<span class="preprocessor">    # $adr_output is a url in HTML and Latex2HTML modes</span>
<span class="preprocessor"></span><span class="preprocessor">    # and a complete path in TEX mode.</span>
<span class="preprocessor"></span>    my $adr_output;
    my $ext                 = <span class="stringliteral">&quot;gif&quot;</span>;
    
<span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">            # .gif FILES in HTML, HTML_tth, HTML_dpng, HTML_img, and Latex2HTML modes</span>
<span class="preprocessor"></span><span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span>
<span class="preprocessor">            #warn &quot;tempDirectory is $tempDirectory&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">            #warn &quot;file Path for auxiliary file is $aux_file_id&quot;;</span>
<span class="preprocessor"></span>
<span class="preprocessor">            # No changes are made for auxiliary files in the htmlDirectory or in the tempDirectory subtree.</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> ( $aux_file_id =~ m|^$tempDirectory| ) {
                $adr_output = $aux_file_id;
                $adr_output =~ s|$tempDirectory|$tempURL|;
                $adr_output .= <span class="stringliteral">&quot;.$ext&quot;</span>;
<span class="preprocessor">                #warn &quot;adress out is $adr_output&quot;,</span>
<span class="preprocessor"></span>            } elsif ($aux_file_id =~ m|^$htmlDirectory| ) {
                $adr_output = $aux_file_id;
                $adr_output =~ s|$htmlDirectory|$htmlURL|;
                $adr_output .= <span class="stringliteral">&quot;.$ext&quot;</span>;
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # files not in the htmlDirectory sub tree are assumed to live under the templateDirectory</span>
<span class="preprocessor"></span><span class="preprocessor">                # subtree in the same directory as the problem.</span>
<span class="preprocessor"></span>
<span class="preprocessor">                # For a gif file the alias macro creates an alias under the html/images directory</span>
<span class="preprocessor"></span><span class="preprocessor">                # which points to the gif file in the problem directory.</span>
<span class="preprocessor"></span><span class="preprocessor">                # All of the subdirectories of html/tmp/gif which are needed are also created.</span>
<span class="preprocessor"></span><span class="preprocessor">          #warn &quot;fileName is $fileName   $self&quot;;</span>
<span class="preprocessor"></span>                my $filePath = ( $self-&gt;directoryFromPath($fileName) );
<span class="preprocessor">          #warn &quot;filePath is $filePath&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">                # $fileName is obtained from environment for PGeval</span>
<span class="preprocessor"></span><span class="preprocessor">                # it gives the full path to the current problem</span>
<span class="preprocessor"></span>                my $gifSourceFile = $self-&gt;convertPath(<span class="stringliteral">&quot;$templateDirectory${filePath}$aux_file_id.gif&quot;</span>);
<span class="preprocessor">                #my $link = &quot;gif/$studentLogin-$psvn-set$setNumber-prob$probNum-$aux_file_id.$ext&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">           #warn &quot;fileName is $fileName filePath is $filePath gifSourceFile is $gifSourceFile&quot;;</span>
<span class="preprocessor"></span>
<span class="preprocessor">                #  Make file names work in Library Browser when the images in several</span>
<span class="preprocessor"></span><span class="preprocessor">                #  files have the same names.</span>
<span class="preprocessor"></span>                my $libFix = <span class="stringliteral">&quot;&quot;</span>;
                <span class="keywordflow">if</span> ($setNumber eq <span class="stringliteral">&quot;Undefined_Set&quot;</span>) {
                  $libFix = $fileName;
                  $libFix =~ s!.*/!!, $libFix =~ s!\.pg(\..*)?$!!;
                  $libFix =~ s![^a-zA-Z0-9._-]!!g;
                  $libFix .= <span class="charliteral">&#39;-&#39;</span>;
                }

<span class="preprocessor">                # my $link = &quot;gif/$setNumber-prob$probNum-$libFix$aux_file_id.$ext&quot;;</span>
<span class="preprocessor"></span>                my $uniqIDstub = $self-&gt;{uniqIDstub};
                my $link = <span class="stringliteral">&quot;gif/${uniqIDstub}-$aux_file_id.$ext&quot;</span>;
                my $linkPath = $self-&gt;surePathToTmpFile($link);
                $adr_output = <span class="stringliteral">&quot;${tempURL}$link&quot;</span>;
<span class="preprocessor">                #warn &quot;linkPath is $linkPath&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">                #warn &quot;adr_output is $adr_output&quot;;</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> (-e $gifSourceFile) {
                    <span class="keywordflow">if</span> (-e $linkPath) {
                        unlink($linkPath) || warn <span class="stringliteral">&quot;Unable to unlink old alias file at $linkPath&quot;</span>;
                    }
                    symlink($gifSourceFile, $linkPath)
                        || warn <span class="stringliteral">&quot;The macro alias cannot create a link from |$linkPath|  to |$gifSourceFile| &lt;BR&gt;&quot;</span> ;
                } <span class="keywordflow">else</span> {
                    warn(<span class="stringliteral">&quot;The macro alias cannot find a GIF file at: |$gifSourceFile|&quot;</span>);
                }
            }
        $adr_output;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="ae0c0ed594d83c258932ddcafab8acf01"></a><!-- doxytag: member="PGalias::alias_for_gif_in_tex_mode" ref="ae0c0ed594d83c258932ddcafab8acf01" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::alias_for_gif_in_tex_mode </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-alias_for_gif_in_tex_mode' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-alias_for_gif_in_tex_mode-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-alias_for_gif_in_tex_mode-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-alias_for_gif_in_tex_mode-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in alias_for_gif_in_tex_mode: 103</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#ae0c0ed594d83c258932ddcafab8acf01">alias_for_gif_in_tex_mode</a> {
    my $self = shift;
    my $aux_file_id = shift;

    my $envir               = $self-&gt;{envir};   my $fileName            = $envir-&gt;{fileName};
    my $htmlDirectory       = $envir-&gt;{htmlDirectory};
    my $htmlURL             = $envir-&gt;{htmlURL};
    my $tempDirectory       = $envir-&gt;{tempDirectory};
    my $tempURL             = $envir-&gt;{tempURL};
    my $studentLogin        = $envir-&gt;{studentLogin};
    my $psvn          = $envir-&gt;{psvn};
    my $setNumber           = $envir-&gt;{setNumber};
    my $probNum             = $envir-&gt;{probNum};
    my $displayMode         = $envir-&gt;{displayMode};
    my $externalGif2EpsPath = $envir-&gt;{externalGif2EpsPath};
    my $externalPng2EpsPath = $envir-&gt;{externalPng2EpsPath};
    
    my $templateDirectory   = $self-&gt;{templateDirectory};
    
    
<span class="preprocessor">    # $adr_output is a url in HTML and Latex2HTML modes</span>
<span class="preprocessor"></span><span class="preprocessor">    # and a complete path in TEX mode.</span>
<span class="preprocessor"></span>    my $adr_output;
    my $ext                 = <span class="stringliteral">&quot;gif&quot;</span>;
<span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">            # .gif FILES in TeX mode</span>
<span class="preprocessor"></span><span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span>
                $setNumber =~ s/\./_/g;  ## extra dots confuse latex<span class="stringliteral">&#39;s graphics package</span>
<span class="stringliteral">            if ($envir-&gt;{texDisposition} eq &quot;pdf&quot;) {</span>
<span class="stringliteral">                # We&#39;</span>re going to create PDF files with our TeX (<span class="keyword">using</span> pdflatex); so we
<span class="preprocessor">                # need images in PNG format.</span>
<span class="preprocessor"></span>
                my $gifFilePath;

                <span class="keywordflow">if</span> ($aux_file_id =~ m/^$htmlDirectory/ or $aux_file_id =~ m/^$tempDirectory/) {
<span class="preprocessor">                    # we&#39;ve got a full pathname to a file</span>
<span class="preprocessor"></span>                    $gifFilePath = <span class="stringliteral">&quot;$aux_file_id.gif&quot;</span>;
                } <span class="keywordflow">else</span> {
<span class="preprocessor">                    # we assume the file is in the same directory as the problem source file</span>
<span class="preprocessor"></span>                    my $dir = $self-&gt;directoryFromPath($fileName);
                    $gifFilePath = <span class="stringliteral">&quot;$templateDirectory${dir}$aux_file_id.gif&quot;</span>;
                }

                my $gifFileName = $self-&gt;fileFromPath($gifFilePath);
                $gifFileName =~ /^(.*)\.gif$/;
                    my $pngFilePath = $self-&gt;surePathToTmpFile(<span class="stringliteral">&quot;${tempDirectory}png/$setNumber-$probNum-$1.png&quot;</span>);
                my $command = $envir-&gt;{externalGif2PngPath};
                my $returnCode = system <span class="stringliteral">&quot;cat $gifFilePath | $command &gt; $pngFilePath&quot;</span>;
<span class="preprocessor">            #warn &quot;FILE path $pngFilePath  exists =&quot;, -e $pngFilePath;</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> ($returnCode or not -e $pngFilePath) {
                    warn <span class="stringliteral">&quot;returnCode $returnCode: failed to convert $gifFilePath to $pngFilePath using gif-&gt;png with $command: $!&quot;</span>;
                }

                $adr_output = $pngFilePath;
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # Since we&#39;re not creating PDF files; we&#39;re probably just using a plain</span>
<span class="preprocessor"></span><span class="preprocessor">                # vanilla latex. Hence; we need EPS images.</span>
<span class="preprocessor"></span>
<span class="preprocessor">                ################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">                # This is statement used below is system dependent.</span>
<span class="preprocessor"></span><span class="preprocessor">                # Notice that the range of colors is restricted when converting to postscript to keep the files small</span>
<span class="preprocessor"></span><span class="preprocessor">                # &quot;cat $gifSourceFile  | /usr/math/bin/giftopnm | /usr/math/bin/pnmtops -noturn &gt; $adr_output&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">                # &quot;cat $gifSourceFile  | /usr/math/bin/giftopnm | /usr/math/bin/pnmdepth 1 | /usr/math/bin/pnmtops -noturn &gt; $adr_output&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">                ################################################################################</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> ($aux_file_id =~  m|^$htmlDirectory|  or $aux_file_id =~  m|^$tempDirectory|)  {
<span class="preprocessor">                    # To serve an eps file copy an eps version of the gif file to the subdirectory of eps/</span>
<span class="preprocessor"></span>                    my $linkPath = $self-&gt;directoryFromPath($fileName);

                    my $gifSourceFile = <span class="stringliteral">&quot;$aux_file_id.gif&quot;</span>;
                    my $gifFileName = $self-&gt;fileFromPath($gifSourceFile);
                    $adr_output = $self-&gt;surePathToTmpFile(<span class="stringliteral">&quot;$tempDirectory/eps/$studentLogin-$psvn-$gifFileName.eps&quot;</span>) ;

                    <span class="keywordflow">if</span> (-e $gifSourceFile) {
<span class="preprocessor">                        #system(&quot;cat $gifSourceFile  | /usr/math/bin/giftopnm | /usr/math/bin/pnmdepth 1 | /usr/math/bin/pnmtops -noturn&gt;$adr_output&quot;)</span>
<span class="preprocessor"></span>                        system(<span class="stringliteral">&quot;cat $gifSourceFile | ${externalGif2EpsPath} &gt; $adr_output&quot;</span> )
                            &amp;&amp; die <span class="stringliteral">&quot;Unable to create eps file:\n |$adr_output| from file\n |$gifSourceFile|\n in problem $probNum &quot;</span> .
                                   <span class="stringliteral">&quot;using the system dependent script\n |${externalGif2EpsPath}| \n&quot;</span>;
                    } <span class="keywordflow">else</span> {
                        die <span class="stringliteral">&quot;|$gifSourceFile| cannot be found.  Problem number: |$probNum|&quot;</span>;
                    }
                } <span class="keywordflow">else</span> {
<span class="preprocessor">                    # To serve an eps file copy an eps version of the gif file to  a subdirectory of eps/</span>
<span class="preprocessor"></span>                    my $filePath = $self-&gt;directoryFromPath($fileName);
                    my $gifSourceFile = <span class="stringliteral">&quot;${templateDirectory}${filePath}$aux_file_id.gif&quot;</span>;
<span class="preprocessor">                    #print &quot;content-type: text/plain \n\nfileName = $fileName and aux_file_id =$aux_file_id&lt;BR&gt;&quot;;</span>
<span class="preprocessor"></span>                    $adr_output = $self-&gt;surePathToTmpFile(<span class="stringliteral">&quot;eps/$studentLogin-$psvn-set$setNumber-prob$probNum-$aux_file_id.eps&quot;</span>);

                    <span class="keywordflow">if</span> (-e $gifSourceFile) {
<span class="preprocessor">                        #system(&quot;cat $gifSourceFile  | /usr/math/bin/giftopnm | /usr/math/bin/pnmdepth 1 | /usr/math/bin/pnmtops -noturn&gt;$adr_output&quot;) &amp;&amp;</span>
<span class="preprocessor"></span><span class="preprocessor">                        #warn &quot;Unable to create eps file: |$adr_output|\n from file\n |$gifSourceFile|\n in problem $probNum&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">                        #warn &quot;Help ${:externalGif2EpsPath}&quot; unless -x &quot;${main::externalGif2EpsPath}&quot;;</span>
<span class="preprocessor"></span>                        system(<span class="stringliteral">&quot;cat $gifSourceFile | ${externalGif2EpsPath} &gt; $adr_output&quot;</span> )
                            &amp;&amp; die <span class="stringliteral">&quot;Unable to create eps file:\n |$adr_output| from file\n |$gifSourceFile|\n in problem $probNum &quot;</span> .
                                   <span class="stringliteral">&quot;using the system dependent commands \n |${externalGif2EpsPath}| \n &quot;</span>;
                    }  <span class="keywordflow">else</span> {
                        die <span class="stringliteral">&quot;|$gifSourceFile| cannot be found.  Problem number: |$probNum|&quot;</span>;
                    }
                }
            }
    $adr_output;

} 
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="aac93aa1548b4ef064e8971b411dd00ff"></a><!-- doxytag: member="PGalias::alias_for_html" ref="aac93aa1548b4ef064e8971b411dd00ff" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::alias_for_html </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-alias_for_html' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-alias_for_html-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-alias_for_html-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-alias_for_html-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in alias_for_html: 131</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#aac93aa1548b4ef064e8971b411dd00ff">alias_for_html</a> {
    my $self = shift;
    my $aux_file_id = shift;
    
<span class="preprocessor">    #######################</span>
<span class="preprocessor"></span><span class="preprocessor">    #   gather needed data  </span>
<span class="preprocessor"></span><span class="preprocessor">    #######################</span>
<span class="preprocessor"></span>    my $envir               = $self-&gt;{envir}; 
    my $fileName            = $self-&gt;{fileName};  #FIXME: <span class="keyword">this</span> is really filePath to <a class="code" href="classWeBWorK_1_1PG.html">PG</a> problem ??rename to filePath
    my $htmlDirectory       = $self-&gt;{htmlDirectory};
    my $htmlURL             = $self-&gt;{htmlURL};
    my $tempDirectory       = $self-&gt;{tempDirectory};
    my $tempURL             = $self-&gt;{tempURL};
    my $studentLogin        = $self-&gt;{studentLogin};
    my $psvn                = $self-&gt;{psvn};
    my $setNumber           = $self-&gt;{setNumber};
    my $probNum             = $self-&gt;{probNum};
    my $displayMode         = $self-&gt;{displayMode};
    my $externalGif2EpsPath = $self-&gt;{externalGif2EpsPath};
    my $externalPng2EpsPath = $self-&gt;{externalPng2EpsPath};     
    my $templateDirectory   = $self-&gt;{templateDirectory};

<span class="preprocessor">    #######################</span>
<span class="preprocessor"></span><span class="preprocessor">    # update resource object</span>
<span class="preprocessor"></span>    my $resource_object = $self-&gt;get_resource($aux_file_id);
<span class="preprocessor">    # $self-&gt;warning_message( &quot;\nresource for $aux_file_id is &quot;, ref($resource_object), $resource_object );</span>
<span class="preprocessor"></span>    $resource_object-&gt;{type}=<span class="stringliteral">&#39;html&#39;</span>;
    $resource_object-&gt;{parent_file}=$fileName;
    
   
<span class="preprocessor">    # $resource_uri is a url in HTML  modes</span>
<span class="preprocessor"></span><span class="preprocessor">    # and a complete path in TEX mode.</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    # Find a complete path to the auxiliary file by searching for it in the appropriate</span>
<span class="preprocessor"></span><span class="preprocessor">    # libraries.  </span>
<span class="preprocessor"></span><span class="preprocessor">    # Store the result in auxiliary_uri</span>
<span class="preprocessor"></span>
<span class="preprocessor">##############################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Find complete path to the original files</span>
<span class="preprocessor"></span><span class="preprocessor">##############################################</span>
<span class="preprocessor"></span>    my ($resource_uri, $htmlFileSource, );
    my $ext   =   <span class="stringliteral">&quot;html&quot;</span>;

<span class="preprocessor"># not yet completely implemented</span>
<span class="preprocessor"></span><span class="preprocessor"># current implementation accepts only the course html directory, the file containing the .pg file </span>
<span class="preprocessor"></span><span class="preprocessor"># and the temp directory as places to look for html files</span>
<span class="preprocessor"></span>
<span class="preprocessor"># No additional action is needed for auxiliary files in the</span>
<span class="preprocessor"></span><span class="preprocessor"># ${Global::htmlDirectory} subtree.</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> ( $aux_file_id =~ m|^$tempDirectory| ) {
        $resource_uri = $aux_file_id,
        $htmlFileSource = $aux_file_id;
        $resource_uri =~ s|$tempDirectory|$tempURL/|,
        $resource_uri .= <span class="stringliteral">&quot;.$ext&quot;</span>,
        $resource_object-&gt;path($htmlFileSource);
        $resource_object-&gt;uri($resource_uri);
        $resource_object-&gt;{copy_link}-&gt;{type} = <span class="stringliteral">&#39;orig&#39;</span>;
        $resource_object-&gt;{path}-&gt;{is_complete}=1;
    } elsif ($aux_file_id =~ m|^$htmlDirectory| ) {
        $resource_uri = $aux_file_id,
        $htmlFileSource = $aux_file_id;
        $resource_uri =~ s|$htmlDirectory|$htmlURL|,
        $resource_uri .= <span class="stringliteral">&quot;.$ext&quot;</span>,
        $resource_object-&gt;path($htmlFileSource);
        $resource_object-&gt;uri($resource_uri);
        $resource_object-&gt;{copy_link}-&gt;{type} = <span class="stringliteral">&#39;orig&#39;</span>;
        $resource_object-&gt;{path}-&gt;{is_complete}=1;
    } <span class="keywordflow">else</span> {
<span class="preprocessor">        # HTML files not in the htmlDirectory are assumed under live under the</span>
<span class="preprocessor"></span><span class="preprocessor">        # templateDirectory in the same directory as the problem.</span>
<span class="preprocessor"></span><span class="preprocessor">        # Create an alias file (link) in the directory html/tmp/html which</span>
<span class="preprocessor"></span><span class="preprocessor">        # points to the original file and return the URL of this alias.</span>
<span class="preprocessor"></span><span class="preprocessor">        # ---  Create all of the subdirectories of html/tmp/html which are needed</span>
<span class="preprocessor"></span><span class="preprocessor">        # --- using sure file to path.  This gives too much information away.</span>
<span class="preprocessor"></span><span class="preprocessor">        # use a uniquID instead.</span>
<span class="preprocessor"></span>    
<span class="preprocessor">        # $fileName is obtained from environment and</span>
<span class="preprocessor"></span><span class="preprocessor">        # is the path to the .pg file</span>
<span class="preprocessor"></span><span class="preprocessor">        # it gives the  relative path to the current PG problem from the template directory</span>
<span class="preprocessor"></span>        my $directoryPath = $self-&gt;directoryFromPath($fileName);
        $htmlFileSource = $self-&gt;convertPath(<span class="stringliteral">&quot;$templateDirectory${directoryPath}$aux_file_id.html&quot;</span>);
        $htmlFileSource = <span class="stringliteral">&quot;$templateDirectory${directoryPath}$aux_file_id.html&quot;</span>;
        $resource_object-&gt;path($htmlFileSource);
        $resource_object-&gt;{copy_link}-&gt;{type} = <span class="stringliteral">&#39;link&#39;</span>;
        $resource_object-&gt;{path}-&gt;{is_complete}=1;
<span class="preprocessor">        # notice the resource uri is not yet defined -- we have to make the link first</span>
<span class="preprocessor"></span>    }

<span class="preprocessor"># Create a unique id which depends on the parent fileName and path to the resource file</span>
<span class="preprocessor"></span><span class="preprocessor"># The uniqueID  also depends on the student, the course name and  the psvn through the uniqeID stub, because </span>
<span class="preprocessor"></span><span class="preprocessor"># if the problem is recreated the specific file linked to might change.</span>
<span class="preprocessor"></span><span class="preprocessor"># You  also want students linked to the same file to NOT be aware of that fact.</span>
<span class="preprocessor"></span>

    my $uniqIDseed = $resource_object-&gt;path() . $resource_object-&gt;{parent_file}.$self-&gt;{psvn};
    $resource_object-&gt;{uniqID} = $self-&gt;{uniqIDstub} .
          <span class="stringliteral">&#39;___&#39;</span>. create_uuid_as_string( UUID_V3, UUID_NS_URL, $uniqIDseed );


<span class="preprocessor">##############################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Create links, between private directories such as myCourse/template</span>
<span class="preprocessor"></span><span class="preprocessor"># and public directories (such as   wwtmp/courseName or myCourse/html</span>
<span class="preprocessor"></span><span class="preprocessor"># The location of the links depends on the type and location of the file</span>
<span class="preprocessor"></span><span class="preprocessor">##############################################</span>
<span class="preprocessor"></span>
    <span class="keywordflow">if</span> ( $resource_object-&gt;{copy_link}-&gt;{type} eq <span class="stringliteral">&#39;link&#39;</span>) {
        my $uniqID = $resource_object-&gt;{uniqID};
        my $link = <span class="stringliteral">&quot;html/$uniqID.$ext&quot;</span>;
        my $resource_uri = <span class="stringliteral">&quot;${tempURL}$link&quot;</span>; #FIXME -- insure that the slash is at the end of $tempURL
        my $linkPath = $self-&gt;surePathToTmpFile($link);
        
        <span class="keywordflow">if</span> (-e $htmlFileSource) {
            <span class="keywordflow">if</span> (-e $linkPath) {
                unlink($linkPath) || warn <span class="stringliteral">&quot;Unable to unlink alias file at |$linkPath|&quot;</span>;
<span class="preprocessor">                # destroy the old link.</span>
<span class="preprocessor"></span>            }
            <span class="keywordflow">if</span> (symlink( $htmlFileSource, $linkPath)) {
                $resource_object-&gt;{path}-&gt;{is_accessible}=1;
                $resource_object-&gt;{copy_link}-&gt;{link_to_path}= $linkPath;
                $resource_object-&gt;uri($resource_uri);
            } <span class="keywordflow">else</span> {
                $self-&gt;warning_message( <span class="stringliteral">&quot;The macro alias cannot create a link from |$linkPath|  to |$htmlFileSource| &lt;BR&gt;&quot;</span>) ;
            }
        } <span class="keywordflow">else</span> {
            $self-&gt;warning_message(<span class="stringliteral">&quot;The macro alias cannot find an HTML file at: |$htmlFileSource|&quot;</span>);
            $resource_object-&gt;{path}-&gt;{is_accessible}=0;
<span class="preprocessor">            # we should delete the resource object in this case?</span>
<span class="preprocessor"></span>        }
        $resource_object-&gt;uri();  # <span class="keywordflow">return</span> the uri of the resource
    }
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a57e608ca16b4a2cb716f5ba115837f6a"></a><!-- doxytag: member="PGalias::alias_for_png_in_html_mode" ref="a57e608ca16b4a2cb716f5ba115837f6a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::alias_for_png_in_html_mode </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-alias_for_png_in_html_mode' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-alias_for_png_in_html_mode-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-alias_for_png_in_html_mode-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-alias_for_png_in_html_mode-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in alias_for_png_in_html_mode: 72</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#a57e608ca16b4a2cb716f5ba115837f6a">alias_for_png_in_html_mode</a> {
    my $self = shift;
    my $aux_file_id = shift;

    my $envir               = $self-&gt;{envir};   my $fileName            = $envir-&gt;{fileName};
    my $htmlDirectory       = $envir-&gt;{htmlDirectory};
    my $htmlURL             = $envir-&gt;{htmlURL};
    my $tempDirectory       = $envir-&gt;{tempDirectory};
    my $tempURL             = $envir-&gt;{tempURL};
    my $studentLogin        = $envir-&gt;{studentLogin};
    my $psvn          = $envir-&gt;{psvn};
    my $setNumber           = $envir-&gt;{setNumber};
    my $probNum             = $envir-&gt;{probNum};
    my $displayMode         = $envir-&gt;{displayMode};
    my $externalGif2EpsPath = $envir-&gt;{externalGif2EpsPath};
    my $externalPng2EpsPath = $envir-&gt;{externalPng2EpsPath};
     
    my $templateDirectory   = $self-&gt;{templateDirectory};
    
   
<span class="preprocessor">    # $adr_output is a url in HTML and Latex2HTML modes</span>
<span class="preprocessor"></span><span class="preprocessor">    # and a complete path in TEX mode.</span>
<span class="preprocessor"></span>    my $adr_output;
    my $ext                 = <span class="stringliteral">&quot;png&quot;</span>;
<span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">            # .png FILES in HTML; HTML_tth; HTML_dpng; HTML_img; etc. and Latex2HTML modes</span>
<span class="preprocessor"></span><span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span>
<span class="preprocessor">            #warn &quot;tempDirectory is $tempDirectory&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">            #warn &quot;file Path for auxiliary file is $aux_file_id&quot;;</span>
<span class="preprocessor"></span>
<span class="preprocessor">            # No changes are made for auxiliary files in the htmlDirectory or in the tempDirectory subtree.</span>
<span class="preprocessor"></span>            <span class="keywordflow">if</span> ( $aux_file_id =~ m|^$tempDirectory| ) {
            $adr_output = $aux_file_id;
                $adr_output =~ s|$tempDirectory|$tempURL|;
                $adr_output .= <span class="stringliteral">&quot;.$ext&quot;</span>;
<span class="preprocessor">                #warn &quot;adress out is $adr_output&quot;;</span>
<span class="preprocessor"></span>            } elsif ($aux_file_id =~ m|^$htmlDirectory| ) {
                $adr_output = $aux_file_id;
                $adr_output =~ s|$htmlDirectory|$htmlURL|;
                $adr_output .= <span class="stringliteral">&quot;.$ext&quot;</span>;
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # files not in the htmlDirectory sub tree are assumed to live under the templateDirectory</span>
<span class="preprocessor"></span><span class="preprocessor">                # subtree in the same directory as the problem.</span>
<span class="preprocessor"></span>
<span class="preprocessor">                # For a png file the alias macro creates an alias under the html/images directory</span>
<span class="preprocessor"></span><span class="preprocessor">                # which points to the png file in the problem directory.</span>
<span class="preprocessor"></span><span class="preprocessor">                # All of the subdirectories of html/tmp/gif which are needed are also created.</span>
<span class="preprocessor"></span>                my $filePath = $self-&gt;directoryFromPath($fileName);

<span class="preprocessor">                # $fileName is obtained from environment for PGeval</span>
<span class="preprocessor"></span><span class="preprocessor">                # it gives the full path to the current problem</span>
<span class="preprocessor"></span>                my $pngSourceFile = $self-&gt;convertPath(<span class="stringliteral">&quot;$templateDirectory${filePath}$aux_file_id.png&quot;</span>);
                my $uniqIDstub = $self-&gt;{uniqIDstub};
                my $link = <span class="stringliteral">&quot;gif/${uniqIDstub}-$aux_file_id.$ext&quot;</span>;
                my $linkPath = $self-&gt;surePathToTmpFile($link);
                $adr_output = <span class="stringliteral">&quot;${tempURL}$link&quot;</span>;
<span class="preprocessor">                #warn &quot;linkPath is $linkPath&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">                #warn &quot;adr_output is $adr_output&quot;;</span>
<span class="preprocessor"></span>                <span class="keywordflow">if</span> (-e $pngSourceFile) {
                    <span class="keywordflow">if</span> (-e $linkPath) {
                        unlink($linkPath) || warn <span class="stringliteral">&quot;Unable to unlink old alias file at $linkPath&quot;</span>;
                    }
                    symlink($pngSourceFile, $linkPath)
                    || warn <span class="stringliteral">&quot;The macro alias cannot create a link from |$linkPath|  to |$pngSourceFile| &lt;BR&gt;&quot;</span> ;
                } <span class="keywordflow">else</span> {
                    warn(<span class="stringliteral">&quot;The macro alias cannot find a PNG file at: |$pngSourceFile|&quot;</span>);
                }
            }
    $adr_output;

}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a2043c9543bc2cec279eb73d6adcadb17"></a><!-- doxytag: member="PGalias::alias_for_png_in_tex_mode" ref="a2043c9543bc2cec279eb73d6adcadb17" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::alias_for_png_in_tex_mode </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-alias_for_png_in_tex_mode' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-alias_for_png_in_tex_mode-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-alias_for_png_in_tex_mode-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-alias_for_png_in_tex_mode-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in alias_for_png_in_tex_mode: 94</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#a2043c9543bc2cec279eb73d6adcadb17">alias_for_png_in_tex_mode</a> {

    my $self = shift;
    my $aux_file_id = shift;

    my $envir               = $self-&gt;{envir};   my $fileName            = $envir-&gt;{fileName};
    my $htmlDirectory       = $envir-&gt;{htmlDirectory};
    my $htmlURL             = $envir-&gt;{htmlURL};
    my $tempDirectory       = $envir-&gt;{tempDirectory};
    my $tempURL             = $envir-&gt;{tempURL};
    my $studentLogin        = $envir-&gt;{studentLogin};
    my $psvn          = $envir-&gt;{psvn};
    my $setNumber           = $envir-&gt;{setNumber};
    my $probNum             = $envir-&gt;{probNum};
    my $displayMode         = $envir-&gt;{displayMode};
    my $externalGif2EpsPath = $envir-&gt;{externalGif2EpsPath};
    my $externalPng2EpsPath = $envir-&gt;{externalPng2EpsPath};
     
    my $templateDirectory   = $self-&gt;{templateDirectory};
    
   
<span class="preprocessor">    # $adr_output is a url in HTML and Latex2HTML modes</span>
<span class="preprocessor"></span><span class="preprocessor">    # and a complete path in TEX mode.</span>
<span class="preprocessor"></span>    my $adr_output;
    my $ext                 = <span class="stringliteral">&quot;png&quot;</span>;          
<span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">            # .png FILES in TeX mode</span>
<span class="preprocessor"></span><span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span>
                $setNumber =~ s/\./_/g;  ## extra dots confuse latex<span class="stringliteral">&#39;s graphics package</span>
<span class="stringliteral">            if ($envir-&gt;{texDisposition} eq &quot;pdf&quot;) {</span>
<span class="stringliteral">                # We&#39;</span>re going to create PDF files with our TeX (<span class="keyword">using</span> pdflatex); so we
<span class="preprocessor">                # need images in PNG format. what luck! they&#39;re already in PDF format!</span>
<span class="preprocessor"></span>
                my $pngFilePath;

                <span class="keywordflow">if</span> ($aux_file_id =~ m/^$htmlDirectory/ or $aux_file_id =~ m/^$tempDirectory/) {
<span class="preprocessor">                    # we&#39;ve got a full pathname to a file</span>
<span class="preprocessor"></span>                    $pngFilePath = <span class="stringliteral">&quot;$aux_file_id.png&quot;</span>;
                } <span class="keywordflow">else</span> {
<span class="preprocessor">                    # we assume the file is in the same directory as the problem source file</span>
<span class="preprocessor"></span>                    my $dir = $self-&gt;directoryFromPath($fileName);
                    $pngFilePath = <span class="stringliteral">&quot;$templateDirectory${dir}$aux_file_id.png&quot;</span>;
                }

                $adr_output = $pngFilePath;
            } <span class="keywordflow">else</span> {
<span class="preprocessor">                # Since we&#39;re not creating PDF files; we&#39;re probably just using a plain</span>
<span class="preprocessor"></span><span class="preprocessor">                # vanilla latex. Hence; we need EPS images.</span>
<span class="preprocessor"></span>
<span class="preprocessor">                ################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">                # This is statement used below is system dependent.</span>
<span class="preprocessor"></span><span class="preprocessor">                # Notice that the range of colors is restricted when converting to postscript to keep the files small</span>
<span class="preprocessor"></span><span class="preprocessor">                # &quot;cat $pngSourceFile  | /usr/math/bin/pngtopnm | /usr/math/bin/pnmtops -noturn &gt; $adr_output&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">                # &quot;cat $pngSourceFile  | /usr/math/bin/pngtopnm | /usr/math/bin/pnmdepth 1 | /usr/math/bin/pnmtops -noturn &gt; $adr_output&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">                ################################################################################</span>
<span class="preprocessor"></span>
                <span class="keywordflow">if</span> ($aux_file_id =~  m|^$htmlDirectory|  or $aux_file_id =~  m|^$tempDirectory|)  {
<span class="preprocessor">                    # To serve an eps file copy an eps version of the png file to the subdirectory of eps/</span>
<span class="preprocessor"></span>                    my $linkPath = $self-&gt;directoryFromPath($fileName);

                    my $pngSourceFile = <span class="stringliteral">&quot;$aux_file_id.png&quot;</span>;
                    my $pngFileName = fileFromPath($pngSourceFile);
                    $adr_output = $self-&gt;surePathToTmpFile(<span class="stringliteral">&quot;$tempDirectory/eps/$studentLogin-$psvn-$pngFileName.eps&quot;</span>) ;

                    <span class="keywordflow">if</span> (-e $pngSourceFile) {
<span class="preprocessor">                        #system(&quot;cat $pngSourceFile  | /usr/math/bin/pngtopnm | /usr/math/bin/pnmdepth 1 | /usr/math/bin/pnmtops -noturn&gt;$adr_output&quot;)</span>
<span class="preprocessor"></span>                        system(<span class="stringliteral">&quot;cat $pngSourceFile | ${externalPng2EpsPath} &gt; $adr_output&quot;</span> )
                            &amp;&amp; die <span class="stringliteral">&quot;Unable to create eps file:\n |$adr_output| from file\n |$pngSourceFile|\n in problem $probNum &quot;</span> .
                                   <span class="stringliteral">&quot;using the system dependent commands\n |${externalPng2EpsPath}| \n&quot;</span>;
                    } <span class="keywordflow">else</span> {
                        die <span class="stringliteral">&quot;|$pngSourceFile| cannot be found.  Problem number: |$probNum|&quot;</span>;
                    }
                } <span class="keywordflow">else</span> {
<span class="preprocessor">                    # To serve an eps file copy an eps version of the png file to  a subdirectory of eps/</span>
<span class="preprocessor"></span>                    my $filePath = $self-&gt;directoryFromPath($fileName);
                    my $pngSourceFile = <span class="stringliteral">&quot;${templateDirectory}${filePath}$aux_file_id.png&quot;</span>;
<span class="preprocessor">                    #print &quot;content-type: text/plain \n\nfileName = $fileName and aux_file_id =$aux_file_id&lt;BR&gt;&quot;;</span>
<span class="preprocessor"></span>                    $adr_output = $self-&gt;surePathToTmpFile(<span class="stringliteral">&quot;eps/$studentLogin-$psvn-set$setNumber-prob$probNum-$aux_file_id.eps&quot;</span>) ;
                    <span class="keywordflow">if</span> (-e $pngSourceFile) {
<span class="preprocessor">                        #system(&quot;cat $pngSourceFile  | /usr/math/bin/pngtopnm | /usr/math/bin/pnmdepth 1 | /usr/math/bin/pnmtops -noturn&gt;$adr_output&quot;) &amp;&amp;</span>
<span class="preprocessor"></span><span class="preprocessor">                        #warn &quot;Unable to create eps file: |$adr_output|\n from file\n |$pngSourceFile|\n in problem $probNum&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">                        #warn &quot;Help ${externalPng2EpsPath}&quot; unless -x &quot;${externalPng2EpsPath}&quot;;</span>
<span class="preprocessor"></span>                        system(<span class="stringliteral">&quot;cat $pngSourceFile | ${externalPng2EpsPath} &gt; $adr_output&quot;</span> )
                            &amp;&amp; die <span class="stringliteral">&quot;Unable to create eps file:\n |$adr_output| from file\n |$pngSourceFile|\n in problem $probNum &quot;</span> .
                                   <span class="stringliteral">&quot;using the system dependent commands\n |${externalPng2EpsPath}| \n &quot;</span>;
                    } <span class="keywordflow">else</span> {
                        die <span class="stringliteral">&quot;|$pngSourceFile| cannot be found.  Problem number: |$probNum|&quot;</span>;
                    }
                }
            }
    $adr_output;

}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a8a1977779bf8ed55e3284426783e034f"></a><!-- doxytag: member="PGalias::check_parameters" ref="a8a1977779bf8ed55e3284426783e034f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::check_parameters </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-check_parameters' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-check_parameters-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-check_parameters-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-check_parameters-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in check_parameters: 24</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#a8a1977779bf8ed55e3284426783e034f">check_parameters</a> {
    my $self = shift;

<span class="preprocessor">    # problem specific data</span>
<span class="preprocessor"></span>    warn <span class="stringliteral">&quot;The path to the current problem file template is not defined.&quot;</span>     unless $self-&gt;{fileName};
    warn <span class="stringliteral">&quot;The current studentLogin is not defined &quot;</span>                          unless $self-&gt;{studentLogin};
    warn <span class="stringliteral">&quot;The current problem set number is not defined&quot;</span>                     <span class="keywordflow">if</span> $self-&gt;{setNumber} eq <span class="stringliteral">&quot;&quot;</span>; # allow <span class="keywordflow">for</span> sets equal to 0
    warn <span class="stringliteral">&quot;The current problem number is not defined&quot;</span>                         <span class="keywordflow">if</span> $self-&gt;{probNum} eq <span class="stringliteral">&quot;&quot;</span>;
    warn <span class="stringliteral">&quot;The current problem set version number (psvn) is not defined&quot;</span>      unless defined($self-&gt;{psvn});
    warn <span class="stringliteral">&quot;The displayMode is not defined&quot;</span>                                    unless $self-&gt;{displayMode};

<span class="preprocessor">    # required macros</span>
<span class="preprocessor"></span><span class="preprocessor">#   warn &quot;The macro &amp;surePathToTmpFile can&#39;t be found&quot;                    unless defined(&amp;{$self-&gt;surePathToTmpFile()} );</span>
<span class="preprocessor"></span><span class="preprocessor">#   warn &quot;The macro &amp;convertPath can&#39;t be found&quot;                          unless defined(&amp;{$self-&gt;convertPath()});</span>
<span class="preprocessor"></span><span class="preprocessor">#   warn &quot;The macro &amp;directoryFromPath can&#39;t be found&quot;                    unless defined(&amp;{$self-&gt;directoryFromPath()});</span>
<span class="preprocessor"></span><span class="preprocessor">#    warn $self-&gt;surePathToTmpFile(&quot;foo&quot;);</span>
<span class="preprocessor"></span><span class="preprocessor">    # warn &quot;The webwork server does not have permission to execute the gif2eps script at  ${externalGif2EpsPath}.&quot; unless ( -x &quot;${externalGif2EpsPath}&quot; );</span>
<span class="preprocessor"></span><span class="preprocessor">    # warn &quot;The webwork server does not have permission to execute the png2eps script at ${externalPng2EpsPath}.&quot; unless ( -x &quot;${externalPng2EpsPath}&quot; );</span>
<span class="preprocessor"></span>
<span class="preprocessor">    # required directory addresses (and URL address)</span>
<span class="preprocessor"></span>    warn <span class="stringliteral">&quot;htmlDirectory is not defined.&quot;</span> unless $self-&gt;{htmlDirectory};
    warn <span class="stringliteral">&quot;htmlURL is not defined.&quot;</span> unless $self-&gt;{htmlURL};
    warn <span class="stringliteral">&quot;tempURL is not defined.&quot;</span> unless $self-&gt;{tempURL};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a53030db600b5522d9e6098569e3f74f2"></a><!-- doxytag: member="PGalias::check_url" ref="a53030db600b5522d9e6098569e3f74f2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::check_url </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-check_url' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-check_url-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-check_url-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-check_url-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in check_url: 14</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#a53030db600b5522d9e6098569e3f74f2">check_url</a> {
    my $self = shift;
    my $url  = shift;
    my $OK_CONSTANT = <span class="stringliteral">&quot;200 OK&quot;</span>;
    <span class="keywordflow">return</span> undef <span class="keywordflow">if</span> $url =~ /;/;   # make sure we can<span class="stringliteral">&#39;t get a second command in the url</span>
<span class="stringliteral">    #FIXME -- check for other exploits of the system call</span>
<span class="stringliteral">    #FIXME -- ALARM feature so that the response cannot be held up for too long.</span>
<span class="stringliteral">    #FIXME doesn&#39;</span>t seem to work with relative addresses.
    #FIXME  Can we <span class="keyword">get</span> the machine name of the server?

     my $check_url_command = $self-&gt;{envir}-&gt;{externalCheckUrl};
     my $response = `$check_url_command $url`; 
    <span class="keywordflow">return</span> ($response =~ /^$OK_CONSTANT/) ? 1 : 0; 
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="abf78a0e9619e8fc1be826a527b5be2a6"></a><!-- doxytag: member="PGalias::findAppletCodebase" ref="abf78a0e9619e8fc1be826a527b5be2a6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::findAppletCodebase </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-findAppletCodebase' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-findAppletCodebase-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-findAppletCodebase-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-findAppletCodebase-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in findAppletCodebase: 25</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#abf78a0e9619e8fc1be826a527b5be2a6">findAppletCodebase</a> {
    my $self     = shift;
    my $fileName = shift;  # probably the name of a jar file
    $server_root_url=$self-&gt;envir(<span class="stringliteral">&quot;server_root_url&quot;</span>);
<span class="preprocessor">    #check cache first</span>
<span class="preprocessor"></span>    <span class="keywordflow">if</span> (defined($appletCodebaseLocations{$fileName})  
          and $appletCodebaseLocations{$fileName} =~/\S/  )
    {
        <span class="keywordflow">return</span> $appletCodebaseLocations{$fileName}; # <span class="keywordflow">return</span> <span class="keywordflow">if</span> found in cache
    }
    my $appletPath = $self-&gt;{appletPath};
    <span class="keywordflow">foreach</span> my $appletLocation (@{$appletPath}) {
        <span class="keywordflow">if</span> ($appletLocation =~ m|^/|) {
            $appletLocation = <span class="stringliteral">&quot;$server_root_url$appletLocation&quot;</span>;
        }
        my $url = <span class="stringliteral">&quot;$appletLocation/$fileName&quot;</span>;

        <span class="keywordflow">if</span> ($self-&gt;check_url($url)) {
                $appletCodebaseLocations{$fileName} = $appletLocation; #update cache
            <span class="keywordflow">return</span> $appletLocation   # <span class="keywordflow">return</span> codebase part of url
        }
    }
    warn <span class="stringliteral">&quot;findAppletCodebase Error: $fileName not found after searching &quot;</span>. join(<span class="stringliteral">&quot;,  &quot;</span>, @{$appletPath} );
    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="add2a5c271e9aa62a2a5c0956787ee33f"></a><!-- doxytag: member="PGalias::findMacroFile" ref="add2a5c271e9aa62a2a5c0956787ee33f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::findMacroFile </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-findMacroFile' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-findMacroFile-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-findMacroFile-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-findMacroFile-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in findMacroFile: 11</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#add2a5c271e9aa62a2a5c0956787ee33f">findMacroFile</a> {
    my $self   = shift;
  my $fileName = shift;
  my $filePath;
  <span class="keywordflow">foreach</span> my $dir (@{$macrosPath}) {
    $filePath = <span class="stringliteral">&quot;$dir/$fileName&quot;</span>;
    $filePath =~ s!^\.\.?/!$pwd/!;
    <span class="keywordflow">return</span> $filePath <span class="keywordflow">if</span> (-r $filePath);
  }
  <span class="keywordflow">return</span>;  # no file found
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a9ff94b22df43e2fd830d67bae33a137d"></a><!-- doxytag: member="PGalias::get_resource" ref="a9ff94b22df43e2fd830d67bae33a137d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::get_resource </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_resource' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-get_resource-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_resource-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_resource-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in get_resource: 5</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#a9ff94b22df43e2fd830d67bae33a137d">get_resource</a> {
    my $self = shift;
    my $aux_file_id =shift;
    $self-&gt;{resource_list}-&gt;{$aux_file_id};
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a579233f6f4cef98896267bdf3f8e4514"></a><!-- doxytag: member="PGalias::initialize" ref="a579233f6f4cef98896267bdf3f8e4514" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-initialize' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-initialize-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-initialize-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-initialize-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in initialize: 50</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#a579233f6f4cef98896267bdf3f8e4514">initialize</a> {
    my $self = shift;
    my $envir = $self-&gt;{envir};
<span class="preprocessor">    # warn &quot;envir-- &quot;, join(&quot; &quot;, %$envir);</span>
<span class="preprocessor"></span>    $self-&gt;{fileName}            = $envir-&gt;{probFileName};
    $self-&gt;{htmlDirectory}       = $envir-&gt;{htmlDirectory};
    $self-&gt;{htmlURL}             = $envir-&gt;{htmlURL};
    $self-&gt;{tempDirectory}       = $envir-&gt;{tempDirectory};
    $self-&gt;{templateDirectory}   = $envir-&gt;{templateDirectory};
    $self-&gt;{tempURL}             = $envir-&gt;{tempURL};
    $self-&gt;{studentLogin}        = $envir-&gt;{studentLogin};
    $self-&gt;{psvn}                = $envir-&gt;{psvn};
    $self-&gt;{setNumber}           = $envir-&gt;{setNumber};
    $self-&gt;{probNum}             = $envir-&gt;{probNum};
    $self-&gt;{displayMode}         = $envir-&gt;{displayMode};
    $self-&gt;{externalGif2EpsPath} = $envir-&gt;{externalGif2EpsPath};
    $self-&gt;{externalPng2EpsPath} = $envir-&gt;{externalPng2EpsPath};
    $self-&gt;{courseID}            = $envir-&gt;{courseName};    
    
    $self-&gt;{appletPath} = $self-&gt;{envir}-&gt;{pgDirectories}-&gt;{appletPath};
<span class="preprocessor">    #</span>
<span class="preprocessor"></span><span class="preprocessor">    #  Find auxiliary files even when the main file is in tempates/tmpEdit</span>
<span class="preprocessor"></span><span class="preprocessor">    #</span>
<span class="preprocessor"></span>    $self-&gt;{fileName} =~ s!(^|/)tmpEdit/!$1!;
    
    $self-&gt;{ext}      = <span class="stringliteral">&quot;&quot;</span>;

    my $uniqIDseed = join(<span class="stringliteral">&quot;-&quot;</span>,   
                               $self-&gt;{studentLogin},
                               $self-&gt;{psvn},
                               $self-&gt;{courseID},
                               <span class="stringliteral">&#39;set&#39;</span>.$self-&gt;{setNumber},
                               <span class="stringliteral">&#39;prob&#39;</span>.$self-&gt;{probNum},
    );

<span class="preprocessor">##################################</span>
<span class="preprocessor"></span><span class="preprocessor"># Cached vs. uncached uuid&#39;s -- or should the uuid be unique to each file/psvn/login, but always the same?</span>
<span class="preprocessor"></span><span class="preprocessor"># If every uuid is uniqu then the same file will be linked to multiple times and it will be important</span>
<span class="preprocessor"></span><span class="preprocessor"># to use asynchronous garbage cleanup to remove all links that won&#39;t be used again</span>
<span class="preprocessor"></span><span class="preprocessor"># If one tries to reuse links then one can get duplicates, for example if many files using the same name</span>
<span class="preprocessor"></span><span class="preprocessor"># (prob3.pg) appear in a list of library problems. </span>
<span class="preprocessor"></span><span class="preprocessor">###################################</span>
<span class="preprocessor"></span>
<span class="preprocessor">##########################</span>
<span class="preprocessor"></span><span class="preprocessor"># create an ID which is unique to the student and context for the problem</span>
<span class="preprocessor"></span><span class="preprocessor">##########################</span>
<span class="preprocessor"></span>    my $uniqIDstub = create_uuid_as_string(UUID_V3, UUID_NS_URL, $uniqIDseed);
    $self-&gt;{uniqIDstub} = $uniqIDstub;         

}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a9726370fecbdaa8291e2221d55d1f732"></a><!-- doxytag: member="PGalias::make_alias" ref="a9726370fecbdaa8291e2221d55d1f732" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::make_alias </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-make_alias' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-make_alias-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-make_alias-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-make_alias-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in make_alias: 130</span>
<span class="preprocessor"></span>sub <a class="code" href="classPGalias.html#a9726370fecbdaa8291e2221d55d1f732">make_alias</a> {
    my $self = shift;       
<span class="preprocessor">    # input is a path to the original auxiliary file</span>
<span class="preprocessor"></span>    my $aux_file_id = shift @_;
<span class="preprocessor">    # warn &quot;aux_file_id = $aux_file_id&quot;;</span>
<span class="preprocessor"></span>
    $self-&gt;warning_message( <span class="stringliteral">&quot;Empty string used as input into the function alias&quot;</span>) unless $aux_file_id;
    
    my $envir               = $self-&gt;{envir}; 
    my $displayMode         = $self-&gt;{displayMode}; 
    my $fileName            = $self-&gt;{fileName};    # name of .pg file
    my $envir               = $self-&gt;{envir};
    my $htmlDirectory       = $self-&gt;{htmlDirectory};
    my $htmlURL             = $self-&gt;{htmlURL};
    my $tempDirectory       = $self-&gt;{tempDirectory};
    my $tempURL             = $self-&gt;{tempURL};
    my $studentLogin        = $self-&gt;{studentLogin};
    my $psvn                = $self-&gt;{psvn};
    my $setNumber           = $self-&gt;{setNumber};
    my $probNum             = $self-&gt;{probNum};
    my $externalGif2EpsPath = $self-&gt;{externalGif2EpsPath};
    my $externalPng2EpsPath = $self-&gt;{externalPng2EpsPath}; 
    my $templateDirectory   = $self-&gt;{templateDirectory};
    
<span class="preprocessor">    # $adr_output is a url in HTML and Latex2HTML modes</span>
<span class="preprocessor"></span><span class="preprocessor">    # and a complete path in TEX mode.</span>
<span class="preprocessor"></span>    my $adr_output;
    my $ext;
    
<span class="preprocessor">####################################################################### </span>
<span class="preprocessor"></span><span class="preprocessor">    # determine file type</span>
<span class="preprocessor"></span><span class="preprocessor">    # determine display mode</span>
<span class="preprocessor"></span><span class="preprocessor">    # dispatch  </span>
<span class="preprocessor"></span><span class="preprocessor">#######################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # determine extension, if there is one</span>
<span class="preprocessor"></span><span class="preprocessor">    # if extension exists, strip and use the value for $ext</span>
<span class="preprocessor"></span><span class="preprocessor">    # files without extensions are considered to be picture files:</span>
<span class="preprocessor"></span>

    <span class="keywordflow">if</span> ($aux_file_id =~ s/\.([^\.]*)$<span class="comment">// ) {</span>
        $ext = $1;
    } <span class="keywordflow">else</span> {
        $self-&gt;warning_message( <span class="stringliteral">&quot;This file name $aux_file_id did not have an extension.&lt;BR&gt; &quot;</span> .
             <span class="stringliteral">&quot;Every file name used as an argument to alias must have an extension.&lt;BR&gt; &quot;</span> .
             <span class="stringliteral">&quot;The permissable extensions are .gif, .png, and .html .&lt;BR&gt;&quot;</span>);
        $ext  = <span class="stringliteral">&quot;gif&quot;</span>;
        <span class="keywordflow">return</span> undef;
    }


<span class="preprocessor">    # in order to facilitate maintenance of this macro the routines for handling</span>
<span class="preprocessor"></span><span class="preprocessor">    # different file types are defined separately.  This involves some redundancy</span>
<span class="preprocessor"></span><span class="preprocessor">    # in the code but it makes it easier to define special handling for a new file</span>
<span class="preprocessor"></span><span class="preprocessor">    # type, (but harder to change the behavior for all of the file types at once</span>
<span class="preprocessor"></span><span class="preprocessor">    # (sigh)  ).</span>
<span class="preprocessor"></span>    
<span class="preprocessor">    ###################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">    # This section checks to see if a resource has already been made (in this problem) for </span>
<span class="preprocessor"></span><span class="preprocessor">    # this particular aux_file_id.</span>
<span class="preprocessor"></span><span class="preprocessor">    # If so, we simply return the appropriate uri for the file.</span>
<span class="preprocessor"></span><span class="preprocessor">    # The displayMode will be the same throughout the processing of the .pg file</span>
<span class="preprocessor"></span><span class="preprocessor">    # This effectively cache&#39;s auxiliary files within a single PG question.</span>
<span class="preprocessor"></span><span class="preprocessor">    ###################################################################</span>
<span class="preprocessor"></span>    unless ( defined $self-&gt;get_resource($aux_file_id) ) {
        $self-&gt;add_resource($aux_file_id, <a class="code" href="classPGresource.html">PGresource</a>-&gt;new());
<span class="preprocessor">        #warn &quot;adding new resource_object $aux_file_id&quot;;</span>
<span class="preprocessor"></span>    } <span class="keywordflow">else</span> {
<span class="preprocessor">        #warn &quot;found existing resource_object $aux_file_id&quot;;</span>
<span class="preprocessor"></span>        <span class="keywordflow">return</span> $self-&gt;get_resource($aux_file_id)-&gt;uri() ; 
    }

<span class="preprocessor">    #warn &quot;next line\n\n&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">    #warn &quot;resource list contains &quot;, %{ $self-&gt;{resource_list} };</span>
<span class="preprocessor"></span><span class="preprocessor">    ###################################################################</span>
<span class="preprocessor"></span>    
    <span class="keywordflow">if</span> ($ext eq <span class="stringliteral">&#39;html&#39;</span>) {
       $adr_output = $self-&gt;alias_for_html($aux_file_id)
    } elsif ($ext eq <span class="stringliteral">&#39;gif&#39;</span>) {
        <span class="keywordflow">if</span> ( $displayMode eq <span class="stringliteral">&#39;HTML_MathJax&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_dpng&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML&#39;</span> ||
             $displayMode eq <span class="stringliteral">&#39;HTML_tth&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_asciimath&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_LaTeXMathML&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_jsMath&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_img&#39;</span>) {
<span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">            # .gif FILES in HTML; HTML_tth; HTML_dpng; HTML_img; and Latex2HTML modes</span>
<span class="preprocessor"></span><span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span>            $adr_output=$self-&gt;alias_for_gif_in_html_mode($aux_file_id);
        
        } elsif ($displayMode eq <span class="stringliteral">&#39;TeX&#39;</span>) {
<span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">            # .gif FILES in TeX mode</span>
<span class="preprocessor"></span><span class="preprocessor">            ################################################################################</span>
<span class="preprocessor"></span>            $adr_output=$self-&gt;alias_for_gif_in_tex_mode($aux_file_id);
        
        } <span class="keywordflow">else</span> {
            die <span class="stringliteral">&quot;Error in alias: dangerousMacros.pl: unrecognizable displayMode = $displayMode&quot;</span>;
        }
    } elsif ($ext eq <span class="stringliteral">&#39;png&#39;</span>) {
        <span class="keywordflow">if</span> ( $displayMode eq <span class="stringliteral">&#39;HTML_MathJax&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_dpng&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML&#39;</span> ||
             $displayMode eq <span class="stringliteral">&#39;HTML_tth&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_asciimath&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_LaTeXMathML&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_jsMath&#39;</span>||
             $displayMode eq <span class="stringliteral">&#39;HTML_img&#39;</span> )  {
            $adr_output = $self-&gt;alias_for_png_in_html_mode($aux_file_id);
        } elsif ($displayMode eq <span class="stringliteral">&#39;TeX&#39;</span>) {
            $adr_output = $self-&gt;alias_for_png_in_tex_mode($aux_file_id);
        
        } <span class="keywordflow">else</span> {
            warn  <span class="stringliteral">&quot;Error in alias: dangerousMacros.pl&quot;</span>,<span class="stringliteral">&quot;unrecognizable displayMode = $displayMode&quot;</span>,<span class="stringliteral">&quot;&quot;</span>;
        }
    } <span class="keywordflow">else</span> { # $ext is not recognized
<span class="preprocessor">        ################################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">        # FILES  with unrecognized file extensions in any display modes</span>
<span class="preprocessor"></span><span class="preprocessor">        ################################################################################</span>
<span class="preprocessor"></span>
        warn <span class="stringliteral">&quot;Error in the macro alias. Alias does not understand how to process files with extension $ext.  (Path ot problem file is  $fileName) &quot;</span>;
    }

    warn <span class="stringliteral">&quot;The macro alias was unable to form a URL for some auxiliary file used in this problem.&quot;</span> unless $adr_output;

<span class="preprocessor">    # $adr_output is a url in HTML  modes</span>
<span class="preprocessor"></span><span class="preprocessor">    # and a complete path in TEX mode.</span>
<span class="preprocessor"></span>    <span class="keywordflow">return</span> $adr_output;
}
</pre></div>  
</div>
 
</div>
</div>
<a class="anchor" id="a08e64de8324961599183ce129ea01d84"></a><!-- doxytag: member="PGalias::new" ref="a08e64de8324961599183ce129ea01d84" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method PGalias::new </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented Method  
<div id='codesection-new' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
	<img id='codesection-new-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-new-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-new-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><pre class="fragment"><span class="preprocessor"># Number of lines of code in new: 17</span>
<span class="preprocessor"></span>sub <span class="keyword">new</span> {
    my $class = shift;  
    my $envir = shift;  #pointer to environment hash
    my %options = @_;
    warn <span class="stringliteral">&quot;PGlias must be called with an environment&quot;</span> unless ref($envir) eq &#39;HASH&#39;;
    my $self = {
        envir       =&gt;  $envir,
        search_list  =&gt;  [{url=&gt;<span class="stringliteral">&#39;foo&#39;</span>,dir=&gt;<span class="charliteral">&#39;.&#39;</span>}],   # <span class="keywordflow">for</span> subclasses -&gt; list of url/directories to search
        resource_list =&gt; {},
        %options,

    };
    bless $self, $class;
    $self-&gt;initialize;
    $self-&gt;check_parameters;
    <span class="keywordflow">return</span> $self;
}
</pre></div>  
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="PGalias_8pm_source.html">PGalias.pm</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:55:01 2012 for PG by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
