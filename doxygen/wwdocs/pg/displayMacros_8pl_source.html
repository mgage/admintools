<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PG: displayMacros.pl Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>displayMacros.pl</h1><a href="displayMacros_8pl.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">################################################################################</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor"># WeBWorK Online Homework Delivery System</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor"># Copyright © 2000-2007 The WeBWorK Project, http://openwebwork.sf.net/</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor"># $CVSHeader$</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span><span class="preprocessor"># </span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor"># This program is free software; you can redistribute it and/or modify it under</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span><span class="preprocessor"># the terms of either: (a) the GNU General Public License as published by the</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor"># Free Software Foundation; either version 2, or (at your option) any later</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor"># version, or (b) the &quot;Artistic License&quot; which comes with this package.</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor"># </span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor"># This program is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="preprocessor"># ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor"># FOR A PARTICULAR PURPOSE.  See either the GNU General Public License or the</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor"># Artistic License for more details.</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">################################################################################</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span>
<a name="l00017"></a>00017 =head1 NAME
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 displayMacros.pl - [DEPRECATED] <a class="code" href="classWeBWorK.html">WeBWorK</a> 1.x display macros.
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 =head1 DESCRIPTION
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 This file is used with <a class="code" href="classWeBWorK.html">WeBWorK</a> 1.9 and is not used <span class="keywordflow">for</span> <a class="code" href="classWeBWorK.html">WeBWorK</a> 2.x.
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 =cut
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 use strict;
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">## $ENV{&#39;PATH&#39;} .= &#39;:/usr/math/bin&#39;;</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 my $debug = 0;
<a name="l00032"></a>00032 $debug = 1 <span class="keywordflow">if</span> $Global::imageDebugMode;
<a name="l00033"></a>00033 <span class="preprocessor">    ## if $debug =1, log, etc. files created by</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">                  ## latex2html are not deleted</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 <span class="preprocessor">##############################################################</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#  File: DisplayMacros.pl</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#  This contains the subroutines for creating problem files</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">##############################################################</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <span class="preprocessor">################################################################</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#  Copyright @1995-1998 by Michael E. Gage, Arnold K. Pizer and</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#  WeBWorK at the University of Rochester. All rights reserved.</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">################################################################</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">## To add or delete displayModes edit this file</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00049"></a>00049 sub displaySelectModeLine_string
<a name="l00050"></a>00050 <span class="preprocessor">                  # called from probSet.pl</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="preprocessor">                  # displays the option line for selecting display modes</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>{
<a name="l00053"></a>00053    my ($displayMode) =@_ ;
<a name="l00054"></a>00054    $displayMode = $Global::htmlModeDefault unless(defined($displayMode));
<a name="l00055"></a>00055 <span class="preprocessor">   # If the system is set up with only one display mode, there is</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">   # no need to display a choice - use the default</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>   <span class="keywordflow">if</span>(scalar(@{$Global::available_mode_list})&lt;2) {
<a name="l00058"></a>00058      <span class="keywordflow">return</span>(<span class="stringliteral">&#39;&lt;input type=&quot;hidden&quot; name=&quot;Mode&quot; value=&quot;&#39;</span>.
<a name="l00059"></a>00059           $displayMode .<span class="stringliteral">&#39;&quot;&gt;&#39;</span>);
<a name="l00060"></a>00060    }
<a name="l00061"></a>00061    my $out = <span class="stringliteral">&quot;Display Mode: &lt;BR&gt;&quot;</span>;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="preprocessor"># A list of the available modes.</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>    my $mode_list = $Global::available_mode_list;   ## ref to a list of available modes
<a name="l00065"></a>00065 <span class="preprocessor">                                                                    ## The format is [internal symbol, external name]</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor"># A list of the available modes.</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor"># Format is [internal symbol, external name, &quot;&quot;], where the third</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor"># argument is changed to checked below for the current displayMode</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#   my $mode_list = [</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#   [&#39;HTML&#39;, &#39;text&#39;, &quot;&quot;],</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#   [&#39;HTML_tth&#39;, &#39;formatted-text&#39;,&quot;&quot;],</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span><span class="preprocessor">#   [&#39;HTML_dpng&#39; ,&#39;dvipng&#39;,&quot;&quot;],</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="preprocessor">#   [&#39;Latex2HTML&#39;, &#39;typeset&#39;,&quot;&quot;]</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">#   ];</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076 <span class="preprocessor"># Make the format [internal symbol, external name, &#39;&#39;]</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="preprocessor"># The third argument is changed to checked below for the current displayMode</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span>    my $j;
<a name="l00079"></a>00079     <span class="keywordflow">for</span> $j (0..(scalar(@{$mode_list})-1)) {
<a name="l00080"></a>00080         push @{$mode_list-&gt;[$j]},<span class="stringliteral">&#39;&#39;</span>;
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083    <span class="keywordflow">if</span> (! defined($displayMode) ) {$displayMode = $Global::htmlModeDefault;}
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 
<a name="l00086"></a>00086    my $found = 0;
<a name="l00087"></a>00087 <span class="preprocessor"># Search through all modes to match for displayMode</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span><span class="preprocessor"># If we don&#39;t find one, found=0 will trigger warn message below</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>   <span class="keywordflow">for</span> $j (0..(scalar(@{$mode_list})-1)) {
<a name="l00090"></a>00090      <span class="keywordflow">if</span>($mode_list-&gt;[$j]-&gt;[0] eq $displayMode) {
<a name="l00091"></a>00091         $mode_list-&gt;[$j]-&gt;[2] = <span class="stringliteral">&quot;CHECKED&quot;</span>;
<a name="l00092"></a>00092         $found=1;
<a name="l00093"></a>00093         last;
<a name="l00094"></a>00094      }
<a name="l00095"></a>00095    }
<a name="l00096"></a>00096 
<a name="l00097"></a>00097    <span class="keywordflow">for</span> $j (@{$mode_list}) {
<a name="l00098"></a>00098      $out .= qq!&lt;INPUT TYPE=RADIO NAME=<span class="stringliteral">&quot;Mode&quot;</span> VALUE=<span class="stringliteral">&quot;$j-&gt;[0]&quot;</span> $j-&gt;[2]&gt;$j-&gt;[1]&lt;BR&gt;\n!;
<a name="l00099"></a>00099    }
<a name="l00100"></a>00100    <span class="keywordflow">if</span>(! $found) {
<a name="l00101"></a>00101      my $wstr = <span class="stringliteral">&quot; Error: displayMacros.pl: sub displaySelectModeLine. Unrecognized mode |$displayMode| .  The acceptable modes are: &quot;</span>;
<a name="l00102"></a>00102      <span class="keywordflow">for</span> $j (@{$mode_list}) {
<a name="l00103"></a>00103        $wstr .= <span class="stringliteral">&quot; $j-&gt;[0] &quot;</span>;
<a name="l00104"></a>00104      }
<a name="l00105"></a>00105      warn $wstr;
<a name="l00106"></a>00106    }
<a name="l00107"></a>00107   $out;
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 sub displaySelectModeLine {
<a name="l00111"></a>00111     print displaySelectModeLine_string(@_);
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 <span class="preprocessor">##################################################################################################################</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span><span class="preprocessor"># Does the initial processing of the problem.</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span><span class="preprocessor"># Returns an array containing the rendered problem.           #</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span><span class="preprocessor">##################################################################################################################</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>
<a name="l00118"></a>00118 sub createDisplayedProblem  {
<a name="l00119"></a>00119 
<a name="l00120"></a>00120    my ($setNumber,$probNum,$psvn,$printlinesref,$rh_flags)= @_;
<a name="l00121"></a>00121    my @printlines;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 
<a name="l00124"></a>00124       my $coursel2hDirectory = getCoursel2hDirectory();
<a name="l00125"></a>00125       unless(-e $coursel2hDirectory ) {
<a name="l00126"></a>00126             &amp;createDirectory($coursel2hDirectory, $Global::l2h_set_directory_permission,
<a name="l00127"></a>00127             $Global::numericalGroupID);
<a name="l00128"></a>00128       }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130       unless(-e <span class="stringliteral">&quot;${coursel2hDirectory}set$setNumber&quot;</span>) {
<a name="l00131"></a>00131             &amp;createDirectory(<span class="stringliteral">&quot;${coursel2hDirectory}set$setNumber&quot;</span>,$Global::l2h_set_directory_permission,
<a name="l00132"></a>00132             $Global::numericalGroupID);
<a name="l00133"></a>00133       }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     my $PROBDIR = convertPath(<span class="stringliteral">&quot;${coursel2hDirectory}set$setNumber/$probNum-$psvn/&quot;</span>);
<a name="l00137"></a>00137     my $TMPPROBDIR = convertPath(<span class="stringliteral">&quot;${coursel2hDirectory}$probNum-$psvn/&quot;</span>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139       <span class="keywordflow">if</span> (! -e $PROBDIR) {  # no gifs of equations have been created
<a name="l00140"></a>00140             &amp;l2hcreate($setNumber,$probNum,$psvn,$printlinesref);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142       } <span class="keywordflow">else</span> {  # determine <span class="keywordflow">if</span> the gifs are older than the modifications of the source file
<a name="l00143"></a>00143 <span class="preprocessor">                #&amp;attachProbSetRecord($psvn);</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>            my $fileName = &amp;getProblemFileName($probNum,$psvn);
<a name="l00145"></a>00145             $fileName = <span class="stringliteral">&quot;${Global::templateDirectory}$fileName&quot;</span>;
<a name="l00146"></a>00146 <span class="preprocessor">                  #print &quot;\n\n The filename is $fileName \n\n&quot;;</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span>            my @probDirStat = stat $PROBDIR;
<a name="l00148"></a>00148             my @sourceFileStat = stat $fileName;
<a name="l00149"></a>00149 <span class="preprocessor">                  #print &quot;\n\n The source file age is $sourceFileStat[9] \n\n&quot;;</span>
<a name="l00150"></a>00150 <span class="preprocessor"></span><span class="preprocessor">                  #print &quot;\n\n The prob dir age is $probDirStat[9] \n\n&quot;;</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>
<a name="l00152"></a>00152             <span class="keywordflow">if</span> (($sourceFileStat[9] &gt; $probDirStat[9] ) or
<a name="l00153"></a>00153                                $rh_flags-&gt;{<span class="stringliteral">&#39;refreshCachedImages&#39;</span>}) {
<a name="l00154"></a>00154 <span class="preprocessor">                    ## source file is newer or solutions should be shown recreate the l2h cache</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>                    rmDirectoryAndFiles($PROBDIR);
<a name="l00156"></a>00156                     &amp;l2hcreate($setNumber,$probNum,$psvn,$printlinesref);
<a name="l00157"></a>00157             }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 
<a name="l00160"></a>00160       }
<a name="l00161"></a>00161 <span class="preprocessor">      #the problem has been rendered by Latex2HTML into this file:</span>
<a name="l00162"></a>00162 <span class="preprocessor"></span><span class="preprocessor">#      open(TEXXX, &quot;${PROBDIR}${psvn}output.html&quot;) || die &quot;Can&#39;t open ${PROBDIR}${psvn}output.html&quot;;</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>      open(TEXXX, <span class="stringliteral">&quot;${PROBDIR}${psvn}output.html&quot;</span>) or
<a name="l00164"></a>00164                warn &quot;ERROR: $0&quot;.
<a name="l00165"></a>00165                &quot;Can&#39;t open the HTML file: \n ${PROBDIR}${psvn}output.html\n(allegedly)<span class="stringliteral">&quot;.</span>
<a name="l00166"></a>00166 <span class="stringliteral">                &quot;</span>translated by latex2HTML\n at displayMacros.pl, line<span class="stringliteral">&quot; . __LINE__ ;</span>
<a name="l00167"></a>00167 <span class="stringliteral"></span>
<a name="l00168"></a>00168 <span class="stringliteral">      @printlines = &lt;TEXXX&gt;;</span>
<a name="l00169"></a>00169 <span class="stringliteral">      push(@printlines, &quot;</span>The file ${PROBDIR}${psvn}output.html was empty<span class="stringliteral">&quot;) unless @printlines;</span>
<a name="l00170"></a>00170 <span class="stringliteral">      #print &quot;</span>PRINTLINES<span class="stringliteral">&quot;,@printlines;</span>
<a name="l00171"></a>00171 <span class="stringliteral">      close(TEXXX);</span>
<a name="l00172"></a>00172 <span class="stringliteral"></span>
<a name="l00173"></a>00173 <span class="stringliteral">   @printlines;</span>
<a name="l00174"></a>00174 <span class="stringliteral">}</span>
<a name="l00175"></a>00175 <span class="stringliteral"></span>
<a name="l00176"></a>00176 <span class="stringliteral"></span>
<a name="l00177"></a>00177 <span class="stringliteral"></span>
<a name="l00178"></a>00178 <span class="stringliteral">###########################################################################################</span>
<a name="l00179"></a>00179 <span class="stringliteral"># Formats and displays the responses to submitted answers to the problem.  Returns a string.          #</span>
<a name="l00180"></a>00180 <span class="stringliteral">###########################################################################################</span>
<a name="l00181"></a>00181 <span class="stringliteral"></span>
<a name="l00182"></a>00182 <span class="stringliteral">sub display_answers {           # this will be put in displayMacros.pl soon.</span>
<a name="l00183"></a>00183 <span class="stringliteral">    #my ($displayCorrectAnswersQ,$showPartialCorrectAnswers,$rh_answer_results,$rh_problem_result)  = @_;</span>
<a name="l00184"></a>00184 <span class="stringliteral">    my  ($rh_answer_results,$rh_problem_result,$rh_flags)  = @_;</span>
<a name="l00185"></a>00185 <span class="stringliteral">    my $displayCorrectAnswersQ = $rh_flags -&gt;{displayCorrectAnswersQ};</span>
<a name="l00186"></a>00186 <span class="stringliteral">    my $showPartialCorrectAnswers = $rh_flags -&gt; {showPartialCorrectAnswers};</span>
<a name="l00187"></a>00187 <span class="stringliteral">    my @answer_entry_order = @{$rh_flags -&gt; {ANSWER_ENTRY_ORDER} };</span>
<a name="l00188"></a>00188 <span class="stringliteral">    my $ANSWER_PREFIX = $rh_flags -&gt; {ANSWER_PREFIX};</span>
<a name="l00189"></a>00189 <span class="stringliteral">    my  $allAnswersCorrectQ = 1;</span>
<a name="l00190"></a>00190 <span class="stringliteral">    my  $printedResponse=&#39;&#39;;</span>
<a name="l00191"></a>00191 <span class="stringliteral">    ###### Print appropriate response to submitted answers</span>
<a name="l00192"></a>00192 <span class="stringliteral">        my ($i,$answerIsCorrectQ, $normalizedSubmittedAnswer,$normalizedCorrectAnswer,$ans_name,$errors);</span>
<a name="l00193"></a>00193 <span class="stringliteral">        $i=0;</span>
<a name="l00194"></a>00194 <span class="stringliteral">#       $printedResponse .= &quot;</span>\n&lt;table border=0 cellpadding=0 cellspacing=0  bgcolor=\<span class="stringliteral">&quot;#cccccc\&quot;&gt;\n&quot;</span>;
<a name="l00195"></a>00195 <span class="preprocessor"># replace above line by next two lines as per Davide Cervone. AKP.</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>        $printedResponse .= <span class="stringliteral">&quot;\n&lt;table border=0 cellpadding=7 cellspacing=0 bgcolor=\&quot;#cccccc\&quot;&gt;\n&quot;</span>;
<a name="l00197"></a>00197         $printedResponse .= <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;table border=0 cellpadding=0 cellspacing=0&gt;\n&quot;</span>;
<a name="l00198"></a>00198         <span class="keywordflow">foreach</span> my $key ( @answer_entry_order ) {
<a name="l00199"></a>00199 
<a name="l00200"></a>00200             $i++;
<a name="l00201"></a>00201             $answerIsCorrectQ = $rh_answer_results -&gt;{$key} -&gt; {score};
<a name="l00202"></a>00202             $normalizedSubmittedAnswer = $rh_answer_results -&gt;{$key} -&gt; {student_ans};
<a name="l00203"></a>00203             $normalizedSubmittedAnswer = <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">if</span> ($normalizedSubmittedAnswer =~ /^error:\s+empty/);
<a name="l00204"></a>00204             $normalizedCorrectAnswer = $rh_answer_results -&gt;{$key} -&gt; {original_correct_ans};
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="preprocessor">                ##  Handle the case where the answer evaluator does not return original_correct_ans</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ((!defined $normalizedCorrectAnswer) or (!$normalizedCorrectAnswer =~ /\S/)) {
<a name="l00208"></a>00208                 $normalizedCorrectAnswer = $rh_answer_results -&gt;{$key} -&gt; {correct_ans};
<a name="l00209"></a>00209             }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211             $errors = $rh_answer_results -&gt;{$key} -&gt; {ans_message};
<a name="l00212"></a>00212             $errors = <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">if</span> ($errors eq <span class="stringliteral">&#39;empty&#39;</span>);
<a name="l00213"></a>00213 <span class="preprocessor">            #$ans_name = $rh_answer_results -&gt;{$key} -&gt; {ans_name};</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span><span class="preprocessor">            #$ans_name =~ s/$ANSWER_PREFIX//;    # this handles implicitly defined answer names.</span>
<a name="l00215"></a>00215 <span class="preprocessor"></span>            $ans_name = $i;  # just number the answers in order
<a name="l00216"></a>00216             $allAnswersCorrectQ = $allAnswersCorrectQ &amp;&amp; $answerIsCorrectQ;
<a name="l00217"></a>00217             $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt;&lt;TD align=left COLSPAN =2&gt;&lt;em&gt;Answer $ans_name entered:&lt;/em&gt;--&amp;gt; $normalizedSubmittedAnswer &amp;lt;-- &quot;</span>;
<a name="l00218"></a>00218             $printedResponse .=  <span class="stringliteral">&quot;&lt;B&gt;Correct. &lt;/B&gt;&lt;/TD&gt;&lt;/TR&gt;&quot;</span>   <span class="keywordflow">if</span>  ($answerIsCorrectQ &amp;&amp; $showPartialCorrectAnswers );
<a name="l00219"></a>00219             $printedResponse .=  <span class="stringliteral">&quot;&lt;B&gt;Incorrect. &lt;/B&gt;&lt;/TD&gt;&lt;/TR&gt;&quot;</span> <span class="keywordflow">if</span> (!($answerIsCorrectQ) &amp;&amp; $showPartialCorrectAnswers);
<a name="l00220"></a>00220             $errors =~ s/\n/&lt;BR&gt;/g;  ## convert newlines to &lt;BR&gt; in error messages as per Davide Cervone
<a name="l00221"></a>00221 <span class="preprocessor">            # change 9/2/00 by MEG -- give width in pixels rather than %.</span>
<a name="l00222"></a>00222 <span class="preprocessor"></span><span class="preprocessor">            # Some browsers break with %  widht which is not the standard</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span>            $printedResponse .=  <span class="stringliteral">&quot;\n&lt;TR&gt; &lt;TD align=left WIDTH = \&quot;50\&quot; &gt;&amp;nbsp;&lt;/TD&gt;&lt;TD align=left&gt;$errors&lt;/TD&gt;&lt;/TR&gt;&quot;</span> <span class="keywordflow">if</span> ($errors =~ /\w/);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225             $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt;&lt;TD align=left WIDTH = \&quot;50\&quot;&gt;&amp;nbsp;&lt;/TD&gt;              &lt;TD align=left&gt;&lt;em&gt;Correct answer:&lt;/em&gt; $normalizedCorrectAnswer&lt;/TD&gt;&lt;/TR&gt;&quot;</span> <span class="keywordflow">if</span> ($displayCorrectAnswersQ);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228         <span class="keywordflow">if</span> ($i == 1) {
<a name="l00229"></a>00229             $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt;&lt;TD align=left COLSPAN =2&gt;&lt;B&gt;The above answer is correct.&lt;/B&gt;&lt;BR&gt;&quot;</span> <span class="keywordflow">if</span> ($allAnswersCorrectQ);
<a name="l00230"></a>00230             $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt;&lt;TD align=left COLSPAN =2&gt;&lt;B&gt;The above answer is NOT correct.&lt;/B&gt;&lt;BR&gt;&quot;</span> <span class="keywordflow">if</span> (!($allAnswersCorrectQ));
<a name="l00231"></a>00231         }
<a name="l00232"></a>00232         <span class="keywordflow">else</span> {
<a name="l00233"></a>00233             $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt;&lt;TD align=left COLSPAN =2&gt;&lt;B&gt;All of the above answers are correct.&lt;/B&gt;&lt;BR&gt;&quot;</span> <span class="keywordflow">if</span> ($allAnswersCorrectQ);
<a name="l00234"></a>00234             $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt;&lt;TD align=left COLSPAN =2&gt;&lt;B&gt;At least one of the above answers is NOT correct.&lt;/B&gt;&lt;BR&gt;&quot;</span> <span class="keywordflow">if</span> (!($allAnswersCorrectQ));
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236         my $percentCorr = int(100*$rh_problem_result-&gt;{score} +.5);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238       $printedResponse .=<span class="stringliteral">&quot;\n&lt;TR&gt;&lt;TD align=left COLSPAN =2&gt;&lt;B&gt;Your score on this attempt is ${percentCorr}\%.&lt;/B&gt;&lt;BR&gt;&quot;</span>;
<a name="l00239"></a>00239 <span class="preprocessor">#     $printedResponse .= &quot;\n&lt;/table&gt;\n&quot;;</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span><span class="preprocessor"># replace above line by next line as per Davide Cervone. AKP.</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>      $printedResponse .= <span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;\n&lt;/table&gt;\n&quot;</span>;
<a name="l00242"></a>00242 <span class="preprocessor">#      $printedResponse .=&quot;\n problem grader is &quot;.$rh_problem_result-&gt;{type}.&quot; and the score is &quot;.$rh_problem_result-&gt;{score}.&quot;&lt;BR&gt;\n&quot;;</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>      $printedResponse;
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="preprocessor">###########################################################################################</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span><span class="preprocessor"># Previews submitted answers to the problem.  Returns a string.           #</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span><span class="preprocessor">###########################################################################################</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span>
<a name="l00250"></a>00250 sub preview_answers {
<a name="l00251"></a>00251     my  ($rh_answer_results,$rh_problem_result,$rh_flags)  = @_;
<a name="l00252"></a>00252     my @answer_entry_order = @{$rh_flags -&gt; {ANSWER_ENTRY_ORDER} };
<a name="l00253"></a>00253     my $ANSWER_PREFIX = $rh_flags -&gt; {ANSWER_PREFIX};
<a name="l00254"></a>00254     my $printedResponse =<span class="stringliteral">&#39;&#39;</span>;
<a name="l00255"></a>00255 <span class="preprocessor">    ###### Print appropriate response to submitted answers</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span>        my ($i,$original_student_ans,$normalizedSubmittedAnswer,$errors,$ans_name,$preview_text_string,$preview_latex_string);
<a name="l00257"></a>00257         my ($ans_evaluator_type, $value_word, $error_word, $show_value);
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         $i=0;
<a name="l00260"></a>00260         $printedResponse .= <span class="stringliteral">&quot;\n&lt;table border=0 cellpadding=0 cellspacing=0  &gt;\n&quot;</span>;
<a name="l00261"></a>00261         <span class="keywordflow">foreach</span> my $key ( @answer_entry_order ) {
<a name="l00262"></a>00262         $i++;
<a name="l00263"></a>00263         $ans_name = $rh_answer_results -&gt;{$key} -&gt; {ans_name};
<a name="l00264"></a>00264 <span class="preprocessor">        #$ans_name =~ s/$ANSWER_PREFIX//;    # this handles implicitly defined answer names.    #commented out by DME 6/6/2000</span>
<a name="l00265"></a>00265 <span class="preprocessor"></span>        $original_student_ans = $rh_answer_results -&gt;{$key} -&gt; {original_student_ans};
<a name="l00266"></a>00266         $normalizedSubmittedAnswer = $rh_answer_results -&gt;{$key} -&gt; {student_ans};
<a name="l00267"></a>00267         $errors = $rh_answer_results -&gt;{$key} -&gt; {ans_message};
<a name="l00268"></a>00268         $errors =~ s/\n/&lt;BR&gt;/g;  ## convert newlines to &lt;BR&gt; in error messages as per Davide Cervone
<a name="l00269"></a>00269         $preview_text_string =<span class="stringliteral">&#39;&#39;</span>;
<a name="l00270"></a>00270         $preview_text_string = $rh_answer_results -&gt;{$key} -&gt; {preview_text_string}
<a name="l00271"></a>00271             <span class="keywordflow">if</span> defined $rh_answer_results -&gt;{$key} -&gt; {preview_text_string};
<a name="l00272"></a>00272         $preview_latex_string =<span class="stringliteral">&#39;&#39;</span>;
<a name="l00273"></a>00273         $preview_latex_string = $rh_answer_results -&gt;{$key} -&gt; {preview_latex_string}
<a name="l00274"></a>00274             <span class="keywordflow">if</span> defined $rh_answer_results -&gt;{$key} -&gt; {preview_latex_string};
<a name="l00275"></a>00275         $ans_evaluator_type = $rh_answer_results -&gt;{$key} -&gt; {type};
<a name="l00276"></a>00276         $value_word = <span class="stringliteral">&#39;value:&#39;</span>;
<a name="l00277"></a>00277         $show_value = 0;
<a name="l00278"></a>00278         $show_value = 1 <span class="keywordflow">if</span> ((($ans_evaluator_type =~ /number/) and ($normalizedSubmittedAnswer =~ /\w/)) or ($normalizedSubmittedAnswer =~ /^error/));
<a name="l00279"></a>00279         $show_value = 0 <span class="keywordflow">if</span> ($normalizedSubmittedAnswer =~ /^error:\s+empty/);
<a name="l00280"></a>00280         $value_word = <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">if</span> ($normalizedSubmittedAnswer =~ /^error/);
<a name="l00281"></a>00281         $error_word = <span class="stringliteral">&#39;error:&#39;</span>;
<a name="l00282"></a>00282         $error_word = <span class="stringliteral">&#39;&#39;</span> <span class="keywordflow">if</span> ($errors =~ /^error:/);
<a name="l00283"></a>00283         $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt;&lt;TD align=left&gt;Ans $i &lt;/TD&gt;&quot;</span>;
<a name="l00284"></a>00284 <span class="preprocessor">        #$printedResponse .= &quot;\n&lt;TD align=left&gt;&lt;INPUT TYPE=\&quot;text\&quot; NAME=\&quot;${ANSWER_PREFIX}${ans_name}\&quot;  VALUE=\&quot;$original_student_ans\&quot; SIZE=70&gt;&lt;/TD&gt;&lt;/TR&gt;&quot;;  #commented out by DME 6/6/2000</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span>        $printedResponse .= <span class="stringliteral">&quot;\n&lt;TD align=left&gt;&lt;INPUT TYPE=\&quot;text\&quot; NAME=\&quot;${ans_name}\&quot;  VALUE=\&quot;$original_student_ans\&quot; SIZE=70&gt;&lt;/TD&gt;&lt;/TR&gt;&quot;</span>;
<a name="l00286"></a>00286         $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt; &lt;TD align=left WIDTH = \&quot;7%\&quot; &gt;&lt;/TD&gt;&lt;TD align=left&gt;parsed: $preview_text_string&lt;/TD&gt;&lt;/TR&gt;&quot;</span> <span class="keywordflow">if</span> ($preview_text_string =~ /\w/);
<a name="l00287"></a>00287         $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt; &lt;TD align=left WIDTH = \&quot;7%\&quot; &gt;&lt;/TD&gt;&lt;TD align=left&gt;${value_word} $normalizedSubmittedAnswer&lt;/TD&gt;&lt;/TR&gt;&quot;</span> <span class="keywordflow">if</span> $show_value == 1;
<a name="l00288"></a>00288         $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt; &lt;TD align=left WIDTH = \&quot;7%\&quot; &gt;&lt;/TD&gt;&lt;TD align=left&gt;${error_word} $errors&lt;/TD&gt;&lt;/TR&gt;&quot;</span> <span class="keywordflow">if</span> (($errors =~ /\w/) and ($errors ne <span class="stringliteral">&#39;empty&#39;</span>)) ;
<a name="l00289"></a>00289         <span class="keywordflow">if</span> ($preview_latex_string =~ /\w/) {
<a name="l00290"></a>00290             $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR&gt; &lt;TD align=left WIDTH = \&quot;7%\&quot; &gt;&lt;/TD&gt;&lt;TD align=left&gt;&quot;</span>;
<a name="l00291"></a>00291             $printedResponse .= <span class="stringliteral">&quot;\n &lt;APPLET CODE=\&quot;HotEqn.class\&quot; HEIGHT=\&quot;80\&quot; WIDTH=\&quot;500\&quot; ARCHIVE=\&quot;HotEqn.zip\&quot; NAME=\&quot;Equation\&quot; ALIGN=\&quot;middle\&quot; CODEBASE=\&quot;$Global::appletsURL\&quot;&gt; &quot;</span>;
<a name="l00292"></a>00292             $printedResponse .= <span class="stringliteral">&quot;\n &lt;PARAM NAME=\&quot;equation\&quot; VALUE=\&quot;$preview_latex_string\&quot;&gt;&lt;/APPLET&gt;&lt;/TD&gt;&lt;/TR&gt; &quot;</span>;
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294         $printedResponse .= <span class="stringliteral">&quot;\n&lt;TR Height = 5&gt;&lt;/TR&gt;&quot;</span>;
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297       $printedResponse .= <span class="stringliteral">&quot;\n&lt;/table&gt;\n&quot;</span>;
<a name="l00298"></a>00298       $printedResponse;
<a name="l00299"></a>00299 }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 sub lc_sort {  # <span class="keyword">this</span> sorts <a class="code" href="PGstringevaluators_8pl.html#a06b59ff01c251186550d61193ec7f328">strings</a> with letters and number groups, alternately lexigraphically and numerically
<a name="l00303"></a>00303 <span class="preprocessor">               # (lc stands for library of congress as in QA617.34R45)</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>    my($left,$right) = @_;
<a name="l00305"></a>00305 <span class="preprocessor">    # format  &quot;abcd345.57def34ABC&quot;;</span>
<a name="l00306"></a>00306 <span class="preprocessor"></span><span class="preprocessor">    # string assumed to begin with alpha</span>
<a name="l00307"></a>00307 <span class="preprocessor"></span><span class="preprocessor">    # string is split into alternating alpha and numeric groups</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span><span class="preprocessor">    # numeric groups match [\d\.]+</span>
<a name="l00309"></a>00309 <span class="preprocessor"></span><span class="preprocessor">    # numeric groups assumed to contain at least one digit, ( a period alone will cause and error)</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span><span class="preprocessor">    # alpha groups can contain any characters except digits and the period</span>
<a name="l00311"></a>00311 <span class="preprocessor"></span><span class="preprocessor">    # spaces in alpha groups will cause unexpected behavior</span>
<a name="l00312"></a>00312 <span class="preprocessor"></span><span class="preprocessor">    # sort is not case sensitive</span>
<a name="l00313"></a>00313 <span class="preprocessor"></span><span class="preprocessor">    # _ sorts after alpha characters</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span>
<a name="l00315"></a>00315 <span class="preprocessor">    # not case sensitive</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>
<a name="l00317"></a>00317     my @a = split( /([\d\.]+)/, $left);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     my @b = split( /([\d\.]+)/, $right);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321     my $out = undef;
<a name="l00322"></a>00322     my $mode = 0;  # even is lexic and odd is numeric
<a name="l00323"></a>00323     my($l,$r);
<a name="l00324"></a>00324     <span class="keywordflow">while</span> (@a) {
<a name="l00325"></a>00325         $l = shift @a;
<a name="l00326"></a>00326         $r = shift @b;
<a name="l00327"></a>00327         $out = ($mode++ % 2 == 0) ? uc($l) cmp uc($r) : $l &lt;=&gt; $r;  # lexic or numeric compare
<a name="l00328"></a>00328         last unless $out==0;   # stop unless $l and $r are different.
<a name="l00329"></a>00329 
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331    $out;
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="preprocessor">#####################################################################</span>
<a name="l00335"></a>00335 <span class="preprocessor"></span><span class="preprocessor"># Creates an insert which appears on the probSet page.              #</span>
<a name="l00336"></a>00336 <span class="preprocessor"></span><span class="preprocessor">#####################################################################</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>sub createDisplayedInsert
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339 <span class="preprocessor">   #my ($mode,$setNumber,$fileName,$psvn,$courseName,$printlinesref)= @_;</span>
<a name="l00340"></a>00340 <span class="preprocessor"></span>   my ($setNumber,$fileName,$psvn,$courseName,$printlinesref)= @_;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342    my @printlines=@$printlinesref;
<a name="l00343"></a>00343    my $PROBDIR;
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="preprocessor">#   if($mode eq &quot;HTML&quot; || $mode eq &#39;HTML_tth&#39;) {</span>
<a name="l00346"></a>00346 <span class="preprocessor"></span><span class="preprocessor">#           @printlines = &amp;createProblem2($mode,$fileName,$psvn,$courseName,$sourceref);</span>
<a name="l00347"></a>00347 <span class="preprocessor"></span><span class="preprocessor">#</span>
<a name="l00348"></a>00348 <span class="preprocessor"></span><span class="preprocessor">#   } elsif ($mode eq &#39;Latex2HTML&#39;)  {</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span><span class="preprocessor">     #latex2html processing</span>
<a name="l00350"></a>00350 <span class="preprocessor"></span>      my $coursel2hDirectory = getCoursel2hDirectory();
<a name="l00351"></a>00351       unless(-e $coursel2hDirectory ) {
<a name="l00352"></a>00352             &amp;createDirectory($coursel2hDirectory, $Global::l2h_set_directory_permission,
<a name="l00353"></a>00353             $Global::numericalGroupID);
<a name="l00354"></a>00354       }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356       unless(-e <span class="stringliteral">&quot;${coursel2hDirectory}set$setNumber&quot;</span>) {
<a name="l00357"></a>00357             &amp;createDirectory(<span class="stringliteral">&quot;${coursel2hDirectory}set$setNumber&quot;</span>,$Global::l2h_set_directory_permission,
<a name="l00358"></a>00358             $Global::numericalGroupID);
<a name="l00359"></a>00359       }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     my $shortFileName = $fileName;
<a name="l00362"></a>00362     $shortFileName =~ s|^.*?([^\/]*)$|$1|;
<a name="l00363"></a>00363     $shortFileName =~ s|\..*$||;
<a name="l00364"></a>00364     $PROBDIR = convertPath(<span class="stringliteral">&quot;${coursel2hDirectory}set$setNumber/$shortFileName-$psvn/&quot;</span>);
<a name="l00365"></a>00365     <span class="keywordflow">if</span> (! -e $PROBDIR) {
<a name="l00366"></a>00366         &amp;l2hcreate($setNumber,$shortFileName,$psvn,$printlinesref);
<a name="l00367"></a>00367     } <span class="keywordflow">else</span>  {
<a name="l00368"></a>00368 <span class="preprocessor">        #&amp;attachProbSetRecord($psvn);</span>
<a name="l00369"></a>00369 <span class="preprocessor"></span>            my $fullFileName = <span class="stringliteral">&quot;${Global::templateDirectory}$fileName&quot;</span>;
<a name="l00370"></a>00370 <span class="preprocessor">            #print &quot;\n\n The  full filename is $fullFileName \n\n&quot;;</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>            my @probDirStat = stat $PROBDIR;
<a name="l00372"></a>00372             my @sourceFileStat = stat $fullFileName;
<a name="l00373"></a>00373 <span class="preprocessor">            #print &quot;\n\n The source file age is $sourceFileStat[9] \n\n&quot;;</span>
<a name="l00374"></a>00374 <span class="preprocessor"></span><span class="preprocessor">            #print &quot;\n\n The prob dir age is $probDirStat[9] \n\n&quot;;</span>
<a name="l00375"></a>00375 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ($sourceFileStat[9] &gt; $probDirStat[9] )  { ## source file is newer
<a name="l00376"></a>00376                 rmDirectoryAndFiles($PROBDIR);
<a name="l00377"></a>00377                     &amp;l2hcreate($setNumber,$shortFileName,$psvn,$printlinesref);
<a name="l00378"></a>00378             }
<a name="l00379"></a>00379 <span class="preprocessor">             #else {&amp;createProblem2($mode, $fileName, $psvn,$courseName,$sourceref);}   ##initialize problem</span>
<a name="l00380"></a>00380 <span class="preprocessor"></span>
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 
<a name="l00384"></a>00384       open(TEXXX, <span class="stringliteral">&quot;${PROBDIR}${psvn}output.html&quot;</span>) or
<a name="l00385"></a>00385         die &quot;ERROR: $0 Can&#39;t open ${PROBDIR}${psvn}output.html<span class="stringliteral">&quot;;</span>
<a name="l00386"></a>00386 <span class="stringliteral">      @printlines = &lt;TEXXX&gt;;</span>
<a name="l00387"></a>00387 <span class="stringliteral">      close(TEXXX);</span>
<a name="l00388"></a>00388 <span class="stringliteral">#   } else  {</span>
<a name="l00389"></a>00389 <span class="stringliteral">#</span>
<a name="l00390"></a>00390 <span class="stringliteral">#         @printlines=&quot;</span>createDisplayedProblem: Error:  Mode is not HTML, HTML_tthHTML_tth or Latex2HTML.<span class="stringliteral">&quot;;</span>
<a name="l00391"></a>00391 <span class="stringliteral">#</span>
<a name="l00392"></a>00392 <span class="stringliteral">#</span>
<a name="l00393"></a>00393 <span class="stringliteral">#   }</span>
<a name="l00394"></a>00394 <span class="stringliteral">   @printlines;</span>
<a name="l00395"></a>00395 <span class="stringliteral">}</span>
<a name="l00396"></a>00396 <span class="stringliteral"></span>
<a name="l00397"></a>00397 <span class="stringliteral">##do not need this subroutine anymore</span>
<a name="l00398"></a>00398 <span class="stringliteral">#sub l2hcreateProb {</span>
<a name="l00399"></a>00399 <span class="stringliteral">#   my ($setNumber,$probNum,$psvn,$printlinesref)= @_;</span>
<a name="l00400"></a>00400 <span class="stringliteral">#   #my ($setNumber,$probNum,$psvn,$courseName,$printlinesref)= @_;</span>
<a name="l00401"></a>00401 <span class="stringliteral">#   #my $mode = &#39;Latex2HTML&#39;;</span>
<a name="l00402"></a>00402 <span class="stringliteral">#</span>
<a name="l00403"></a>00403 <span class="stringliteral">#   #my @printlines = &amp;createProblem($mode, $probNum, $psvn, $courseName,$sourceref,$refSubmittedAnswers);</span>
<a name="l00404"></a>00404 <span class="stringliteral">#   #my $printlinesref = \@printlines;</span>
<a name="l00405"></a>00405 <span class="stringliteral">#   my $tmpDirectory = &quot;</span>tmp/l2h/<span class="keyword">set</span>$setNumber/$probNum-$psvn/<span class="stringliteral">&quot;;</span>
<a name="l00406"></a>00406 <span class="stringliteral">#   l2hcreate($setNumber,$probNum,$psvn,$printlinesref)</span>
<a name="l00407"></a>00407 <span class="stringliteral">#}</span>
<a name="l00408"></a>00408 <span class="stringliteral"></span>
<a name="l00409"></a>00409 <span class="stringliteral">#do not use this subroutine anymore</span>
<a name="l00410"></a>00410 <span class="stringliteral">#sub l2hcreateInsert {</span>
<a name="l00411"></a>00411 <span class="stringliteral">#   my ($setNumber,$shortFileName,$psvn,$printlinesref)= @_;</span>
<a name="l00412"></a>00412 <span class="stringliteral">#   #my $mode = &#39;Latex2HTML&#39;;</span>
<a name="l00413"></a>00413 <span class="stringliteral">#   #my @printlines = &amp;createProblem2($mode, $fileName, $psvn,$courseName,$sourceref);</span>
<a name="l00414"></a>00414 <span class="stringliteral">#   #my $printlinesref = \@printlines;</span>
<a name="l00415"></a>00415 <span class="stringliteral">#   #my $shortFileName = $fileName;</span>
<a name="l00416"></a>00416 <span class="stringliteral">#   #$shortFileName =~ s|^.*?([^\/]*)$|$1|;</span>
<a name="l00417"></a>00417 <span class="stringliteral">#   #my $tmpDirectory = &quot;</span>tmp/l2h/<span class="keyword">set</span>$setNumber/$shortFileName-$psvn/<span class="stringliteral">&quot;;</span>
<a name="l00418"></a>00418 <span class="stringliteral">#   l2hcreate($setNumber,$shortFileName,$psvn,$printlinesref)</span>
<a name="l00419"></a>00419 <span class="stringliteral">#}</span>
<a name="l00420"></a>00420 <span class="stringliteral"></span>
<a name="l00421"></a>00421 <span class="stringliteral">sub l2hcreate {     ## for latex2HTML 96.1 and 98.1</span>
<a name="l00422"></a>00422 <span class="stringliteral">   my ($setNumber,$probNum,$psvn,$printlinesref) = @_;</span>
<a name="l00423"></a>00423 <span class="stringliteral"></span>
<a name="l00424"></a>00424 <span class="stringliteral">   # warn &quot;</span>l2hcreate is being executed displaymacros.pl line <span class="stringliteral">&quot;.__LINE__;</span>
<a name="l00425"></a>00425 <span class="stringliteral"></span>
<a name="l00426"></a>00426 <span class="stringliteral">   my $PROBDIR = convertPath(&amp;getCoursel2hDirectory.&quot;</span><span class="keyword">set</span>$setNumber/$probNum-$psvn/<span class="stringliteral">&quot;);</span>
<a name="l00427"></a>00427 <span class="stringliteral">   my $TMPPROBDIR = convertPath(&amp;getCoursel2hDirectory.&quot;</span>$probNum-$psvn/<span class="stringliteral">&quot;);</span>
<a name="l00428"></a>00428 <span class="stringliteral">   my $PROBURL = &amp;getCoursel2hURL.&quot;</span><span class="keyword">set</span>$setNumber/$probNum-$psvn/<span class="stringliteral">&quot;;</span>
<a name="l00429"></a>00429 <span class="stringliteral"></span>
<a name="l00430"></a>00430 <span class="stringliteral">   &amp;createDirectory($TMPPROBDIR,$Global::l2h_prob_directory_permission,$Global::numericalGroupID)</span>
<a name="l00431"></a>00431 <span class="stringliteral">     unless(-e &quot;</span>$TMPPROBDIR<span class="stringliteral">&quot;);</span>
<a name="l00432"></a>00432 <span class="stringliteral"></span>
<a name="l00433"></a>00433 <span class="stringliteral">   open(OUTTEXFILE, &quot;</span>&gt;$TMPPROBDIR${psvn}output.tex<span class="stringliteral">&quot;) or die &quot;</span>Can<span class="stringliteral">&#39;t open temporary file $TMPPROBDIR${psvn}output.tex&quot;;</span>
<a name="l00434"></a>00434 <span class="stringliteral"></span>
<a name="l00435"></a>00435 <span class="stringliteral">   print OUTTEXFILE &amp;texInput($Global::TEX_PROB_PREAMBLE);</span>
<a name="l00436"></a>00436 <span class="stringliteral">   print OUTTEXFILE &amp;texInput($Global::TEX_PROB_HEADER);</span>
<a name="l00437"></a>00437 <span class="stringliteral">   print OUTTEXFILE @$printlinesref;</span>
<a name="l00438"></a>00438 <span class="stringliteral">   print OUTTEXFILE &amp;texInput($Global::TEX_PROB_FOOTER);</span>
<a name="l00439"></a>00439 <span class="stringliteral">   close(OUTTEXFILE);</span>
<a name="l00440"></a>00440 <span class="stringliteral"></span>
<a name="l00441"></a>00441 <span class="stringliteral">   ## Give this temporary file permission 666 in case the process dies before it it deleted 60 lines further down</span>
<a name="l00442"></a>00442 <span class="stringliteral">   chmod(0666, &quot;$TMPPROBDIR${psvn}output.tex&quot;);</span>
<a name="l00443"></a>00443 <span class="stringliteral"></span>
<a name="l00444"></a>00444 <span class="stringliteral">                  ##  system(&quot;/usr/math/bin/latex2html -init_file ${Global::mainDirectory}latex2html.init -dir $PROBDIR -prefix $psvn ${htmlDirectory}tmp/l2h/${psvn}output.tex &gt; ${htmlDirectory}tmp/l2h/${psvn}l2h.log&quot;);</span>
<a name="l00445"></a>00445 <span class="stringliteral">   my $latex2HTML_result = &amp;makeL2H($TMPPROBDIR, $psvn) ;</span>
<a name="l00446"></a>00446 <span class="stringliteral">   warn( &quot;LaTeX2HTML failed. Returned with status: $latex2HTML_result\n&quot; ) if $latex2HTML_result ;</span>
<a name="l00447"></a>00447 <span class="stringliteral"></span>
<a name="l00448"></a>00448 <span class="stringliteral">   ##Get rid of all unwanted stuff in html document created by latex2html</span>
<a name="l00449"></a>00449 <span class="stringliteral">   unless(-e &quot;${TMPPROBDIR}${psvn}output.html&quot;) {</span>
<a name="l00450"></a>00450 <span class="stringliteral">        warn &quot;Can&#39;</span>t rename ${TMPPROBDIR}${psvn}output.html<span class="stringliteral">&quot;;</span>
<a name="l00451"></a>00451 <span class="stringliteral">        return (0);  ### there was a failure in latex2html processing</span>
<a name="l00452"></a>00452 <span class="stringliteral">                     ### we just give a warning so that so that l2hPrecreateSet.pl can continue</span>
<a name="l00453"></a>00453 <span class="stringliteral">   }</span>
<a name="l00454"></a>00454 <span class="stringliteral"></span>
<a name="l00455"></a>00455 <span class="stringliteral">   rename(&quot;</span>${TMPPROBDIR}${psvn}output.html<span class="stringliteral">&quot;,&quot;</span>${TMPPROBDIR}${psvn}output.html.org<span class="stringliteral">&quot;) or</span>
<a name="l00456"></a>00456 <span class="stringliteral">     warn &quot;</span>Can<span class="stringliteral">&#39;t rename ${TMPPROBDIR}${psvn}output.html at &quot;. __LINE__;</span>
<a name="l00457"></a>00457 <span class="stringliteral">   open(TEXORG, &quot;${TMPPROBDIR}${psvn}output.html.org&quot;) or</span>
<a name="l00458"></a>00458 <span class="stringliteral">     warn &quot;Can&#39;</span>t open ${TMPPROBDIR}${psvn}output.html.org<span class="stringliteral">&quot;;</span>
<a name="l00459"></a>00459 <span class="stringliteral">   my @l2hOutputArray;</span>
<a name="l00460"></a>00460 <span class="stringliteral"></span>
<a name="l00461"></a>00461 <span class="stringliteral"></span>
<a name="l00462"></a>00462 <span class="stringliteral"></span>
<a name="l00463"></a>00463 <span class="stringliteral"></span>
<a name="l00464"></a>00464 <span class="stringliteral">   BLK: {  # This is protection to make absolutely sure that the line separater is set properly.</span>
<a name="l00465"></a>00465 <span class="stringliteral">           # It&#39;s still a mystery as to where this becomes defined to be something else.</span>
<a name="l00466"></a>00466 <span class="stringliteral">       local($/);</span>
<a name="l00467"></a>00467 <span class="stringliteral">       $/ = &quot;</span>\n<span class="stringliteral">&quot;;</span>
<a name="l00468"></a>00468 <span class="stringliteral">       @l2hOutputArray = &lt;TEXORG&gt;;</span>
<a name="l00469"></a>00469 <span class="stringliteral"></span>
<a name="l00470"></a>00470 <span class="stringliteral"></span>
<a name="l00471"></a>00471 <span class="stringliteral">   }</span>
<a name="l00472"></a>00472 <span class="stringliteral"></span>
<a name="l00473"></a>00473 <span class="stringliteral">   close(TEXORG);</span>
<a name="l00474"></a>00474 <span class="stringliteral">   open(TEXNEW, &quot;</span>&gt;${TMPPROBDIR}${psvn}output.html<span class="stringliteral">&quot;) or</span>
<a name="l00475"></a>00475 <span class="stringliteral">     die &quot;</span>Can<span class="stringliteral">&#39;t open ${TMPPROBDIR}${psvn}output.html&quot;;</span>
<a name="l00476"></a>00476 <span class="stringliteral"></span>
<a name="l00477"></a>00477 <span class="stringliteral"></span>
<a name="l00478"></a>00478 <span class="stringliteral">    foreach (@l2hOutputArray) {</span>
<a name="l00479"></a>00479 <span class="stringliteral">        if($_ =~ /^&lt;META/) {next;}</span>
<a name="l00480"></a>00480 <span class="stringliteral">        if($_ =~ /^&lt;!DOCTYPE HTML PUBLIC/) {next;}</span>
<a name="l00481"></a>00481 <span class="stringliteral">        if($_ =~ /^&lt;HTML&gt;/) {next;}</span>
<a name="l00482"></a>00482 <span class="stringliteral">        if($_ =~ /^&lt;HEAD&gt;/) {next;}</span>
<a name="l00483"></a>00483 <span class="stringliteral">        if($_ =~ /^&lt;TITLE&gt;/) {next;}</span>
<a name="l00484"></a>00484 <span class="stringliteral">        if($_ =~ /^&lt;LINK REL/) {next;}</span>
<a name="l00485"></a>00485 <span class="stringliteral">        if($_ =~ /^&lt;\/HEAD&gt;/) {next;}</span>
<a name="l00486"></a>00486 <span class="stringliteral">        if($_ =~ /^&lt;BODY/) {next;}</span>
<a name="l00487"></a>00487 <span class="stringliteral">        if($_ =~ /^&lt;\/BODY&gt;/) {next;}</span>
<a name="l00488"></a>00488 <span class="stringliteral">        if($_ =~ /^&lt;\/HTML&gt;/) {next;}</span>
<a name="l00489"></a>00489 <span class="stringliteral">        if($_ =~ /^&lt;BR&gt; &lt;HR&gt;/) {next;}</span>
<a name="l00490"></a>00490 <span class="stringliteral"></span>
<a name="l00491"></a>00491 <span class="stringliteral">        print TEXNEW ;</span>
<a name="l00492"></a>00492 <span class="stringliteral">    }</span>
<a name="l00493"></a>00493 <span class="stringliteral"></span>
<a name="l00494"></a>00494 <span class="stringliteral"></span>
<a name="l00495"></a>00495 <span class="stringliteral">    close(TEXNEW);</span>
<a name="l00496"></a>00496 <span class="stringliteral"></span>
<a name="l00497"></a>00497 <span class="stringliteral">         ## Now do global multiline changes on whole file</span>
<a name="l00498"></a>00498 <span class="stringliteral"></span>
<a name="l00499"></a>00499 <span class="stringliteral">    open(TEXNEW, &quot;${TMPPROBDIR}${psvn}output.html&quot;) or</span>
<a name="l00500"></a>00500 <span class="stringliteral">     die &quot;Can&#39;</span>t open ${TMPPROBDIR}${psvn}output.html<span class="stringliteral">&quot;;</span>
<a name="l00501"></a>00501 <span class="stringliteral">    @l2hOutputArray = &lt;TEXNEW&gt;;</span>
<a name="l00502"></a>00502 <span class="stringliteral">    close(TEXNEW);</span>
<a name="l00503"></a>00503 <span class="stringliteral">    my $l2hOutputString = join(&#39;&#39;,@l2hOutputArray);</span>
<a name="l00504"></a>00504 <span class="stringliteral"></span>
<a name="l00505"></a>00505 <span class="stringliteral">               ## make gif images created by latex2html locatable by server</span>
<a name="l00506"></a>00506 <span class="stringliteral">               ## NOTE: $htmlURL is defined in webworkCourse.ph . Often this will</span>
<a name="l00507"></a>00507 <span class="stringliteral">               ## will be a link appearing in a public_html_docs directory.</span>
<a name="l00508"></a>00508 <span class="stringliteral">               ## The $htmlURL, any links, and the next line must be coordinated.</span>
<a name="l00509"></a>00509 <span class="stringliteral"></span>
<a name="l00510"></a>00510 <span class="stringliteral">    $l2hOutputString =~ s|${psvn}img|${PROBURL}${psvn}img|g;</span>
<a name="l00511"></a>00511 <span class="stringliteral"></span>
<a name="l00512"></a>00512 <span class="stringliteral">                 ## remove multiline comments</span>
<a name="l00513"></a>00513 <span class="stringliteral">    $l2hOutputString =~ s|&lt;!--.*?--&gt;\n||sg;</span>
<a name="l00514"></a>00514 <span class="stringliteral"></span>
<a name="l00515"></a>00515 <span class="stringliteral">    open(TEXNEW, &quot;</span>&gt;${TMPPROBDIR}${psvn}output.html<span class="stringliteral">&quot;) or</span>
<a name="l00516"></a>00516 <span class="stringliteral">     die &quot;</span>Can<span class="stringliteral">&#39;t open ${TMPPROBDIR}${psvn}output.html&quot;;</span>
<a name="l00517"></a>00517 <span class="stringliteral">    print TEXNEW $l2hOutputString;</span>
<a name="l00518"></a>00518 <span class="stringliteral">    close(TEXNEW);</span>
<a name="l00519"></a>00519 <span class="stringliteral"></span>
<a name="l00520"></a>00520 <span class="stringliteral">               ## remove unneeded files</span>
<a name="l00521"></a>00521 <span class="stringliteral"></span>
<a name="l00522"></a>00522 <span class="stringliteral">    unless ($debug) {unlink(&quot;${TMPPROBDIR}${psvn}output.html.org&quot;);}</span>
<a name="l00523"></a>00523 <span class="stringliteral">    unless ($debug) {unlink(&lt;${TMPPROBDIR}*images.*&gt;);}</span>
<a name="l00524"></a>00524 <span class="stringliteral">    unless ($debug) {unlink(&lt;${TMPPROBDIR}.*.db&gt;);}</span>
<a name="l00525"></a>00525 <span class="stringliteral">    unless ($debug) {unlink(&lt;${TMPPROBDIR}*.db&gt;);}</span>
<a name="l00526"></a>00526 <span class="stringliteral">    unless ($debug) {unlink(&lt;${TMPPROBDIR}IMG_PARAMS.*&gt;);}</span>
<a name="l00527"></a>00527 <span class="stringliteral">    unless ($debug) {unlink(&lt;${TMPPROBDIR}*.pl&gt;);}</span>
<a name="l00528"></a>00528 <span class="stringliteral">    unless ($debug) {unlink(&lt;${TMPPROBDIR}*.css&gt;);}</span>
<a name="l00529"></a>00529 <span class="stringliteral">    unless ($debug) {unlink(&quot;${TMPPROBDIR}index.html&quot;);}</span>
<a name="l00530"></a>00530 <span class="stringliteral">    unless ($debug) {unlink(&quot;${TMPPROBDIR}${psvn}output.tex&quot;);}</span>
<a name="l00531"></a>00531 <span class="stringliteral">    unless ($debug) {unlink(&quot;${TMPPROBDIR}${psvn}l2h.log&quot;);}</span>
<a name="l00532"></a>00532 <span class="stringliteral">    unless ($debug) {</span>
<a name="l00533"></a>00533 <span class="stringliteral">        my @allfiles = ();</span>
<a name="l00534"></a>00534 <span class="stringliteral">        opendir( DIRHANDLE, &quot;$TMPPROBDIR&quot;) || warn qq/Can&#39;</span>t read directory $TMPPROBDIR $!/;
<a name="l00535"></a>00535         @allfiles = map <span class="stringliteral">&quot;$TMPPROBDIR$_&quot;</span>, grep( /^l2h/, readdir DIRHANDLE);
<a name="l00536"></a>00536         closedir(DIRHANDLE);
<a name="l00537"></a>00537         my $l2hTempDir = $allfiles[0];
<a name="l00538"></a>00538         <span class="keywordflow">if</span> (defined $l2hTempDir)  {
<a name="l00539"></a>00539             unlink(&lt;$l2hTempDir<span class="comment">/*&gt;);</span>
<a name="l00540"></a>00540 <span class="comment">            rmdir ($l2hTempDir);</span>
<a name="l00541"></a>00541 <span class="comment">        }</span>
<a name="l00542"></a>00542 <span class="comment">    }</span>
<a name="l00543"></a>00543 <span class="comment"></span>
<a name="l00544"></a>00544 <span class="comment">               ## change permission and group on remaining files</span>
<a name="l00545"></a>00545 <span class="comment">    chmod($Global::l2h_data_permission, glob(&quot;${TMPPROBDIR}*&quot;));</span>
<a name="l00546"></a>00546 <span class="comment">    chown(-1,$Global::numericalGroupID,glob(&quot;${TMPPROBDIR}*&quot;));</span>
<a name="l00547"></a>00547 <span class="comment"></span>
<a name="l00548"></a>00548 <span class="comment">    ## Now that all the processing has been done, rename the $TMPPROBDIR TO $PROBDIR</span>
<a name="l00549"></a>00549 <span class="comment"></span>
<a name="l00550"></a>00550 <span class="comment">     rename(&quot;$TMPPROBDIR&quot;,&quot;$PROBDIR&quot;) or</span>
<a name="l00551"></a>00551 <span class="comment">    warn &quot;Can&#39;t rename the temporary problem directory:\n $TMPPROBDIR to $PROBDIR\n at displayMacros.pl , line: &quot; . __LINE__ ;</span>
<a name="l00552"></a>00552 <span class="comment"></span>
<a name="l00553"></a>00553 <span class="comment">}</span>
<a name="l00554"></a>00554 <span class="comment"></span>
<a name="l00555"></a>00555 <span class="comment"></span>
<a name="l00556"></a>00556 <span class="comment">#########################################################################################################</span>
<a name="l00557"></a>00557 <span class="comment">##Subroutine that makes answers sticky in l2h mode                                                      #</span>
<a name="l00558"></a>00558 <span class="comment">#                                                                                                       #</span>
<a name="l00559"></a>00559 <span class="comment"># INPUT:        $rh_submittedAnswers    Reference to a hash containing the answers submitted            #</span>
<a name="l00560"></a>00560 <span class="comment">#               $ra_printLines          Reference to an array containing the (HTML) text to be output   #</span>
<a name="l00561"></a>00561 <span class="comment">#               $rh_flags               Reference to a hash containing flags; specifically a            #</span>
<a name="l00562"></a>00562 <span class="comment">#                                           reference to an array containing the answer field labels    #</span>
<a name="l00563"></a>00563 <span class="comment">#                                                                                                       #</span>
<a name="l00564"></a>00564 <span class="comment"># OUTPUT:       @printLines             An array containing the (modified) text to be output            #</span>
<a name="l00565"></a>00565 <span class="comment">#                                                                                                       #</span>
<a name="l00566"></a>00566 <span class="comment"># OVERVIEW:     l2h_sticky_answers is given HTML text, a list of submitted answers, and a list of       #</span>
<a name="l00567"></a>00567 <span class="comment">#               answer field labels. Its job is to retain the user&#39;s answers between submissions        #</span>
<a name="l00568"></a>00568 <span class="comment">#               when in typeset mode (this is handled elsewhere in the text modes). Basically, its      #</span>
<a name="l00569"></a>00569 <span class="comment">#               job is to act as a &quot;filter&quot; for the HTML text, replacing the answer fields that have    #</span>
<a name="l00570"></a>00570 <span class="comment">#               been reset with fields containing the previously entered answers, returning the         #</span>
<a name="l00571"></a>00571 <span class="comment">#               modified text. A brief high-level overview of the algorithm follows:                    #</span>
<a name="l00572"></a>00572 <span class="comment">#                                                                                                       #</span>
<a name="l00573"></a>00573 <span class="comment"># ALGORITHM:    The references are first dereferenced. The incoming text is first joined into           #</span>
<a name="l00574"></a>00574 <span class="comment">#               one string. It is then split up again, but not by line. Rather, the text is split       #</span>
<a name="l00575"></a>00575 <span class="comment">#               such that each array entry is either text which can be ignored, or a single             #</span>
<a name="l00576"></a>00576 <span class="comment">#               &lt;INPUT...&gt; tag. Each entry is then processed. If it is an &lt;INPUT&gt; tag, then it          #</span>
<a name="l00577"></a>00577 <span class="comment">#               must be checked for the presence of each answer field label for which a value was       #</span>
<a name="l00578"></a>00578 <span class="comment">#               submitted (there are many &lt;INPUT&gt; fields which are not answer fields, so we can&#39;t       #</span>
<a name="l00579"></a>00579 <span class="comment">#               assume that consecutive &lt;INPUT&gt; fields correspond to consecutive answer labels).        #</span>
<a name="l00580"></a>00580 <span class="comment">#               If a label is found, the blank value space is replaced with the appropriate             #</span>
<a name="l00581"></a>00581 <span class="comment">#               submitted answer (note that we can assume that there is a one-to-one correspondence     #</span>
<a name="l00582"></a>00582 <span class="comment">#               between answer labels and submitted answers; this is guaranteed by the specs). Radio    #</span>
<a name="l00583"></a>00583 <span class="comment">#               buttons and checkboxes are handled specially; see below. The modified text is then      #</span>
<a name="l00584"></a>00584 <span class="comment">#               added to the output string, which is split on a placeholder such that the output        #</span>
<a name="l00585"></a>00585 <span class="comment">#               array has the same number of entries as the input array (this is not required, but      #</span>
<a name="l00586"></a>00586 <span class="comment">#               might avoid some subtle bug in the future).                                             #</span>
<a name="l00587"></a>00587 <span class="comment">#                                                                                                       #</span>
<a name="l00588"></a>00588 <span class="comment"># NOTE:         The specifications seem to require that the input text array consist of one             #</span>
<a name="l00589"></a>00589 <span class="comment">#               field for each line of text. However, it appears that the input is actually one         #</span>
<a name="l00590"></a>00590 <span class="comment">#               field, with newline characters separating lines. This function should accept            #</span>
<a name="l00591"></a>00591 <span class="comment">#               either form of input, although the &quot;correct&quot; form of one field per line has not         #</span>
<a name="l00592"></a>00592 <span class="comment">#               been tested. It is possible that, if input is received in this form AND the             #</span>
<a name="l00593"></a>00593 <span class="comment">#               newline characters have been truncated, the output could be garbled.                    #</span>
<a name="l00594"></a>00594 <span class="comment">#                                                                                                       #</span>
<a name="l00595"></a>00595 <span class="comment">#                                                                           --David Etlinger 6/7/2000   #</span>
<a name="l00596"></a>00596 <span class="comment">#                                                                                                       #</span>
<a name="l00597"></a>00597 <span class="comment"># ADDED:        Added a few lines of code to properly handle radio buttons. Checkboxes still need       #</span>
<a name="l00598"></a>00598 <span class="comment">#               to be implemented.                                                                      #</span>
<a name="l00599"></a>00599 <span class="comment">#                                                                           --David Etlinger 6/14/2000  #</span>
<a name="l00600"></a>00600 <span class="comment">#                                                                                                       #</span>
<a name="l00601"></a>00601 <span class="comment"># ADDED:        Added code to handle checkboxes. This is complicated because the submitted checkboxes   #</span>
<a name="l00602"></a>00602 <span class="comment">#               are originally stored as a single string with &quot;\0&quot; as a delimiter. If the input type    #</span>
<a name="l00603"></a>00603 <span class="comment">#               is determined to be checkboxes, the string is first split into an array. A hash key     #</span>
<a name="l00604"></a>00604 <span class="comment">#               in a special checkbox array is then made to point to the array. This is done because    #</span>
<a name="l00605"></a>00605 <span class="comment">#               there might be more than one checkbox set in a single question. Each time an input line #</span>
<a name="l00606"></a>00606 <span class="comment">#               of type checkbox appears, the next value in this array is popped into a temp variable.  #</span>
<a name="l00607"></a>00607 <span class="comment">#               If it is determined that the line being processed corresponds to this value, the line   #</span>
<a name="l00608"></a>00608 <span class="comment">#               is processed (made &quot;sticky&quot;); otherwise, the value is pushed back on the array. The     #</span>
<a name="l00609"></a>00609 <span class="comment">#               fact that the number of checked cehckboxes is known but the total number of checkboxes  #</span>
<a name="l00610"></a>00610 <span class="comment">#               is not means that a given line of input type checkbox might or might not correspond     #</span>
<a name="l00611"></a>00611 <span class="comment">#               to the next value in the checkbox array. (I hope this explanation is clear enough!)     #</span>
<a name="l00612"></a>00612 <span class="comment">#                                                                           --David Etlinger 6/28/2000  #</span>
<a name="l00613"></a>00613 <span class="comment">#########################################################################################################</span>
<a name="l00614"></a>00614 <span class="comment"></span>
<a name="l00615"></a>00615 <span class="comment">sub l2h_sticky_answers {</span>
<a name="l00616"></a>00616 <span class="comment">    my ( $rh_submittedAnswers, $ra_printLines, $rh_flags ) = @_;</span>
<a name="l00617"></a>00617 <span class="comment"></span>
<a name="l00618"></a>00618 <span class="comment">    #warn (&quot;rh_submittedAnswers = \@rh_submittedAnswers&quot;);</span>
<a name="l00619"></a>00619 <span class="comment">    #warn (&quot;ra_printLines = \@{ra_printLines}&quot;);</span>
<a name="l00620"></a>00620 <span class="comment">    #warn (&quot;rh_flags = \@{rh_flags}&quot;);</span>
<a name="l00621"></a>00621 <span class="comment"></span>
<a name="l00622"></a>00622 <span class="comment">    my %submittedAnswers = %{$rh_submittedAnswers};</span>
<a name="l00623"></a>00623 <span class="comment">    my @printLines = @{$ra_printLines};</span>
<a name="l00624"></a>00624 <span class="comment">    my @answerLabels = @{$rh_flags -&gt; {ANSWER_ENTRY_ORDER}};</span>
<a name="l00625"></a>00625 <span class="comment"></span>
<a name="l00626"></a>00626 <span class="comment">    my $line;                   # holds the text of each line</span>
<a name="l00627"></a>00627 <span class="comment">    my $label;                  # holds each answer label</span>
<a name="l00628"></a>00628 <span class="comment">    my $counter = 0;            # holds the index of the current answer</span>
<a name="l00629"></a>00629 <span class="comment">    my $output;                 # holds the text the subroutine returns</span>
<a name="l00630"></a>00630 <span class="comment"></span>
<a name="l00631"></a>00631 <span class="comment">    my $answer_value;</span>
<a name="l00632"></a>00632 <span class="comment"></span>
<a name="l00633"></a>00633 <span class="comment">    my %checkboxAns;            # holder for the checkbox multi-part answers</span>
<a name="l00634"></a>00634 <span class="comment">    my $nextCheckboxAns;        # temp holder for the next checkbox answer to be processed</span>
<a name="l00635"></a>00635 <span class="comment"></span>
<a name="l00636"></a>00636 <span class="comment">    my $placeholder = &quot;\x253&quot;;  # unused hex character to join text lines with</span>
<a name="l00637"></a>00637 <span class="comment"></span>
<a name="l00638"></a>00638 <span class="comment">    #first, convert the array of text lines to one string...</span>
<a name="l00639"></a>00639 <span class="comment">    my $text = join( &quot;$placeholder&quot;, @printLines );</span>
<a name="l00640"></a>00640 <span class="comment"></span>
<a name="l00641"></a>00641 <span class="comment">    #then, split it such that a line consists of either text</span>
<a name="l00642"></a>00642 <span class="comment">    #or a single &lt;INPUT&gt; tag (case insensitive; note also that</span>
<a name="l00643"></a>00643 <span class="comment">    #whitespace within the &lt;INPUT&gt; tag is accounted for).</span>
<a name="l00644"></a>00644 <span class="comment">    #   NOTE -- the regular expression searches for &quot;&lt;&quot;, then any</span>
<a name="l00645"></a>00645 <span class="comment">    #   amount of whitespace, then &quot;INPUT&quot;, then any number of</span>
<a name="l00646"></a>00646 <span class="comment">    #   characters that aren&#39;t &quot;&gt;&quot;, then &quot;&gt;&quot;. I think that instead of</span>
<a name="l00647"></a>00647 <span class="comment">    #   searching for characters that aren&#39;t &quot;&gt;&quot;, I could have instead</span>
<a name="l00648"></a>00648 <span class="comment">    #   searched to match a minimal number of characters (using ?), and</span>
<a name="l00649"></a>00649 <span class="comment">    #   then &quot;&gt;&quot;. I don&#39;t know regular expressions well enough to tell</span>
<a name="l00650"></a>00650 <span class="comment">    #   if this might lead to some subtle difference.</span>
<a name="l00651"></a>00651 <span class="comment">    my @textLines = split( m|(&lt;\s*INPUT[^&gt;]*&gt;)|is, $text );</span>
<a name="l00652"></a>00652 <span class="comment">    #my @textLines = split( m|(&lt;\s*INPUT.*?&gt;)|is, $text );</span>
<a name="l00653"></a>00653 <span class="comment"></span>
<a name="l00654"></a>00654 <span class="comment">    foreach $line ( @textLines ) {</span>
<a name="l00655"></a>00655 <span class="comment">        if( $line =~ m|&lt;\s*INPUT|i ) {</span>
<a name="l00656"></a>00656 <span class="comment">            foreach $label ( @answerLabels ) {</span>
<a name="l00657"></a>00657 <span class="comment">                next unless exists( $submittedAnswers{$label} );  # skip if no answer was submitted.</span>
<a name="l00658"></a>00658 <span class="comment">                if( $line =~ m|NAME\s*=\s*&quot;$label&quot;|i ) {</span>
<a name="l00659"></a>00659 <span class="comment">                    if( $line =~ m|TYPE\s*=\s*RADIO|i ) {           #handle radio buttons</span>
<a name="l00660"></a>00660 <span class="comment">                        $line =~ s|VALUE\s*=\s*&quot;$submittedAnswers{$label}&quot;|VALUE = &quot;$submittedAnswers{$label}&quot; CHECKED|i;</span>
<a name="l00661"></a>00661 <span class="comment">                    }</span>
<a name="l00662"></a>00662 <span class="comment">                    elsif( $line =~ m|TYPE\s*=\s*CHECKBOX|i ) {</span>
<a name="l00663"></a>00663 <span class="comment">                        #make the hash key point to an anonymous array</span>
<a name="l00664"></a>00664 <span class="comment">                        $checkboxAns{$label} = [ split( &quot;\0&quot;, $submittedAnswers{$label} ) ] if not exists( $checkboxAns{$label} );</span>
<a name="l00665"></a>00665 <span class="comment">                        if( defined $checkboxAns{$label}[0] ) {</span>
<a name="l00666"></a>00666 <span class="comment">                            $nextCheckboxAns = shift @{$checkboxAns{$label}};</span>
<a name="l00667"></a>00667 <span class="comment">                            if( $line !~ s|VALUE\s*=\s*&quot;$nextCheckboxAns&quot;|VALUE = &quot;$nextCheckboxAns&quot; CHECKED|i ) {</span>
<a name="l00668"></a>00668 <span class="comment">                                unshift( @{$checkboxAns{$label}}, $nextCheckboxAns );       #put the unused answer back on the list</span>
<a name="l00669"></a>00669 <span class="comment">                            }</span>
<a name="l00670"></a>00670 <span class="comment">                        }</span>
<a name="l00671"></a>00671 <span class="comment">                    }</span>
<a name="l00672"></a>00672 <span class="comment">                    else {</span>
<a name="l00673"></a>00673 <span class="comment">                         # we&#39;ll assume this is something else, like one or more fields.</span>
<a name="l00674"></a>00674 <span class="comment">                         # if it&#39;s several fields, we need to take only one answer at a time</span>
<a name="l00675"></a>00675 <span class="comment">                         # \0 are used to delimeter between entries.</span>
<a name="l00676"></a>00676 <span class="comment">                         if ($submittedAnswers{$label} =~ /\0/ ) {</span>
<a name="l00677"></a>00677 <span class="comment">                                my @answers = split(&quot;\0&quot;, $submittedAnswers{$label});</span>
<a name="l00678"></a>00678 <span class="comment">                                $answer_value = shift(@answers);  # use up the first answer</span>
<a name="l00679"></a>00679 <span class="comment">                                $submittedAnswers{$label}=join &quot;\0&quot;, @answers;  # store the rest</span>
<a name="l00680"></a>00680 <span class="comment">                                $answer_value= &#39;&#39; unless defined($answer_value);</span>
<a name="l00681"></a>00681 <span class="comment"></span>
<a name="l00682"></a>00682 <span class="comment">                          }</span>
<a name="l00683"></a>00683 <span class="comment">                          else {</span>
<a name="l00684"></a>00684 <span class="comment">                          $answer_value = $submittedAnswers{$label};</span>
<a name="l00685"></a>00685 <span class="comment">                        }</span>
<a name="l00686"></a>00686 <span class="comment"></span>
<a name="l00687"></a>00687 <span class="comment">                        $line =~ s|VALUE\s*=\s*&quot;&quot;|VALUE = &quot;$answer_value&quot;|i;</span>
<a name="l00688"></a>00688 <span class="comment">                    }</span>
<a name="l00689"></a>00689 <span class="comment">                }</span>
<a name="l00690"></a>00690 <span class="comment">            }</span>
<a name="l00691"></a>00691 <span class="comment">        }                                   #end if test for &quot;&lt;INPUT&quot;</span>
<a name="l00692"></a>00692 <span class="comment"></span>
<a name="l00693"></a>00693 <span class="comment">        $output .= $line;</span>
<a name="l00694"></a>00694 <span class="comment">    }                                       #end foreach</span>
<a name="l00695"></a>00695 <span class="comment"></span>
<a name="l00696"></a>00696 <span class="comment">    @printLines = split( m|$placeholder|, $output );</span>
<a name="l00697"></a>00697 <span class="comment">    return @printLines;</span>
<a name="l00698"></a>00698 <span class="comment">}                                           #end l2h_sticky_answers()</span>
<a name="l00699"></a>00699 <span class="comment"></span>
<a name="l00700"></a>00700 <span class="comment">## This is the old system (but newer than the one below).</span>
<a name="l00701"></a>00701 <span class="comment">## It has been replaced for two reasons:</span>
<a name="l00702"></a>00702 <span class="comment">## 1) It is complicated and difficult to understand or modify</span>
<a name="l00703"></a>00703 <span class="comment">## 2) It does not work for several situations that rarely come up,</span>
<a name="l00704"></a>00704 <span class="comment">##    but must be handled properly. Specifically, it doesn&#39;t handle</span>
<a name="l00705"></a>00705 <span class="comment">##    text with more than one &lt;INPUT&gt; tag on a given line very well.</span>
<a name="l00706"></a>00706 <span class="comment">##    there are probably other problems, but that is the biggest.</span>
<a name="l00707"></a>00707 <span class="comment">##                                                              --DME 6/7/2000</span>
<a name="l00708"></a>00708 <span class="comment">#       # the following doubly nested loop iterates over each line,</span>
<a name="l00709"></a>00709 <span class="comment">#       # and for each line searches for each answer label. Technically,</span>
<a name="l00710"></a>00710 <span class="comment">#       # it might have been faster to join each entry in @printlines</span>
<a name="l00711"></a>00711 <span class="comment">#       # into one string, search on that, and split it back up, but I</span>
<a name="l00712"></a>00712 <span class="comment">#       # felt that the slight theoretical speed gain was not worth the</span>
<a name="l00713"></a>00713 <span class="comment">#       # added complexity.</span>
<a name="l00714"></a>00714 <span class="comment">#       warn &quot;answerLabels = @answerLabels&quot;;    #DEBUG</span>
<a name="l00715"></a>00715 <span class="comment">#       foreach $line ( @printLines ) {</span>
<a name="l00716"></a>00716 <span class="comment">#           warn &quot;Line is $line&quot;;       #DEBUG</span>
<a name="l00717"></a>00717 <span class="comment">#           foreach $label ( @answerLabels ) {</span>
<a name="l00718"></a>00718 <span class="comment">#               if( $line =~ m|&lt;INPUT TYPE=TEXT.*NAME=&quot;$label| ) {</span>
<a name="l00719"></a>00719 <span class="comment">#                   while ($line =~ /VALUE = &quot;&quot;/) {</span>
<a name="l00720"></a>00720 <span class="comment">#                       # Put trailing space in displayed answer so that while loop will</span>
<a name="l00721"></a>00721 <span class="comment">#                       # always end.  We are using the form of the s/// operator which</span>
<a name="l00722"></a>00722 <span class="comment">#                       # evaluates its right hand side</span>
<a name="l00723"></a>00723 <span class="comment">#                       $line =~ s|NAME=&quot;$label&quot; VALUE = &quot;&quot;|</span>
<a name="l00724"></a>00724 <span class="comment">#                           $counter++;</span>
<a name="l00725"></a>00725 <span class="comment">#                           $submittedAnswers[$counter]=&quot; &quot; unless defined ($submittedAnswers[$counter])</span>
<a name="l00726"></a>00726 <span class="comment">#                               &amp;&amp; not $submittedAnswers[$counter] =~ /^\s*$/;</span>
<a name="l00727"></a>00727 <span class="comment">#                           qq{ NAME=&quot;$label&quot; VALUE = &quot;$submittedAnswers[$counter]&quot; } |e;</span>
<a name="l00728"></a>00728 <span class="comment">#                       # This insures that in VALUE = &quot;$submittedAnswers[$counter]&quot;</span>
<a name="l00729"></a>00729 <span class="comment">#                       # the quantity $submittedAnswers[$counter]</span>
<a name="l00730"></a>00730 <span class="comment">#                       # is never empty. This is required in order to terminate the loop.</span>
<a name="l00731"></a>00731 <span class="comment">#                   }                               #end while</span>
<a name="l00732"></a>00732 <span class="comment">#                   push( @output, $line );</span>
<a name="l00733"></a>00733 <span class="comment">#               }                                   #end if</span>
<a name="l00734"></a>00734 <span class="comment">#               else {</span>
<a name="l00735"></a>00735 <span class="comment">#                   push( @output, $line );</span>
<a name="l00736"></a>00736 <span class="comment">#               }</span>
<a name="l00737"></a>00737 <span class="comment">#           }                                       #end foreach over @answerLabels</span>
<a name="l00738"></a>00738 <span class="comment">#       }                                           #end foreach over @printLines</span>
<a name="l00739"></a>00739 <span class="comment">#</span>
<a name="l00740"></a>00740 <span class="comment">#       @printLines = @output;</span>
<a name="l00741"></a>00741 <span class="comment">#   }                                               #end outer if</span>
<a name="l00742"></a>00742 <span class="comment">#</span>
<a name="l00743"></a>00743 <span class="comment">#   return @printLines;</span>
<a name="l00744"></a>00744 <span class="comment"># }                                                 #end l2h_sticky_answers()</span>
<a name="l00745"></a>00745 <span class="comment"></span>
<a name="l00746"></a>00746 <span class="comment">##subroutine that makes answers sticky in l2h mode</span>
<a name="l00747"></a>00747 <span class="comment"># this is an old version of this routine, which assumes (incorrectly)</span>
<a name="l00748"></a>00748 <span class="comment"># that answer labels begin with &quot;AnSwEr&quot;. I&#39;ve left it here just in case...</span>
<a name="l00749"></a>00749 <span class="comment"># DME 6/6/2000</span>
<a name="l00750"></a>00750 <span class="comment">#sub l2h_sticky_answers {</span>
<a name="l00751"></a>00751 <span class="comment">#   my ($refSubmittedAnswers, $refprintlines)=@_;</span>
<a name="l00752"></a>00752 <span class="comment">#   my @printlines=@$refprintlines;</span>
<a name="l00753"></a>00753 <span class="comment">#   if ((@{$refSubmittedAnswers}!=0)) {</span>
<a name="l00754"></a>00754 <span class="comment">#       my $line;</span>
<a name="l00755"></a>00755 <span class="comment">#       my @output=();</span>
<a name="l00756"></a>00756 <span class="comment">#       foreach $line (@printlines)     {</span>
<a name="l00757"></a>00757 <span class="comment">#           if  ($line =~ m|&lt;INPUT TYPE=TEXT.*NAME=&quot;AnSwEr|)    {</span>
<a name="l00758"></a>00758 <span class="comment">#               #print &quot;&lt;P&gt;line doesn&#39;t exists&lt;P&gt;\n&quot; unless defined($line);</span>
<a name="l00759"></a>00759 <span class="comment">#               while ($line =~ /VALUE = &quot;&quot;/) {</span>
<a name="l00760"></a>00760 <span class="comment">#                   ## Put trailing space in displayed answer so that while loop will</span>
<a name="l00761"></a>00761 <span class="comment">#                   ## always end.  We are using the form of the s/// operator which evaluates its right hand side</span>
<a name="l00762"></a>00762 <span class="comment">#                   $line =~ s|NAME=&quot;AnSwEr(\d*)&quot; VALUE = &quot;&quot;|</span>
<a name="l00763"></a>00763 <span class="comment">#                       my $tttemp = $1;</span>
<a name="l00764"></a>00764 <span class="comment">#                       ${$refSubmittedAnswers}[$tttemp-1]=&quot; &quot; unless defined (${$refSubmittedAnswers}[$tttemp-1])</span>
<a name="l00765"></a>00765 <span class="comment">#                           &amp;&amp;  not ${$refSubmittedAnswers}[$tttemp-1] =~ /^\s*$/;</span>
<a name="l00766"></a>00766 <span class="comment">#</span>
<a name="l00767"></a>00767 <span class="comment">#                       qq{ NAME=&quot;AnSwEr$tttemp&quot; VALUE = &quot;${$refSubmittedAnswers}[$tttemp-1]&quot; } |e;</span>
<a name="l00768"></a>00768 <span class="comment">#                   # This insures that in VALUE = &quot;${$refSubmittedAnswers}[$tttemp-1]&quot; the quantity ${$refSubmittedAnswers}[$tttemp-1]</span>
<a name="l00769"></a>00769 <span class="comment">#                   # is never empty.  This is required in order to terminate the loop.</span>
<a name="l00770"></a>00770 <span class="comment">#               }</span>
<a name="l00771"></a>00771 <span class="comment">#               push(@output, $line);</span>
<a name="l00772"></a>00772 <span class="comment">#           }</span>
<a name="l00773"></a>00773 <span class="comment">#           else {</span>
<a name="l00774"></a>00774 <span class="comment">#               push(@output, $line);</span>
<a name="l00775"></a>00775 <span class="comment">#           }</span>
<a name="l00776"></a>00776 <span class="comment">#       }</span>
<a name="l00777"></a>00777 <span class="comment">#</span>
<a name="l00778"></a>00778 <span class="comment">#       @printlines = @output;</span>
<a name="l00779"></a>00779 <span class="comment">#   }</span>
<a name="l00780"></a>00780 <span class="comment">#</span>
<a name="l00781"></a>00781 <span class="comment">#   @printlines;</span>
<a name="l00782"></a>00782 <span class="comment">#}</span>
<a name="l00783"></a>00783 <span class="comment"></span>
<a name="l00784"></a>00784 <span class="comment">##subroutine that updates current keys in the l2h mode</span>
<a name="l00785"></a>00785 <span class="comment"></span>
<a name="l00786"></a>00786 <span class="comment"># sub l2h_update_keys {</span>
<a name="l00787"></a>00787 <span class="comment">#         my ($sessionKey, $refprintlines)= @_;</span>
<a name="l00788"></a>00788 <span class="comment">#         my @printlines=@$refprintlines;</span>
<a name="l00789"></a>00789 <span class="comment">#         my $line;</span>
<a name="l00790"></a>00790 <span class="comment">#         my @output=();</span>
<a name="l00791"></a>00791 <span class="comment">#   #my $sessionKey = $main::sessionKey;</span>
<a name="l00792"></a>00792 <span class="comment">#   warn &quot;hi lines = &quot;,join(&quot;&quot;,@printlines);</span>
<a name="l00793"></a>00793 <span class="comment">#       foreach $line (@printlines)     {</span>
<a name="l00794"></a>00794 <span class="comment">#       if  ($line =~ m|^\s*&lt;A(.*?)\&amp;key=[^&amp;]*&amp;user|)   {  #&lt;A.*&amp;key=.*?&amp;user</span>
<a name="l00795"></a>00795 <span class="comment">#           #grab the session key from the CGI input or make it blank</span>
<a name="l00796"></a>00796 <span class="comment">#           $line =~ s|^\s*&lt;A(.*?)&amp;key=[^&amp;]*&amp;user|&lt;A$1&amp;key=$sessionKey&amp;user|;</span>
<a name="l00797"></a>00797 <span class="comment">#           warn &quot;line = $line&lt;BR&gt;&quot;;</span>
<a name="l00798"></a>00798 <span class="comment">#           push(@output, $line);</span>
<a name="l00799"></a>00799 <span class="comment">#       }else{</span>
<a name="l00800"></a>00800 <span class="comment">#           push(@output, $line);</span>
<a name="l00801"></a>00801 <span class="comment">#       }</span>
<a name="l00802"></a>00802 <span class="comment">#</span>
<a name="l00803"></a>00803 <span class="comment">#         }</span>
<a name="l00804"></a>00804 <span class="comment">#         @printlines;</span>
<a name="l00805"></a>00805 <span class="comment">#</span>
<a name="l00806"></a>00806 <span class="comment"># }</span>
<a name="l00807"></a>00807 <span class="comment"></span>
<a name="l00808"></a>00808 <span class="comment"></span>
<a name="l00809"></a>00809 <span class="comment">sub makeL2H {</span>
<a name="l00810"></a>00810 <span class="comment">    my ($TMPPROBDIR,$psvn) =@_;</span>
<a name="l00811"></a>00811 <span class="comment">    $ENV{PATH} .= &quot;$Global::extendedPath&quot;;</span>
<a name="l00812"></a>00812 <span class="comment">    if($Global::externalLaTeX2HTMLVersion eq &quot;98.1p1&quot;) {</span>
<a name="l00813"></a>00813 <span class="comment">        system(&quot;$Global::externalLaTeX2HTMLPath -no_math -init_file $Global::externalLaTeX2HTMLInit -dir $TMPPROBDIR -prefix $psvn $TMPPROBDIR${psvn}output.tex &gt; $TMPPROBDIR${psvn}l2h.log 2&gt;&amp;1&quot;);</span>
<a name="l00814"></a>00814 <span class="comment">    } elsif($Global::externalLaTeX2HTMLVersion eq &quot;96.1&quot;) {</span>
<a name="l00815"></a>00815 <span class="comment">        system(&quot;$Global::externalLaTeX2HTMLPath -init_file $Global::externalLaTeX2HTMLInit -dir $TMPPROBDIR -prefix $psvn $TMPPROBDIR${psvn}output.tex &gt; $TMPPROBDIR${psvn}l2h.log&quot;);</span>
<a name="l00816"></a>00816 <span class="comment">    } else {</span>
<a name="l00817"></a>00817 <span class="comment">        die &quot;Unknown LaTeX2HTML version: \$Global::externalLaTeX2HTMLVersion = $Global::externalLaTeX2HTMLVersion&quot;;</span>
<a name="l00818"></a>00818 <span class="comment">    }</span>
<a name="l00819"></a>00819 <span class="comment">}</span>
<a name="l00820"></a>00820 <span class="comment"></span>
<a name="l00821"></a>00821 <span class="comment">1;</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jun 8 22:54:55 2012 for PG by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
